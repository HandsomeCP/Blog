<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": true,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "天验",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "华为云",
            "enable": false,
            "url": "https://activity.huaweicloud.com/2020_618_promotion/index.html?bpName=5f9f98a29e2c40b780c1793086f29fe2&bindType=1&salesID=wangyubei",
            "src": "https://qiniu.cuiqingcai.com/y42ik.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "张小鸡",
            "enable": false,
            "url": "http://www.zxiaoji.com/",
            "src": "https://qiniu.cuiqingcai.com/fm72f.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "Luminati",
            "src": "https://qiniu.cuiqingcai.com/ikkq9.jpg",
            "url": "https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095",
            "width": "100%",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/10/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="崔庆才">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="PHP">
  <meta property="article:tag" content="Java">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Spider">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Web">
  <meta property="article:tag" content="Kubernetes">
  <meta property="article:tag" content="深度学习">
  <meta property="article:tag" content="机器学习">
  <meta property="article:tag" content="数据分析">
  <meta property="article:tag" content="网络">
  <meta property="article:tag" content="IT">
  <meta property="article:tag" content="技术">
  <meta property="article:tag" content="博客">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/10/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://cuiqingcai.com/5052.html"><img title="Python3网络爬虫开发实战教程" src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/1052.html"><img title="Python2爬虫学习系列教程" src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 20 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6509.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6509.html" class="post-title-link" itemprop="url">如何使用 SSH 控制连接 Windows 服务器</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>入职微软之后，这边大多数是使用 Windows 进行开发的，比如我的台式机是 Windows 的，还有一部分服务器是 Windows 的，当然 Linux 是也非常多。 很多情况下我是使用自己的 Mac 笔记本来远程连接我的 Windows 机器来开发的。比如如果我在工位上，我会用我的 Mac 连接两块显示屏，然后一种一块用来远程桌面连接我的 Windows 开发机，这样另外一块屏幕和 Mac 自带的屏幕就用来看文档或者使用 Teams 通讯等等。如果我回家了，我家里也是有两块屏，开上 VPN，照样用一块屏使用远程桌面，另外一块屏幕和 Mac 自带屏幕就可以做其他事情了。 这样就解决了一个问题：我的 Windows 基本上都是仅用作开发的，一块屏幕就开着一个 Visual Studio，其他的操作都会在 Mac 进行，比如查文档，发消息等等。这样我下班之后照样使用远程连接的方式来操作，和在公司就是一样的。这样就避免了一些软件的来回登录，比如如果我上班只用公司机器，下班了之后换了 Mac 还得切 Teams、切微信、切浏览器等等，还是很麻烦的，而且上班期间 Mac 就闲置了也不好。所以我就采取了这样的开发方案。</p>
                  <h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2>
                  <p>有了这个情景，就引入了一个问题。开了一个远程桌面之后，我几乎一个屏幕都是被 Visual Studio 占据的，而远程桌面貌似只能开一个屏幕？如果我要再开一个终端窗口的话，那可能屏幕就不太够用了，或者它就得覆盖我的全屏 Visual Stuido。 另外我平时 Mac 终端软件都是使用 SSH 的，基本都是用来连 Linux 的，Windows 一般都是开远程桌面。但命令行这个情形的确让我头疼，让我感到不够爽，因为毕竟远程桌面之后，Windows 里面的操作都得挤在一个桌面里面操作了。当然可能能设置多个桌面，如果可以的话，麻烦大家告知一下谢谢。 所以解决的痛点在于：我要把一些操作尽量从 Windows 里面分离出来，例如终端软件，我能否在远程桌面外面操作，能否使用 SSH 来控制我的 Windows 机器。 好，有需求才有动力，说干就干。</p>
                  <h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2>
                  <p>查了一下，Windows 上其实也是有 SSH 服务器的，只不过默认是没有装的，这里只需要安装一个 OpenSSH 服务器就好了。 Win10 的话，就在设置里面可以安装，从开始菜单打开“设置”，然后选择应用和功能，这里就有一个“管理可选功能”的选项。 <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g17uv5tf19j30xb0puwm9.jpg" alt="image-20190319093941643"> 点击之后便可以看到一个可选功能，选择 OpenSSH 服务器即可，一般情况下是没有安装的。如果没有安装的话它会提示一个安装按钮，这里我已经安装好了，就提示了一个卸载按钮。 <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g17uwoakpij30x70pv0u6.jpg" alt="image-20190319094113033"> OK，有了它，直接点击安装即可完成 OpenSSH 服务器的安装。 当然如果你是想批量部署 Windows 服务器的话，当然是推荐使用 PowerShell 来自动化部署了。 首先需要用管理员身份启动 PowerShell，使用如下命令看一下，要确保 OpenSSH 可用于安装：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Get</span>-WindowsCapability -Online | ? <span class="type">Name</span> -<span class="keyword">like</span> <span class="string">'OpenSSH*'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出应该是类似的结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">Name</span>  : <span class="selector-tag">OpenSSH</span><span class="selector-class">.Client</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br><span class="line"><span class="selector-tag">State</span> : <span class="selector-tag">NotPresent</span></span><br><span class="line"><span class="selector-tag">Name</span>  : <span class="selector-tag">OpenSSH</span><span class="selector-class">.Server</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br><span class="line"><span class="selector-tag">State</span> : <span class="selector-tag">NotPresent</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 PowerShell 安装服务器即可：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">Add-WindowsCapability</span> <span class="selector-tag">-Online</span> <span class="selector-tag">-Name</span> <span class="selector-tag">OpenSSH</span><span class="selector-class">.Server</span>~~~~0<span class="selector-class">.0</span><span class="selector-class">.1</span><span class="selector-class">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果类似：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Path          :</span></span><br><span class="line"><span class="attr">Online        :</span> <span class="literal">True</span></span><br><span class="line"><span class="attr">RestartNeeded :</span> <span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样也可以完成 OpenSSH 的安装。 安装完成之后，就需要进行一些初始化配置了，还是以管理员身份，使用 PowerShell 执行即可。 首先需要开启 SSHD 服务：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="literal">Start</span>-Service sshd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后设置服务的自动启动：</p>
                  <figure class="highlight delphi">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Set</span>-Service -<span class="keyword">Name</span> sshd -StartupType <span class="string">'Automatic'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后确认一下防火墙是否是放开的：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Get</span>-NetFirewallRule -<span class="type">Name</span> *ssh*</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果是放开的，那么结果会提示 <code>OpenSSH-Server-In-TCP</code>这个状态是 enabled。 好了，完成如上操作之后我们就可以使用 SSH 来连接我们的 Windows 服务器了。</p>
                  <h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2>
                  <p>连接非常简单了，用户名密码就是 Windows 的用户名和密码，使用 IP 地址链接即可。 比如我的 Windows 开发机的局域网 IP 为：10.172.134.88，那么就可以使用如下命令完成链接：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh <span class="symbol">user@</span><span class="number">10.172</span><span class="number">.134</span><span class="number">.88</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后输入密码，就连接成功了，和 Linux 的是一样的。 另外我自己现在 Mac 常用的 SSH 客户端工具有 Termius，可以多终端同步使用，非常方便，这里我只需要添加我的 Windows 机器就好了，如图所示： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g17vz64duxj30zk0m8gn6.jpg" alt="image-20190319101812208"> OK，以后就可以非常轻松地用 SSH 连接我的 Windows 服务器了，爽歪歪，上面的需求也成功解决。 以上便是使用 SSH 来连接 Windows 服务器的方法，如果大家有需求可以试试。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-03-25 02:33:31" itemprop="dateCreated datePublished" datetime="2019-03-25T02:33:31+08:00">2019-03-25</time>
                </span>
                <span id="/6509.html" class="post-meta-item leancloud_visitors" data-flag-title="如何使用 SSH 控制连接 Windows 服务器" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6462.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6462.html" class="post-title-link" itemprop="url">程序猿的情人节怎么过？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>都说程序猿是一类不解风情的生物，“赚的多，花的少，死的早”已经成为了程序猿的标志，“眼镜、格子衫、垢面蓬头、拖鞋裤衩”已然也成了程序猿的代表形象，“代码、游戏、老湿”也已经快要成了程序猿的生命。 但！有的时候，比如情人节，我们就可以发挥我们的特长了，我们程序猿也可以有自己的浪漫！ 不过这个第一步是，你得有一个女朋友（哦哦，是不是可以不用往下看了？ 那么有了第一步之后，下面我们应该怎么办呢？ 下面介绍一个比较实用的可以送给女朋友的礼物（这其实也是我今天送给女朋友的礼物嘿嘿。 首先想想，作为程序猿，我们的专长是什么？废话，当然是代码。 有了代码，还需要送口红吗？还需要送包包吗？还需要送鲜花吗？废话，都有了代码了，这些当然就….还是要送的。万一写的代码你女朋友看不懂那岂不是死翘翘了。 好那送完了口红或包包或鲜花之后，确保已经平安无事了，我们就可以再发挥我们的光和热了（听起来咋这么奇怪呢？ 进入正题，那我们可以利用代码做点什么呢？想想可以做文章的地方有什么，你们的纪念日，你们曾经做过的事情，你们在一起的时间，这些都是属于你们的独一无二的，我们可以想方设法把它们和代码联系起来。 那怎么发给女朋友看呢？做个 App、小程序、网页什么的都是可以的吧，其中网页可能是做起来最快最方便的了，然后配上一个专属域名，简直美滋滋。 好，那一想，基本方向就确定了，直接开干，接下来就描述一下我准备这个礼物的历程吧。 对于我来说，我就计划做一个网页，同时用代码的形式把和女朋友在一起的时间呈现出来，通过网页的动效来呈现我们在一起的时间，另外还计划把我们之间的故事用代码关联表示出来。 本来我打算是从零开始手撸一个的，但是一些组件比如动画特效，还有一些倒计时的组件是相对比较难做的，于是我就在 GitHub 上逛了一下，看了几个示例，找到了一个和我理想作品差不多的项目，然后在它的基础上做了一些改动，就成了最终的效果。 主要功能如下：</p>
                  <ul>
                    <li>第一是通过代码来表述出来和女朋友之间的故事。由于我和女朋友是因为 Python 认识的，而且我们两个平时都会写一些 Python，所以我决定用 Python 来写出我们之间的故事，加上 Python 的注释来辅助描述每一行代码的意义。</li>
                    <li>第二是通过代码来呈现我和女朋友在一起的时间。这里就用上了一些动画特效和秒数计时方案，实时地呈现出来我和女朋友在一起已经有多久了。</li>
                  </ul>
                  <p>最终完成之后的效果是这样子的： <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g062do1uo8j31al0u0axr.jpg" alt="预览图"> 然后由于我自己有一个域名，叫做 cuiqingcai.com，然后我就把它设置了二级域名解析，二级域名名称就叫做 love，域名最终就是 love.cuiqingcai.com。 最终的效果大家可以扫码或者复制链接查看一下最终的效果：<a href="http://love.cuiqingcai.com/，二维码如下：" target="_blank" rel="noopener">http://love.cuiqingcai.com/，二维码如下：</a> <img src="https://ws1.sinaimg.cn/large/006tKfTcly1g064wqfgqvj30ea0eadg5.jpg" alt="二维码"> 感觉还可以吧？如果你也想送这样的礼物的话，可以根据我现有的代码来进行修改，我已经将源码放到 GitHub 了，地址为：<a href="https://github.com/Germey/ValentinesDay，大家可以修改源码，把它变成属于你和你女朋友的专属页面，然后送给女朋友。" target="_blank" rel="noopener">https://github.com/Germey/ValentinesDay，大家可以修改源码，把它变成属于你和你女朋友的专属页面，然后送给女朋友。</a> 下面说一些关键的技术和需要修改的点。</p>
                  <h2 id="代码动画"><a href="#代码动画" class="headerlink" title="代码动画"></a>代码动画</h2>
                  <p>打开页面之后，我们可以看到页面的代码是一个字一个字敲出来的，这实际上是利用了一个定时器来实现的。 首先我们可以预定义好所有的文本，然后动画播放的时候，首先把所有的文本隐藏，然后每隔几十毫秒读取一个字符，然后将其呈现出来。由于文本本身就是换行的，所以在呈现的时候就会一行一行地像打字机一样呈现出来。 另外为了模拟打字的效果，在呈现的时候可以在最后的字符后面添加一个下划线符号，模拟打字的效果。 其关键的实现代码如下：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="name">function</span> (<span class="name">a</span>) &#123;</span><br><span class="line">    a.fn.typewriter = function () &#123;</span><br><span class="line">        this.each(<span class="name">function</span> () &#123;</span><br><span class="line">            var d = a(<span class="name">this</span>), c = d.html(), b = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">            d.html(<span class="string">""</span>)<span class="comment">;</span></span><br><span class="line">            var e = setInterval(<span class="name">function</span> () &#123;</span><br><span class="line">                var f = c.substr(<span class="name">b</span>, <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">                if (<span class="name">f</span> == <span class="string">"&lt;"</span>) &#123;</span><br><span class="line">                    b = c.indexOf(<span class="string">"&gt;"</span>, b) + <span class="number">1</span></span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    b++</span><br><span class="line">                &#125;</span><br><span class="line">                d.html(<span class="name">c.substring</span>(<span class="number">0</span>, b) + (<span class="name">b</span> &amp; <span class="number">1</span> ? <span class="string">"_"</span> : <span class="string">""</span>))<span class="comment">;</span></span><br><span class="line">                if (<span class="name">b</span> &gt;= c.length) &#123;</span><br><span class="line">                    clearInterval(<span class="name">e</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">75</span>)</span><br><span class="line">        &#125;)<span class="comment">;</span></span><br><span class="line">        return this</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="name">jQuery</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里可以看到，首先获取了页面代码区域的内容，然后通过 DOM 操作将代码先清空，然后利用 setInterval 方法设置一个定时器，定时间隔 75 毫秒，也就是说 75 毫秒循环调用一次。每调用一次，就会从原来的字符上多取一个字符，然后尾部拼接一个下划线就好了。</p>
                  <h2 id="代码内容"><a href="#代码内容" class="headerlink" title="代码内容"></a>代码内容</h2>
                  <p>接下来就是代码内容了，这里面要想好怎样把一些关键时间来表示出来。比如和女朋友怎样认识的，后来什么时间在一起的，一起做过什么事情，将来有什么计划和打算，都可以来描述出来，另外编程语言可以选择你喜欢的语言，然后配以一定的注释来描述代码所代表的含义。 我和女朋友是在 PyCon 认识的，也算是因为 Python 结缘，然后平时我们都会写一些 Python，所以我就选用 Python 作为编程语言了。 然后我又加上了我们认识的时间、在一起的时间、一起做过的事情，然后再配以一段代码来表达自己的想法，其中的一些灵感也是我看了一些案例想出来的，在表述过程中我使用了面向对象的思维声明了两个对象，一个代表我，一个代表我女朋友，然后一起做过的事情就可以通过对象调用方法的形式来表述出来了，另外一些动作和标志可以通过自定义方法或者代码的参数来表示出来，其中每一行代码的动作我都配以一条 Python 的注释来完成，注释当然是用英文，一些话我还用了翻译软件一句句查的。 然后最后我用了一段 Python 代码来表达了自己的感情，内容如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># You are the greatest love of my life.</span></span><br><span class="line"><span class="attr">while</span> <span class="string">True:</span></span><br><span class="line">    <span class="attr">if</span> <span class="string">u.with(i):</span></span><br><span class="line">        <span class="attr">you</span> = <span class="string">everything</span></span><br><span class="line">    <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">        <span class="attr">everything</span> = <span class="string">u</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个代码的含义叫做“无论天涯海角，你都是我的一切。“，一个 while True 循环代表了永久。 这些代码其实都是在 HTML 代码中预定义好的，其中注释需要用 span 标签配以 comments 的 class 来修饰，缩进需要用 span 标签配以 placeholder 的 class 来修饰，例如：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"comments"</span>&gt;</span># You are the greatest love of my life.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">while <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>True<span class="tag">&lt;/<span class="name">span</span>&gt;</span>:<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>if<span class="tag">&lt;/<span class="name">span</span>&gt;</span> u.with(i):<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>you = everything<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"keyword"</span>&gt;</span>else<span class="tag">&lt;/<span class="name">span</span>&gt;</span>:<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>everything = u<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里不同的格式用 span 的不同 class 来标识，空格缩进一个 placeholder 是两个空格，comments 代表注释格式，关键词使用 keyword 来标识。如果你需要自定义自己的内容，通过控制这些内容穿插写入就好了。</p>
                  <h2 id="纪念日计时"><a href="#纪念日计时" class="headerlink" title="纪念日计时"></a>纪念日计时</h2>
                  <p>关于纪念日，这个实现起来其实挺简单的，就是首先定义好你们的纪念日，然后获取当前系统时间，然后计算秒数差值，然后将其转化为天数、小时数即可，关键核心代码实现如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeElapse</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> f = (<span class="built_in">Date</span>.parse(e) - <span class="built_in">Date</span>.parse(c)) / <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">var</span> g = <span class="built_in">Math</span>.floor(f / (<span class="number">3600</span> * <span class="number">24</span>));</span><br><span class="line">    f = f % (<span class="number">3600</span> * <span class="number">24</span>);</span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">Math</span>.floor(f / <span class="number">3600</span>);</span><br><span class="line">    <span class="keyword">if</span> (b &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        b = <span class="string">"0"</span> + b</span><br><span class="line">    &#125;</span><br><span class="line">    f = f % <span class="number">3600</span>;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="built_in">Math</span>.floor(f / <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">if</span> (d &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        d = <span class="string">"0"</span> + d</span><br><span class="line">    &#125;</span><br><span class="line">    f = f % <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">if</span> (f &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        f = <span class="string">"0"</span> + f</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外它也是通过一个定时器来实现的时间刷新，每隔 500 毫秒调用一次：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">setInterval(<span class="name">function</span> () &#123;</span><br><span class="line">    timeElapse(<span class="name">together</span>)<span class="comment">;</span></span><br><span class="line">&#125;, <span class="number">500</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="动画心形"><a href="#动画心形" class="headerlink" title="动画心形"></a>动画心形</h2>
                  <p>动画心形，其实这个实现起来是很巧妙的。这里在画的时候实际上是利用了贝塞尔曲线来绘制一个心形，同时在在画的过程中还加了花开的效果，花开的效果使用了随机数和随机颜色生成。 其中动画画心形的核心代码如下：</p>
                  <figure class="highlight kotlin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Petal.prototype = &#123;</span><br><span class="line">    draw: function () &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="keyword">this</span>.bloom.garden.ctx;</span><br><span class="line">        <span class="keyword">var</span> e, d, c, b;</span><br><span class="line">        e = new Vector(<span class="number">0</span>, <span class="keyword">this</span>.r).rotate(Garden.degrad(<span class="keyword">this</span>.startAngle));</span><br><span class="line">        d = e.clone().rotate(Garden.degrad(<span class="keyword">this</span>.angle));</span><br><span class="line">        c = e.clone().mult(<span class="keyword">this</span>.stretchA);</span><br><span class="line">        b = d.clone().mult(<span class="keyword">this</span>.stretchB);</span><br><span class="line">        a.strokeStyle = <span class="keyword">this</span>.bloom.c;</span><br><span class="line">        a.beginPath();</span><br><span class="line">        a.moveTo(e.x, e.y);</span><br><span class="line">        a.bezierCurveTo(c.x, c.y, b.x, b.y, d.x, d.y);</span><br><span class="line">        a.stroke()</span><br><span class="line">    &#125;, render: function () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.r &lt;= <span class="keyword">this</span>.bloom.r) &#123;</span><br><span class="line">            <span class="keyword">this</span>.r += <span class="keyword">this</span>.growFactor;</span><br><span class="line">            <span class="keyword">this</span>.draw()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.isfinished = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里最关键的一个部分就是 bezierCurveTo，这里传入的是绘制贝塞尔曲线的参数坐标，那这些坐标怎么生成的呢，这里是利用了数学上的一个桃心线方程，如图所示： <img src="https://ws3.sinaimg.cn/large/006tKfTcly1g06493zp47j30x30u0h2f.jpg" alt="贝塞尔曲线"> 其中心形线的解析方程为： <script type="math/tex">x = 16(sint)^3 \\ y = 13cost-5cos2t-2cos3t-cos4t</script> 这个公式代表了绘制坐标点的 x、y 的解析方程，用代码表示出来就是：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> get<span class="constructor">HeartPoint(<span class="params">c</span>)</span> &#123;</span><br><span class="line">    var b = c<span class="operator"> / </span>Math.PI;</span><br><span class="line">    var a = <span class="number">19.5</span><span class="operator"> * </span>(<span class="number">16</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>pow(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>sin(b), <span class="number">3</span>));</span><br><span class="line">    var d = -<span class="number">20</span><span class="operator"> * </span>(<span class="number">13</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(b) - <span class="number">5</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">2</span><span class="operator"> * </span>b) - <span class="number">2</span><span class="operator"> * </span><span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">3</span><span class="operator"> * </span>b) - <span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>cos(<span class="number">4</span><span class="operator"> * </span>b));</span><br><span class="line">    return <span class="keyword">new</span> <span class="constructor">Array(<span class="params">offsetX</span> + <span class="params">a</span>, <span class="params">offsetY</span> + <span class="params">d</span>)</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是生产了心形线方程的 x、y 坐标，然后再以此绘制出带有动画效果的心形。 最终呈现的效果就是现在你看到的样子。 不过这些在改代码的时候实际上不用关心，只需要修改你们在一起的时间就好了，就是代码中的这一行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">together.setFullYear(<span class="number">2018</span>, <span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">together.setHours(<span class="number">15</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里修改你们在一起的时间和小时就可以了，然后页面就会自动更新你们在一起多久了，并动态呈现出来了。</p>
                  <h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2>
                  <p>对于域名解析，这个建议大家可以申请一个域名，比如我的域名就是 cuiqingcai.com，我可以设置一个二级域名解析，叫做 love.cuiqingcai.com。 如果没有域名的话可以现买一个，比如阿里云、腾讯云购买，然后设置解析即可。 如果没有域名，也可以使用一些虚拟云服务器，他们会帮你设置二级域名，当然也可以使用 GitHub Pages，甚至你使用 IP 地址来访问也是没问题的。</p>
                  <h2 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h2>
                  <p>项目的代码我都放在了：<a href="https://github.com/Germey/ValentinesDay，大家可以自行修改成想要的样子送给女朋友，只能帮你到这里啦。" target="_blank" rel="noopener">https://github.com/Germey/ValentinesDay，大家可以自行修改成想要的样子送给女朋友，只能帮你到这里啦。</a> 嘿嘿，这就是我今天送给女朋友的礼物，女朋友收到了开心得不得了，开心。</p>
                  <h2 id="我的礼物"><a href="#我的礼物" class="headerlink" title="我的礼物"></a>我的礼物</h2>
                  <p>其实我今天也收到了女朋友送的特殊的礼物，可以说她确实花了不少心思啊，她送了我什么呢？令我没想到的是，她居然刚申请了一个微店，然后她微店上架了好多商品，我看到时候惊呆了，店铺如图所示： <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g064lc6433j30u01hck6t.jpg" alt="image-20190214182451019"> 里面上架了什么商品？洗水果服务？做饭刷碗服务？捏肩膀服务？还有自动哄老婆机？我惊了。 她把商品发给我，我好奇问她这是干嘛的。 她说：要获得我的洗水果服务，捏肩膀服务，只需要在我的小店里购买使用就好了（作掐腰状）！还有自动哄老婆机，你要惹我生气了，只需要购买一个自动哄老婆机，我就会不生气了！嘿嘿合不合算？ <img src="https://ws4.sinaimg.cn/large/006tKfTcly1g0652dxmglj30cg0ck0zf.jpg" alt=""> 我说：多少钱？999！这么贵的吗！ 她说：当然不是啦，亲亲我们店里有活动的，使用优惠券满 999 减 998 呢，您是我的 VIP 唯一专属客户，我会给您发优惠券的呀，使用优惠券只需要一块钱就可以购买了。购买之后，您每次使用一张，我就可以给您洗水果、捏肩膀了！这个情人节的话呢，我要送亲亲 10 张！可省着点话，不能累到店长我啊！ 哦哦，卧槽真牛逼啊！于是乎我就快快乐乐领取到了十张优惠券购买了女朋友的这些服务，等着时不时用一张，享受一下帝王级的待遇，美滋滋！哈哈~ 最后，祝大家情人节快乐！幸福！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:50:13" itemprop="dateCreated datePublished" datetime="2019-02-21T09:50:13+08:00">2019-02-21</time>
                </span>
                <span id="/6462.html" class="post-meta-item leancloud_visitors" data-flag-title="程序猿的情人节怎么过？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6457.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6457.html" class="post-title-link" itemprop="url">分享一套 MacBook 高效开发工具</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>作为一名程序员，能够利用好工具提高开发和工作效率是非常重要的。我个人使用的都是苹果系列产品，电脑为 MacBook Pro 15 寸，手机 iPhone 7P，另外还有一个 iPad Pro 和一副 Apple Watch。我一直觉得 Mac 是非常适合做程序开发的，它既有比较不错的页面，也有类 Unix 的操作系统，使得日常使用和程序开发都极其便利，另外由于苹果本身自有的 iCloud 机制，使用 Mac、iPhone、iPad 跨平台开发和工作也变得十分便利。</p>
                  <p>近期我又对自己的一些工具进行了整理，弃用了一些工具，新启用了一些工具。目的也只有一个，就是提高自己的工作和开发效率，让生活变得更美好。如果你也在用 Mac 开发，或者你也有使用 iPad、iPhone，下面我所总结的个人的一些工具或许能给你带来帮助。</p>
                  <h2 id="快速导航"><a href="#快速导航" class="headerlink" title="快速导航"></a>快速导航</h2>
                  <p>这是 Mac 上的一个工具，要说到提高效率，首推 Alfred，可以说是 Mac 必备软件，利用它我们可以快速地进行各种操作，大幅提高工作效率，如快速打开某个软件、快速打开某个链接、快速搜索某个文档，快速定位某个文件，快速查看本机 IP，快速定义某个色值，几乎我们能想到的都能对接实现。</p>
                  <p>其实 Mac 本身已经自带了软件搜索还有 Spotlight，但是其功能还是远远比不上 Alfred，有了它，所有的快捷操作几乎都能实现。</p>
                  <p>这些快速功能是怎么实现的呢？实际上是 Alfred 对接了很多 Workflow，我们可以使用 Workflow 方便地进行功能扩展，一些比较优秀的 Workflow 已经有人专门做过整理了，可以参见：<a href="https://github.com/zenorocha/alfred-workflows" target="_blank" rel="noopener">https://github.com/zenorocha/alfred-workflows</a>，大家可以安装自己所需要的 Workflow，大大提高效率。</p>
                  <h2 id="复制粘贴"><a href="#复制粘贴" class="headerlink" title="复制粘贴"></a>复制粘贴</h2>
                  <p>Mac 上默认只有一个粘贴板，当我们新复制了一段文字之后，如果我们想再找寻之前复制的历史记录就找不到了，这其实是很反人类的。</p>
                  <p>好在 Paste 这款软件帮我们解决了这个问题，它可以保存我们粘贴板的历史记录，等需要粘贴某个内容的时候只需要呼出 Paste 历史粘贴板，然后选择某个特定的内容粘贴就好了，另外它还支持文本格式调整粘贴板分类和搜索，还可以支持快速便捷粘贴。有了它，再也不用担心粘贴板丢失了！</p>
                  <p>另外使用 Mac 和 iPhone、iPad 之间也可以相互之间复制粘贴，可以在一台 Apple 设备上拷贝文本、图像、照片和视频，然后在另一台 Apple 设备上粘贴该内容。例如，可以拷贝在 Mac 上浏览网页时发现的食谱，然后将其粘贴到附近 iPhone 上“备忘录”中的购物清单。这是在 macOS Sierra 版本之后出来的功能，若要使用需要确保 Mac 的版本是 Sierra 及以后。若要使用，几个设备必须满足“连续互通”系统要求。它们还必须在“系统偏好设置”（在 Mac 上）和“设置”（在 iOS 设备上）中打开 Wi-Fi、蓝牙和 Handoff，另外必须在所有设备上使用同一 Apple ID登录 iCloud。</p>
                  <p>具体的操作流程可以参见苹果的官网说明：<a href="https://support.apple.com/kb/PH25168" target="_blank" rel="noopener">https://support.apple.com/kb/PH25168</a>，有了这个功能，日常的一些操作便可以直接同步了，甚至不再需要 AirDrop，更不需要微信和邮件。</p>
                  <h2 id="时间管理"><a href="#时间管理" class="headerlink" title="时间管理"></a>时间管理</h2>
                  <p>现在这个时候，时间比什么都重要，每个人的时间都是公平的，如果我们能够合理规划好自己的时间和工作，这就跨出了成功的一步。</p>
                  <p>我曾经尝试用手写的方式来记录自己的一些任务，但总感觉它有一些并不方便的地方。比如某时某刻突然想起来，想要添加一件事情或者完成了一件事情，或者想要修改截止时间，或者想要划分优先级，其实都不怎么方便。最好的方式还是通过一些专用的时间管理软件来分配分配和管理自己的时间。</p>
                  <p>我曾经使用过非常多款时间管理工具，最终我选择的是 Todoist，这个是我感觉体验非常不错的一款。这个软件里面基本的任务添加与勾划功能当然必不可少，它也支持优先级管理，分类管理，时间设置，另外还有几个我觉得非常加分的几个点，比如：</p>
                  <ul>
                    <li>
                      <p>添加时间时可以直接通过一句话来添加，比如”每隔两天晚上九点运动”，它会自动识别并设置为循环任务，并能在相应的时刻提醒你。</p>
                    </li>
                    <li>
                      <p>支持全部平台，不论是网页还是 Windows、Mac、Android、iPhone、iPad、Apple Watch、Chrome、Firefox，你能想到的平台，应有尽有。</p>
                    </li>
                    <li>
                      <p>它还支持事件同步，可以在 Mac 或者 iPhone 的日历中添加 Todoist 的同步，这样你所有的事情都会被定时同步到日历软件中，这样日历中就既包含了节日、生日等信息，又可以把每天我们需要做的事同步进来，日程信息一目了然。这样你就可以把日历变成一个提醒器，设置什么时候提醒就好了，现在我就在用 Mac 或者 iPhone 上的日历来提醒我什么时间该做什么事情了。</p>
                    </li>
                    <li>
                      <p>它还支持多人写作，就类似于 Worktile、Teambition、Trello，我曾经使用这款软件完成了多个项目的任务分配和多人协作开发，还是非常方便的。</p>
                    </li>
                    <li>
                      <p>另外它还支持过期智能重新安排任务，比如有一些任务没有完成，它还可以根据优先级来重新进行时间规划和安排，同时也有任务评分和目标评价机制，来反映我们任务完成情况。</p>
                    </li>
                  </ul>
                  <p>另外关于时间管理还有一个非常重要的四象限法则，大家也可以了解一下。有了这个法则，大家可以合理安排优先级，合理分配每个任务的时间。有关于我的时间管理经验我后面还会详细写一篇相关的文章，介绍一下我平时会怎样进行时间规划和学习的。</p>
                  <p>另外我还尝试过番茄土豆这个软件，这个软件的缺点在于整体的功能还比较简陋，而且不能和我已有的 Todo List 进行同步。好处就是可以自己设置番茄，保持专注工作。但目前我尚未发现满意的产品，如有还希望大家可以留言推荐一下，谢谢。</p>
                  <h2 id="笔记记录"><a href="#笔记记录" class="headerlink" title="笔记记录"></a>笔记记录</h2>
                  <p>在学习的时候来进行记录是非常非常重要的，强烈建议一边学习一边把所做所想记录下来，最后做一下整理成文。一方面方便查阅，另一方面加深印象和理解。</p>
                  <p>Markdown 想必大家都已经很耳熟了，现在我写文章或者笔记几乎全都用 Markdown 来写，现在很多云笔记也慢慢逐步支持 Markdown 的语法了，我的博客后台也自己配置了 Markdown 的支持。不过也有某些平台尚未支持 Markdown，比如知乎，忍不住吐槽一句，知乎的编辑器实在用得是心累，当然可以使用插件来解决，也当然也有所好，我就不再说什么了。不过我还是强烈推荐 Markdown 来进行写作和记录的，用过之后你可能就不再想用 Word 了。</p>
                  <p>言归正传，既然谈到笔记和写作。我的笔记本是 Mac，之前几乎所有的笔记，包括写书，都几乎是在 Mac 上完成的，但是确实有的时候是不方便的。比如 Mac 不在身边或者想用 iPhone 或者 iPad 来写点东西的时候，一个需要解决的问题就是云同步问题。有了云同步，我们如果在电脑上写了一部分内容，接着切换了另一台台式机，或者切换了手机的时候，照样能够接着在原来的基础上写，非常方便。</p>
                  <p>这时候可能就有小伙伴推荐有道云笔记、印象笔记等软件，它们支持 Markdown，但这并不是它们的主打支持方向，对 Makrdown 的支持当然没有一些专业的 Makrdown 编辑工具专业。对我个人而言，我不想因为它们自带了云同步而抛弃了纯粹的 Makrdown 写作环境，我只想要一个纯粹的 Makrdown 写作环境，而不想引入比如有道云里面的普通笔记、签到等冗余的功能，也不想看到里面的广告推荐等内容。所以对于云同步，我使用了另外的解决方案。对于写作软件，我也摸索出了自己的一套方案。</p>
                  <p>对于电脑端的 Markdown 写作软件，推荐两款，一款是 Typora，另一款是 MarkEditor。</p>
                  <p>对于 Makrdown 编辑器来说，我觉得有几个比较重要的点：</p>
                  <ul>
                    <li>
                      <p>不能纯写 Makrdown，要实时地能够看到自己写完 Makrdown 之后最终呈现的效果是怎样的。</p>
                    </li>
                    <li>
                      <p>插入图片要方便，很多编辑器需要先将图片挪到某个文件夹下或者上传图片才可以插入图片，这是很不友好的，如果能够直接通过复制粘贴的形式插入图片，甚至能够自动将图片上传到云端，那就再好不过了。</p>
                    </li>
                    <li>
                      <p>能够打开一整个 Makrdown 文件夹，左侧显示文件列表，右侧进行写作编辑，不能仅仅支持一个 Markdown 文件的编辑。</p>
                    </li>
                    <li>
                      <p>如果需要用到公司，那么编辑器需要对 Markdown 公式支持比较好。</p>
                    </li>
                  </ul>
                  <p>以上介绍的这两款软件都可以做到。</p>
                  <ul>
                    <li>
                      <p>Typora 是免费的，更加轻量级，而且支持即写即得，界面支持和公式支持都比较好，图片的话可以结合 iPic 软件直接上传到图床，同时也可以直接将复制的图片直接粘贴到编辑器中，非常友好，目前我正在使用。</p>
                    </li>
                    <li>
                      <p>MarkEditor 是收费的，功能更为丰富，支持左右分栏模式、阅读模式等，它也支持直接复制和粘贴图片，另外还有强大的导出功能，还可以直接将文件发布为一个网站等等，也十分推荐。</p>
                    </li>
                  </ul>
                  <p>不过目前由于 Typora 更轻量级，并且能和 iPic 而且功能配合使用，粘贴后的图片可以点击直接上传到云端，非常方便，我目前已经由 MarkEditor 切换到 Typora 了。</p>
                  <p>写作界面如下：</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1g0508a70joj31jw0u0au6.jpg" alt=""></p>
                  <p>如图这是打开了一个文件夹，这个文件夹里面有好多 Makrdown 文件，都是我在研究和学习过程中所写的笔记。</p>
                  <p>然后需要解决的就是云同步问题，云同步其实使用网盘就足够了。由于我使用 Mac，所以我选用了 iCloud，开了 200G 的空间，足够了。这样我所记录的内容能够秒级同步到 iCloud Drive 中，这样我再使用 iPhone、iPad 就可以直接看到最新的内容了。当然还有一些推荐的，比如 OneDrive、谷歌云等多种云盘同步工具，哪个方便用哪个。Mac 和 iPhone 的好处就是已经内置了 iCloud Drive，所以不用再去在各个终端上配置了。</p>
                  <p>接下来就是在其他的电脑以及 iPhone、iPad 上进行写作的解决方案了。由于我的文件都已经存放在了 iCloud Drive，所以就需要一款 Makrdown 编辑软件可以直接读写 iCloud Drive 里面的内容，同时界面还要友好，功能完善一点。在这里我最终选择了 Markdown Pro，它的功能简洁但是又比较完善，打开之后直接选取 iCloud Drive 里面的 Makrdown 文件即可开始编辑，并且它是左右分栏的，即左侧编辑，右侧预览，非常方便简洁，另外它对公式的支持也很好，下图是我在 iPad 上对本文进行编辑的效果预览图。</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1g055n71vrvj31400u0npd.jpg" alt=""></p>
                  <p>对于图片的插入，在 iPhone 和 iPad 上我借助了另外一个工具，叫做 SM.MS，这个软件可以直接选取图片，然后上传到云端，点击复制即可得到链接和 Makrdown 图片链接，所以插图也不是什么问题了。</p>
                  <p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1g0578rt4s6j30u01hcnpd.jpg" alt=""></p>
                  <p>如图所示，上传照片之后，便会出现各种各样的图片链接形式，有纯链接、HTML、Markdown 等等，直接点击复制按钮即可复制，然后粘贴到文档中。</p>
                  <p>另外如果你用了 Windows 的话，只要下载一个 iCloud 云盘软件即可同步。如果使用的是其他的云盘软件，也只需要配置一下就好了。</p>
                  <p>有了这套，我们就可以实现随时随地写笔记，Mac、iPhone、iPad 无缝切换。</p>
                  <h2 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h2>
                  <p>很多时候我们在构思方案或者流程的时候需要对思维做梳理，或者在列方案呈现的时候也需要分门别类地进行呈现。这时候大多数情况下就需要用到一个工具，思维导图。</p>
                  <p>思维导图工具我个人使用的是 MindNode，在 Mac 上用它可以通过各种快捷键快速的增删思维导图节点，另外界面也非常绚丽多彩。</p>
                  <p>对于思维导图软件来说，我也希望能全平台同步，其实 MindNode 也有对应的移动端软件，同样是 MindNode，二者可以通过 iCloud Drive 进行同步，同样可以做到无缝衔接。</p>
                  <p>另外还有很多朋友也在用 XMind，功能同样很强大，大家也可以试试。</p>
                  <h2 id="远程控制"><a href="#远程控制" class="headerlink" title="远程控制"></a>远程控制</h2>
                  <p>我们经常会和各种服务器打交道，例如我们经常使用 SSH 来远程连接某台 Linux 服务器，原生 Terminal 是支持 SSH 的，但你会发现原生带的这个太难用了。可能很多小伙伴使用 iTerm，不得不说这确实是个神器，大大方便了远程管理流程。但我在这里还要推荐一个我经常使用的 SSH Shell，没错，它的名字就是 SSH Shell，它的页面操作简洁，同时管理和记录远程主机十分方便，另外还支持秘钥管理、自动重连、自定义主题等等功能，个人用起来十分顺手，强烈推荐！</p>
                  <p>当然除了电脑，当我们出去在外的时候，紧急情况也可能需要使用 SSH 来连接和管理我们的服务器，所以我也在 iPhone 和 iPad 上装了远程管理软件，叫做 Termius，同样功能十分强大，快捷操作十分便捷，有免费的试用期限，我觉得非常好用就订购了，推荐给大家。</p>
                  <p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1g057v8tli7j30u01hc46y.jpg" alt=""></p>
                  <h2 id="代码记录"><a href="#代码记录" class="headerlink" title="代码记录"></a>代码记录</h2>
                  <p>作为一名程序员，我们会经常写或者使用一些关键代码。</p>
                  <p>比如有一天我写了一些方法，这些方法可以完成非常重要的功能，后面的项目也会经常遇到，那么怎么办呢？很多情况下我们想把它保存起来，放到某个收藏夹里面备用，等到用的时候重新把它复制出来。或者有一些繁琐的命令，我实在是记不住，或许我们也想把它记录下来。</p>
                  <p>很多情况下，我们可能简单地使用文本文件，但并不方便同步和查找。或者云笔记保存下来，但这些并不是专门用来保存代码的。更高级一点，我们会联想到使用 GitHub Gists，但每次记录的这个流程也比较麻烦。</p>
                  <p>这里推荐一个专门用来记录代码片段的软件，叫做 SnippetsLab，适用于 Mac 系统，可以专门用来管理代码片段，还支持多种代码格式。比如我就将代码按照编程语言划分，划分为 Python、JavaScript 等等，分文件夹存储，有不错的代码就随手贴过来，另外它也支持搜索，管理代码非常方便。如果某一天想查某个代码了，直接打开它一搜就有了，可以大大提高开发效率。</p>
                  <p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1g0579amrgyj31f70u0dq4.jpg" alt=""></p>
                  <p>以上就暂且总结这么多，其实还有不少好用的用具，后面再一一为大家总结分享。</p>
                  <p>另外再问下大家，你们买 iPad 了吗？是不是觉得比较鸡肋，或者平时都用不上，那这样就没有发挥 iPad 的最大效用，如果利用好了，它可以进一步方便我们的生活，后面我也会专门写一下 iPad 方面的一些用途。</p>
                  <p>由于水平和见识有限，如果大家有更好的软件或者方案推荐，欢迎大家留言！也希望我的一些方案对大家有所帮助，谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:19:30" itemprop="dateCreated datePublished" datetime="2019-02-21T09:19:30+08:00">2019-02-21</time>
                </span>
                <span id="/6457.html" class="post-meta-item leancloud_visitors" data-flag-title="分享一套 MacBook 高效开发工具" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6454.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6454.html" class="post-title-link" itemprop="url">还在一个个写规则？来了解下爬虫的智能化解析吧！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>爬虫是做什么的？是帮助我们来快速获取有效信息的。然而做过爬虫的人都知道，解析是个麻烦事。 比如一篇新闻吧，链接是这个：<a href="https://news.ifeng.com/c/7kQcQG2peWU，页面预览图如下：" target="_blank" rel="noopener">https://news.ifeng.com/c/7kQcQG2peWU，页面预览图如下：</a> <img src="https://ws2.sinaimg.cn/large/006tKfTcly1g0cwc0n5u9j30w10no4ho.jpg" alt="预览图"> 我们需要从页面中提取出标题、发布人、发布时间、发布内容、图片等内容。一般情况下我们需要怎么办？写规则。 那么规则都有什么呢？怼正则，怼 CSS 选择器，怼 XPath。我们需要对标题、发布时间、来源等内容做规则匹配，更有甚者再需要正则表达式来辅助一下。我们可能就需要用 re、BeautifulSoup、pyquery 等库来实现内容的提取和解析。 但如果我们有成千上万个不同样式的页面怎么办呢？它们来自成千上万个站点，难道我们还需要对他们一一写规则来匹配吗？这得要多大的工作量啊。另外这些万一弄不好还会解析有问题。比如正则表达式在某些情况下匹配不了了，CSS、XPath 选择器选错位了也会出现问题。 想必大家可能见过现在的浏览器有阅读模式，比如我们把这个页面用 Safari 浏览器打开，然后开启阅读模式，看看什么效果： <img src="https://ws4.sinaimg.cn/large/006tKfTcly1g0cwgg60joj30mg0odwtt.jpg" alt="Safari预览"> 页面一下子变得非常清爽，只保留了标题和需要读的内容。原先页面多余的导航栏、侧栏、评论等等的统统都被去除了。它怎么做到的？难道是有人在里面写好规则了？那当然不可能的事。其实，这里面就用到了智能化解析了。 那么本篇文章，我们就来了解一下页面的智能化解析的相关知识。</p>
                  <h2 id="智能化解析"><a href="#智能化解析" class="headerlink" title="智能化解析"></a>智能化解析</h2>
                  <p>所谓爬虫的智能化解析，顾名思义就是不再需要我们针对某一些页面来专门写提取规则了，我们可以利用一些算法来计算出来页面特定元素的位置和提取路径。比如一个页面中的一篇文章，我们可以通过算法计算出来，它的标题应该是什么，正文应该是哪部分区域，发布时间是什么等等。 其实智能化解析是非常难的一项任务，比如说你给人看一个网页的一篇文章，人可以迅速找到这篇文章的标题是什么，发布时间是什么，正文是哪一块，或者哪一块是广告位，哪一块是导航栏。但给机器来识别的话，它面临的是什么？仅仅是一系列的 HTML 代码而已。那究竟机器是怎么做到智能化提取的呢？其实这里面融合了多方面的信息。</p>
                  <ul>
                    <li>比如标题。一般它的字号是比较大的，而且长度不长，位置一般都在页面上方，而且大部分情况下它应该和 title 标签里的内容是一致的。</li>
                    <li>比如正文。它的内容一般是最多的，而且会包含多个段落 p 或者图片 img 标签，另外它的宽度一般可能会占用到页面的三分之二区域，并且密度（字数除以标签数量）会比较大。</li>
                    <li>比如时间。不同语言的页面可能不同，但时间的格式是有限的，如 2019-02-20 或者 2019/02/20 等等，也有的可能是美式的记法，顺序不同，这些也有特定的模式可以识别。</li>
                    <li>比如广告。它的标签一般可能会带有 ads 这样的字样，另外大多数可能会处于文章底部、页面侧栏，并可能包含一些特定的外链内容。</li>
                  </ul>
                  <p>另外还有一些特点就不再一一赘述了，这其中包含了区块位置、区块大小、区块标签、区块内容、区块疏密度等等多种特征，另外很多情况下还需要借助于视觉的特征，所以说这里面其实结合了算法计算、视觉处理、自然语言处理等各个方面的内容。如果能把这些特征综合运用起来，再经过大量的数据训练，是可以得到一个非常不错的效果的。</p>
                  <h2 id="业界进展"><a href="#业界进展" class="headerlink" title="业界进展"></a>业界进展</h2>
                  <p>未来的话，页面也会越来越多，页面的渲染方式也会发生很大的变化，爬虫也会越来越难做，智能化爬虫也将会变得越来越重要。 目前工业界，其实已经有落地的算法应用了。经过我的一番调研，目前发现有这么几种算法或者服务对页面的智能化解析做的比较好：</p>
                  <ul>
                    <li>Diffbot，国外的一家专门来做智能化解析服务的公司，<a href="https://www.diffbot.com" target="_blank" rel="noopener">https://www.diffbot.com</a></li>
                    <li>Boilerpipe，Java 语言编写的一个页面解析算法，<a href="https://github.com/kohlschutter/boilerpipe" target="_blank" rel="noopener">https://github.com/kohlschutter/boilerpipe</a></li>
                    <li>Embedly，提供页面解析服务的公司，<a href="https://embed.ly/extract" target="_blank" rel="noopener">https://embed.ly/extract</a></li>
                    <li>Readability，是一个页面解析算法，但现在官方的服务已经关闭了，<a href="https://www.readability.com/" target="_blank" rel="noopener">https://www.readability.com/</a></li>
                    <li>Mercury，Readability 的替代品，<a href="https://mercury.postlight.com/" target="_blank" rel="noopener">https://mercury.postlight.com/</a></li>
                    <li>Goose，Java 语音编写的页面解析算法，<a href="https://github.com/GravityLabs/goose" target="_blank" rel="noopener">https://github.com/GravityLabs/goose</a></li>
                  </ul>
                  <p>那么这几种算法或者服务到底哪些好呢，Driffbot 官方曾做过一个对比评测，使用 Google 新闻的一些文章，使用不同的算法依次摘出其中的标题和文本，然后与真实标注的内容进行比较，比较的指标就是文字的准确率和召回率，以及根据二者计算出的 F1 分数。 其结果对比如下：</p>
                  <p>Service/Software</p>
                  <p><a href="https://www.diffbot.com/benefits/comparison/#definitions" target="_blank" rel="noopener">Precision</a></p>
                  <p><a href="https://www.diffbot.com/benefits/comparison/#definitions" target="_blank" rel="noopener">Recall</a></p>
                  <p><a href="https://www.diffbot.com/benefits/comparison/#definitions" target="_blank" rel="noopener">F1-Score</a></p>
                  <p><strong>Diffbot</strong></p>
                  <p>0.968</p>
                  <p>0.978</p>
                  <p>0.971</p>
                  <p><a href="https://code.google.com/p/boilerpipe/" target="_blank" rel="noopener">Boilerpipe</a></p>
                  <p>0.893</p>
                  <p>0.924</p>
                  <p>0.893</p>
                  <p><a href="https://www.readability.com/" target="_blank" rel="noopener">Readability</a></p>
                  <p>0.819</p>
                  <p>0.911</p>
                  <p>0.854</p>
                  <p><a href="http://www.alchemyapi.com/" target="_blank" rel="noopener">AlchemyAPI</a></p>
                  <p>0.876</p>
                  <p>0.892</p>
                  <p>0.850</p>
                  <p><a href="http://embed.ly/" target="_blank" rel="noopener">Embedly</a></p>
                  <p>0.786</p>
                  <p>0.880</p>
                  <p>0.822</p>
                  <p><a href="https://github.com/GravityLabs/goose" target="_blank" rel="noopener">Goose</a></p>
                  <p>0.498</p>
                  <p>0.815</p>
                  <p>0.608</p>
                  <p>经过对比我们可以发现，Diffbot 的准确率和召回率都独占鳌头，其中的 F1 值达到了 0.97，可以说准确率非常高了。另外接下来比较厉害的就是 Boilerpipe 和 Readability，Goose 的表现则非常差，F1 跟其他的算法差了一大截。下面是几个算法的 F1 分数对比情况： <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g0d4cv31noj30yw0kstaa.jpg" alt="F1分数对比"> 有人可能好奇为什么 Diffbot 这么厉害？我也查询了一番。Diffbot 自 2010 年以来就致力于提取 Web 页面数据，并提供许多 API 来自动解析各种页面。其中他们的算法依赖于自然语言技术、机器学习、计算机视觉、标记检查等多种算法，并且所有的页面都会考虑到当前页面的样式以及可视化布局，另外还会分析其中包含的图像内容、CSS 甚至 Ajax 请求。另外在计算一个区块的置信度时还考虑到了和其他区块的关联关系，基于周围的标记来计算每个区块的置信度。 总之，Diffbot 也是一直致力于这一方面的服务，整个 Diffbot 就是页面解析起家的，现在也一直专注于页面解析服务，准确率高也就不足为怪了。 但它们的算法开源了吗？很遗憾，并没有，而且我也没有找到相关的论文介绍它们自己的具体算法。 所以，如果想实现这么好的效果，那就使用它们家的服务就好了。 接下来的内容，我们就来说说如何使用 Diffbot 来进行页面的智能解析。另外还有 Readability 算法也非常值得研究，我会写专门的文章来介绍 Readability 及其与 Python 的对接使用。</p>
                  <h2 id="Diffbot-页面解析"><a href="#Diffbot-页面解析" class="headerlink" title="Diffbot 页面解析"></a>Diffbot 页面解析</h2>
                  <p>首先我们需要注册一个账号，它有 15 天的免费试用，注册之后会获得一个 Developer Token，这就是使用 Diffbot 接口服务的凭证。 接下来切换到它的测试页面中，链接为：<a href="https://www.diffbot.com/dev/home/，我们来测试一下它的解析效果到底是怎样的。" target="_blank" rel="noopener">https://www.diffbot.com/dev/home/，我们来测试一下它的解析效果到底是怎样的。</a> 这里我们选择的测试页面就是上文所述的页面，链接为：<a href="https://news.ifeng.com/c/7kQcQG2peWU，API" target="_blank" rel="noopener">https://news.ifeng.com/c/7kQcQG2peWU，API</a> 类型选择 Article API，然后点击 Test Drive 按钮，接下来它就会出现当前页面的解析结果： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0d4u30pjij30v70lhq57.jpg" alt="结果"> 这时候我们可以看到，它帮我们提取出来了标题、发布时间、发布机构、发布机构链接、正文内容等等各种结果。而且目前来看都十分正确，时间也自动识别之后做了转码，是一个标准的时间格式。 接下来我们继续下滑，查看还有什么其他的字段，这里我们还可以看到有 html 字段，它和 text 不同的是，它包含了文章内容的真实 HTML 代码，因此图片也会包含在里面，如图所示： <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0d4wnlzbhj30uv0k3490.jpg" alt="结果"> 另外最后面还有 images 字段，他以列表形式返回了文章套图及每一张图的链接，另外还有文章的站点名称、页面所用语言等等结果，如图所示： <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g0d4yai8qqj30uf0l0q7v.jpg" alt="结果"> 当然我们也可以选择 JSON 格式的返回结果，其内容会更加丰富，例如图片还返回了其宽度、高度、图片描述等等内容，另外还有各种其他的结果如面包屑导航等等结果，如图所示： <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0d500i671j30tn0fx0ue.jpg" alt="结果"> 经过手工核对，发现其返回的结果都是完全正确的，准确率相当之高！ 所以说，如果你对准确率要求没有那么非常非常严苛的情况下，使用 Diffbot 的服务可以帮助我们快速地提取页面中所需的结果，省去了我们绝大多数的手工劳动，可以说是非常赞了。 但是，我们也不能总在网页上这么试吧。其实 Diffbot 也提供了官方的 API 文档，让我们来一探究竟。</p>
                  <h2 id="Diffbot-API"><a href="#Diffbot-API" class="headerlink" title="Diffbot API"></a>Diffbot API</h2>
                  <p>Driffbot 提供了多种 API，如 Analyze API、Article API、Disscussion API 等。 下面我们以 Article API 为例来说明一下它的用法，其官方文档地址为：<a href="https://www.diffbot.com/dev/docs/article/，API" target="_blank" rel="noopener">https://www.diffbot.com/dev/docs/article/，API</a> 调用地址为：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https:<span class="regexp">//</span>api.diffbot.com<span class="regexp">/v3/</span>article</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用 GET 方式来进行请求，其中的 Token 和 URL 都可以以参数形式传递给这个 API，其必备的参数有：</p>
                  <ul>
                    <li>token：即 Developer Token</li>
                    <li>url：即要解析的 URL 链接</li>
                  </ul>
                  <p>另外它还有几个可选参数：</p>
                  <ul>
                    <li>fields：用来指定返回哪些字段，默认已经有了一些固定字段，这个参数可以指定还可以额外返回哪些可选字段</li>
                    <li>paging：如果是多页文章的话，如果将这个参数设置为 false 则可以禁止多页内容拼接</li>
                    <li>maxTags：可以设置返回的 Tag 最大数量，默认是 10 个</li>
                    <li>tagConfidence：设置置信度的阈值，超过这个值的 Tag 才会被返回，默认是 0.5</li>
                    <li>discussion：如果将这个参数设置为 false，那么就不会解析评论内容</li>
                    <li>timeout：在解析的时候等待的最长时间，默认是 30 秒</li>
                    <li>callback：为 JSONP 类型的请求而设计的回调</li>
                  </ul>
                  <p>这里大家可能关注的就是 fields 字段了，在这里我专门做了一下梳理，首先是一些固定字段：</p>
                  <ul>
                    <li>type：文本的类型，这里就是 article 了</li>
                    <li>title：文章的标题</li>
                    <li>text：文章的纯文本内容，如果是分段内容，那么其中会以换行符来分隔</li>
                    <li>html：提取结果的 HTML 内容</li>
                    <li>date：文章的发布时间，其格式为 RFC 1123</li>
                    <li>estimatedDate：如果日期时间不太明确，会返回一个预估的时间，如果文章超过两天或者没有发布日期，那么这个字段就不会返回</li>
                    <li>author：作者</li>
                    <li>authorUrl：作者的链接</li>
                    <li>discussion：评论内容，和 Disscussion API 返回结果一样</li>
                    <li>humanLanguage：语言类型，如英文还是中文等</li>
                    <li>numPages：如果文章是多页的，这个参数会控制最大的翻页拼接数目</li>
                    <li>nextPages：如果文章是多页的，这个参数可以指定文章后续链接</li>
                    <li>siteName：站点名称</li>
                    <li>publisherRegion：文章发布地区</li>
                    <li>publisherCountry：文章发布国家</li>
                    <li>pageUrl：文章链接</li>
                    <li>resolvedPageUrl：如果文章是从 pageUrl 重定向过来的，则返回此内容</li>
                    <li>tags：文章的标签或者文章包含的实体，根据自然语言处理技术和 DBpedia 计算生成，是一个列表，里面又包含了子字段：<ul>
                        <li>label：标签名</li>
                        <li>count：标签出现的次数</li>
                        <li>score：标签置信度</li>
                        <li>rdfTypes：如果实体可以由多个资源表示，那么则返回相关的 URL</li>
                        <li>type：类型</li>
                        <li>uri：Diffbot Knowledge Graph 中的实体链接</li>
                      </ul>
                    </li>
                    <li>images：文章中包含的图片</li>
                    <li>videos：文章中包含的视频</li>
                    <li>breadcrumb：面包屑导航信息</li>
                    <li>diffbotUri：Diffbot 内部的 URL 链接</li>
                  </ul>
                  <p>以上的预定字段就是如果可以返回那就会返回的字段，是不能定制化配置的，另外我们还可以通过 fields 参数来指定扩展如下可选字段：</p>
                  <ul>
                    <li>quotes：引用信息</li>
                    <li>sentiment：文章的情感值，-1 到 1 之间</li>
                    <li>links：所有超链接的顶级链接</li>
                    <li>querystring：请求的参数列表</li>
                  </ul>
                  <p>好，以上便是这个 API 的用法，大家可以申请之后使用这个 API 来做智能化解析了。 下面我们用一个实例来看一下这个 API 的用法，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests, json</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://api.diffbot.com/v3/article'</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'token'</span>: <span class="string">'77b41f6fbb24496d5113d528306528fa'</span>,</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'https://news.ifeng.com/c/7kQcQG2peWU'</span>,</span><br><span class="line">    <span class="string">'fields'</span>: <span class="string">'meta'</span> </span><br><span class="line">&#125;</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(url, <span class="attribute">params</span>=params)</span><br><span class="line"><span class="builtin-name">print</span>(json.dumps(response.json(), <span class="attribute">indent</span>=2, <span class="attribute">ensure_ascii</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先定义了 API 的链接，然后指定了 params 参数，即 GET 请求参数。 参数中包含了必选的 token、url 字段，也设置了可选的 fields 字段，其中 fields 为可选的扩展字段 meta 标签。 我们来看下运行结果，结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"request"</span>: &#123;</span><br><span class="line">    <span class="attr">"pageUrl"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">    <span class="attr">"api"</span>: <span class="string">"article"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: <span class="string">"sentiment, meta"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">3</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"objects"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"date"</span>: <span class="string">"Wed, 20 Feb 2019 02:26:00 GMT"</span>,</span><br><span class="line">      <span class="attr">"images"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"naturalHeight"</span>: <span class="number">460</span>,</span><br><span class="line">          <span class="attr">"width"</span>: <span class="number">640</span>,</span><br><span class="line">          <span class="attr">"diffbotUri"</span>: <span class="string">"image|3|-1139316034"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://e0.ifengimg.com/02/2019/0219/1731DC8A29EB2219C7F2773CF9CF319B3503D0A1_size382_w690_h460.png"</span>,</span><br><span class="line">          <span class="attr">"naturalWidth"</span>: <span class="number">690</span>,</span><br><span class="line">          <span class="attr">"primary"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">"height"</span>: <span class="number">426</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"author"</span>: <span class="string">"中国新闻网"</span>,</span><br><span class="line">      <span class="attr">"estimatedDate"</span>: <span class="string">"Wed, 20 Feb 2019 06:47:52 GMT"</span>,</span><br><span class="line">      <span class="attr">"diffbotUri"</span>: <span class="string">"article|3|1591137208"</span>,</span><br><span class="line">      <span class="attr">"siteName"</span>: <span class="string">"ifeng.com"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"article"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调"</span>,</span><br><span class="line">      <span class="attr">"breadcrumb"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://news.ifeng.com/"</span>,</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"资讯"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://news.ifeng.com/shanklist/3-35197-/"</span>,</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"大陆"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"humanLanguage"</span>: <span class="string">"zh"</span>,</span><br><span class="line">      <span class="attr">"meta"</span>: &#123;</span><br><span class="line">        <span class="attr">"og"</span>: &#123;</span><br><span class="line">          <span class="attr">"og:time "</span>: <span class="string">"2019-02-20 02:26:00"</span>,</span><br><span class="line">          <span class="attr">"og:image"</span>: <span class="string">"https://e0.ifengimg.com/02/2019/0219/1731DC8A29EB2219C7F2773CF9CF319B3503D0A1_size382_w690_h460.png"</span>,</span><br><span class="line">          <span class="attr">"og:category "</span>: <span class="string">"凤凰资讯"</span>,</span><br><span class="line">          <span class="attr">"og: webtype"</span>: <span class="string">"news"</span>,</span><br><span class="line">          <span class="attr">"og:title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调"</span>,</span><br><span class="line">          <span class="attr">"og:url"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">          <span class="attr">"og:description"</span>: <span class="string">"　　“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。” 　　“重"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"referrer"</span>: <span class="string">"always"</span>,</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"　　“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。” 　　“重"</span>,</span><br><span class="line">        <span class="attr">"keywords"</span>: <span class="string">"故宫 紫禁城 故宫博物院 灯光 元宵节 博物馆 一票难求 元之 中新社 午门 杜洋 藏品 文化 皇帝 清明上河图 元宵 千里江山图卷 中英北京条约 中法北京条约 天津条约"</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"故宫，你低调点！故宫：不，实力已不允许我继续低调_凤凰资讯"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"authorUrl"</span>: <span class="string">"https://feng.ifeng.com/author/308904"</span>,</span><br><span class="line">      <span class="attr">"pageUrl"</span>: <span class="string">"https://news.ifeng.com/c/7kQcQG2peWU"</span>,</span><br><span class="line">      <span class="attr">"html"</span>: <span class="string">"&lt;p&gt;“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。...&lt;/blockquote&gt; &lt;/blockquote&gt;"</span>,</span><br><span class="line">      <span class="attr">"text"</span>: <span class="string">"“我的名字叫紫禁城，快要600岁了，这上元的夜啊，总是让我沉醉，这么久了却从未停止。”\\n“..."</span>,</span><br><span class="line">      <span class="attr">"authors"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"中国新闻网"</span>,</span><br><span class="line">          <span class="attr">"link"</span>: <span class="string">"https://feng.ifeng.com/author/308904"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见其返回了如上的内容，是一个完整的 JSON 格式，其中包含了标题、正文、发布时间等等各种内容。 可见，不需要我们配置任何提取规则，我们就可以完成页面的分析和抓取，得来全不费功夫。</p>
                  <h2 id="Diffbot-SDK"><a href="#Diffbot-SDK" class="headerlink" title="Diffbot SDK"></a>Diffbot SDK</h2>
                  <p>另外 Diffbot 还提供了几乎所有语言的 SDK 支持，我们也可以使用 SDK 来实现如上功能，链接为：<a href="https://www.diffbot.com/dev/docs/libraries/，如果大家使用" target="_blank" rel="noopener">https://www.diffbot.com/dev/docs/libraries/，如果大家使用</a> Python 的话，可以直接使用 Python 的 SDK 即可，Python 的 SDK 链接为：<a href="https://github.com/diffbot/diffbot-python-client。" target="_blank" rel="noopener">https://github.com/diffbot/diffbot-python-client。</a> 这个库并没有发布到 PyPi，需要自己下载并导入使用，另外这个库是使用 Python 2 写的，其实本质上就是调用了 requests 库，如果大家感兴趣的话可以看一下。 下面是一个调用示例：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span><span class="built_in"> client </span>import DiffbotClient,DiffbotCrawl</span><br><span class="line"></span><br><span class="line">diffbot = DiffbotClient()</span><br><span class="line">token = <span class="string">'your_token'</span></span><br><span class="line">url = <span class="string">'http://shichuan.github.io/javascript-patterns/'</span></span><br><span class="line">api = <span class="string">'article'</span></span><br><span class="line">response = diffbot.request(url, token, api)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过这行代码我们就可以通过调用 Article API 来分析我们想要的 URL 链接了，返回结果是类似的。 具体的用法大家直接看下它的源码注释就一目了然了，还是很清楚的。 好，以上便是对智能化提取页面原理的基本介绍以及对 Diffbot 的用法的讲解，后面我会继续介绍其他的智能化解析方法以及一些相关实战，希望大家可以多多关注。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-21 09:17:06" itemprop="dateCreated datePublished" datetime="2019-02-21T09:17:06+08:00">2019-02-21</time>
                </span>
                <span id="/6454.html" class="post-meta-item leancloud_visitors" data-flag-title="还在一个个写规则？来了解下爬虫的智能化解析吧！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6431.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6431.html" class="post-title-link" itemprop="url">今天，我终于弄懂了字体反爬是个啥玩意！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，欢迎关注我的公众号。"><a href="#大家好，我是四毛，欢迎关注我的公众号。" class="headerlink" title="大家好，我是四毛，欢迎关注我的公众号。"></a>大家好，我是四毛，欢迎关注我的公众号。</h1>
                  <h1 id="有什么想要交流的可以在后台第一时间私我。"><a href="#有什么想要交流的可以在后台第一时间私我。" class="headerlink" title="有什么想要交流的可以在后台第一时间私我。"></a>有什么想要交流的可以在后台第一时间私我。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  <h2 id="今天的文章内容主要是关于字体反爬。"><a href="#今天的文章内容主要是关于字体反爬。" class="headerlink" title="今天的文章内容主要是关于字体反爬。"></a>今天的文章内容主要是关于字体反爬。</h2>
                  <p>目前已知的几个字体反爬的网站是猫眼，汽车之家，天眼查，起点中文网等等。 以前也看过这方面的文章，今天跟个老哥在交流的时候，终于实操了一把，弄懂了字体反爬是个啥玩意。下面听我慢慢道来。</p>
                  <h3 id="本文用到的第三方库"><a href="#本文用到的第三方库" class="headerlink" title="本文用到的第三方库"></a><strong>本文用到的第三方库</strong></h3>
                  <blockquote>
                    <p><strong>fontTools</strong></p>
                  </blockquote>
                  <h2 id="1、目标网站"><a href="#1、目标网站" class="headerlink" title="1、目标网站"></a><strong>1、目标网站</strong></h2>
                  <blockquote>
                    <p><strong>url = “<a href="https://su.58.com/qztech/" target="_blank" rel="noopener">https://su.58.com/qztech/</a>“</strong></p>
                  </blockquote>
                  <h2 id="2、反爬虫机制"><a href="#2、反爬虫机制" class="headerlink" title="2、反爬虫机制"></a><strong>2、反爬虫机制</strong></h2>
                  <p>网页上看见的 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/1.png" alt=""> 后台源代码里面的 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/2.png" alt=""> 从上面可以看出，生这个字变成了乱码，请大家特别注意箭头所指的数字。 </p>
                  <h2 id="3、解决"><a href="#3、解决" class="headerlink" title="3、解决"></a><strong>3、解决</strong></h2>
                  <h3 id="1、确定反爬方法"><a href="#1、确定反爬方法" class="headerlink" title="1、确定反爬方法"></a><strong>1、确定反爬方法</strong></h3>
                  <p>在看了别人的解析文章之后，确定采取的是<strong>字体反爬机制</strong>，即网站定义了字体文件，然后进行相应的查找替换，在前端看起来，是没有任何差异的。其实从审查元素的也是可以看到的： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/4.png" alt=""> 和大众点评的反爬差不多，都是通过css搞得。</p>
                  <h3 id="2、寻找字体文件"><a href="#2、寻找字体文件" class="headerlink" title="2、寻找字体文件"></a><strong>2、寻找字体文件</strong></h3>
                  <p>以上面方框里的”<strong>customfont</strong>“为关键词搜了一下，发现就在源代码里面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/3.png" alt=""> 而且还有base64，直接进行解密，但是解密出来的其实是乱码，这个时候其实要做的很简单，把解密后的内容保存为<strong>.ttf</strong>格式即可。</p>
                  <blockquote>
                    <p><strong>ttf文件</strong>： <em>.ttf是字体文件格式。TTF(TrueTypeFont)是Apple公司和Microsoft公司共同推出的字体文件格式,随着windows的流行,已经变成最常用的一种字体文件表示方式。 <em>*@font-face</em></em> 是CSS3中的一个模块，主要是实现将自定义的Web字体嵌入到指定网页中去。</p>
                  </blockquote>
                  <p>因为我们要对字体进行研究，所以必须将它打开，这里我是用的是<strong>FontCreator</strong>，打开以后是这个样子（其实很多字，在这里为了看的清楚，所以只截了下面的图）： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/5.png" alt=""> 很明显，每个字可以看到字形和字形编码。 观察现在箭头指的地方和前面箭头指的地方的数字是不是一样啊，没错，就是通过这种方法进行映射的。 所以我们现在的思路似乎就是在源代码里找到箭头指的数字，然后再来字体里找到后替换就行了。 恭喜你，如果你也是这么想的，那你就掉坑里了。 因为每次访问，字体字形是不变的，但字符的编码确是变化的。因此，我们需要根据每次访问，<strong>动态解析字体文件</strong>。 字体1： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/5.png" alt=""> 字体2： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/8.png" alt=""> 所以想通过写死的方式也是行不通的。 这个时候我们就要对字体文件进行更深一步的研究了。 <strong>3、研究字体文件</strong> 刚刚的.ttf文件我们是看不到内部的东西的，所以这个时候我们要对字体文件进行转换格式，将其转换为xml格式，然后来查看： 具体操作如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from fontTools.ttLib import TTFont</span><br><span class="line">font_1 = <span class="constructor">TTFont('58_font_1.<span class="params">ttf</span>')</span></span><br><span class="line">font_base.save<span class="constructor">XML('<span class="params">font_1</span>.<span class="params">xml</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>xml的格式如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/9-1.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/10.png" alt=""> 文件很长，我只截取了一部分。 <strong>仔细的观察一下，你会发现~这俩下面的x,y,on值都是一毛一样的。所以我们的思路就是以一个已知的字体文件为基本，然后将获取到的新的字体文件的每个文字对应的x,y,on值进行比较，如果相同，那么说明新的文字对就 可以在基础字体那里找到对应的文字，有点绕，下面举个小例子。</strong> <strong>假设: “我” 在基本字体中的名为uni1，对应的x=1,y=1,n=1新的字体文件中，一个名为uni2对应的x，y, n分别于上面的相等，那么这个时候就可以确定uni2 对应的文字为”我”。</strong> <strong>查资料的时候，发现在特殊情况下，有时候两个字体中的文字对应的x,y不相等，但是差距都是在某一个阈值之内，处理方法差不多，只不过上面是相等，这种情况下就是要比较一下。</strong> 其实，如果你用画图工具按照上面的x与y值把点给连起来，你会发现，就是汉字的字形~ 所以，到此总结一下：</p>
                  <blockquote>
                    <p><strong>一、将某次请求获取到的字体文件保存到本地[基本字体]；</strong> <strong>二、用软件打开后，人工的找出每一个数字对应的编码[</strong> <strong>一定要保证顺序的正确，要不然会出事]；</strong> <strong>三、我们以后访问网页时，需要保存新字体文件；</strong> <strong>四、用Fonttools库对基本字体与新字体进行处理，找</strong> <strong>到新的字体与基本字体之间的映射；</strong> <strong>五、替换；</strong></p>
                  </blockquote>
                  <h2 id="4、上代码"><a href="#4、上代码" class="headerlink" title="4、上代码"></a><strong>4、上代码</strong></h2>
                  <p>微信里上代码真的太丑了， 还是算了吧，微信后台关键词“<strong>字体加密</strong>” 即可获取github地址。 看一下成果 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/02/11.png" alt=""> </p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2>
                  <p>其实这个流程最大的问题就是我们人工录入的基本字体的字典数据有可能是会发生变化的，这就导致我们后面还要手动去改。 现在，如果你已经看懂了本文，那么还不快去其他几个网站试试？ 如果有任何问题，欢迎交流。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-02-20 21:22:24" itemprop="dateCreated datePublished" datetime="2019-02-20T21:22:24+08:00">2019-02-20</time>
                </span>
                <span id="/6431.html" class="post-meta-item leancloud_visitors" data-flag-title="今天，我终于弄懂了字体反爬是个啥玩意！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6408.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6408.html" class="post-title-link" itemprop="url">第一次见到这种反爬虫。咋办？盘它。</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，欢迎大家关注我的公众号。"><a href="#大家好，我是四毛，欢迎大家关注我的公众号。" class="headerlink" title="大家好，我是四毛，欢迎大家关注我的公众号。"></a>大家好，我是四毛，欢迎大家关注我的公众号。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> 今天在工作中，碰到了第一次碰见的反爬虫机制，感觉很有意思，在这里记录一下，希望对大家有帮助。</p>
                  <h2 id="今天用到的库："><a href="#今天用到的库：" class="headerlink" title="今天用到的库："></a><strong>今天用到的库</strong>：</h2>
                  <blockquote>
                    <p>requests [请求] lzstring [解压数据] pyexecjs [执行JS]</p>
                  </blockquote>
                  <p> 简单粗暴，直接上网站部分源代码，因为这个网站应该不太希望别人来爬，所以就不上网站了。为什么这么说，因为刚开始请求的时候，老是给我返回GO TO HELL ，哈哈。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/兔子.gif" alt=""> 这个网站点击鼠标右键审查元素，查看网页源代码是无法用的，但是这个好像只能防住小白啊，<strong>简单的按F12审查元素，CTRL+u 直接查看源代码（谷歌浏览器）</strong>。 这次的目的主要是为了获取下面的链接（重度打码）</p>
                  <blockquote>
                    <p>xxxxxxxxxxx/<strong>xxxxx-003-a5f7xxxxxx</strong>?cid=xxxxx&amp;xxx=<strong>siOE_q4XxBtwdoXqD0xxxx</strong></p>
                  </blockquote>
                  <p>其中，红色加粗的就是我们要找的变量了。</p>
                  <h2 id="一、观察与抓包"><a href="#一、观察与抓包" class="headerlink" title="一、观察与抓包"></a>一、观察与抓包</h2>
                  <p><strong>首先</strong>，我观察到了网页源代码中的一部分js代码：</p>
                  <blockquote>
                    <p>type=”text/javascript”&gt;window<a href="function(p,a,c,k,e,d">“\x65\x76\x61\x6c”</a>{e=function(c){return(c<a?"":e(parseInt(c /a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!’’.replace(/^/,String)){while(c—)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return’\\w+’};c=1;};while(c—)if(k[c])p=p.replace(new RegExp(‘\\b’+e(c)+’\\b’,’g’),k[c]);return p;}(‘29.2a({“2c”:1k,”26”:”21”,”22”:”1k.24”,”2o”:2n,”2s”:”2r”,”2l”:[“0-2f-2e.3.2”,”0-2j-2i.3.2”,”0-1r-1L.3.2”,”0-1r-1K.3.2”,”0-1e-1X.3.2”,”0-1e-1Q.3.2”,”0-1x-1W.3.2”,”0-1x-1M.3.2”,”0-1B-33.3.2”,”0-1B-36.3.2”,”0-1F-30.3.2”,”0-1F-2U.3.2”,”0-1g-2Y.3.2”,”0-1g-3e.3.2”,”0-1q-3i.3.2”,”0-1q-38.3.2”,”0-1o-37.3.2”,”0-1o-3a.3.2”,”0-1s-2B.3.2”,”0-1s-2E.3.2”,”0-1i-2v.3.2”,”0-1i-2y.3.2”,”0-1G-2P.3.2”,”0-1G-2S.3.2”,”0-1E-2R.3.2”,”0-1E-2H.3.2”,”0-1I-2L.3.2”,”0-1I-2J.3.2”,”0-t-2K.3.2”,”0-t-2G.3.2”,”0-p-2I.3.2”,”0-p-2M.3.2”,”0-o-2Q.3.2”,”0-o-2N.3.2”,”0-u-2O.3.2”,”0-u-2w.3.2”,”0-D-2x.3.2”,”0-D-2t.3.2”,”0-z-2u.3.2”,”0-z-2z.3.2”,”0-y-2D.3.2”,”0-y-2F.3.2”,”0-7-2A.3.2”,”0-7-2C.3.2”,”0-5-2T.3.2”,”0-5-3b.3.2”,”0-4-3c.3.2”,”0-4-39.3.2”,”0-g-3d.3.2”,”0-g-3h.3.2”,”0-i-3j.3.2”,”0-i-3f.3.2”,”0-b-3g.3.2”,”0-b-2X.3.2”,”0-d-2Z.3.2”,”0-d-2V.3.2”,”0-11-2W.3.2”,”0-11-34.3.2”,”0-13-35.3.2”,”0-13-31.3.2”,”0-10-32.3.2”,”0-10-1J.3.2”,”0-15-1O.3.2”,”0-15-1P.3.2”,”0-1d-1R.3.2”,……………………………………,’M4UxFsAsB9odxAIwA7WQOwObQAwCYBWXPAFlwHYBmY6ncousuvYgDlwDZ38BOT8zn3wcKARmICKOXK1qsmrFjlHdRAnKxEb1rBqK2ih5dSSbkteJXnEbpGm+SF47HLZSEElBOwRsEmlOqU3AS0JHYkWiRKJAwkYTYkQiQmIQwcShy0HDaUSpQuDJQ2HAG0BEFFWgTVQhw+3JRMOEw8Shq4PK……………………………………..GHXTzLjxjzN5CziB+3ODSAhicwuCyeBJ3YJD+eKhEi83fHm76PmK3Y/htPJFzw8LzOCqKTMcXGHr7Jm/nlPtuSUfPBAA===’<a href="&#39;\\x7c&#39;">‘\x73\x70\x6c\x69\x63’</a>,0,{})) &lt;/script&gt;</p>
                  </blockquote>
                  <p>为了节省篇幅，我把一些替换成…….了。如果你对这些数据的解压有兴趣，请后台联系我。 我第一眼看见时，做了2件事： 1、把[\x65\x76\x61\x6c]，[ \x73\x70\x6c\x69\x63]，[\x7c]分别解码，解码出的结果为eval和splic，| ； <strong>注：</strong>其实这里看到eval时就应该想到可以试试直接用pyexecjs执行后面的那段js匿名函数，但是当时确实啥都没有想起来，很惭愧，后来复盘时才发现这一点。虽然执行了也会报错。 2、把那一长串的字母试着用base64解码了，但是解不出来； <strong>然后，</strong>就只能再去其他js文件里找了，也找到了js代码，打了断点，但是看着还是很烦，于是这个时候我就没有在js上面死抠。 <strong>接着</strong>，我调转了方向，在GITHUB，Google运用了我祖传的高级搜索技巧，Finally，终于可以盘它了。</p>
                  <h2 id="二、解密"><a href="#二、解密" class="headerlink" title="二、解密"></a>二、解密</h2>
                  <p>下面开始解密： 1、<strong>数据解压</strong> 包含A===的字符串到底时啥呢，其实<strong>这个是js的一种数据的压缩方式</strong>，知道了这种方式你就可以立即破解这种反爬虫机制了，反正我以前是不知道的，第一次见到，学习了。 在这里，lzstring闪亮登场，运用这个库，执行下面的代码：</p>
                  <blockquote>
                    <p>lzstring.LZString().decompressFromBase64(string)</p>
                  </blockquote>
                  <p>这样就可以把上面的那串字符给解码了，解出来的数据像下面这样：</p>
                  <blockquote>
                    <p><strong>webp|png|025|024|073</strong></p>
                  </blockquote>
                  <p>没错，数据解压就是这么的简单； 2、<strong>看懂JS</strong> 我们在上面解码出来了一个splic和一个[ | ]，再看看我们上面解压出来的数据，是不是很有感觉；但是，查了好一会资料，也没有发现js里面有这个方法，可能是在别的地方定义了；在我找到的资料里面，那个作者是直接用了split，最后的结果是对的，走逻辑上也说得过去，不知道为什么这么设置成splic，还希望有大神可以指教； 3、<strong>执行JS</strong> 所以，到这里就很明显了，把解码以后以及解压以后的数据在替换会原js数据中，我们前面解码出来的eval就有用了，我找到的资料里面作者使用node做的，我没有安装node环境，所以我就直接用了pyexecjs.eval直接执行了，结果也正确； 4、<strong>梳理流程</strong>： 匹配长字符串==&gt;lzstring解压+解码后的字段==&gt;拼凑成新的js代码==&gt;pyexecjs执行==&gt;出结果 5、<strong>部分代码</strong> 执行的主要步骤和结果</p>
                  <blockquote>
                    <p>execjs.eval(res)</p>
                  </blockquote>
                  <p>没错，就是这么简单，res就是替换后的js，然后就可以直接出来我们上面网址中需要的两个字段了。 截个图吧 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/01/2.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2019/01/3.png" alt=""> </p>
                  <h2 id="三、结语"><a href="#三、结语" class="headerlink" title="三、结语"></a>三、结语</h2>
                  <p>到这里，今天的文章就结束了，总结一下就是<strong>知道了一种JS数据的压缩方式，并且学习了解压的方式，JS的执行，同时写代码的时候**</strong>多观察，多想，多试**。 如果觉得还不错，欢迎动动手指关注我。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-26 18:49:29" itemprop="dateCreated datePublished" datetime="2019-01-26T18:49:29+08:00">2019-01-26</time>
                </span>
                <span id="/6408.html" class="post-meta-item leancloud_visitors" data-flag-title="第一次见到这种反爬虫。咋办？盘它。" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6341.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6341.html" class="post-title-link" itemprop="url">大众点评还不会爬？跟着我，我教你。</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。"><a href="#大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。" class="headerlink" title="大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。"></a>大家好，我是四毛，好久没有写东西了，欢迎大家关注我的公众号。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> 今天的文章是关于如何使用requests来爬取大众点评的数据。 看完本文，你可以：</p>
                  <blockquote>
                    <p>1、了解大众点评的CSS反爬虫机制 2、破解反爬虫机制 3、使用requests即可正确获取到评论数，平均价格，服务，味道，环境数据，评论文本数据；</p>
                  </blockquote>
                  <p> 如果你想跟我继续交流的话，欢迎加我的个人微信，二维码在最后。 <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong> 同时，代码我并<strong>没有做太多的优化，因为没有大量的代理，爬不了太多的内容。</strong> <strong>这里只是跟大家分享一下处理的流程。欢迎来公众号留言探讨。</strong> </p>
                  <h1 id="正文开始。"><a href="#正文开始。" class="headerlink" title="正文开始。"></a><strong>正文开始。</strong></h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/兔子.gif" alt=""></p>
                  <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2>
                  <p>在工作生活中，发现越来越多的人对大众点评的数据感兴趣，而大众点评的反爬又是比较严格的。采取的策略差不多是宁可错杀一万，也不放过一个。有的时候正常浏览都会跳出验证码。 另外，在PC端的展示数据是通过CSS来控制的，从网页上看不出来太大的区别，但是用普通的脚本取获取时，会发现数据是获取不到的，具体的源代码是下面这样的： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205192407.png" alt=""> 然，在搜资料的时候，你会发现，很多教程都是用的selenium之类的方法，效率太低，没有啥技术含量。 所以，这篇文章的面向的对象就是PC端的大众点评；目标是解决这种反爬虫措施，使用requests获取到干净正确的数据； 跟着我，绝不会让你失望。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/HGXSM1O5KGB_QWQDIC.gif" alt=""></p>
                  <h2 id="2-正文开始"><a href="#2-正文开始" class="headerlink" title="2.正文开始"></a>2.正文开始</h2>
                  <p>相信搞过大众点评网站的同学都应该知道上面的这种是一个css反爬的方法，具体的解析操作，即将开始。</p>
                  <h4 id="找到藏着秘密的css"><a href="#找到藏着秘密的css" class="headerlink" title="找到藏着秘密的css"></a>找到藏着秘密的css</h4>
                  <p>当我们的鼠标在上面框框内的span上面点击时，会发现右边部分会相应的发生变化： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205193028.png" alt=""> 这张图片<strong>很重要，很重要，很重要</strong>，我们要的值，几乎都从这里匹配出来。 这里我们看到了“<strong>vxt20</strong>”这个变量对应的两个像素值，<strong>前面的是控制用哪个数字，后面的是控制用哪一段的数字集合</strong>，先记下，后面要用，同时这里的值应该是6； 这里其实就是整个破解流程最关键的一步了。在这里我们看到了一个链接。 瞎猫当死耗子吧，点进去看看。 <a href="https://s3plus.meituan.net/v1/mss_0a06a471f9514fc79c981b5466f56b91/svgtextcss/f556c0559161832a4c6192e097db3dc2.svg" target="_blank" rel="noopener">https://s3plus.meituan.net/v1/mss_0a06a471f9514fc79c981b5466f56b91/svgtextcss/f556c0559161832a4c6192e097db3dc2.svg</a> 你会发现，返回的是一些数字，我一开始是不知道这是啥玩意的，看过一些大神的解析才知道，其实这里就是我们看到的数字的来源，也就是整个破解的源头，知道了这些数字的含义，也就可以直接破解了整个反爬的流程。 现在直接看源代码： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205193754.png" alt=""> 可以看到这里面的几个关键数字：font-size：字体大小；还有几个y的值，我到后面才知道原来这个y是个阈值，起的是个控制的作用。 所以，这一反爬的原理就是：</p>
                  <blockquote>
                    <p>获取属性值与偏移量和阈值映射，然后从svg文件中找到真数据。</p>
                  </blockquote>
                  <p>现在我们就要用到上面的像素值了。</p>
                  <blockquote>
                    <p>1.把所有的值取绝对值； 2.用后面的值来选择用哪个段的数字，这里的值是103，所以使用第三个段的数字集合； 3.因为每个字体是12个像素，所以用163/12=13.58，约等于14，那么我们数一下第14个数字是啥，没错，是6，和预期一样。你可以多试验几次。</p>
                  </blockquote>
                  <p>以上，就是整个破解的逻辑过程。 画个流程图，装个逼： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/跨职能流程图（水平）.png" alt=""></p>
                  <h2 id="3-Show-Code"><a href="#3-Show-Code" class="headerlink" title="3.Show Code"></a>3.Show Code</h2>
                  <p>下面开始晒代码，俗话说得好，天下代码一大抄。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" alt="">这里对主要的步骤代码进行解释， <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong>。 <strong>1.获取css_url及span对应的TAG值；</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tag</span><span class="params">(_list, offset=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 从第一个开始查</span></span><br><span class="line">    _new_list = [data[<span class="number">0</span>:offset] <span class="keyword">for</span> data <span class="keyword">in</span> _list]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(set(_new_list)) == <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 如果set后只有一个值，说明全部重复，这个时候就把offset加1</span></span><br><span class="line">        offset += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> get_tag(_list, offset)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        _return_data = [data[<span class="number">0</span>:offset - <span class="number">1</span>] <span class="keyword">for</span> data <span class="keyword">in</span> _list][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _return_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_css_and_tag</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param url: 待爬链接</span></span><br><span class="line"><span class="string">    :return: css链接，该span对应的tag</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    find_css_url = re.search(<span class="string">r'href="([^"]+svgtextcss[^"]+)"'</span>, content, re.M)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> find_css_url:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"cannot find css_url ,check"</span>)</span><br><span class="line">    css_url = find_css_url.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    css_url = <span class="string">"https:"</span> + css_url</span><br><span class="line">    <span class="comment"># 这个网页上不同的字段是由不同的css段来进行控制的，所以要找到这个评论数据对应的tag，在这里返回的值为vx；而在获取评论数据时，tag就是fu-;</span></span><br><span class="line">    <span class="comment"># 具体可以观察上面截图的3个span对应的属性值，相等的最长部分为vx</span></span><br><span class="line">    class_tag = re.findall(<span class="string">"&lt;b class=\"(.*?)\"&gt;&lt;/b&gt;"</span>, content)</span><br><span class="line">    _tag = get_tag(class_tag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> css_url, _tag</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>2.获取属性与像素值的对应关系</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_css_and_px_dict</span><span class="params">(css_url)</span>:</span></span><br><span class="line">    con = requests.get(css_url, headers=headers).content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    find_datas = re.findall(<span class="string">r'(\.[a-zA-Z0-9-]+)\&#123;background:(\-\d+\.\d+)px (\-\d+\.\d+)px'</span>, con)</span><br><span class="line">    css_name_and_px = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> find_datas:</span><br><span class="line">        <span class="comment"># 属性对应的值</span></span><br><span class="line">        span_class_attr_name= data[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line">        <span class="comment"># 偏移量</span></span><br><span class="line">        offset = data[<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 阈值</span></span><br><span class="line">        position = data[<span class="number">2</span>]</span><br><span class="line">        css_name_and_px[span_class_attr_name] = [offset, position]</span><br><span class="line">    <span class="keyword">return</span> css_name_and_px</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> <strong>3.获取svg文件的url</strong></p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_svg_threshold_and_int_dict</span><span class="params">(css_url, _tag)</span>:</span></span><br><span class="line">    con = requests.get(css_url, headers=headers).content.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    index_and_word_dict = &#123;&#125;</span><br><span class="line">    <span class="comment"># 根据tag值匹配到相应的svg的网址</span></span><br><span class="line"></span><br><span class="line">    find_svg_url = re.search(<span class="string">r'span[class\^="%s"].*?background\-image: url\((.*?)\);'</span> % _tag, con)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> find_svg_url:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">"cannot find svg file, check"</span>)</span><br><span class="line">    svg_url = find_svg_url.group(<span class="number">1</span>)</span><br><span class="line">    svg_url = <span class="string">"https:"</span> + svg_url</span><br><span class="line">    svg_content = requests.get(svg_url, headers=headers).content</span><br><span class="line">    root = H.document_fromstring(svg_content)</span><br><span class="line">    datas = root.xpath(<span class="string">"//text"</span>)</span><br><span class="line">    <span class="comment"># 把阈值和对应的数字集合放入一个字典中</span></span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> index, data <span class="keyword">in</span> enumerate(datas):</span><br><span class="line">        y = int(data.xpath(<span class="string">'@y'</span>)[<span class="number">0</span>])</span><br><span class="line">        int_data = data.xpath(<span class="string">'text()'</span>)[<span class="number">0</span>]</span><br><span class="line">        index_and_word_dict[int_data] = range(last, y+<span class="number">1</span>)</span><br><span class="line">        last = y</span><br><span class="line">    <span class="keyword">return</span> index_and_word_dict</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> <strong>4. 获取最终的值</strong></p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def get_data(url ):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    :param page_url: 待获取url</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="attr">con</span> = requests.get(url, <span class="attr">headers=headers).content.decode("utf-8")</span></span><br><span class="line">    <span class="comment"># 获取css url，及tag</span></span><br><span class="line">    css_url, <span class="attr">_tag</span> = get_css(con)</span><br><span class="line">    <span class="comment"># 获取css对应名与像素的映射</span></span><br><span class="line">    <span class="attr">css_and_px_dict</span> = get_css_and_px_dict(css_url)</span><br><span class="line">    <span class="comment"># 获取svg的阈值与数字集合的映射</span></span><br><span class="line">    <span class="attr">svg_threshold_and_int_dict</span> = get_svg_threshold_and_int_dict(css_url, _tag)</span><br><span class="line"></span><br><span class="line">    <span class="attr">doc</span> = etree.HTML(con)</span><br><span class="line">    <span class="attr">shops</span> = doc.xpath('//div[@<span class="attr">id="shop-all-list"]/ul/li')</span></span><br><span class="line">    for shop <span class="keyword">in</span> shops:</span><br><span class="line">        <span class="comment"># 店名</span></span><br><span class="line">        <span class="attr">name</span> = shop.xpath('.//div[@<span class="attr">class="tit"]/a')[0].attrib["title"]</span></span><br><span class="line">        print name</span><br><span class="line">        <span class="attr">comment_num</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">comment_and_price_datas</span> = shop.xpath('.//div[@<span class="attr">class="comment"]')</span></span><br><span class="line">        for comment_and_price_data <span class="keyword">in</span> comment_and_price_datas:</span><br><span class="line">            <span class="attr">_comment_data</span> = comment_and_price_data.xpath('a[@<span class="attr">class="review-num"]/b/node()')</span></span><br><span class="line">            <span class="comment"># 遍历每一个node，这里node的类型不同，分别有etree._ElementStringResult(字符)，etree._Element（元素），etree._ElementUnicodeResult（字符）</span></span><br><span class="line">            for _node <span class="keyword">in</span> _comment_data:</span><br><span class="line">                <span class="comment"># 如果是字符，则直接取出</span></span><br><span class="line">                <span class="keyword">if</span> isinstance(_node, etree._ElementStringResult):</span><br><span class="line">                    <span class="attr">comment_num</span> = comment_num * <span class="number">10</span> + int(_node)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 如果是span类型，则要去找数据</span></span><br><span class="line">                    <span class="comment"># span class的attr</span></span><br><span class="line">                    <span class="attr">span_class_attr_name</span> = _node.attrib[<span class="string">"class"</span>]</span><br><span class="line">                    <span class="comment"># 偏移量，以及所处的段</span></span><br><span class="line">                    offset, <span class="attr">position</span> = css_and_px_dict[span_class_attr_name]</span><br><span class="line">                    <span class="attr">index</span> = abs(int(float(offset) ))</span><br><span class="line">                    <span class="attr">position</span> = abs(int(float(position)))</span><br><span class="line">                    <span class="comment"># 判断</span></span><br><span class="line">                    for key, value <span class="keyword">in</span> svg_threshold_and_int_dict.iteritems():</span><br><span class="line">                        <span class="keyword">if</span> position <span class="keyword">in</span> value:</span><br><span class="line">                            <span class="attr">threshold</span> = int(math.ceil(index/<span class="number">12</span>))</span><br><span class="line">                            <span class="attr">number</span> = int(key[threshold])</span><br><span class="line">                            <span class="attr">comment_num</span> = comment_num * <span class="number">10</span> + number</span><br><span class="line">            print comment_num</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-结果展示"><a href="#4-结果展示" class="headerlink" title="4.结果展示"></a>4.结果展示</h2>
                  <h3 id="评论条数数据"><a href="#评论条数数据" class="headerlink" title="评论条数数据"></a>评论条数数据</h3>
                  <p>其实，其他的我都写好了，就不贴了 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205205030.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205205218.png" alt=""> </p>
                  <h3 id="评论具体数据"><a href="#评论具体数据" class="headerlink" title="评论具体数据"></a>评论具体数据</h3>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205211804.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/微信截图_20181205211954.png" alt=""> </p>
                  <h2 id="5-结语"><a href="#5-结语" class="headerlink" title="5.结语"></a>5.结语</h2>
                  <p>以上就是大众点评Css反爬破解的全部步骤和部分代码。 <strong>如果你想获取更多的代码，请关注我的公众号，并发送 “大众点评”即可。</strong> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-24 14:07:53" itemprop="dateCreated datePublished" datetime="2019-01-24T14:07:53+08:00">2019-01-24</time>
                </span>
                <span id="/6341.html" class="post-meta-item leancloud_visitors" data-flag-title="大众点评还不会爬？跟着我，我教你。" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6401.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/6401.html" class="post-title-link" itemprop="url">2018 年终总结：成就不算少，进步不算多</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近一段时间没有更新原创文章了，主要是因为最近整个在忙硕士毕业的各种事情，毕业答辩完了以后休假了一小段时间，整个十二月就这么过去了。 转眼已经 2019 年了，其实去年我并没有写年终总结，现在到头来还是蛮后悔的，说实话总结其实还是蛮有必要的，现在就趁着这个时间来对自己的 2018 做一下总结，并立一下 2019 的一些 Flag，再等到 2020 年翻出来打脸吧。 世界上最了解自己的人当然是自己，一句话总结我的 2018 可以说是： <strong>成就不算少，进步不算多</strong> 的一年。为什么成就不算少呢？因为今年可能发生的事相比我之前几年，自己取得了一些从未有的成就，或者完成了一些比较重要的事情。下面就先总结一下自己取得的一些成就吧： <strong>1. 2018 年中出版了自己人生中第一本书籍作品《Python3网络爬虫开发实战》，半年多时间现在已经累计印刷九次，共计 45000 册，上市初长期处在京东科技新书榜第一位的位置，豆瓣评分 9.2。</strong> <strong>2. 2018 年 1 月 20 日正式开始运营自己的个人公众号“进击的Coder”，发布了两百多篇文章，其中大约一半为原创，粉丝现在是 25000 多人。</strong> <strong>3. 发布了自己开发的一款分布式网络爬虫管理框架 Gerapy，可以完成爬虫项目的配置、部署、管理、监控等功能，目前 GitHub 上 Star 数目将近 1000。</strong> <strong>4. 在 GitHub 上创建和贡献了近 100 个项目，目前个人 Followers 达到 3000 人，收获 Star 数目在 2000 左右。</strong> <strong>5. 开始从事机器学习、深度学习方向的研究和开发，并发布了自己开发的一套深度学习脚手架 ModelZoo，并不断对接各种模型，持续完善中。</strong> <strong>6. 比较顺利地完成秋招，并最终拿到了微软的 Offer，达成理想的结果。</strong> <strong>7. 完成了多次大型公开演讲并结识了许多优秀的业界大佬。</strong> <strong>8. 顺利地完成了毕业论文和毕业答辩，成功取得北航硕士学位。</strong> <strong>9. 凭借自己赚得人生第二桶金，实现收入翻番。</strong> <strong>10. Last but not least，她。</strong> 当然还有一些其他的就不再一一列举了。这些可能有的跟一些大佬比起来可能真的是小巫见大巫，不过对我来说，这些成就我总体还是比较满意的。 在这些成就里，有些是真的改变我人生轨迹的事情，有些可能只是我人生路顺理成章踏过去的事情，有的可能只是昙花一现几年后毫无价值的东西。但拿掉其中一个，不管是看似有用或者没用的，也可能会产生意想不到的影响，他们确实是我真实经历过，并出现在我生命旅途中的一部分。 本来把成就一个个地展开来说，但后来想想没这个必要。昨日取得的成就就让它过去吧，不要念过去，把更多的精力着眼在未来吧。重要的在于，我在这一年里收获了多少，这些收获的东西能够为我未来的成长带来多少价值。以及另外重要的是，对过去的反思，我还有哪些做的不好的地方，我需要在未来做怎样的调整。 所以为什么说进步不算多呢？虽然自己达成了某些目标，但我真的没怎么感觉到自己相比去年年初的自己有特别大的成长，或许一切都是潜移默化的，或许真的把我现在放回到 2018年初，和现在的自己相比，我才会感觉到差别，但现在自己仿佛真的感觉自己本身和之前没有太多不同。但总的来说，我还有非常多需要反思和改进的地方。 下面再好好反思下自己吧，我总觉得自己的这一年，自己的有些方面做得不够好，总体体现在这么几个方面吧： <strong>1. 拖延症</strong>。还是觉得自己的拖延症太严重，执行力还不够好。有些事总是会拖个好几天才完成，没太有恒心。或者有的时候这件事到了要做的时间，却又不想做。之前也会有，但是感觉今年犯的很严重。其实我挺佩服那些持之以恒的人的，自制力和执行力真的很重要。 <strong>2. 记录少</strong>。挺多自己觉得会的东西，由于懒或者忙，没有记下来，其实还是因为懒。到头来发现真正学会的其实仅仅就是自己记录的部分，因为当时没做记录的，又忘得一干二净了。所以我总体感觉，今年输出的文章并不多。 <strong>3. 白忙活</strong>。这一年来，其实回想起来，感觉做的无用功是很多了。许多事情感觉做完了之后，真正的价值并不大，所以这个真的需要我来好好权衡。 4. <strong>虎头蛇尾</strong>。由于自己的很多事情安排的满满当当，所以有的项目可能就容易被搁置了，导致有一些项目做得虎头蛇尾，草草收场，想想还是很可惜的，但有时候就是缺乏那重新捡起来的一步动力，这个必须得改。 <strong>5. 时间规划</strong>。我使用 Todoist 已经好多年了，感谢它帮我完成了大部分的时间规划，但有些时候发现还是有些不够好。我多少还会有一些小事优先，大事拖延的倾向，但总体来说已经把握得还算可以了，还得继续加油。 <strong>6. 缺乏锻炼</strong>。平时事情安排的挺多，有时候也懒得去健身房锻炼，唯一锻炼的时间就是睡前的几分钟了，但是效果不大。可能偶尔一时兴起会去几次健身房，但是还是难以坚持下来。虽然还没感觉到身体有啥不适，但也得加强锻炼了。 所以总体感觉下来，感觉到自己做的不够好的地方还有很多，或许真的要改正对我来说真的挺难，但我也要尽力去做的更好。 这一年中，领悟或贯彻的一些理念也不少，其实太多太多，在这里也不能一一列举了，这里就把现在想到的一些说一下吧： <strong>1. 做一件事前，想想这件事的意义和成本有多大，别把时间浪费在无意义的事情上面。</strong> <strong>2. 记录和总结真的很重要。别以为自己当时记住了，等回过头来，你有时候会发现自己的收获就是你所记录的那一部分，没有记录的你想也想不起来了。</strong> <strong>3. 如果自己没本事，认识很多牛人，没什么太大意义，重要的还是自己要牛逼，多投资自己。自己牛逼了，别人就都会看到你了。</strong> <strong>4. 成年人、社会人的世界，有太多大家都已经默认的规矩，自己要去懂，没几个人会教你。</strong> <strong>5. 钱，不能保证能买到所有东西，但是它的确可以提供便利或者免去不必要的麻烦。它是可以增加幸福感的。</strong> <strong>6. 如果想要赚钱，最好不要选和时间或精力成正比的事情，多考虑复利。</strong> <strong>7. 如果一件东西，花了钱，买到的又不是达到自己预期的，这是双亏。如果买到的是自己所满意或喜欢的的，这就是值的。</strong> <strong>8. 选择比努力很重要，眼界比本事更重要。</strong> <strong>9. 所有的一切，如果有能力，就不要将就，可能一时由于自己的能力还无法改变，但一定不要丢了改变下去的动力。</strong> <strong>10. 如果一件事是自己不喜欢的但是非要做，那就用最短的时间去完成。</strong> <strong>11. 健康第一。</strong> 还有很多，就暂且写这些吧。这是我现阶段所领悟到的一些东西，也是我成长路上的一种认知转变过程吧。也可能再过几年我就不会这么想了。不过现阶段我会秉承这些理念继续前行。 最后就立几个 2019 年的 Flag 吧（等明年翻出来打脸： <strong>1. 踏入社会和职场的第一年，好好工作，把握好节奏。</strong> <strong>2. 完成《Python3网络爬虫开发实战（第二版）》以及现在初步规划的另外的两部作品（名称尚未完全确定暂不透露。</strong> <strong>3. 微信公众号读者粉丝在 2019 年底达到 10 万。</strong> <strong>4. 自己的 Gerapy、ModelZoo 两个项目持续运营维护，力求完善。</strong> <strong>5. 坚持记录，持续输出（内容规划了挺多），达到自己内心中设定的基本目标。</strong> <strong>6. 2019 年年收入比 2018 年继续翻番。</strong> <strong>7. 结识更多的人，扩展更广的人脉。</strong> <strong>8. Last but not least，和她好好地在一起，过我们的向往的生活，做喜欢的事情。</strong> 好啦，感谢大家一直以来的支持！新的一年，继续努力！愿我们都成为更好的自己！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-01-06 00:31:48" itemprop="dateCreated datePublished" datetime="2019-01-06T00:31:48+08:00">2019-01-06</time>
                </span>
                <span id="/6401.html" class="post-meta-item leancloud_visitors" data-flag-title="2018 年终总结：成就不算少，进步不算多" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6378.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6378.html" class="post-title-link" itemprop="url">小白学爬虫之代理(公有云)</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/HGXSM1O5KGB_QWQDIC.gif" alt=""> Hello 各位小伙伴 雷门吼！</p>
                  <h2 id="在教程之前首先申明！此教程适合土豪不缺钱的玩家"><a href="#在教程之前首先申明！此教程适合土豪不缺钱的玩家" class="headerlink" title="在教程之前首先申明！此教程适合土豪不缺钱的玩家"></a><strong>在教程之前首先申明！此教程适合土豪不缺钱的玩家</strong></h2>
                  <p>潜水了许久了，今天来更新点东西~ 今天说点啥呢？ 那就是<strong>代理</strong>！！ 代理在爬虫界的重要作用相信各位应该清楚吧！毕竟绝大部分反爬可以靠<strong>代理</strong>解决；不能被代理解决的也得要<strong>代理</strong>配合解决。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/03/FCADE87DD50A4DE0DCB39A3FA5F4A5C0-1.jpg" alt=""> 市面上各种代理也是琳琅满目的说··· 相信大家最喜欢用的之一应该就是 <strong>某布云。</strong> 根据官网的显示他他家的代理是这个样子的：</p>
                  <ul>
                    <li><strong>无须切换 IP，每一个请求一个随机 IP。</strong></li>
                  </ul>
                  <p>哇！感觉很爽的样子今天我们就来实现一个类似的代理！ 其实 So Easy！ 我们需要借助 <strong>公有云</strong> 来实现。 下面我以 AWS 举例(其它公有云操作类似，唯一的区别的就是：各个服务的名字不同而已) </p>
                  <ol>
                    <li>首先我们需要需要使用EC2来建立一个代理（Google Could 叫 GCE）<ol>
                        <li>安装Squid（当然你可以使用其它的代理）<ol>
                            <li>无认证安装参考这儿(<a href="https://cuiqingcai.com/3443.html">点我</a>)设置代理服务器那一段</li>
                            <li>MySQL认证安装(<a href="https://www.thsheep.com/post/squid+mysql%E8%AE%A4%E8%AF%81/" target="_blank" rel="noopener">点我</a>)</li>
                            <li><strong>Note: 请注意检查！！！务必设置Ipv4转发</strong></li>
                          </ol>
                        </li>
                      </ol>
                    </li>
                    <li>安装完成之后我们制作启动模板（毕竟一个EC2 一个IP 你总不能安装很多很多台吧！会死人的）<ol>
                        <li>注意设置你的安全组！正常情况下 入站规则只应该有你需要的端口（squid使用的端口一定要放心！嫌麻烦的小伙伴儿 可以进出都放行全部流量！）出站则是全部流量！</li>
                        <li>启动EC2的时候选择安全组<strong>一定要看清是否是设置过放行的规则</strong>！ 不要选错了！</li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/ec2.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/制作启动镜像01.jpg" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/制作启动镜像02.png" alt=""></li>
                        <li>好了现在就可以批量启动了！<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/从模板启动实例.png" alt=""></li>
                        <li>实例数量就是需要<strong>同时</strong>有多少个IP就启动多少个了。<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/从模板启动实例01.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/启动结果.png" alt=""></li>
                      </ol>
                    </li>
                    <li>设置前端负载均衡（提供一个固定地址，这个地址负责随机将请求转发到后端代理服务器上）<ol>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器01.png" alt=""></li>
                        <li>必须使用TCP四层负载！原因为啥大家自己百度一哈<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器02.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器03.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器04.png" alt=""></li>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/负载均衡器05.png" alt=""></li>
                        <li>等待负载均衡器启动完成！</li>
                        <li>启动完成后获取负载地址<img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/代理地址.png" alt=""></li>
                      </ol>
                    </li>
                    <li>下面来测试一下效果！<ol>
                        <li><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/12/测试IP.png" alt=""></li>
                      </ol>
                    </li>
                  </ol>
                  <p>以上完毕！你可以不停的重启Ec2实例！你就有百万IP池啦！！（前提是你有钱啊） 下面是重启Ec2的示例：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">from</span> boto3 <span class="keyword">import</span> setup_default_session</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setup_default_session(aws_access_key_id=<span class="string">'XXXXXX'</span>,</span><br><span class="line">                      aws_secret_access_key=<span class="string">'XXXXXX'</span>,</span><br><span class="line">                      region_name=<span class="string">'区域'</span>)</span><br><span class="line"></span><br><span class="line">ec2 = boto3.client(<span class="string">'ec2'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_public_ip_address</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取IP和实例ID</span></span><br><span class="line"><span class="string">    :return: &#123;实例ID: ip&#125;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    response = ec2.describe_instances()</span><br><span class="line">    reservations = response.get(<span class="string">'Reservations'</span>)</span><br><span class="line">    instances = [i.get(<span class="string">'Instances'</span>)[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> reservations]</span><br><span class="line">    instance_id_public_ip_address = &#123;i.get(<span class="string">'InstanceId'</span>): i.get(<span class="string">'PublicIpAddress'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> instances&#125;</span><br><span class="line">    <span class="keyword">return</span> instance_id_public_ip_address</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reboot_ec2</span><span class="params">(ip)</span>:</span></span><br><span class="line">    <span class="string">"""重启实例</span></span><br><span class="line"><span class="string">    :param ip: </span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    instance_id_public_ip_address = get_public_ip_address()</span><br><span class="line">    instance_id = instance_id_public_ip_address.get(ip)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ec2.reboot_instances(InstanceIds=[instance_id], DryRun=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> ClientError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'DryRunOperation'</span> <span class="keyword">not</span> <span class="keyword">in</span> str(e):</span><br><span class="line">            print(<span class="string">"You don't have permission to reboot instances."</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = ec2.reboot_instances(InstanceIds=[instance_id], DryRun=<span class="literal">False</span>)</span><br><span class="line">        print(<span class="string">'Success'</span>, response)</span><br><span class="line">    <span class="keyword">except</span> ClientError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Error'</span>, e)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-12-26 15:59:15" itemprop="dateCreated datePublished" datetime="2018-12-26T15:59:15+08:00">2018-12-26</time>
                </span>
                <span id="/6378.html" class="post-meta-item leancloud_visitors" data-flag-title="小白学爬虫之代理(公有云)" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5094.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5094.html" class="post-title-link" itemprop="url">爬虫代理哪家强？十大付费代理详细对比评测出炉！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>随着大数据时代的到来，爬虫已经成了获取数据的必不可少的方式，做过爬虫的想必都深有体会，爬取的时候莫名其妙 IP 就被网站封掉了，毕竟各大网站也不想自己的数据被轻易地爬走。 对于爬虫来说，为了解决封禁 IP 的问题，一个有效的方式就是使用代理，使用代理之后可以让爬虫伪装自己的真实 IP，如果使用大量的随机的代理进行爬取，那么网站就不知道是我们的爬虫一直在爬取了，这样就有效地解决了反爬的问题。 那么问题来了，使用什么代理好呢？这里指的代理一般是 HTTP 代理，主要用于数据爬取。现在打开搜索引擎一搜 HTTP 代理，免费的、付费的太多太多品牌，我们该如何选择呢？看完这一篇文章，想必你心中就有了答案。 对于免费代理，其实想都不用想了，可用率能超过 10% 就已经是谢天谢地了。真正靠谱的代理还是需要花钱买的，那这么多家到底哪家可用率高？哪家响应速度快？哪家比较稳定？哪家性价比比较高？为此，我对市面上比较流行的多家付费代理针对可用率、爬取速度、爬取稳定性、价格、安全性、请求限制等做了详细的评测，让我们来一起看一下到底哪家更强！</p>
                  <h2 id="测评范围"><a href="#测评范围" class="headerlink" title="测评范围"></a>测评范围</h2>
                  <h3 id="免费代理"><a href="#免费代理" class="headerlink" title="免费代理"></a>免费代理</h3>
                  <p>在这里我主要测试的是付费代理，免费代理可用率太低，几乎不会超过 10%，但为了作为对比，我选取了西刺免费代理进行了测试。</p>
                  <h3 id="付费代理"><a href="#付费代理" class="headerlink" title="付费代理"></a>付费代理</h3>
                  <p>付费代理我选取了站大爷、芝麻 HTTP 代理、太阳 HTTP 代理、讯代理、快代理、蘑菇代理、阿布云代理、全网代理、云代理、大象代理、多贝云进行了对比评测，购买了他们的各个不同级别的套餐使用同样的网络环境进行了测评，详情如下：</p>
                  <p> 代理商家</p>
                  <p> 套餐类型</p>
                  <p>官方网站</p>
                  <p>芝麻 HTTP 代理</p>
                  <p> 默认版</p>
                  <p><a href="http://www.zhimaruanjian.com/" target="_blank" rel="noopener">http://www.zhimaruanjian.com/</a></p>
                  <p>阿布云代理</p>
                  <p> 专业版</p>
                  <p><a href="https://www.abuyun.com" target="_blank" rel="noopener">https://www.abuyun.com</a></p>
                  <p> 动态版</p>
                  <p> 经典版</p>
                  <p> 大象代理</p>
                  <p> 个人版</p>
                  <p><a href="http://www.daxiangdaili.com" target="_blank" rel="noopener">http://www.daxiangdaili.com</a></p>
                  <p> 专业版</p>
                  <p> 企业版</p>
                  <p>全网代理</p>
                  <p> 普通版</p>
                  <p><a href="http://www.goubanjia.com" target="_blank" rel="noopener">http://www.goubanjia.com</a></p>
                  <p> 动态版</p>
                  <p> 快代理</p>
                  <p> VIP 套餐</p>
                  <p><a href="https://www.kuaidaili.com" target="_blank" rel="noopener">https://www.kuaidaili.com</a></p>
                  <p> 蘑菇代理</p>
                  <p> 默认版</p>
                  <p><a href="http://www.mogumiao.com" target="_blank" rel="noopener">http://www.mogumiao.com</a></p>
                  <p> 太阳 HTTP 代理</p>
                  <p> 默认版</p>
                  <p><a href="http://http.taiyangruanjian.com" target="_blank" rel="noopener">http://http.taiyangruanjian.com</a></p>
                  <p> 讯代理</p>
                  <p> 优质代理</p>
                  <p><a href="http://www.xdaili.cn" target="_blank" rel="noopener">http://www.xdaili.cn</a></p>
                  <p> 混播代理</p>
                  <p> 独享代理</p>
                  <p> 云代理</p>
                  <p> VIP 套餐</p>
                  <p><a href="http://www.ip3366.net" target="_blank" rel="noopener">http://www.ip3366.net</a></p>
                  <p> 站大爷代理</p>
                  <p> 普通代理</p>
                  <p><a href="http://ip.zdaye.com" target="_blank" rel="noopener">http://ip.zdaye.com</a></p>
                  <p> 短效优质代理</p>
                  <p>多贝云代理</p>
                  <p> 套餐一</p>
                  <p><a href="http://dobel.cn/" target="_blank" rel="noopener">http://dobel.cn/</a></p>
                  <p> 套餐二</p>
                  <p> 套餐三</p>
                  <p>注：其中蘑菇代理、太阳 HTTP 代理、芝麻 HTTP 代理的默认版表示此网站只有这一种代理，不同套餐仅是时长区别，代理质量没有差别。 嗯，我把上面的套餐全部买了一遍，以供下面的评测使用。</p>
                  <h2 id="测评目标"><a href="#测评目标" class="headerlink" title="测评目标"></a>测评目标</h2>
                  <p>本次测评主要分析代理的可用率、响应速度、稳定性、价格、安全性、使用频率等因素，下面我们来一一进行说明。</p>
                  <h3 id="可用率"><a href="#可用率" class="headerlink" title="可用率"></a>可用率</h3>
                  <p>可用率就是提取的这些代理中可以正常使用的比率。假如我们无法使用这个代理请求某个网站或者访问超时，那么就代表这个代理不可用，在这里我的测试样本大小为 500，即提取 500 个代理，看看里面可用的比率多少。</p>
                  <h3 id="响应速度"><a href="#响应速度" class="headerlink" title="响应速度"></a>响应速度</h3>
                  <p>响应速度可以用耗费时间来衡量，即计算使用这个代理请求网站一直到得到响应所耗费的时间。时间越短，证明代理的响应速度越快，这里同样是 500 个样本，计算时只对正常可用的代理做统计，计算耗费时间的平均值。</p>
                  <h3 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h3>
                  <p>由于爬虫时我们需要使用大量代理，如果一个代理响应速度特别快，很快就能得到响应，而下一次请求使用的代理响应速度特别慢，等了三十秒才得到响应，那势必会影响爬取效率，所以我们需要看下商家提供的这些代理稳定性怎样，总不能这一个特别快，下一个又慢的不行。所以这里我们需要统计一下耗费时间的方差，方差越大，证明稳定性越差。</p>
                  <h3 id="价格"><a href="#价格" class="headerlink" title="价格"></a>价格</h3>
                  <p>价格，这个当然是需要考虑的内容，如果一个代理不论是响应速度还是稳定性都特别不错，但是价格非常非常高，这也是不可接受的。</p>
                  <h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3>
                  <p>这的确也是需要考虑的因素，比如一旦不小心把代理提取的 API 泄露出去了，别人就肆意使用我们的 API 提取代理使用，而一直耗费的是我们的套餐。另外一旦别人通过某些手段获取了我们的代理列表，而这些代理是没有安全验证的，这也会导致别人偷偷使用我们的代理。在生产环境上，这方面尤其需要注意。</p>
                  <h3 id="使用频率"><a href="#使用频率" class="headerlink" title="使用频率"></a>使用频率</h3>
                  <p>有些代理套餐在 API 调用提取代理时有频率限制，有的代理套餐则会限制请求频率，这些因素都会或多或少影响爬虫的效率，这部分因素我们也需要考虑进来。</p>
                  <h2 id="测评标准"><a href="#测评标准" class="headerlink" title="测评标准"></a>测评标准</h2>
                  <p>要做标准的测评，那就必须在标准的测评环境下进行，且尽可能排除一些杂项的干扰，如网络波动、传输延迟等一系列的影响。</p>
                  <h3 id="主机选取"><a href="#主机选取" class="headerlink" title="主机选取"></a>主机选取</h3>
                  <p>由于我的个人笔记本是使用 WiFi 上网的，所以可能会有网络波动，而且实际带宽其实并不太好把控，因此它并不适合来做标准评测使用。评测需要在一个网络稳定的条件下进行，而且多个代理的评测环境必须相同，在此我选择了一台腾讯云主机作为测试，主机配置如下：</p>
                  <p> 参数名</p>
                  <p> 参数值</p>
                  <p> 操作系统</p>
                  <p>Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-53-generic x86_64)</p>
                  <p> 带宽</p>
                  <p>5 Mbps</p>
                  <p> 核心数</p>
                  <p> 2</p>
                  <p> 内存</p>
                  <p> 4GB</p>
                  <p>Python 版本</p>
                  <p> 3.5.2</p>
                  <p>这样我们就可以保证一个标准统一的测试环境了。</p>
                  <h3 id="现取现测"><a href="#现取现测" class="headerlink" title="现取现测"></a>现取现测</h3>
                  <p>另外在评测时还需要遵循一个原则，那就是现取现测，即取一个测一个。现在很多付费代理网站都提供了 API 接口，我们可以一次性提取多个代理，但是这样会导致一个问题，每个代理在提取出来的时候，商家是会尽量保证它的可用性的，但过一段时间，这个代理可能就不好用了，所以假如我们一次性提取出来了 100 个代理，但是这 100 个代理并没有同时参与测试，后面的代理就会经历一个的等待期，过一段时间再测这些代理的话，肯定会影响后半部分代理的有效性，所以这里我们将提取的数量统一设置成 1，即请求一次接口获取一个代理，然后立即进行测试，这样可以保证测试的公平性，排除了不同代理有效期的干扰。</p>
                  <h3 id="时间计算"><a href="#时间计算" class="headerlink" title="时间计算"></a>时间计算</h3>
                  <p>由于我们有一项是测试代理的响应速度，所以我们需要计算程序请求之前和得到响应之后的时间差，这里我们使用的测试 Python 库是 requests，所以我们就计算发起请求和得到响应之间的时间差即可，时间计算方法如下所示：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">start_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">requests.<span class="keyword">get</span>(test_url, <span class="keyword">timeout</span>=<span class="keyword">timeout</span>, proxies=proxies)</span><br><span class="line">end_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">used_time = end_time - start_time</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 used_time 就是使用代理请求的耗时，这样测试的就仅仅是发起请求到得到响应的时间。</p>
                  <h3 id="测试链接"><a href="#测试链接" class="headerlink" title="测试链接"></a>测试链接</h3>
                  <p>测试时我们也需要使用一个稳定的且没有反爬虫的链接，这样可以排除服务器的干扰，这里我们使用百度来作为测试目标。</p>
                  <h3 id="超时限制"><a href="#超时限制" class="headerlink" title="超时限制"></a>超时限制</h3>
                  <p>在测试时免不了的会遇到代理请求超时的问题，所以这里我们也需要统一一个超时时间，这里设置为 60 秒，如果使用代理请求百度，60 秒还没有得到响应，那就视为该代理无效。</p>
                  <h3 id="测试数量"><a href="#测试数量" class="headerlink" title="测试数量"></a>测试数量</h3>
                  <p>要做测评，那么样本不能太小，如只有十几次测试是不能轻易下结论的，这里我选取了一个适中的测评数量 500，即每个套餐获取 500 个代理进行测试。</p>
                  <h2 id="测评过程"><a href="#测评过程" class="headerlink" title="测评过程"></a>测评过程</h2>
                  <p>嗯，测评过程这边主要说一下测评的代码逻辑，首先测的时候是取一个测一个的，所以这里定义了一个 test_proxy() 方法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">test_url = <span class="string">'https://www.baidu.com/'</span></span><br><span class="line">timeout = 60</span><br><span class="line"></span><br><span class="line">def test_proxy(proxy):</span><br><span class="line">    try:</span><br><span class="line">        proxies = &#123;</span><br><span class="line">            <span class="string">'https'</span>: <span class="string">'http://'</span> + proxy</span><br><span class="line">        &#125;</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        requests.<span class="builtin-name">get</span>(test_url, <span class="attribute">timeout</span>=timeout, <span class="attribute">proxies</span>=proxies)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        used_time = end_time - start_time</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Proxy Valid'</span>, <span class="string">'Used Time:'</span>, used_time)</span><br><span class="line">        return <span class="literal">True</span>, used_time</span><br><span class="line">    except (ProxyError, ConnectTimeout, SSLError, ReadTimeout, ConnectionError):</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Proxy Invalid:'</span>, proxy)</span><br><span class="line">        return <span class="literal">False</span>, None</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要传入一个参数 proxy，代表一个代理，即 IP 加端口组成的代理，然后这里使用了 requests 的 proxies 参数传递给 get() 方法。对于代理无效的检测，这里判断了 ProxyError, ConnectTimeout, SSLError, ReadTimeout, ConnectionError 这几种异常，如果发生了这些异常统统视为代理无效，返回错误。如果在 timeout 60 秒内得到了响应，那么就计算其耗费时间并返回。 在主程序里，就是获取 API 然后统计结果了，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">max = 500</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Testing'</span>)</span><br><span class="line">    used_time_list = []</span><br><span class="line">    valid_count = 0</span><br><span class="line">    total_count = 0</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        flag, result = get_page(api_url)</span><br><span class="line">        <span class="keyword">if</span> flag:</span><br><span class="line">           <span class="built_in"> proxy </span>= result.strip()</span><br><span class="line">            <span class="keyword">if</span> is_proxy(proxy):</span><br><span class="line">                total_count += 1</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'Testing proxy'</span>, proxy)</span><br><span class="line">                test_flag, test_result = test_proxy(<span class="attribute">proxy</span>=proxy)</span><br><span class="line">                <span class="keyword">if</span> test_flag:</span><br><span class="line">                    valid_count += 1</span><br><span class="line">                    used_time_list.append(test_result)</span><br><span class="line">                stats_result(used_time_list, valid_count, total_count)</span><br><span class="line">        time.sleep(wait)</span><br><span class="line">        <span class="keyword">if</span> total_count == max:</span><br><span class="line">            break</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里加了一些判断，如 is_proxy() 方法判断了获取的是不是符合有效的代理规则，即判断它是不是 IP 加端口的形式，这样可以排除 API 返回一些错误信息的干扰。另外这里设置了 total_count 和 valid_count 变量，只有符合代理规则的代理参与了测试，这样才算一次有效测试，total_count 加一，如果测试可用，那么 valid_count 加一并记录耗费时间。最后调用了 stats_results 方法进行了统计：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stats_result</span><span class="params">(used_time_list, valid_count, total_count)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> used_time_list <span class="keyword">or</span> <span class="keyword">not</span> total_count:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    used_time_array = np.asarray(used_time_list, np.float32)</span><br><span class="line">    print(<span class="string">'Total Count:'</span>, total_count,</span><br><span class="line">          <span class="string">'Valid Count:'</span>, valid_count,</span><br><span class="line">          <span class="string">'Valid Percent: %.2f%%'</span> % (valid_count * <span class="number">100.0</span> / total_count),</span><br><span class="line">          <span class="string">'Used Time Mean:'</span>, used_time_array.mean(),</span><br><span class="line">          <span class="string">'Used Time Var'</span>, used_time_array.var())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用了 Numpy 来统计了耗费时间的均值和方差，分别反映代理的响应速度和稳定性。 嗯，就这样，利用这个方法我对各个不同的代理套餐逐一进行了测试。</p>
                  <h2 id="测评结果"><a href="#测评结果" class="headerlink" title="测评结果"></a>测评结果</h2>
                  <p>经过测评，初步得到如下统计结果：</p>
                  <p> 代理商家</p>
                  <p> 套餐类型</p>
                  <p> 测试次数</p>
                  <p> 有效次数</p>
                  <p> 可用率</p>
                  <p> 响应时间均值</p>
                  <p> 响应时间方差</p>
                  <p> 芝麻 HTTP 代理</p>
                  <p> 默认版</p>
                  <p> 500</p>
                  <p> 495</p>
                  <p> 99.00%</p>
                  <p> 0.916853</p>
                  <p> 1.331989</p>
                  <p>阿布云代理</p>
                  <p> 专业版</p>
                  <p> 500</p>
                  <p> 452</p>
                  <p> 90.40%</p>
                  <p>0.68770707</p>
                  <p>1.1477163</p>
                  <p> 动态版</p>
                  <p> 500</p>
                  <p> 494</p>
                  <p> 98.80%</p>
                  <p>1.83994</p>
                  <p>6.0491614</p>
                  <p> 经典版</p>
                  <p> 500</p>
                  <p> 499</p>
                  <p> 99.80%</p>
                  <p>0.49301904</p>
                  <p>0.25724468</p>
                  <p> 大象代理</p>
                  <p> 个人版</p>
                  <p> 500</p>
                  <p> 238</p>
                  <p> 47.60%</p>
                  <p>5.340489</p>
                  <p>78.56444</p>
                  <p> 专业版</p>
                  <p> 500</p>
                  <p> 284</p>
                  <p> 56.80%</p>
                  <p>6.87078</p>
                  <p>105.7984</p>
                  <p> 企业版</p>
                  <p> 500</p>
                  <p> 259</p>
                  <p> 51.80%</p>
                  <p>6.3081837</p>
                  <p>121.08402</p>
                  <p>全网代理</p>
                  <p> 普通版</p>
                  <p> 500</p>
                  <p> 220</p>
                  <p> 44.00%</p>
                  <p>5.584057</p>
                  <p>47.442596</p>
                  <p> 动态版</p>
                  <p> 500</p>
                  <p> 485</p>
                  <p> 97.00%</p>
                  <p>2.776973</p>
                  <p>17.568045</p>
                  <p>快代理</p>
                  <p> VIP 套餐</p>
                  <p> 500</p>
                  <p> 178</p>
                  <p> 35.60%</p>
                  <p>16.636587</p>
                  <p>221.69661</p>
                  <p>蘑菇代理</p>
                  <p> 默认版</p>
                  <p> 500</p>
                  <p> 497</p>
                  <p> 99.40%</p>
                  <p>1.0985725</p>
                  <p>9.532586</p>
                  <p>太阳 HTTP 代理</p>
                  <p> 默认版</p>
                  <p> 500</p>
                  <p> 400</p>
                  <p> 80.00%</p>
                  <p>1.2522483</p>
                  <p>12.662229</p>
                  <p>讯代理</p>
                  <p> 优质代理</p>
                  <p> 500</p>
                  <p> 495</p>
                  <p> 99.00%</p>
                  <p>1.0512681</p>
                  <p>6.4247565</p>
                  <p> 混播代理</p>
                  <p> 500</p>
                  <p> 494</p>
                  <p> 98.80%</p>
                  <p>1.0664985</p>
                  <p>6.451699</p>
                  <p> 独享代理</p>
                  <p> 500</p>
                  <p> 500</p>
                  <p> 100%</p>
                  <p> 0.7056521</p>
                  <p> 0.35416448</p>
                  <p>多贝云代理</p>
                  <p> 套餐一</p>
                  <p> 500</p>
                  <p> 500</p>
                  <p> 100.00%</p>
                  <p>0.6580079</p>
                  <p>0.199466</p>
                  <p> 套餐二</p>
                  <p> 500</p>
                  <p> 500</p>
                  <p> 100.00%</p>
                  <p>0.510749</p>
                  <p>0.022519</p>
                  <p> 套餐三</p>
                  <p> 500</p>
                  <p> 499</p>
                  <p> 99.80%</p>
                  <p> 0.6785444</p>
                  <p> 0.5197055</p>
                  <p> 云代理</p>
                  <p> VIP 套餐</p>
                  <p> 500</p>
                  <p> 489</p>
                  <p> 97.80%</p>
                  <p> 3.4216988</p>
                  <p> 38.120296</p>
                  <p> 站大爷代理</p>
                  <p> 普通代理</p>
                  <p> 500</p>
                  <p> 92</p>
                  <p> 18.40%</p>
                  <p> 5.067193</p>
                  <p>66.12128</p>
                  <p> 短效优质代理</p>
                  <p> 500</p>
                  <p> 488</p>
                  <p> 97.60%</p>
                  <p> 1.5625348</p>
                  <p>8.121197</p>
                  <p> 西刺代理</p>
                  <p> 免费</p>
                  <p> 500</p>
                  <p> 31</p>
                  <p> 6.2%</p>
                  <p>9.712833</p>
                  <p>95.09569</p>
                  <p>注：</p>
                  <ul>
                    <li><strong>表中的响应时间方差越大，代表稳定性越低。</strong></li>
                    <li><strong>阿布云代理经典版方差较小是因为它是长时间锁定了同一个 IP，因此极其稳定，但每秒最大请求默认 5 次。</strong></li>
                    <li><strong>多贝云代理套餐一二方差较小是因为它是长时间锁定了同一个 IP，因此极其稳定，但每秒最大请求默认 20 次。</strong></li>
                  </ul>
                  <h2 id="测评分析"><a href="#测评分析" class="headerlink" title="测评分析"></a>测评分析</h2>
                  <p>下面我们将从各个方面分析一下各个套餐的优劣。</p>
                  <h3 id="可用率-1"><a href="#可用率-1" class="headerlink" title="可用率"></a>可用率</h3>
                  <p>通过可用率统计，我们可以发现可用率较高的代理套餐有：</p>
                  <p> 级别</p>
                  <p> 套餐</p>
                  <p>描述</p>
                  <p> 第一梯队</p>
                  <p> 多贝云代理、讯代理独享代理、阿布云代理经典版、蘑菇代理、芝麻 HTTP 代理、讯代理优质代理</p>
                  <p> 可用率 99% 以上</p>
                  <p> 第二梯队</p>
                  <p> 阿布云代理动态版、讯代理混播代理、云代理、站大爷短效优质代理、全网代理动态版、阿布云代理专业版</p>
                  <p> 可用率 99% 以下，90% 以上</p>
                  <p> 第三梯队</p>
                  <p> 太阳 HTTP 代理、大象代理专业版、大象代理企业版</p>
                  <p> 可用率 90% 以下，50% 以上</p>
                  <p> 第四梯队</p>
                  <p> 大象代理个人版、全网代理普通版、快代理</p>
                  <p>可用率 50% 以下，20% 以上</p>
                  <p> 第五梯队</p>
                  <p>站大爷普通代理、西刺代理</p>
                  <p> 可用率 20% 以下</p>
                  <h3 id="响应速度-1"><a href="#响应速度-1" class="headerlink" title="响应速度"></a>响应速度</h3>
                  <p>通过平均响应速度判别，我们可以发现响应速度较快的代理套餐有：</p>
                  <p> 级别</p>
                  <p> 套餐</p>
                  <p> 描述</p>
                  <p> 第一梯队</p>
                  <p> 多贝云代理、阿布云代理经典版、阿布云代理专业版、讯代理独享代理、芝麻 HTTP 代理</p>
                  <p>响应时间 1s 以内</p>
                  <p> 第二梯队</p>
                  <p> 讯代理优质代理、讯代理混播代理、蘑菇代理、太阳代理、站大爷短效优质代理、阿布云代理动态版</p>
                  <p>响应时间 1s 以上，2s 以内</p>
                  <p> 第三梯队</p>
                  <p>全网代理动态版、云代理</p>
                  <p>响应时间 2s 以上，5s 以内</p>
                  <p> 第四梯队</p>
                  <p>站大爷普通代理、大象代理个人版、全网代理普通版、大象代理企业版、大象代理专业版、西刺代理</p>
                  <p>响应时间 5s 以上，10s 以内</p>
                  <p> 第五梯队</p>
                  <p>快代理</p>
                  <p>响应时间 10s 以上</p>
                  <h3 id="稳定性-1"><a href="#稳定性-1" class="headerlink" title="稳定性"></a>稳定性</h3>
                  <p>通过平均响应速度方差分析，我们可以发现稳定性较高的代理套餐有：</p>
                  <p> 级别</p>
                  <p> 套餐</p>
                  <p> 描述</p>
                  <p> 第一梯队</p>
                  <p>多贝云代理、阿布云代理经典版、讯代理独享代理、阿布云代理专业版、芝麻 HTTP 代理</p>
                  <p> 方差 3 以内</p>
                  <p> 第二梯队</p>
                  <p>阿布云代理动态版、讯代理优质代理、讯代理混播代理、站大爷短效优质代理、蘑菇代理</p>
                  <p>方差 10 以内，3 以上</p>
                  <p> 第三梯队</p>
                  <p>太阳HTTP代理、全网代理动态版、云代理、全网代理普通版、站大爷普通代理、大象代理个人版、西刺代理</p>
                  <p> 方差 100 以内，10 以上</p>
                  <p> 第四梯队</p>
                  <p> 大象代理专业版、大象代理企业版、快代理</p>
                  <p> 方差 100 以上</p>
                  <h3 id="价格-1"><a href="#价格-1" class="headerlink" title="价格"></a>价格</h3>
                  <p>我们可以先看一下各个套餐的价格：</p>
                  <p> 代理商家</p>
                  <p> 套餐类型</p>
                  <p>价格描述</p>
                  <p> 价格 URL</p>
                  <p> 备注</p>
                  <p>芝麻 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>￥40/周 ￥114/月</p>
                  <p><a href="http://www.zhimaruanjian.com/pay/" target="_blank" rel="noopener">http://www.zhimaruanjian.com/pay/</a></p>
                  <p>另有包量套餐、定期有优惠活动，可领免费 IP，可免费试用</p>
                  <p>阿布云代理</p>
                  <p> 专业版</p>
                  <p>￥1/时 ￥16/天 ￥108/周 ￥429/月</p>
                  <p><a href="https://www.abuyun.com/" target="_blank" rel="noopener">https://www.abuyun.com/</a></p>
                  <p> 每秒请求只有5个，多加每秒请求1个需要 1￥0.5/月，￥90 /年</p>
                  <p> 动态版</p>
                  <p>￥1/时 ￥16/天 ￥108/周 ￥429/月</p>
                  <p> 经典版</p>
                  <p>￥1/时 ￥16/天 ￥108/周 ￥429/月</p>
                  <p>多贝云代理</p>
                  <p> 套餐一</p>
                  <p>￥500/月</p>
                  <p><a href="http://dobel.cn/" target="_blank" rel="noopener">http://dobel.cn/</a></p>
                  <p> 套餐一二默认每秒最多请求 20 次 套餐三每秒默认最多请求 5次，最多都可购买到 100 个请求数</p>
                  <p> 套餐二</p>
                  <p>￥600/月</p>
                  <p> 套餐三</p>
                  <p>￥425/月</p>
                  <p> 大象代理</p>
                  <p> 个人版</p>
                  <p>￥9/天 ￥98/月</p>
                  <p><a href="http://www.daxiangdaili.com/" target="_blank" rel="noopener">http://www.daxiangdaili.com/</a></p>
                  <p>好评可送时长</p>
                  <p> 专业版</p>
                  <p>￥19/天 ￥198/月</p>
                  <p> 企业版</p>
                  <p>￥49/天 ￥498/月</p>
                  <p>全网代理</p>
                  <p> 普通版</p>
                  <p>￥9/天 ￥35/周 ￥93/月 ￥500/年</p>
                  <p><a href="http://www.goubanjia.com/buy/high.shtml" target="_blank" rel="noopener">http://www.goubanjia.com/buy/high.shtml</a></p>
                  <p> 动态版</p>
                  <p>￥10/天 ￥160/月 ￥1250/年</p>
                  <p><a href="http://www.goubanjia.com/buy/dynamic.shtml" target="_blank" rel="noopener">http://www.goubanjia.com/buy/dynamic.shtml</a></p>
                  <p> 快代理</p>
                  <p> VIP 套餐</p>
                  <p>￥20/天 ￥60/周 ￥200/月 ￥2000/年</p>
                  <p><a href="https://www.kuaidaili.com/pricing" target="_blank" rel="noopener">https://www.kuaidaili.com/pricing</a></p>
                  <p>有普通、VIP、SVIP、专业版可选</p>
                  <p> 蘑菇代理</p>
                  <p> 默认版</p>
                  <p>￥6/天 ￥169/月 ￥1699/年</p>
                  <p><a href="http://www.mogumiao.com/buy" target="_blank" rel="noopener">http://www.mogumiao.com/buy</a></p>
                  <p>另有包量套餐可选购，可免费试用</p>
                  <p> 太阳 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>￥60/周 ￥198/月 ￥498/季 ￥1590/年</p>
                  <p><a href="http://http.taiyangruanjian.com/newrecharge/" target="_blank" rel="noopener">http://http.taiyangruanjian.com/newrecharge/</a></p>
                  <p>另有保量套餐可选购，可领免费 IP，可免费试用</p>
                  <p> 讯代理</p>
                  <p> 优质代理</p>
                  <p>￥9/天 ￥210/月 ￥2100/年</p>
                  <p><a href="http://www.xdaili.cn/buyproxy" target="_blank" rel="noopener">http://www.xdaili.cn/buyproxy</a></p>
                  <p> 可免费试用</p>
                  <p> 混播代理</p>
                  <p>￥29/天 ￥729/月 ￥6999/年</p>
                  <p> 独享代理</p>
                  <p>￥9/天 ￥210/月 ￥2100/年</p>
                  <p> 云代理</p>
                  <p> VIP 套餐</p>
                  <p>￥10/天 ￥120/月 ￥599/年</p>
                  <p><a href="http://www.ip3366.net/pricing/" target="_blank" rel="noopener">http://www.ip3366.net/pricing/</a></p>
                  <p> 另有普通套餐可选</p>
                  <p> 站大爷代理</p>
                  <p> 普通代理</p>
                  <p>￥8/天 ￥80/月 ￥720/年</p>
                  <p><a href="http://ip.zdaye.com/buy.html" target="_blank" rel="noopener">http://ip.zdaye.com/buy.html</a></p>
                  <p> 另有私密代理可选</p>
                  <p> 短效优质代理</p>
                  <p>￥17/天 ￥475/月 ￥4569/年</p>
                  <p><a href="http://ip.zdaye.com/ShortProxy.html" target="_blank" rel="noopener">http://ip.zdaye.com/ShortProxy.html</a></p>
                  <p>按照包月的价格，我们可以统一对比如下：</p>
                  <p> 级别</p>
                  <p> 套餐</p>
                  <p> 描述</p>
                  <p> 第一梯队</p>
                  <p> 多贝云代理、大象代理企业版、站大爷短效优质代理、阿布云代理、芝麻 HTTP代理</p>
                  <p> 包月大于 400</p>
                  <p> 第二梯队</p>
                  <p> 讯代理混播代理</p>
                  <p> 包月小于 400，大于 300</p>
                  <p> 第三梯队</p>
                  <p> 讯代理优质代理、讯代理独享代理、快代理</p>
                  <p> 包月小于 300，大于 200</p>
                  <p> 第四梯队</p>
                  <p> 太阳 HTTP 代理、大象代理专业版、蘑菇代理、全网代理动态版、云代理</p>
                  <p> 包月小于 200，大于 100</p>
                  <p> 第五梯队</p>
                  <p> 大象代理个人版、全网代理、站大爷普通代理</p>
                  <p> 包月小于 100</p>
                  <h3 id="安全性-1"><a href="#安全性-1" class="headerlink" title="安全性"></a>安全性</h3>
                  <p>对于安全性，此处主要考虑提取 API 是否有访问验证，使用代理时是否有访问验证，即可以通过设置白名单来控制哪些可以使用。 其中只有芝麻 HTTP 代理、太阳 HTTP 代理默认使用了白名单限制，即只有将使用 IP 添加到白名单才可以使用，可以有效控制使用权限。 另外阿布云代理提供了隧道代理验证，只有成功配置了用户名和密码才可以正常使用。 所以在此归纳如下：</p>
                  <p> 级别</p>
                  <p> 套餐</p>
                  <p> 描述</p>
                  <p> 第一梯队</p>
                  <p>芝麻 HTTP 代理、太阳 HTTP 代理、阿布云代理、多贝云代理</p>
                  <p>默认使用了白名单控制或隧道代理验证</p>
                  <p> 第二梯队</p>
                  <p> 其他</p>
                  <p>可直接使用</p>
                  <h3 id="调取频率"><a href="#调取频率" class="headerlink" title="调取频率"></a>调取频率</h3>
                  <p>不同的接口具有不同的 API 调用频率限制，归纳如下：</p>
                  <p> 代理商家</p>
                  <p> 套餐类型</p>
                  <p>调取频率限制</p>
                  <p>芝麻 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>1秒</p>
                  <p>阿布云代理</p>
                  <p> 专业版</p>
                  <p>无需获取</p>
                  <p> 动态版</p>
                  <p>无需获取</p>
                  <p> 经典版</p>
                  <p>无需获取</p>
                  <p>多贝云代理</p>
                  <p> 套餐一</p>
                  <p>无需获取</p>
                  <p> 套餐二</p>
                  <p>无需获取</p>
                  <p> 套餐三</p>
                  <p>无需获取</p>
                  <p> 大象代理</p>
                  <p> 个人版</p>
                  <p>1秒</p>
                  <p> 专业版</p>
                  <p>1秒</p>
                  <p> 企业版</p>
                  <p>无限制</p>
                  <p>全网代理</p>
                  <p> 普通版</p>
                  <p>无限制</p>
                  <p> 动态版</p>
                  <p>100毫秒</p>
                  <p>快代理</p>
                  <p> VIP 套餐</p>
                  <p>200毫秒</p>
                  <p>蘑菇代理</p>
                  <p> 默认版</p>
                  <p>5秒</p>
                  <p>太阳 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>1秒</p>
                  <p>讯代理</p>
                  <p> 优质代理</p>
                  <p>5秒</p>
                  <p> 混播代理</p>
                  <p>10秒</p>
                  <p> 独享代理</p>
                  <p>15秒</p>
                  <p> 云代理</p>
                  <p> VIP 套餐</p>
                  <p>无限制</p>
                  <p> 站大爷代理</p>
                  <p> 普通代理</p>
                  <p>3秒</p>
                  <p> 短效优质代理</p>
                  <p>10秒</p>
                  <p> 西刺代理</p>
                  <p> 免费</p>
                  <p>无限制</p>
                  <p>在此可以简单总结如下：</p>
                  <p>级别</p>
                  <p> 套餐</p>
                  <p> 描述</p>
                  <p> 第一梯队</p>
                  <p> 云代理、全网代理普通版、大象代理企业版、西刺代理、阿布云（调取无限制，请求默认最大 1 秒 5 请求）、多贝云（调取无限制，请求默认最大 1 秒 20 请求）</p>
                  <p> 无限制</p>
                  <p> 第二梯队</p>
                  <p> 全网代理动态版、快代理</p>
                  <p> 小于 1s</p>
                  <p> 第三梯队</p>
                  <p> 大象代理个人版、大象代理专业版、芝麻 HTTP 代理、太阳 HTTP 代理、站大爷普通代理、蘑菇代理、讯代理优质代理</p>
                  <p> 1s - 5s</p>
                  <p> 第四梯队</p>
                  <p> 讯代理混播代理、讯代理独享代理、站大爷短效优质代理</p>
                  <p> 大于 5s</p>
                  <h3 id="特色功能"><a href="#特色功能" class="headerlink" title="特色功能"></a>特色功能</h3>
                  <p>除了常规的测试之外，我这边还选取了某些套餐的与众不同之处进行说明，这些特点有的算是缺点，有的算是优点，现列举如下：</p>
                  <p> 代理</p>
                  <p> 描述</p>
                  <p> 阿布云代理 多贝云代理</p>
                  <p> 使用隧道技术实现，代理不能直接拿到，必须配置访问认证，默认 1 秒只能支持 5/20 个请求，如需更多需要付费。</p>
                  <p> 讯代理</p>
                  <p> 独享代理拨号时间略长，可用主机少，容易出现拨号失败现象，单个代理有效时长可控。</p>
                  <p> 芝麻 HTTP 代理</p>
                  <p> 必须要设置白名单才可以使用，后台可控，使用 API 提取代理不扣费，使用时才扣费。</p>
                  <h2 id="测评综合"><a href="#测评综合" class="headerlink" title="测评综合"></a>测评综合</h2>
                  <p>分项了解了各个代理套餐的可用率、响应速度、稳定性、性价比、安全性等内容之后，最后做一下总结：</p>
                  <p> 代理商家</p>
                  <p> 套餐类型</p>
                  <p>可用率</p>
                  <p> 可用率评价</p>
                  <p>响应时间均值</p>
                  <p>响应速度评价</p>
                  <p>响应时间方差</p>
                  <p>稳定性</p>
                  <p>包月价格</p>
                  <p>价格评价</p>
                  <p>安全性</p>
                  <p>访问频率限制</p>
                  <p>调取频率限制</p>
                  <p>推荐指数</p>
                  <p>芝麻 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>99%</p>
                  <p>极高</p>
                  <p>0.916853</p>
                  <p>极快</p>
                  <p>1.331989</p>
                  <p>极好</p>
                  <p>360</p>
                  <p>较高</p>
                  <p>高</p>
                  <p>无</p>
                  <p>1 秒</p>
                  <p>★★★★★</p>
                  <p>阿布云代理</p>
                  <p> 专业版</p>
                  <p>90.4%</p>
                  <p>高</p>
                  <p>0.68770707</p>
                  <p>极快</p>
                  <p>1.1477163</p>
                  <p>极好</p>
                  <p>429</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★☆</p>
                  <p> 动态版</p>
                  <p>98.8%</p>
                  <p>高</p>
                  <p>1.83994</p>
                  <p>快</p>
                  <p>6.0491614</p>
                  <p>好</p>
                  <p>429</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★★</p>
                  <p> 经典版</p>
                  <p>99.8%</p>
                  <p>极高</p>
                  <p>0.49301904</p>
                  <p>极快</p>
                  <p>0.25724468</p>
                  <p>极好</p>
                  <p>429</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★★</p>
                  <p>多贝云代理</p>
                  <p> 套餐一</p>
                  <p>100%</p>
                  <p>极高</p>
                  <p>0.658007</p>
                  <p>极快</p>
                  <p>0.199466</p>
                  <p>极好</p>
                  <p>500</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★★★</p>
                  <p> 套餐二</p>
                  <p>100%</p>
                  <p>极高</p>
                  <p>0.510748</p>
                  <p>极快</p>
                  <p>0.022519</p>
                  <p>极好</p>
                  <p>600</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★★★</p>
                  <p> 套餐三</p>
                  <p>100%</p>
                  <p>极高</p>
                  <p>0.678544</p>
                  <p>极快</p>
                  <p>0.519705</p>
                  <p>极好</p>
                  <p>425</p>
                  <p>高</p>
                  <p>高</p>
                  <p>有</p>
                  <p>无需获取</p>
                  <p>★★★★☆</p>
                  <p> 大象代理</p>
                  <p> 个人版</p>
                  <p>47.6%</p>
                  <p>低</p>
                  <p>5.340489</p>
                  <p>慢</p>
                  <p>78.56444</p>
                  <p>一般</p>
                  <p>98</p>
                  <p>低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>1 秒</p>
                  <p>★★</p>
                  <p> 专业版</p>
                  <p>56.8%</p>
                  <p>一般</p>
                  <p>6.87078</p>
                  <p>慢</p>
                  <p>105.7984</p>
                  <p>差</p>
                  <p>198</p>
                  <p>较低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>1 秒</p>
                  <p>★☆</p>
                  <p> 企业版</p>
                  <p>51.8%</p>
                  <p>一般</p>
                  <p>6.3081837</p>
                  <p>慢</p>
                  <p>121.08402</p>
                  <p>差</p>
                  <p>498</p>
                  <p>高</p>
                  <p>低</p>
                  <p>无</p>
                  <p>无限制</p>
                  <p>★</p>
                  <p>全网代理</p>
                  <p> 普通版</p>
                  <p>44%</p>
                  <p>低</p>
                  <p>5.584057</p>
                  <p>慢</p>
                  <p>47.442596</p>
                  <p>一般</p>
                  <p>93</p>
                  <p>低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>无限制</p>
                  <p>★★</p>
                  <p> 动态版</p>
                  <p>97%</p>
                  <p>高</p>
                  <p>2.776973</p>
                  <p>一般</p>
                  <p>17.568045</p>
                  <p>一般</p>
                  <p>160</p>
                  <p>较低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>100毫秒</p>
                  <p>★★★</p>
                  <p>快代理</p>
                  <p> VIP 套餐</p>
                  <p>35.6%</p>
                  <p>一般</p>
                  <p>16.636587</p>
                  <p>极慢</p>
                  <p>221.69661</p>
                  <p>差</p>
                  <p>200</p>
                  <p>中</p>
                  <p>低</p>
                  <p>无</p>
                  <p>200毫秒</p>
                  <p>☆</p>
                  <p>蘑菇代理</p>
                  <p> 默认版</p>
                  <p>99.4%</p>
                  <p>极高</p>
                  <p>1.0985725</p>
                  <p>快</p>
                  <p>9.532586</p>
                  <p>好</p>
                  <p>169</p>
                  <p>较低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>5秒</p>
                  <p>★★★★☆</p>
                  <p>太阳 HTTP 代理</p>
                  <p> 默认版</p>
                  <p>80%</p>
                  <p>一般</p>
                  <p>1.2522483</p>
                  <p>快</p>
                  <p>12.662229</p>
                  <p>一般</p>
                  <p>198</p>
                  <p>较低</p>
                  <p>高</p>
                  <p>无</p>
                  <p>1秒</p>
                  <p>★★★★</p>
                  <p>讯代理</p>
                  <p> 优质代理</p>
                  <p>99%</p>
                  <p>极高</p>
                  <p>1.0512681</p>
                  <p>快</p>
                  <p>6.4247565</p>
                  <p>好</p>
                  <p>210</p>
                  <p>中</p>
                  <p>低</p>
                  <p>无</p>
                  <p>5秒</p>
                  <p>★★★★☆</p>
                  <p> 混播代理</p>
                  <p>98.8%</p>
                  <p>高</p>
                  <p>1.0664985</p>
                  <p>快</p>
                  <p>6.451699</p>
                  <p>好</p>
                  <p>729</p>
                  <p>高</p>
                  <p>低</p>
                  <p>无</p>
                  <p>10秒</p>
                  <p>★★★☆</p>
                  <p> 独享代理</p>
                  <p>100%</p>
                  <p>极高</p>
                  <p>0.7056521</p>
                  <p>极快</p>
                  <p>0.35416448</p>
                  <p>极好</p>
                  <p>210</p>
                  <p>中</p>
                  <p>低</p>
                  <p>无</p>
                  <p>15秒</p>
                  <p>★★★★☆</p>
                  <p> 云代理</p>
                  <p> VIP 套餐</p>
                  <p>97.8%</p>
                  <p>高</p>
                  <p>3.4216988</p>
                  <p>一般</p>
                  <p>38.120296</p>
                  <p>一般</p>
                  <p>120</p>
                  <p>较低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>无限制</p>
                  <p>★★★☆</p>
                  <p> 站大爷代理</p>
                  <p> 普通代理</p>
                  <p>18.4%</p>
                  <p>极低</p>
                  <p>5.067193</p>
                  <p>慢</p>
                  <p>66.12128</p>
                  <p>一般</p>
                  <p>80</p>
                  <p>低</p>
                  <p>低</p>
                  <p>无</p>
                  <p>3秒</p>
                  <p>★☆</p>
                  <p> 短效优质代理</p>
                  <p>97.6%</p>
                  <p>高</p>
                  <p>1.5625348</p>
                  <p>快</p>
                  <p>8.121197</p>
                  <p>好</p>
                  <p>475</p>
                  <p>高</p>
                  <p>低</p>
                  <p>无</p>
                  <p>10秒</p>
                  <p>★★★☆</p>
                  <p> 西刺代理</p>
                  <p> 免费</p>
                  <p>6.2%</p>
                  <p>极低</p>
                  <p>9.712833</p>
                  <p>慢</p>
                  <p>95.09569</p>
                  <p>一般</p>
                  <p>0</p>
                  <p>免费</p>
                  <p>低</p>
                  <p>无</p>
                  <p>无限制</p>
                  <p>★</p>
                  <p>所以在综合来看比较推荐的有：芝麻代理、讯代理、阿布云、多贝云代理，详细的对比结果可以参照表格。 以上便是各家代理的详细对比测评情况，希望此文能够在大家选购代理的时候有所帮助。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-10-04 02:31:43" itemprop="dateCreated datePublished" datetime="2018-10-04T02:31:43+08:00">2018-10-04</time>
                </span>
                <span id="/5094.html" class="post-meta-item leancloud_visitors" data-flag-title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6289.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6289.html" class="post-title-link" itemprop="url">破解网站登录加密--RSA</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，下面的是我的公众号，欢迎关注。"><a href="#大家好，我是四毛，下面的是我的公众号，欢迎关注。" class="headerlink" title="大家好，我是四毛，下面的是我的公众号，欢迎关注。"></a>大家好，我是四毛，下面的是我的公众号，欢迎关注。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> </p>
                  <h2 id="今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。"><a href="#今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。" class="headerlink" title="今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。"></a><strong>今天的内容主要讲的是破解一个网站的rsa加密，当然肯定不是破解这个算法，而是找到加密的参数，正确模拟这个算法即可。</strong></h2>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" alt=""></p>
                  <h2 id="1-什么是rsa算法"><a href="#1-什么是rsa算法" class="headerlink" title="1. 什么是rsa算法"></a>1. 什么是rsa算法</h2>
                  <p>下面的资料摘抄自阮一峰老师的文章， <a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html" target="_blank" rel="noopener">点这里了解更多</a> 1976年，两位美国计算机学家Whitfield Diffie 和 Martin Hellman，提出了一种崭新构思，可以在不直接传递密钥的情况下，完成解密。这被称为<a href="http://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="noopener">“Diffie-Hellman密钥交换算法”</a>。这个算法启发了其他科学家。人们认识到，加密和解密可以使用不同的规则，只要这两种规则之间存在某种对应关系即可，这样就避免了直接传递密钥。 这种新的加密模式被称为”非对称加密算法”。</p>
                  <blockquote>
                    <p>（1）乙方生成两把密钥（公钥和私钥）。公钥是公开的，任何人都可以获得，私钥则是保密的。 （2）甲方获取乙方的公钥，然后用它对信息加密。 （3）乙方得到加密后的信息，用私钥解密。</p>
                  </blockquote>
                  <p>如果公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的。</p>
                  <h2 id="2-研究目标"><a href="#2-研究目标" class="headerlink" title="2. 研究目标"></a>2. 研究目标</h2>
                  <p>从我要研究的网站来说，就是根据参数得到正确的公钥，加密以后返回给服务器，让服务器使用私钥可以解密出正确的数据即可。 同时，本文不会将具体的网站说出来，只是给大家提供一个解决问题的思路。</p>
                  <h2 id="3-开始"><a href="#3-开始" class="headerlink" title="3. 开始"></a>3. 开始</h2>
                  <h3 id="3-1-抓包找参数"><a href="#3-1-抓包找参数" class="headerlink" title="3.1 抓包找参数"></a>3.1 抓包找参数</h3>
                  <p>首先，打开某个网站的登录页面，输入用户名，密码，验证码之类的参数， 抓包看到了下面这个页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/09/Selection_191.png" alt=""> 我实际输入的值全是1, 然后都被加密了， 没办法，只能去找加密的方法了。 经过一番搜索过后，才发现，原来加密的算法就在源代码里面，这里截个图： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/09/Selection_192.png" alt=""> <strong>从这里就可以看到具体的算法名以及相关的参数了，你会说，这是什么算法我都不知道啊？搜啊，用关键词搜一下就能知道了。</strong> 同时，是不是觉得这个网站好傻逼，这不太简单了吗？ 肯定不是！！！ 这么简单，说明此处也是必有玄机！！！ 至于什么玄机，到后面说，都是泪。 </p>
                  <h3 id="3-2-分析加密流程"><a href="#3-2-分析加密流程" class="headerlink" title="3.2 分析加密流程"></a>3.2 分析加密流程</h3>
                  <p>首先， 我们知道了公钥以后，解析这个公钥，就可以得到相关的参数，给大家找了示例代码</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># /usr/bin/python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">import</span> <span class="string">base64</span></span><br><span class="line"></span><br><span class="line"><span class="attr">def</span> <span class="string">str2key(s):</span></span><br><span class="line"><span class="comment">    # 对字符串解码</span></span><br><span class="line">    <span class="attr">b_str</span> = <span class="string">base64.b64decode(s)</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">if</span> <span class="string">len(b_str) &lt; 162:</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">False</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">hex_str</span> = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # 按位转换成16进制</span></span><br><span class="line">    <span class="attr">for</span> <span class="string">x in b_str:</span></span><br><span class="line">        <span class="attr">h</span> = <span class="string">hex(ord(x))[2:]</span></span><br><span class="line">        <span class="attr">h</span> = <span class="string">h.rjust(2, '0')</span></span><br><span class="line">        <span class="attr">hex_str</span> <span class="string">+= h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # 找到模数和指数的开头结束位置</span></span><br><span class="line">    <span class="attr">m_start</span> = <span class="string">29 * 2</span></span><br><span class="line">    <span class="attr">e_start</span> = <span class="string">159 * 2</span></span><br><span class="line">    <span class="attr">m_len</span> = <span class="string">128 * 2</span></span><br><span class="line">    <span class="attr">e_len</span> = <span class="string">3 * 2</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">modulus</span> = <span class="string">hex_str[m_start:m_start + m_len]</span></span><br><span class="line">    <span class="attr">exponent</span> = <span class="string">hex_str[e_start:e_start + e_len]</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">return</span> <span class="string">modulus,exponent</span></span><br><span class="line"></span><br><span class="line"><span class="attr">if</span> <span class="string">__name__ == "__main__":</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">pubkey</span> = <span class="string">"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDC7kw8r6tq43pwApYvkJ5laljaN9BZb21TAIfT/vexbobzH7Q8SUdP5uDPXEBKzOjx2L28y7Xs1d9v3tdPfKI2LR7PAzWBmDMn8riHrDDNpUpJnlAGUqJG9ooPn8j7YNpcxCa1iybOlc2kEhmJn5uwoanQq+CA6agNkqly2H4j6wIDAQAB"</span></span><br><span class="line">    <span class="attr">key</span> = <span class="string">str2key(pubkey)</span></span><br><span class="line">    <span class="attr">print</span> <span class="string">key</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>相应的输出</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">('c2ee4c3cafab6ae37a<span class="number">700296</span>2f909e656a58da37d<span class="number">0596</span>f6d<span class="number">530087</span>d3fef7b16e86f31fb43c<span class="number">4947</span>4fe6e0cf5c404acce8f1d8bdbccbb5ecd5df6fded74f7ca<span class="number">2362</span>d1ecf<span class="number">033581983327</span>f2b887ac30cda54a499e<span class="number">500652</span>a246f68a0f9fc8fb60da5cc426b58b26ce95cda<span class="number">41219899</span>f9bb0a1a9d0abe080e9a80d92a972d87e23eb', </span><br><span class="line">'<span class="number">010001</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从代码中可以看出，解析了公钥之后得到了两个值，一个就是010001，和我们在网站源代码里面找到的值是一样的。所以，源代码里面的参数我们应该就是可以直接使用的，是不是有种找到组织的赶脚。 接下来，利用下面的代码，来对数据进行加密</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> rsa</span><br><span class="line"><span class="built_in">import</span> binascii</span><br><span class="line">def en_test():</span><br><span class="line">    <span class="attr">param_1</span> = <span class="string">"010001"</span></span><br><span class="line">    <span class="comment"># 某次我找到的</span></span><br><span class="line">    <span class="attr">param_2</span> = <span class="string">"955120AB9334B7CD52FCDB422DBF564AFD46DEBDC706F33502BBFAD9DD216A22E4D5012CB70F28473B46FB7190D08C31B4B8E76B5112ACE1C5552408961530B1C932DEEA8FC38A9A624AD22073F56F02BF453DD2C1FEA0164106D6B099CC9E5EC88C356FC164FCA47C766DD565D3D11048D27F2DD4221A0B26AB59BD7D09841F"</span></span><br><span class="line">    <span class="attr">message</span> = 'nihao'</span><br><span class="line">    <span class="attr">modulus</span> = int(param_2, <span class="number">16</span>)</span><br><span class="line">    <span class="attr">exponent</span> = int(param_1, <span class="number">16</span>)</span><br><span class="line">    <span class="attr">rsa_pubkey</span> = rsa.PublicKey(modulus, exponent)</span><br><span class="line">    <span class="attr">crypto</span> = rsa.encrypt(message, rsa_pubkey)</span><br><span class="line">    <span class="attr">data</span> = binascii.b2a_hex(crypto)</span><br><span class="line"></span><br><span class="line">    print data</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="attr">__name__</span> == '__main__':</span><br><span class="line">    en_test()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是当我这样做完，进行模拟登录，还以为自己很牛逼的时候，服务器却给我返回了这样的结果， 目瞪狗呆啊：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"Status"</span>:<span class="literal">false</span>,<span class="attr">"ResultValue"</span>:<span class="string">""</span>,<span class="attr">"StatusCode"</span>:<span class="string">"REFRESH"</span>,<span class="attr">"StatusMessage"</span>:<span class="string">"请尝试重新登录"</span>,<span class="attr">"RecordCount"</span>:<span class="number">0</span>,<span class="attr">"Data"</span>:<span class="literal">null</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2017/09/00602RHagw1f7yyuxxeucj305i05i744.jpg" alt=""> 可以看到信息提示要刷新，但是当时是百思不得其解，为毛线要刷新？ 困惑了一会之后，我再次从头走了一遍流程，这下我才发现，原来源代码里面的那个长长的数据是会改变的，直到这个时候，我才意识到为什么要我刷新。。。。。。 服务器啊，你就不能直接说参数错误吗？刷新你大爷啊。 果然，我还是太年轻啊。</p>
                  <h1 id="果然，天上掉下的绝不是馅饼，绝逼是个陷阱。"><a href="#果然，天上掉下的绝不是馅饼，绝逼是个陷阱。" class="headerlink" title="果然，天上掉下的绝不是馅饼，绝逼是个陷阱。"></a>果然，天上掉下的绝不是馅饼，绝逼是个陷阱。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/03/你特么在逗我？.jpeg" alt=""> 知道这个坑以后就好办了，用个正则匹配一下就行了，而结果也是对的：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"Status"</span>:<span class="literal">true</span>,<span class="attr">"ResultValue"</span>:<span class="string">""</span>,<span class="attr">"StatusCode"</span>:<span class="string">"OK"</span>,<span class="attr">"StatusMessage"</span>:<span class="string">"成功"</span>,<span class="attr">"RecordCount"</span>:<span class="number">0</span>,<span class="attr">"Data"</span>:&#123;<span class="attr">"LoginUrl"</span>:<span class="string">"/System/Welcome"</span>&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h4>
                  <p>到这里这篇文章就结束了，这个案例相对于来说很简单，而且为了保护网站的隐私，所以没办法展开说。 有些网站的加密方式是很变态的，比如网易云音乐，知晓常见的加密方法，就可以处理大部分的情况了。 其实，网易云音乐并不是一定要加密， 有想知道非加密的方法的，可以关注我，私聊我。有点敏感，就不写文章了。 反正，我爬了1000W+的网易云音乐都是不加密的～～ 如果你有类似的问题待解决或者想了解的更清楚的细节的，欢迎关注我的公众号以后，后台私我一下。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-14 13:43:33" itemprop="dateCreated datePublished" datetime="2018-09-14T13:43:33+08:00">2018-09-14</time>
                </span>
                <span id="/6289.html" class="post-meta-item leancloud_visitors" data-flag-title="破解网站登录加密--RSA" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6284.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6284.html" class="post-title-link" itemprop="url">详解 Linux 下的用户管理、用户组管理和权限管理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近和几个朋友开发项目，期间使用了一台服务器跑模型，这台服务器是多人公用的，很多人都在上面有自己的账号，互不干涉内政，一切看起来十分井然有序。近期，这个服务器上刚挂载了一块新硬盘，是一位朋友使用 root 账号挂载的，然后将磁盘映射到某个文件夹下。然而挂载好了之后发现使用普通账号没有权限在文件夹下操作，无法创建文件，于是他干脆就直接把文件夹权限改成 777 了。我心想，这还了得，改成 777 了，其他人在里面乱改咋办？会出人命的！所以，我就这件事详细梳理了一下 Linux 下的用户、用户组、文件权限等基本知识，看完这些，以后不要动不动就把文件夹改成 777 权限了。</p>
                  <h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2>
                  <p>首选我们梳理一下 Linux 下的用户、用户组、文件权限等基本知识，然后后面通过一个案例来实际演示一下权限设置的一些操作。 首先 Linux 系统中，是有用户和用户组的概念的，用户就是身份的象征，我们必须以某一个用户身份来操作一个系统，实际上这就对应着我们登录系统时的账号。而用户组就是一些用户的集合，我们可以通过用户组来划分和统一管理某些用户。 比如我要在微信发一条朋友圈，我只想给我的亲人们看，难道我发的时候还要一个个去勾选所有的人？这未免太麻烦了。为了解决这问题，微信里面就有了标签的概念，我们可以提前给好友以标签的方式分类，发的时候直接勾选某个标签就好了，简单高效。实际上这就是用户组的概念，我们可以将某些人进行分组和归类，到时候只需要指定类别或组别就可以了，而不用一个个人去对号入座，从而节省了大量时间。 在 Linux 中，一个用户是可以属于多个组的，一个组也是可以包含多个用户的，下面我以一台 Ubuntu Linux 为例来演示一下相关的命令和操作。</p>
                  <h3 id="用户和用户组"><a href="#用户和用户组" class="headerlink" title="用户和用户组"></a>用户和用户组</h3>
                  <p>首先查看所有用户，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cut -d<span class="string">':'</span> -f <span class="number">1</span> <span class="regexp">/etc/</span>passwd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">root</span></span><br><span class="line"><span class="symbol">daemon</span></span><br><span class="line"><span class="keyword">bin</span></span><br><span class="line"><span class="keyword">sys</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">ubuntu</span></span><br><span class="line"><span class="keyword">mysql</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里一行就是一个用户名，由于太多，部分就省略了，实际上这个命令就是从密码文件中把用户名单独列出来了。 然后查看所有用户组，命令也是类似的：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cut -d<span class="string">':'</span> -f <span class="number">1</span> <span class="regexp">/etc/g</span>roup</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">root</span></span><br><span class="line"><span class="symbol">daemon</span></span><br><span class="line"><span class="keyword">bin</span></span><br><span class="line"><span class="keyword">sys</span></span><br><span class="line"><span class="keyword">...</span></span><br><span class="line"><span class="keyword">ubuntu</span></span><br><span class="line"><span class="keyword">mysql</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果基本是类似的，因为每个用户在被创建的时候都会自动创建一个同名的组作为其默认的用户组。 这里我是使用 ubuntu 这个账号来登录的，下面我来看下 ubuntu 这个账号是属于哪些组。 查看一个用户所属组的命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gorups <span class="tag">&lt;<span class="name">username</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就是 groups 命令加上用户名就能查看该用户名所属的组了，如果不加用户名的话就默认是当前用户。 例如查看 ubuntu 这个用户所属于的组，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">groups ubuntu</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ubuntu : <span class="type">ubuntu</span> adm cdrom sudo dip plugdev lxd lpadmin sambashare</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还不少，这个用户被分配到了很多组下，比如同名的组 ubuntu，还有 sudo 组，另外还有一些其他的组。 其中 sudo 组比较特殊，如果被分到了这个组里面就代表该账号拥有 root 权限，可以使用 sudo 命令。 了解了怎样查看用户所属的组，我们也应该反过来了解如何查看一个用户组里面包含哪些用户啊。 查看某个用户组下所有用户命令如下：</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">members</span> &lt;<span class="built_in">group</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过这个命令不是自带的，需要额外安装 members 包，命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install members</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如查看 sudo 用户组下的所有用户，即拥有 root 权限的用户：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members sudo</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ubuntu hadoop</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到拥有 root 权限的用户有两个，ubuntu 和 hadoop，当然不同的机器结果肯定是不一样的。 接下来介绍一个比较有用的命令，就是 id 命令，它可以用来查看用户的所属组别，格式如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> &lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如查看 ubuntu 用户的信息，就是这样：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> ubuntu</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=<span class="number">500</span>(ubuntu) gid=<span class="number">500</span>(ubuntu) groups=<span class="number">500</span>(ubuntu),<span class="number">4</span>(adm),<span class="number">24</span>(cdrom),<span class="number">27</span>(sudo),<span class="number">30</span>(dip),<span class="number">46</span>(plugdev),<span class="number">110</span>(lxd),<span class="number">115</span>(lpadmin),<span class="number">116</span>(sambashare)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里有一个 gid，作为主工作组，后面还有个 groups，它列出了用户所在的所有组。主工作组只有一个，而后者的数量则不限。可以看到用户组的结果和使用 groups 命令看到的结果是一致的。 接下来我们再来了解一下如何创建一个用户和怎样为用户分配组别。 添加一个用户命令格式如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>&lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如我要添加一个用户 cqc，命令就可以这么写：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用的命令前面都带有 sudo，因为毕竟是系统级别的操作。 添加一个组的命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo groupadd <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>格式是类似的，后面跟一个组的名称就可以了，例如我要为我的实验室创建一个用户组，那么就可以使用如下命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo groupadd lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建完了用户和组，那得把它们关联起来吧，关联的意思就是把某个用户加入到某个组里面，命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo adduser <span class="tag">&lt;<span class="name">username</span>&gt;</span> <span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者使用 usermod 命令：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo usermod -G <span class="tag">&lt;<span class="name">group</span>&gt;</span> <span class="tag">&lt;<span class="name">username</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果要添加多个组的话，可以通过 -a 选项指定多个名称：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo usermod -aG &lt;group1,group2,group3..&gt; &lt;username&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要将 cqc 用户添加到 sudo 用户组中，命令就是：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc sudo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo usermod -G sudo cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就为用户和用户组做好关联了。</p>
                  <h3 id="文件权限管理"><a href="#文件权限管理" class="headerlink" title="文件权限管理"></a>文件权限管理</h3>
                  <p>了解了这些之后，我们再来了解一下文件权限的相关知识，下面我们先随便找一个目录，查看一下文件的列表。 列出某个目录下文件详细信息的命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ll</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者使用：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ls -l</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如我这里列出了 /etc/nginx 目录下的文件列表：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">total <span class="number">80</span></span><br><span class="line">drwxr-xr-x   <span class="number">7</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">22</span>:<span class="number">16</span> ./</span><br><span class="line">drwxr-xr-x <span class="number">103</span> root root  <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">04</span> ../</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jul <span class="number">12</span>  <span class="number">2017</span> conf.d/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1077</span> Feb <span class="number">12</span>  <span class="number">2017</span> fastcgi.conf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1007</span> Feb <span class="number">12</span>  <span class="number">2017</span> fastcgi_params</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">2837</span> Feb <span class="number">12</span>  <span class="number">2017</span> koi-utf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">2223</span> Feb <span class="number">12</span>  <span class="number">2017</span> koi-win</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">3957</span> Feb <span class="number">12</span>  <span class="number">2017</span> mime.types</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">1505</span> Jun <span class="number">21</span> <span class="number">20</span>:<span class="number">24</span> nginx.conf</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root <span class="number">12288</span> Jun <span class="number">21</span> <span class="number">20</span>:<span class="number">44</span> .nginx.conf.swp</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">180</span> Feb <span class="number">12</span>  <span class="number">2017</span> proxy_params</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">636</span> Feb <span class="number">12</span>  <span class="number">2017</span> scgi_params</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">22</span>:<span class="number">42</span> sites-available/</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">19</span>:<span class="number">08</span> sites-enabled/</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">21</span> <span class="number">19</span>:<span class="number">08</span> snippets/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root   <span class="number">664</span> Feb <span class="number">12</span>  <span class="number">2017</span> uwsgi_params</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root  <span class="number">4096</span> Jun <span class="number">22</span> <span class="number">02</span>:<span class="number">44</span> vhosts/</span><br><span class="line">-rw-r--r--   <span class="number">1</span> root root  <span class="number">3071</span> Feb <span class="number">12</span>  <span class="number">2017</span> win-utf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们注意到了每一行都是一个文件或文件夹的信息，一共包括七列：</p>
                  <ul>
                    <li>第一列是文件的权限信息</li>
                    <li>第二列表示该文件夹连接的文件数</li>
                    <li>第三列表示文件所属用户</li>
                    <li>第四列表示文件所属用户组</li>
                    <li>第五列表示文件大小（字节）</li>
                    <li>第六列表示最后修改日期</li>
                    <li>第七列表示文件名</li>
                  </ul>
                  <p>其中第一列的文件权限信息是非常重要的，它由十个字符组成：</p>
                  <ul>
                    <li>第一个字符代表文件的类型，有三种，- 代表这是一个文件，d 代表这是一个文件夹，l 代表这是一个链接。</li>
                    <li>第 2-4 个字符代表文件所有者对该文件的权限，r 就是读，w 就是写，x 就是执行，如果是文件夹的话，执行就意味着查看文件夹下的内容，例如 rw- 就代表文件所有者可以对该文件进行读取和写入。</li>
                    <li>第 5-7 个字符代表文件所属组对该文件的权限，含义是一样的，如 r-x 就代表该文件所属组内的所有用户对该文件有读取和执行的权限。</li>
                    <li>第 8-10 个字符代表是其他用户对该文件的权限，含义也是一样的，如 r— 就代表非所有者，非用户组的用户只拥有对该文件的读取权限。</li>
                  </ul>
                  <p>我们可以使用 chmod 命令来改变文件或目录的权限，有这么几种用法。 一种是数字权限命名，rwx 对应一个二进制数字，如 101 就代表拥有读取和执行的权限，而转为十进制的话，r 就代表 4，w 就代表 2，x 就代表 1，然后三个数字加起来就和二进制数字对应起来了。如 7=4+2+1，这就对应着 rwx；5=4+1，这就对应着 r-x。所以，相应地 777 就代表了 rwxrwxrwx，即所有者、所属用户组、其他用户对该文件都拥有读取、写入、执行的权限，这是相当危险的！ 赋予权限的命令如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="tag">&lt;<span class="name">permission</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要为一个 file.txt 赋予 777 权限，就写成：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> file.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们也可以使用代号来赋予权限，代号有 u、g、o、a 四中，分别代表所有者权限，用户组权限，其他用户权限和所有用户权限，这些代号后面通过 + 和 - 符号来控制权限的添加和移除，再后面跟上权限类型就好，例如：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod u-<span class="meta">x</span> <span class="meta">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是给所有者移除 x 权限，也就是执行权限。</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod g+w <span class="built_in">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是为用户组添加 w 权限，即写入权限。 另外如果是文件夹的话还可以对文件夹进行递归赋权限操作，如：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod -R <span class="number">777</span> share</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是将 share 文件夹和其内所有内容都赋予 777 权限。 好，有了权限的标识，那我们还得把用户和用户组与文件关联起来啊，这里使用的命令就是 chown 和 chgrp 命令。 命令格式如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chown <span class="tag">&lt;<span class="name">username</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">sudo chgrp <span class="tag">&lt;<span class="name">group</span>&gt;</span> <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我要将 file.txt 的所有者换成 cqc，那就可以使用如下命令：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chown cqc <span class="built_in">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我要将 file.txt 所属用户组换成 lab，那就可以使用如下命令：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chgrp <span class="keyword">lab</span> <span class="keyword">file</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外同样可以使用 -R 来进行递归操作，如将 share 文件夹及其内所有内容的所有者都换成 cqc，命令如下：</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">chown</span> -R cqc share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，了解了 chown、chgrp、chmod 之后，我们就可以灵活地对文件权限进行控制了。</p>
                  <h2 id="实战演示"><a href="#实战演示" class="headerlink" title="实战演示"></a>实战演示</h2>
                  <p>可能上面说起来有点抽象，下面我们以一个实例来演示一下权限控制的流程，通过这个流程，相信理解以上的命令都不在话下了。 首先情况是这样的，我要在某台主机上共享一些文件给我实验室的人，但这台主机上还有其他非实验室的人在使用，我只想让实验室的人查看和修改这些文件，其他人不行。 另外我自己的账号要有最高权限来管理这些文件的共享权限，即要有 root 权限。 现在我已经登录了一个 ubuntu 的账号，是系统初始化的，拥有 root 权限。 下面我就模拟创建三个账号和一个用户组，来得到如下效果：</p>
                  <ul>
                    <li>账号 cqc 是我自己使用的账号，拥有最高权限，可以自由调整文件权限信息，可以自由为某个用户分配用户组。</li>
                    <li>账号 lbd 是我实验室的人员，没有 root 权限，但能查看和修改我共享的文件。</li>
                    <li>账号 slb 不是我实验室的人员，没有 root 权限，也不能修改我共享的文件。</li>
                  </ul>
                  <h3 id="创建自己的账户"><a href="#创建自己的账户" class="headerlink" title="创建自己的账户"></a>创建自己的账户</h3>
                  <p>首先我先为自己创建一个账户，添加一个 cqc 的用户：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后会提示输入密码和其他信息：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' ...</span></span><br><span class="line"><span class="string">Adding new group `cqc'</span> (1002) <span class="built_in">..</span>.</span><br><span class="line">Adding new<span class="built_in"> user </span>`cqc<span class="string">' (1002) with group `cqc'</span> <span class="built_in">..</span>.</span><br><span class="line">Creating home directory `/home/cqc<span class="string">' ...</span></span><br><span class="line"><span class="string">Copying files from `/etc/skel'</span> <span class="built_in">..</span>.</span><br><span class="line">Enter new UNIX password: </span><br><span class="line">Retype new UNIX password: </span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the<span class="built_in"> user </span>information <span class="keyword">for</span> cqc</span><br><span class="line">Enter the new value, <span class="keyword">or</span> press ENTER <span class="keyword">for</span> the default</span><br><span class="line">        Full Name []: </span><br><span class="line">        Room Number []: </span><br><span class="line">        Work Phone []: </span><br><span class="line">        Home Phone []: </span><br><span class="line">        Other []: </span><br><span class="line">Is the information correct? [Y/n]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候发现一个同名的组就被创建了，查看下 cqc 所在的组：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">groups cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cqc : <span class="type">cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再用 id 命令查看下信息：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=1002(<span class="name">cqc</span>) gid=1002(<span class="name">cqc</span>) groups=1002(<span class="name">cqc</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到当前 cqc 只属于 cqc 用户组。 接下来我们创建一个用户组，叫做 lab，来标明我的实验室，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo groupadd lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后查看下用户组里面的成员：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>没有任何结果，说明我们创建了一个空的组，没有任何成员。 然后我们将刚才创建的 cqc 加入到该组中，因为我自己也属于该实验室，肯定也要加进来，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc lab</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' to group `lab'</span> <span class="built_in">..</span>.</span><br><span class="line">Adding<span class="built_in"> user </span>cqc <span class="keyword">to</span><span class="built_in"> group </span>lab</span><br><span class="line">Done.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后查看下组内成员：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">members lab</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">cqc</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 lab 组内就有了 cqc 这个用户了。 别忘了 cqc 还需要拥有 root 权限，所以我们还需要将 cqc 添加到 sudo 组内，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>cqc sudo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Adding<span class="built_in"> user </span>`cqc<span class="string">' to group `sudo'</span> <span class="built_in">..</span>.</span><br><span class="line">Adding<span class="built_in"> user </span>cqc <span class="keyword">to</span><span class="built_in"> group </span>sudo</span><br><span class="line">Done.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功加入到 sudo 组了，cqc 也就是我的账户就可以使用 sudo 命令了。 查看下用户状态：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">uid</span>=1002(cqc) <span class="attribute">gid</span>=1002(cqc) <span class="attribute">groups</span>=1002(cqc),27(sudo),1003(lab)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 cqc 就属于三个用户组了，既是实验室成员，又拥有 root 权限。 上面的分配用户组的命令我们也可以使用 usermod 来实现：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> usermod -aG sudo,lab cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就添加到多个组了。</p>
                  <h3 id="添加实验室用户"><a href="#添加实验室用户" class="headerlink" title="添加实验室用户"></a>添加实验室用户</h3>
                  <p>接下来，再添加实验室的另外一个人员 lbd，然后将其添加到 lab 组中，流程是类似的，命令如下：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">adduser </span><span class="keyword">lbd</span></span><br><span class="line"><span class="keyword">sudo </span><span class="keyword">adduser </span><span class="keyword">lbd </span>lab</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后，id 命令查看其信息：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> lbd</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">uid</span>=1004(lbd) <span class="attribute">gid</span>=1005(lbd) <span class="attribute">groups</span>=1005(lbd),1003(lab)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功创建 lbd，并将其添加到实验室 lab 组了。</p>
                  <h3 id="添加非实验室用户"><a href="#添加非实验室用户" class="headerlink" title="添加非实验室用户"></a>添加非实验室用户</h3>
                  <p>最后另外添加一个用户 slb，非实验室成员，只创建账户就好了，命令如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> <span class="keyword">adduser </span>slb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是我们不把他加入 lab 组中。 查看他的状态：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">id</span> slb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uid=1003(<span class="name">slb</span>) gid=1004(<span class="name">slb</span>) groups=1004(<span class="name">slb</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以三人的状态是这样的：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id cqc</span><br><span class="line"><span class="attribute">uid</span>=1002(cqc) <span class="attribute">gid</span>=1002(cqc) <span class="attribute">groups</span>=1002(cqc),27(sudo),1003(lab)</span><br><span class="line">id lbd</span><br><span class="line"><span class="attribute">uid</span>=1004(lbd) <span class="attribute">gid</span>=1005(lbd) <span class="attribute">groups</span>=1005(lbd),1003(lab)</span><br><span class="line">id slb</span><br><span class="line"><span class="attribute">uid</span>=1003(slb) <span class="attribute">gid</span>=1004(slb) <span class="attribute">groups</span>=1004(slb)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="文件权限分配"><a href="#文件权限分配" class="headerlink" title="文件权限分配"></a>文件权限分配</h3>
                  <p>接下来我们创建一个文件夹来共享实验室数据，放在 /srv 目录下。然后调用 mkdir 命令创建名称为 share 的文件夹，命令如下：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">cd</span> /srv</span><br><span class="line">sudo <span class="built_in">mkdir</span> share</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意这里我还是使用 ubuntu 账户来创建的。 先看下当前目录权限：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ls -l</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">total <span class="number">12</span></span><br><span class="line">drwxr-xr-x  <span class="number">3</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> ./</span><br><span class="line">drwxr-xr-x <span class="number">24</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> ../</span><br><span class="line">drwxr-xr-x  <span class="number">2</span> root root <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">18</span>:<span class="number">17</span> share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到 share 文件的所有者是 root，用户组也是 root，权限是 755，即只有 root 拥有修改权限，其他的只有读取和执行权限。 然后进入 share 文件夹创建一个 names.txt：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> share</span><br><span class="line">sudo <span class="keyword">vi</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>编辑内容如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">cqc</span></span><br><span class="line"><span class="attribute">lbd</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>保存完毕之后，这时查看一下文件权限，如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> root root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">00</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>权限是 640，这表明只有所有者 root 拥有写入的权限，所在组只有读的权限。 这时开启另外一个终端，登录 cqc 账号，实际上是不能查看和修改任何该文件的内容的，下面的修改和读取命令都会提示权限不够：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为什么呢？因为该文件是刚才由 ubuntu 账号使用 sudo 命令创建的，因此文件的所有者是 root，并不是 cqc，因此即使文件的权限是 640，那也就不能使用文件所有者的权限，而且 cqc 也不属于 root 组，所以也不能使用文件组的权限了，因此什么都看不了，什么都改不了。 但 cqc 属于 sudo 组啊，可以利用 sudo 命令临时获取 root 权限，临时以 root 的身份来操作该文件，这样就可以来查看和修改文件了，因此下面的命令是有效的：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样还是需要使用 sudo 才能修改，很不方便。 这时如果我们把文件的所有者改成 cqc，情况那就不一样了。 使用 ubuntu 账号，对 names.txt 更改其所有者为 cqc，改的命令如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chown</span> <span class="selector-tag">cqc</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时查看下文件信息：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> cqc  root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">29</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到所有者信息已经变成了 cqc，这样 cqc 账号再直接查看和修改，那就可以了，不再需要 sudo 命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就不会有权限提示，当然加上 sudo 更是没问题。 好，接下来 lbd 呢？我们登录试试修改。 首先当前的文件状态是这样的：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-rw-r----- <span class="number">1</span> cqc  root    <span class="number">8</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">31</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>lbd 不是所有者了，因此前面的 rw- 权限是没什么用的，但他属于 lab 组，而该文件对于用户组的权限是 r—，也就是读取权限。 我们使用 lbd 账号来尝试看下文件的内容：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cat</span> names.txt </span><br><span class="line"><span class="keyword">ca</span><span class="variable">t:</span> names.tx<span class="variable">t:</span> Permission denied</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很遗憾，又没有权限。因为什么？因为这个文件的用户组并不是 lab 啊，而 lbd 这个用户又不属于 root 组，所以没有任何权限。 那咋办？将文件的用户组改成 lab 就好了，使用 ubuntu 账号或 cqc 账号来操作：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chgrp</span> <span class="selector-tag">lab</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功将文件所属用户组改成 lab 了，接下来再使用 lbd 账号查看下文件内容：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就成功读取了。 然而 lbd 现在是没有写入权限的，因为对于用户组来说，该文件的权限是 r—，如果要获取写入权限，我们可以使用如下命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chmod</span> <span class="selector-tag">g</span>+<span class="selector-tag">w</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">660</span> names.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就相当于赋予了 rw- 权限，下面我们再使用 lbd 账号尝试修改这个文件：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就没问题了。 那么对于非实验室同学 slb 呢？它没有任何权限，我们登录 slb 账号尝试修改和读取该文件：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">cat</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br><span class="line"><span class="selector-tag">vi</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>均无权限。 所以说，这样我们就成功为实验室的人员赋予了权限，而非实验室的人则没有任何权限。 如果我要为 slb 赋予读取权限咋办呢？很简单，添加一下就好了：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chmod</span> <span class="selector-tag">o</span>+<span class="selector-tag">r</span> <span class="selector-tag">names</span><span class="selector-class">.txt</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这就是为其他用户添加了读取权限。这时 slb 就可以读取文件，但不能修改文件，也是比较安全的。 好，如果我的文件非常多呢？比如十几二十个，都放在 share 文件夹内，那不能一个个进行权限设置吧？ 这时候我们只需要针对文件夹进行操作即可，下面的命令就可以为 share 文件夹赋予 775 权限，即所有者 cqc 和所在组 lab 可对其进行查看和修改，其他的人只能看不能改：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod -R <span class="number">775</span> <span class="keyword">share</span>/</span><br><span class="line">sudo chown -R cqc <span class="keyword">share</span>/</span><br><span class="line">sudo chgrp -R lab <span class="keyword">share</span>/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意文件夹一般都会赋予 x 权限，不然连进入文件夹的权限都没有。这也就是文件夹一般会赋予 775、755，而文件会赋予 664、600、644、640 的原因了。 赋予 775 权限之后，share 的权限就变成了：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">drwxrwxr-x  <span class="number">2</span> cqc  lab  <span class="number">4096</span> Sep  <span class="number">4</span> <span class="number">20</span>:<span class="number">31</span> share/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样其他用户就只能看，不能改，这样普通文件就没什么问题了。 如文件夹内包含了可执行文件，还可以单独为其他用户针对可执行文件去除 x 权限，如去除 Python 文件的可执行权限：</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> chmod o-x <span class="regexp">*.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，到现在为止，我们就得心应手地完成了权限控制了！ 相信如果你耐心看完的话，什么用户管理、权限管理，都不在话下！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-04 23:20:13" itemprop="dateCreated datePublished" datetime="2018-09-04T23:20:13+08:00">2018-09-04</time>
                </span>
                <span id="/6284.html" class="post-meta-item leancloud_visitors" data-flag-title="详解 Linux 下的用户管理、用户组管理和权限管理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6281.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/6281.html" class="post-title-link" itemprop="url">如何给Azure云服务器扩展云磁盘</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文介绍一下如何给 Azure 的云服务器增加一块磁盘。</p>
                  <h2 id="页面操作"><a href="#页面操作" class="headerlink" title="页面操作"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C" target="_blank" rel="noopener"></a>页面操作</h2>
                  <p>首先切换到磁盘页面，然后点击添加数据磁盘按钮： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-42-27.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-42-27.jpg" alt=""></a> 然后选定存储容器，这里使用的是存储账户 Blob，然后点击确定按钮： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-43-38.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-43-38.jpg" alt=""></a> 主机缓存切换为“读/写”，然后点击保存： <a href="https://github.com/Germey/AI/blob/master/assets/2018-08-02-16-44-09.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-08-02-16-44-09.jpg" alt=""></a> 这样就添加好了。</p>
                  <h2 id="挂载磁盘"><a href="#挂载磁盘" class="headerlink" title="挂载磁盘"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98" target="_blank" rel="noopener"></a>挂载磁盘</h2>
                  <p>接下来回到 Linux 服务器下，我们需要将磁盘进行挂载。 首先 SSH 连接到服务器，然后使用 dmesg 命令来查找磁盘：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dmesg <span class="string">| grep SCSI</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出类似如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-attr">[    0.728389]</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">subsystem</span> <span class="selector-tag">initialized</span></span><br><span class="line"><span class="selector-attr">[    2.139341]</span> <span class="selector-tag">Block</span> <span class="selector-tag">layer</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">generic</span> (<span class="selector-tag">bsg</span>) <span class="selector-tag">driver</span> <span class="selector-tag">version</span> 0<span class="selector-class">.4</span> <span class="selector-tag">loaded</span> (<span class="selector-tag">major</span> 244)</span><br><span class="line"><span class="selector-attr">[    2.978928]</span> <span class="selector-tag">sd</span> 1<span class="selector-pseudo">:0</span><span class="selector-pseudo">:1</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sdb]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br><span class="line"><span class="selector-attr">[    3.341183]</span> <span class="selector-tag">sd</span> 0<span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sda]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br><span class="line"><span class="selector-attr">[   18.397942]</span> <span class="selector-tag">Loading</span> <span class="selector-tag">iSCSI</span> <span class="selector-tag">transport</span> <span class="selector-tag">class</span> <span class="selector-tag">v2</span><span class="selector-class">.0-870</span>.</span><br><span class="line"><span class="selector-attr">[ 6641.364794]</span> <span class="selector-tag">sd</span> 3<span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span><span class="selector-pseudo">:0</span>: <span class="selector-attr">[sdc]</span> <span class="selector-tag">Attached</span> <span class="selector-tag">SCSI</span> <span class="selector-tag">disk</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 sdc 就是我们新添加的一块硬盘。 然后我们使用 fdisk 对其进行分区，将其设置为分区 1 中的主磁盘，并接受其他的默认值，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo fdisk <span class="regexp">/dev/</span>sdc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用 n 命令添加新分区，然后 p 选择主分区，其他的默认：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Welcome <span class="keyword">to</span> fdisk (util-linux 2.27.1).</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide <span class="keyword">to</span> write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Device does <span class="keyword">not</span> contain a recognized partition table.</span><br><span class="line">Created a new DOS disklabel with disk identifier 0xc305fe54.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> help): n</span><br><span class="line">Partition type</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended (container <span class="keyword">for</span> logical partitions)</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4,<span class="built_in"> default </span>1): </span><br><span class="line">First sector (2048-2145386495,<span class="built_in"> default </span>2048): </span><br><span class="line">Last sector, +sectors <span class="keyword">or</span> +size&#123;K,M,G,T,P&#125; (2048-2145386495,<span class="built_in"> default </span>2145386495): </span><br><span class="line"></span><br><span class="line">Created a new partition 1 of<span class="built_in"> type </span><span class="string">'Linux'</span> <span class="keyword">and</span> of size 1023 GiB.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 p 打印分区表并使用 w 将表写入磁盘，然后退出：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Command (m for <span class="keyword">help</span>): p</span><br><span class="line">Disk /dev/sdc: <span class="number">1023</span> GiB, <span class="number">1098437885952</span> <span class="keyword">bytes</span>, <span class="number">2145386496</span> sectors</span><br><span class="line">Units: sectors <span class="keyword">of</span> <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Sector <span class="keyword">size</span> (<span class="keyword">logical</span>/<span class="keyword">physical</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">I/O <span class="keyword">size</span> (<span class="keyword">minimum</span>/<span class="keyword">optimal</span>): <span class="number">512</span> <span class="keyword">bytes</span> / <span class="number">512</span> <span class="keyword">bytes</span></span><br><span class="line">Disklabel <span class="keyword">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0xc305fe54</span></span><br><span class="line"></span><br><span class="line">Device     Boot <span class="keyword">Start</span>        <span class="keyword">End</span>    Sectors  <span class="keyword">Size</span> <span class="keyword">Id</span> <span class="keyword">Type</span></span><br><span class="line">/dev/sdc1        <span class="number">2048</span> <span class="number">2145386495</span> <span class="number">2145384448</span> <span class="number">1023</span>G <span class="number">83</span> Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="keyword">help</span>): w</span><br><span class="line">The <span class="keyword">partition</span> <span class="keyword">table</span> has been altered.</span><br><span class="line"><span class="keyword">Calling</span> ioctl() <span class="keyword">to</span> re-<span class="keyword">read</span> <span class="keyword">partition</span> table.</span><br><span class="line">Syncing disks.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来使用 mkfs 命令将文件系统写入分区，指定文件系统的类型和设备名称：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mkfs -t ext4 <span class="regexp">/dev/</span>sdc1</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出类似如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mke2fs <span class="number">1.42</span><span class="number">.13</span> (<span class="number">17</span>-May<span class="number">-2015</span>)</span><br><span class="line">Creating filesystem with <span class="number">268173056</span> <span class="number">4</span>k blocks <span class="keyword">and</span> <span class="number">67043328</span> inodes</span><br><span class="line">Filesystem UUID: d744c5d7-f4d1<span class="number">-4f</span>81<span class="number">-9f</span>56<span class="number">-59</span>dfab956782</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        <span class="number">32768</span>, <span class="number">98304</span>, <span class="number">163840</span>, <span class="number">229376</span>, <span class="number">294912</span>, <span class="number">819200</span>, <span class="number">884736</span>, <span class="number">1605632</span>, <span class="number">2654208</span>, </span><br><span class="line">        <span class="number">4096000</span>, <span class="number">7962624</span>, <span class="number">11239424</span>, <span class="number">20480000</span>, <span class="number">23887872</span>, <span class="number">71663616</span>, <span class="number">78675968</span>, </span><br><span class="line">        <span class="number">102400000</span>, <span class="number">214990848</span></span><br><span class="line"></span><br><span class="line">Allocating group tables: done                            </span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (<span class="number">32768</span> blocks): done</span><br><span class="line">Writing superblocks <span class="keyword">and</span> filesystem accounting information: done</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后使用 mkdir 创建一个目录来装载该文件系统，然后挂载：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mkdir <span class="string">/datadrive</span></span><br><span class="line">sudo mount <span class="string">/dev/sdc1</span> <span class="string">/datadrive</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就挂载成功了。</p>
                  <h2 id="添加引导信息"><a href="#添加引导信息" class="headerlink" title="添加引导信息"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Azure%E3%80%91%E7%BB%99Azure%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%A9%E5%B1%95%E7%A3%81%E7%9B%98.md#%E6%B7%BB%E5%8A%A0%E5%BC%95%E5%AF%BC%E4%BF%A1%E6%81%AF" target="_blank" rel="noopener"></a>添加引导信息</h2>
                  <p>若要确保在重新引导后自动重新装载驱动器，必须将其添加到 /etc/fstab 文件。 此外，强烈建议在 /etc/fstab 中使用 UUID（全局唯一标识符）来引用驱动器而不是只使用设备名称（例如 /dev/sdc1）。 如果 OS 在启动过程中检测到磁盘错误，使用 UUID 可以避免将错误的磁盘装载到给定位置。 然后，为剩余的数据磁盘分配这些设备 ID。 若要查找新驱动器的 UUID，请使用 blkid 实用工具：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo -i blkid</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入类似如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/dev/sdb1: <span class="attribute">UUID</span>=<span class="string">"d5b61f40-4129-4b39-b861-c2d3b09cee69"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"4927b944-01"</span></span><br><span class="line">/dev/sda1: <span class="attribute">LABEL</span>=<span class="string">"cloudimg-rootfs"</span> <span class="attribute">UUID</span>=<span class="string">"b2e62f4f-d338-470e-9ae7-4fc0e014858c"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"577c3e7c-01"</span></span><br><span class="line">/dev/sdc1: <span class="attribute">UUID</span>=<span class="string">"d744c5d7-f4d1-4f81-9f56-59dfab956782"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> <span class="attribute">PARTUUID</span>=<span class="string">"c305fe54-01"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后编辑 /etc/fstab，添加下面一行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">UUID=d744c5d7-f4d1<span class="number">-4f</span>81<span class="number">-9f</span>56<span class="number">-59</span>dfab956782       /datadrive      ext4    defaults,nofail <span class="number">1</span>      <span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后保存退出即可。 这样就成功添加了一块外部磁盘。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-09-04 15:42:35" itemprop="dateCreated datePublished" datetime="2018-09-04T15:42:35+08:00">2018-09-04</time>
                </span>
                <span id="/6281.html" class="post-meta-item leancloud_visitors" data-flag-title="如何给Azure云服务器扩展云磁盘" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6255.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/6255.html" class="post-title-link" itemprop="url">Ubuntu 搭建 Elasticsearch 6 集群流程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="为何要搭建-Elasticsearch-集群"><a href="#为何要搭建-Elasticsearch-集群" class="headerlink" title="为何要搭建 Elasticsearch 集群"></a>为何要搭建 Elasticsearch 集群</h2>
                  <p>凡事都要讲究个为什么。在搭建集群之前，我们首先先问一句，为什么我们需要搭建集群？它有什么优势呢？</p>
                  <h3 id="高可用性"><a href="#高可用性" class="headerlink" title="高可用性"></a>高可用性</h3>
                  <p>Elasticsearch 作为一个搜索引擎，我们对它的基本要求就是存储海量数据并且可以在非常短的时间内查询到我们想要的信息。所以第一步我们需要保证的就是 Elasticsearch 的高可用性，什么是高可用性呢？它通常是指，通过设计减少系统不能提供服务的时间。假设系统一直能够提供服务，我们说系统的可用性是 100%。如果系统在某个时刻宕掉了，比如某个网站在某个时间挂掉了，那么就可以它临时是不可用的。所以，为了保证 Elasticsearch 的高可用性，我们就应该尽量减少 Elasticsearch 的不可用时间。 那么怎样提高 Elasticsearch 的高可用性呢？这时集群的作用就体现出来了。假如 Elasticsearch 只放在一台服务器上，即单机运行，假如这台主机突然断网了或者被攻击了，那么整个 Elasticsearch 的服务就不可用了。但如果改成 Elasticsearch 集群的话，有一台主机宕机了，还有其他的主机可以支撑，这样就仍然可以保证服务是可用的。 那可能有的小伙伴就会说了，那假如一台主机宕机了，那么不就无法访问这台主机的数据了吗？那假如我要访问的数据正好存在这台主机上，那不就获取不到了吗？难道其他的主机里面也存了一份一模一样的数据？那这岂不是很浪费吗？ 为了解答这个问题，这里就引出了 Elasticsearch 的信息存储机制了。首先解答上面的问题，一台主机宕机了，这台主机里面存的数据依然是可以被访问到的，因为在其他的主机上也有备份，但备份的时候也不是整台主机备份，是分片备份的，那这里就又引出了一个概念——分片。 分片，英文叫做 Shard，顾名思义，分片就是对数据切分成了多个部分。我们知道 Elasticsearch 中一个索引（Index）相当于是一个数据库，如存某网站的用户信息，我们就建一个名为 user 的索引。但索引存储的时候并不是整个存一起的，它是被分片存储的，Elasticsearch 默认会把一个索引分成五个分片，当然这个数字是可以自定义的。分片是数据的容器，数据保存在分片内，分片又被分配到集群内的各个节点里。当你的集群规模扩大或者缩小时， Elasticsearch 会自动的在各节点中迁移分片，使得数据仍然均匀分布在集群里，所以相当于一份数据被分成了多份并保存在不同的主机上。 那这还是没解决问题啊，如果一台主机挂掉了，那么这个分片里面的数据不就无法访问了？别的主机都是存储的其他的分片。其实是可以访问的，因为其他主机存储了这个分片的备份，叫做副本，这里就引出了另外一个概念——副本。 副本，英文叫做 Replica，同样顾名思义，副本就是对原分片的复制，和原分片的内容是一样的，Elasticsearch 默认会生成一份副本，所以相当于是五个原分片和五个分片副本，相当于一份数据存了两份，并分了十个分片，当然副本的数量也是可以自定义的。这时我们只需要将某个分片的副本存在另外一台主机上，这样当某台主机宕机了，我们依然还可以从另外一台主机的副本中找到对应的数据。所以从外部来看，数据结果是没有任何区别的。 一般来说，Elasticsearch 会尽量把一个索引的不同分片存储在不同的主机上，分片的副本也尽可能存在不同的主机上，这样可以提高容错率，从而提高高可用性。 但这时假如你只有一台主机，那不就没办法了吗？分片和副本其实是没意义的，一台主机挂掉了，就全挂掉了。</p>
                  <h3 id="健康状态"><a href="#健康状态" class="headerlink" title="健康状态"></a>健康状态</h3>
                  <p>针对一个索引，Elasticsearch 中其实有专门的衡量索引健康状况的标志，分为三个等级：</p>
                  <ul>
                    <li>green，绿色。这代表所有的主分片和副本分片都已分配。你的集群是 100% 可用的。</li>
                    <li>yellow，黄色。所有的主分片已经分片了，但至少还有一个副本是缺失的。不会有数据丢失，所以搜索结果依然是完整的。不过，你的高可用性在某种程度上被弱化。如果更多的分片消失，你就会丢数据了。所以可把 yellow 想象成一个需要及时调查的警告。</li>
                    <li>red，红色。至少一个主分片以及它的全部副本都在缺失中。这意味着你在缺少数据：搜索只能返回部分数据，而分配到这个分片上的写入请求会返回一个异常。</li>
                  </ul>
                  <p>如果你只有一台主机的话，其实索引的健康状况也是 yellow，因为一台主机，集群没有其他的主机可以防止副本，所以说，这就是一个不健康的状态，因此集群也是十分有必要的。</p>
                  <h3 id="存储空间"><a href="#存储空间" class="headerlink" title="存储空间"></a>存储空间</h3>
                  <p>另外，既然是群集，那么存储空间肯定也是联合起来的，假如一台主机的存储空间是固定的，那么集群它相对于单个主机也有更多的存储空间，可存储的数据量也更大。 所以综上所述，我们需要一个集群！</p>
                  <h2 id="详细了解-Elasticsearch-集群"><a href="#详细了解-Elasticsearch-集群" class="headerlink" title="详细了解 Elasticsearch 集群"></a>详细了解 Elasticsearch 集群</h2>
                  <p>接下来我们再来了解下集群的结构是怎样的。 首先我们应该清楚多台主机构成了一个集群，每台主机称作一个节点（Node）。 如图就是一个三节点的集群：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-04-23-52-42.png" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-04-23-52-42.png" alt=""></p>
                  <p>在图中，每个 Node 都有三个分片，其中 P 开头的代表 Primary 分片，即主分片，R 开头的代表 Replica 分片，即副本分片。所以图中主分片 1、2，副本分片 0 储存在 1 号节点，副本分片 0、1、2 储存在 2 号节点，主分片 0 和副本分片 1、2 储存在 3 号节点，一共是 3 个主分片和 6 个副本分片。同时我们还注意到 1 号节点还有个 MASTER 的标识，这代表它是一个主节点，它相比其他的节点更加特殊，它有权限控制整个集群，比如资源的分配、节点的修改等等。 这里就引出了一个概念就是节点的类型，我们可以将节点分为这么四个类型：</p>
                  <ul>
                    <li>主节点：即 Master 节点。主节点的主要职责是和集群操作相关的内容，如创建或删除索引，跟踪哪些节点是群集的一部分，并决定哪些分片分配给相关的节点。稳定的主节点对集群的健康是非常重要的。默认情况下任何一个集群中的节点都有可能被选为主节点。索引数据和搜索查询等操作会占用大量的cpu，内存，io资源，为了确保一个集群的稳定，分离主节点和数据节点是一个比较好的选择。虽然主节点也可以协调节点，路由搜索和从客户端新增数据到数据节点，但最好不要使用这些专用的主节点。一个重要的原则是，尽可能做尽量少的工作。</li>
                    <li>数据节点：即 Data 节点。数据节点主要是存储索引数据的节点，主要对文档进行增删改查操作，聚合操作等。数据节点对 CPU、内存、IO 要求较高，在优化的时候需要监控数据节点的状态，当资源不够的时候，需要在集群中添加新的节点。</li>
                    <li>负载均衡节点：也称作 Client 节点，也称作客户端节点。当一个节点既不配置为主节点，也不配置为数据节点时，该节点只能处理路由请求，处理搜索，分发索引操作等，从本质上来说该客户节点表现为智能负载平衡器。独立的客户端节点在一个比较大的集群中是非常有用的，他协调主节点和数据节点，客户端节点加入集群可以得到集群的状态，根据集群的状态可以直接路由请求。</li>
                    <li>预处理节点：也称作 Ingest 节点，在索引数据之前可以先对数据做预处理操作，所有节点其实默认都是支持 Ingest 操作的，也可以专门将某个节点配置为 Ingest 节点。</li>
                  </ul>
                  <p>以上就是节点几种类型，一个节点其实可以对应不同的类型，如一个节点可以同时成为主节点和数据节点和预处理节点，但如果一个节点既不是主节点也不是数据节点，那么它就是负载均衡节点。具体的类型可以通过具体的配置文件来设置。</p>
                  <h2 id="怎样搭建-Elasticsearch-集群"><a href="#怎样搭建-Elasticsearch-集群" class="headerlink" title="怎样搭建 Elasticsearch 集群"></a>怎样搭建 Elasticsearch 集群</h2>
                  <p>好，接下来我们就来动手搭建一个集群吧。 这里我一共拥有七台 Linux 主机，系统是 Ubuntu 16.04，都连接在一个内网中，IP 地址为：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">10.0.0.4</span></span><br><span class="line"><span class="number">10.0.0.5</span></span><br><span class="line"><span class="number">10.0.0.6</span></span><br><span class="line"><span class="number">10.0.0.7</span></span><br><span class="line"><span class="number">10.0.0.8</span></span><br><span class="line"><span class="number">10.0.0.9</span></span><br><span class="line"><span class="number">10.0.0.10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>每台主机的存储空间是 1TB，内存是 13GB。 下面我们来一步步介绍如何用这几台主机搭建一个 Elasticsearch 集群，这里使用的 Elasticsearch 版本是 6.3.2，另外我们还需要安装 Kibana 用来可视化监控和管理 Elasticsearch 的相关配置和数据，使得集群的管理更加方便。 环境配置如下所示：</p>
                  <p>名称</p>
                  <p>内容</p>
                  <p>主机台数</p>
                  <p>7</p>
                  <p>主机内存</p>
                  <p>13GB</p>
                  <p>主机系统</p>
                  <p>Ubuntu 16.04</p>
                  <p>存储空间</p>
                  <p>1TB</p>
                  <p>Elasticsearch 版本</p>
                  <p>6.3.2</p>
                  <p>Java 版本</p>
                  <p>1.8</p>
                  <p>Kibana 版本</p>
                  <p>6.3.2</p>
                  <h3 id="安装-Java"><a href="#安装-Java" class="headerlink" title="安装 Java"></a>安装 Java</h3>
                  <p>Elasticsearch 是基于 Lucene 的，而 Lucene 又是基于 Java 的。所以第一步我们就需要在每台主机上安装 Java。 首先更新 Apt 源：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后安装 Java：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> install <span class="keyword">default</span>-jre</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后可以检查下 Java 的版本：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">java -<span class="built_in">version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的版本是 1.8，类似输出如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">openjdk version <span class="string">"1.8.0_171"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_171-8u171-b11-0ubuntu0.16.04.1-b11)</span><br><span class="line">OpenJDK 64-Bit<span class="built_in"> Server </span>VM (build 25.171-b11, mixed mode)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果看到上面的内容就说明安装成功了。 注意一定要每台主机都要安装。</p>
                  <h2 id="安装-Elasticsearch"><a href="#安装-Elasticsearch" class="headerlink" title="安装 Elasticsearch"></a>安装 Elasticsearch</h2>
                  <p>接下来我们来安装 Elasticsearch，同样是每台主机都需要安装。 首先需要添加 Apt-key：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget -qO - https://artifacts.elastic.co/GPG-<span class="meta">KEY</span>-elasticsearch | sudo apt-<span class="meta">key</span> <span class="meta">add</span> -</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后添加 Elasticsearch 的 Repository 定义：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">echo <span class="string">"deb https://artifacts.elastic.co/packages/6.x/apt stable main"</span> | sudo tee -a /etc/apt/sources.<span class="type">list</span>.d/elastic<span class="number">-6.</span>x.<span class="type">list</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来安装 Elasticsearch 即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> update </span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后我们就完成了 Elasticsearch 的安装，注意还是要每台主机都要安装。</p>
                  <h3 id="配置-Elasticsearch"><a href="#配置-Elasticsearch" class="headerlink" title="配置 Elasticsearch"></a>配置 Elasticsearch</h3>
                  <p>这时我们只是每台主机都安装好了 Elasticsearch，接下来我们还需要将它们联系在一起构成一个集群。 安装完之后，Elasticsearch 的配置文件是 /etc/elasticsearch/elasticsearch.yml，接下来让我们编辑一下配置文件：</p>
                  <ul>
                    <li>集群的名称</li>
                  </ul>
                  <p>通过 cluster.name 可以配置集群的名称，集群是一个整体，因此名称都要一致，所有主机都配置成相同的名称，配置示例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cluster</span>.name: germey-es-clusters</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>节点的名称</li>
                  </ul>
                  <p>通过 node.name 可以配置每个节点的名称，每个节点都是集群的一部分，每个节点名称都不要相同，可以按照顺序编号，配置示例：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">node</span>.name:<span class="title"> es-node-1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他的主机可以配置为 es-node-2、es-node-3 等。</p>
                  <ul>
                    <li>是否有资格成为主节点</li>
                  </ul>
                  <p>通过 node.master 可以配置该节点是否有资格成为主节点，如果配置为 true，则主机有资格成为主节点，配置为 false 则主机就不会成为主节点，可以去当数据节点或负载均衡节点。注意这里是有资格成为主节点，不是一定会成为主节点，主节点需要集群经过选举产生。这里我配置所有主机都可以成为主节点，因此都配置为 true，配置示例： node.master: true</p>
                  <ul>
                    <li>是否是数据节点</li>
                  </ul>
                  <p>通过 node.data 可以配置该节点是否为数据节点，如果配置为 true，则主机就会作为数据节点，注意主节点也可以作为数据节点，当 node.master 和 node.data 均为 false，则该主机会作为负载均衡节点。这里我配置所有主机都是数据节点，因此都配置为 true，配置示例： node.data: true</p>
                  <ul>
                    <li>数据和日志路径</li>
                  </ul>
                  <p>通过 path.data 和 path.logs 可以配置 Elasticsearch 的数据存储路径和日志存储路径，可以指定任意位置，这里我指定存储到 1T 硬盘对应的路径下，另外注意一下写入权限问题，配置示例： path.data: /datadrive/elasticsearch/data path.logs: /datadrive/elasticsearch/logs</p>
                  <ul>
                    <li>​设置访问的地址和端口</li>
                  </ul>
                  <p>我们需要设定 Elasticsearch 运行绑定的 Host，默认是无法公开访问的，如果设置为主机的公网 IP 或 0.0.0.0 就是可以公开访问的，这里我们可以都设置为公开访问或者部分主机公开访问，如果是公开访问就配置为：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">network</span><span class="selector-class">.host</span>: 0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果不想被公开访问就不用配置。 另外还可以配置访问的端口，默认是 9200： http.port: 9200</p>
                  <ul>
                    <li>集群地址设置</li>
                  </ul>
                  <p>通过 discovery.zen.ping.unicast.hosts 可以配置集群的主机地址，配置之后集群的主机之间可以自动发现，这里我配置的是内网地址，配置示例：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">discovery</span><span class="selector-class">.zen</span><span class="selector-class">.ping</span><span class="selector-class">.unicast</span><span class="selector-class">.hosts</span>: <span class="selector-attr">[<span class="string">"10.0.0.4"</span>, <span class="string">"10.0.0.5"</span>, <span class="string">"10.0.0.6"</span>, <span class="string">"10.0.0.7"</span>, <span class="string">"10.0.0.8"</span>, <span class="string">"10.0.0.9"</span>, <span class="string">"10.0.0.10"</span>]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里请改成你的主机对应的 IP 地址。</p>
                  <ul>
                    <li>节点数目相关配置</li>
                  </ul>
                  <p>为了防止集群发生“脑裂”，即一个集群分裂成多个，通常需要配置集群最少主节点数目，通常为 (可成为主节点的主机数目 / 2) + 1，例如我这边可以成为主节点的主机数目为 7，那么结果就是 4，配置示例：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">discovery</span><span class="selector-class">.zen</span><span class="selector-class">.minimum_master_nodes</span>: 4</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还可以配置当最少几个节点回复之后，集群就正常工作，这里我设置为 4，可以酌情修改，配置示例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gateway.recover_after_nodes: <span class="number">4</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他的暂时先不需要配置，保存即可。注意每台主机都需要配置。</p>
                  <h3 id="启动-Elasticsearch"><a href="#启动-Elasticsearch" class="headerlink" title="启动 Elasticsearch"></a>启动 Elasticsearch</h3>
                  <p>配置完成之后就可以在每台主机上分别启动 Elasticsearch 服务了，命令如下：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="keyword"> system</span>ctl daemon-reload</span><br><span class="line">sudo<span class="keyword"> system</span>ctl enable elasticsearch.service</span><br><span class="line">sudo<span class="keyword"> system</span>ctl start elasticsearch.service</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所有主机都启动之后，我们在任意主机上就可以查看到集群状态了，命令行如下：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -XGET 'http://localhost:<span class="number">9200</span>/_cluster/<span class="keyword">state</span>?pretty'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>类似的输出如下：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"cluster_name"</span>: <span class="string">"germey-es-clusters"</span>,</span><br><span class="line">    <span class="string">"compressed_size_in_bytes"</span>: <span class="number">20799</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="number">658</span>,</span><br><span class="line">    <span class="string">"state_uuid"</span>: <span class="string">"a64wCwPnSueKRtVuKx8xRw"</span>,</span><br><span class="line">    <span class="string">"master_node"</span>: <span class="string">"73BQvOC2TpSXcr-IXBcDdg"</span>,</span><br><span class="line">    <span class="string">"blocks"</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">"nodes"</span>: &#123;</span><br><span class="line">        <span class="string">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"es-node-1"</span>,</span><br><span class="line">            <span class="string">"ephemeral_id"</span>: <span class="string">"KpCG4jNvTUGKNHNwKKoMrA"</span>,</span><br><span class="line">            <span class="string">"transport_address"</span>: <span class="string">"10.0.0.4:9300"</span>,</span><br><span class="line">            <span class="string">"attributes"</span>: &#123;</span><br><span class="line">                <span class="string">"ml.machine_memory"</span>: <span class="string">"7308464128"</span>,</span><br><span class="line">                <span class="string">"ml.max_open_jobs"</span>: <span class="string">"20"</span>,</span><br><span class="line">                <span class="string">"xpack.installed"</span>: <span class="string">"true"</span>,</span><br><span class="line">                <span class="string">"ml.enabled"</span>: <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"es-node-7"</span>,</span><br><span class="line">            <span class="string">"ephemeral_id"</span>: <span class="string">"Fs9v2XTASnGbqrM8g7IhAQ"</span>,</span><br><span class="line">            <span class="string">"transport_address"</span>: <span class="string">"10.0.0.10:9300"</span>,</span><br><span class="line">            <span class="string">"attributes"</span>: &#123;</span><br><span class="line">                <span class="string">"ml.machine_memory"</span>: <span class="string">"14695202816"</span>,</span><br><span class="line">                <span class="string">"ml.max_open_jobs"</span>: <span class="string">"20"</span>,</span><br><span class="line">                <span class="string">"xpack.installed"</span>: <span class="string">"true"</span>,</span><br><span class="line">                <span class="string">"ml.enabled"</span>: <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">....</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里输出了集群的相关信息，同时 nodes 字段里面包含了每个节点的详细信息，这样一个基本的集群就构建完成了。</p>
                  <h3 id="安装-Kibana"><a href="#安装-Kibana" class="headerlink" title="安装 Kibana"></a>安装 Kibana</h3>
                  <p>接下来我们需要安装一个 Kibana 来帮助可视化管理 Elasticsearch，依然还是通过 Apt 安装，只需要任意一台主机安装即可，因为集群是一体的，所以 Kibana 在任意一台主机只要能连接到 Elasticsearch 即可，安装命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install kibana</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装之后修改 /etc/kibana/kibana.yml，设置公开访问和绑定的端口：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">server</span><span class="selector-class">.port</span>: 5601</span><br><span class="line"><span class="selector-tag">server</span><span class="selector-class">.host</span>: "0<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span>"</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后启动服务：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="keyword"> system</span>ctl daemon-reload</span><br><span class="line">sudo<span class="keyword"> system</span>ctl enable kibana.service</span><br><span class="line">sudo<span class="keyword"> system</span>ctl start kibana.service</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们可以在浏览器输入该台主机的 IP 加端口，查看 Kibana 管理页面了，类似如下： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-01-44-28.jpg" alt=""></p>
                  <p>这样 Kibana 可视化管理就配置成功了。</p>
                  <h3 id="配置认证"><a href="#配置认证" class="headerlink" title="配置认证"></a>配置认证</h3>
                  <p>现在集群已经初步搭建完成了，但是现在集群很危险，如果我们配置了可公网访问，那么它是可以被任何人操作的，比如储存数据，增删节点等，这是非常危险的，所以我们必须要设置访问权限。 在 Elasticsearch 中，配置认证是通过 X-Pack 插件实现的，幸运的是，我们不需要额外安装了，在 Elasticsearch 6.3.2 版本中，该插件是默认集成到 Elasticsearch 中的，所以我们只需要更改一部分设置就可以了。 首先我们需要升级 License，只有修改了高级版 License 才能使用X-Pack 的权限认证功能。 在 Kibana 中访问 Management -&gt; Elasticsearch -&gt; License Management，点击右侧的升级 License 按钮，可以免费试用 30 天的高级 License，升级完成之后页面会显示如下：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-16-45-10.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-16-45-10.jpg" alt=""></p>
                  <p>另外还可以使用 API 来更新 License，详情可以参考官方文档：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/update-license.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/update-license.html</a>。 然后每台主机需要修改 /etc/elasticsearch/elasticsearch.yml 文件，开启 Auth 认证功能：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">xpack</span><span class="selector-class">.security</span><span class="selector-class">.enabled</span>: <span class="selector-tag">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后设置 elastic、kibana、logstash_system 三个用户的密码，任意一台主机修改之后，一台修改，多台生效，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/usr/</span>share<span class="regexp">/elasticsearch/</span>bin<span class="regexp">/elasticsearch-setup-passwords interactive</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后会依次提示设置这三个用户的密码并确认，一共需要输入六次密码，完成之后就成功设置好了密码了。 修改完成之后重启 Elasticsearch 和 Kibana 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">kibana</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时再访问 Kibana 就会跳转到登录页面了：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-18-28.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-18-28.jpg" alt=""></p>
                  <p>可以使用 elastic 用户登录，它的角色是超级管理员，登录之后就可以重新进入 Kibana 的管理页面。 我们还可以自行修改和添加账户，在 Management -&gt; Security -&gt; User/Roles 里面：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-20-05.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-20-05.jpg" alt=""></p>
                  <p>例如这里添加一个超级管理员的账户：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-03-17-21-44.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-03-17-21-44.jpg" alt=""></p>
                  <p>这样以后我们就可以使用新添加的用户来登录和访问了。 另外修改权限认证之后，Elasticsearch 也不能直接访问了，我们也必须输入用户密码才可以访问和调用其 API，保证了安全性。</p>
                  <h3 id="开启内存锁定"><a href="#开启内存锁定" class="headerlink" title="开启内存锁定"></a>开启内存锁定</h3>
                  <p>系统默认会进行内存交换，这样会导致 Elasticsearch 的性能变差，我们查看下内存锁定状态，在任意一台主机上的访问 <a href="http://ip:port/_nodes?filter_path=**.mlockall：">http://ip:port/_nodes?filter_path=**.mlockall：</a> 可以看到如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"nodes"</span>: &#123;</span><br><span class="line">        <span class="attr">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"9tRr4nFDT_2rErLLQB2dIQ"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"hskSDv_JQlCUnjp_INI8Kg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"LgaRuqXBTZaBdDGAktFWJA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"ZcsZgowERzuvpqVbYOgOEA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"_mSmfhUtQiqhzTKZ7u75Dw"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这代表内存交换没有开启，会影响 Elasticsearch 的性能，所以我们需要开启内存物理地址锁定，每台主机需要修改 /etc/elasticsearch/elasticsearch.yml 文件，修改如下配置：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bootstrap.<span class="string">memory_lock:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样修改之后重新启动是会报错的，Elasticsearch 无法正常启动，查看日志，报错如下：</p>
                  <figure class="highlight inform7">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">[1]</span> bootstrap checks failed</span><br><span class="line"><span class="comment">[1]</span>: memory locking requested for elasticsearch process but memory <span class="keyword">is</span> not <span class="keyword">locked</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要修改两个地方，第一个是 /etc/security/limits.conf，添加如下内容：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="bullet">* </span>soft nofile 65536</span><br><span class="line"><span class="bullet">* </span>hard nofile 65536</span><br><span class="line"><span class="bullet">* </span>soft nproc 32000</span><br><span class="line"><span class="bullet">* </span>hard nproc 32000</span><br><span class="line"><span class="bullet">* </span>hard memlock unlimited</span><br><span class="line"><span class="bullet">* </span>soft memlock unlimited</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还需要修改 /etc/systemd/system.conf，修改如下内容：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">DefaultLimitNOFILE</span>=<span class="number">65536</span></span><br><span class="line"><span class="attr">DefaultLimitNPROC</span>=<span class="number">32000</span></span><br><span class="line"><span class="attr">DefaultLimitMEMLOCK</span>=infinity</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>详细的解释可以参考：<a href="https://segmentfault.com/a/1190000014891856" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014891856</a>。 修改之后重启 Elasticsearch 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>重新访问刚才的地址，即可发现每台主机的物理地址锁定都被打开了：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"nodes"</span>: &#123;</span><br><span class="line">        <span class="attr">"73BQvOC2TpSXcr-IXBcDdg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"9tRr4nFDT_2rErLLQB2dIQ"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"hskSDv_JQlCUnjp_INI8Kg"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"LgaRuqXBTZaBdDGAktFWJA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"ZcsZgowERzuvpqVbYOgOEA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"I2M80AP-T7yVP_AZPA0bpA"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"_mSmfhUtQiqhzTKZ7u75Dw"</span>: &#123;</span><br><span class="line">            <span class="attr">"process"</span>: &#123;</span><br><span class="line">                <span class="attr">"mlockall"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就又解决了性能的问题。</p>
                  <h3 id="安装分词插件"><a href="#安装分词插件" class="headerlink" title="安装分词插件"></a>安装分词插件</h3>
                  <p>另外还推荐安装中文分词插件，这样可以对中文进行全文索引，安装命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="regexp">/usr/</span>share<span class="regexp">/elasticsearch/</span>bin<span class="regexp">/elasticsearch-plugin install https:/</span><span class="regexp">/github.com/m</span>edcl<span class="regexp">/elasticsearch-analysis-ik/</span>releases<span class="regexp">/download/</span>v6.<span class="number">3.2</span><span class="regexp">/elasticsearch-analysis-ik-6.3.2.zip</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完之后需要重启 Elasticsearch 服务：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">elasticsearch</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="主机监控"><a href="#主机监控" class="headerlink" title="主机监控"></a>主机监控</h3>
                  <p>到此为止，我们的 Elasticsearch 集群就搭建完成了。 最后我们看下 Kibana 的部分功能，看下整个 Elasticsearch 有没有在正常工作。 访问 Kibana，打开 Management -&gt; Elasticsearch -&gt;Index Management，即可看到当前有的一些索引和状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-29-07.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-29-07.jpg" alt=""></p>
                  <p>打开 Monitoring，可以查看 Elasticsearch 和 Kibana 的状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-27-33.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-27-33.jpg" alt=""></p>
                  <p>进一步点击 Nodes，可以查看各个节点的状态：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-28-01.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-28-01.jpg" alt=""></p>
                  <p>打开任意节点，可以查看当前资源状况变化：</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/2018-08-05-02-28-30.jpg" alt=""><img src="https://mp.weixin.qq.com/cgi-bin/assets/2018-08-05-02-28-30.jpg" alt=""></p>
                  <p>另外还有一些其他的功能如可视化、图表、搜索等等，这里就不再一一列举了，更多功能可以详细了解 Kibana。 以上都是自己在安装过程中趟过的坑，如有疏漏，还望指正。 还有更多的 Elasticsearch 相关的内容可以参考官方文档：<a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/index.html</a>。</p>
                  <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
                  <ul>
                    <li><a href="https://www.elastic.co/guide/en/x-pack/current/security-getting-started.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/x-pack/current/security-getting-started.html</a></li>
                    <li><a href="https://segmentfault.com/a/1190000014891856" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014891856</a></li>
                    <li><a href="https://blog.csdn.net/a19860903/article/details/72467996" target="_blank" rel="noopener">https://blog.csdn.net/a19860903/article/details/72467996</a></li>
                    <li><a href="https://logz.io/blog/elasticsearch-cluster-tutorial/" target="_blank" rel="noopener">https://logz.io/blog/elasticsearch-cluster-tutorial/</a></li>
                    <li><a href="https://es.xiaoleilu.com/020_Distributed_Cluster/30_Scale_more.html" target="_blank" rel="noopener">https://es.xiaoleilu.com/020_Distributed_Cluster/30_Scale_more.html</a></li>
                    <li><a href="https://blog.csdn.net/archer119/article/details/76589189" target="_blank" rel="noopener">https://blog.csdn.net/archer119/article/details/76589189</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-05 02:57:01" itemprop="dateCreated datePublished" datetime="2018-08-05T02:57:01+08:00">2018-08-05</time>
                </span>
                <span id="/6255.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu 搭建 Elasticsearch 6 集群流程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>11k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6217.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6217.html" class="post-title-link" itemprop="url">快来学习怎么可视化监控你的爬虫</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。"><a href="#大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。" class="headerlink" title="大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。"></a>大家好，我是四毛，下面是我的个人公众号，欢迎关注。有问题的可以私信我，看到就会回复。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""> </p>
                  <h2 id="更新-2018年08月03日14-39-32"><a href="#更新-2018年08月03日14-39-32" class="headerlink" title="更新 2018年08月03日14:39:32"></a>更新 2018年08月03日14:39:32</h2>
                  <blockquote>
                    <p>其实可以利用scrapy的扩展展示更多的数据，立个flag，后面更新上来</p>
                  </blockquote>
                  <p> 好，开始今天的文章。 今天主要是来说一下怎么可视化来<strong>监控你的爬虫的状态</strong>。 相信大家在跑爬虫的过程中，也会好奇自己养的爬虫一分钟可以<strong>爬多少页面</strong>，<strong>多大的数据量</strong>，当然查询的方式多种多样。今天我来讲一种可视化的方法。</p>
                  <h3 id="关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后，-回复“可视化”即可获取脚本地址。"><a href="#关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后，-回复“可视化”即可获取脚本地址。" class="headerlink" title="关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后， 回复“可视化”即可获取脚本地址。"></a><strong>关于爬虫数据在mongodb里的版本我写了一个可以热更新配置的版本，即添加了新的爬虫配置以后，不用重启程序，即可获取刚刚添加的爬虫的状态数据，大家可以通过关注我的公众号以后， 回复“可视化”即可获取脚本地址</strong>。</h3>
                  <h2 id="1-成品图"><a href="#1-成品图" class="headerlink" title="1.成品图"></a>1.成品图</h2>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_164.png" alt=""> 这个是监控服务器网速的最后成果，显示的是下载与上传的网速，单位为M。爬虫的原理都是一样的，只不过将数据存到InfluxDB的方式不一样而已， 如下图。</p>
                  <h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_172.png" alt=""></h3>
                  <p>可以实现对爬虫数量，增量，大小，大小增量的实时监控。 </p>
                  <h2 id="2-环境"><a href="#2-环境" class="headerlink" title="2. 环境"></a>2. 环境</h2>
                  <ul>
                    <li><strong>InfluxDb</strong>，是目前比较流行的时间序列数据库；</li>
                    <li><strong>Grafana</strong>，一个可视化面板（Dashboard），有着非常漂亮的图表和布局展示，功能齐全的度量仪表盘和图形编辑器，支持Graphite、zabbix、InfluxDB、Prometheus和OpenTSDB作为数据源</li>
                    <li><strong>Ubuntu</strong></li>
                    <li>
                      <p><strong>influxdb</strong>（pip install influxdb)</p>
                    </li>
                    <li>
                      <p><strong>Python 2.7</strong></p>
                    </li>
                  </ul>
                  <h2 id="3-原理"><a href="#3-原理" class="headerlink" title="3. 原理"></a>3. 原理</h2>
                  <blockquote>
                    <p>获取要展示的数据，包含当前的时间数据，存到InfluxDb里面，然后再到Grafana里面进行相应的配置即可展示；</p>
                  </blockquote>
                  <h2 id="4-安装"><a href="#4-安装" class="headerlink" title="4. 安装"></a>4. 安装</h2>
                  <h3 id="4-1-Grafana安装"><a href="#4-1-Grafana安装" class="headerlink" title="4.1 Grafana安装"></a>4.1 Grafana安装</h3>
                  <p> <a href="http://docs.grafana.org/installation/debian/" target="_blank" rel="noopener">官方安装指导</a> 安装好以后，打开本地的3000端口，即可进入管理界面，用户名与密码都是<strong>admin</strong>。</p>
                  <h3 id="4-2-InfulxDb安装"><a href="#4-2-InfulxDb安装" class="headerlink" title="4.2 InfulxDb安装"></a>4.2 InfulxDb安装</h3>
                  <p>这个安装就网上自己找吧，有很多的配置我都没有配置，就不在这里误人子弟了。</p>
                  <h2 id="5-InfluxDb简单操作"><a href="#5-InfluxDb简单操作" class="headerlink" title="5. InfluxDb简单操作"></a>5. InfluxDb简单操作</h2>
                  <p>碰到了数据库，肯定要把增删改查学会了啊， 和sql几乎一样，只有一丝丝的区别，具体操作，大家可以参考官方的文档。</p>
                  <ul>
                    <li><strong>influx</strong> 进入命令行</li>
                    <li><strong>CREATE DATABASE test</strong> 创建数据库</li>
                    <li><strong>show databases</strong> 查看数据库</li>
                    <li><strong>use test</strong> 使用数据库</li>
                    <li><strong>show series</strong> 看表</li>
                    <li><strong>select * from table_test</strong> 选择数据</li>
                    <li><strong>DROP MEASUREMENT table_test</strong> 删表</li>
                  </ul>
                  <h2 id="6-存数据"><a href="#6-存数据" class="headerlink" title="6. 存数据"></a>6. 存数据</h2>
                  <p>InfluxDb数据库的数据有一定的格式，因为我都是利用python库进行相关操作，所以下面将在python中的格式展示一下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">json_body</span> = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"measurement"</span>: <span class="string">"crawler"</span>,</span><br><span class="line">        <span class="string">"time"</span>: current_time,</span><br><span class="line">        <span class="string">"tags"</span>: &#123;</span><br><span class="line">            <span class="string">"spider_name"</span>: collection_name</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"fields"</span>: &#123;</span><br><span class="line">            <span class="string">"count"</span>: current_count,</span><br><span class="line">            <span class="string">"increase_count"</span>: increase_amount,</span><br><span class="line">            <span class="string">"size"</span>: co_size,</span><br><span class="line">            <span class="string">"increase_size"</span>: increase_co_size</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中:</p>
                  <ul>
                    <li>measurement, 表名</li>
                    <li>time，时间</li>
                    <li>tags，标签</li>
                    <li>fields，字段</li>
                  </ul>
                  <p>可以看到，就是个列表里面，嵌套了一个字典。其中，对于时间字段，有特殊要求，可以参考<a href="https://stackoverflow.com/questions/32090883/how-to-use-time-field-in-adding-metrics-data-to-the-influx-db" target="_blank" rel="noopener">这里</a>， 下面是python实现方法：</p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from datetime import datetime</span><br><span class="line">current_time = datetime.utcnow().strftime('<span class="built_in">%Y</span>-<span class="built_in">%m</span>-<span class="built_in">%dT</span><span class="built_in">%H</span>:<span class="built_in">%M</span>:<span class="built_in">%SZ</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以，到这里，如何将爬虫的相关属性存进去呢？以MongoDB为例</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">mongodb_client</span> = pymongo.MongoClient(uri)</span><br><span class="line">    for db_name, collection_name <span class="keyword">in</span> dbs_and_cos.iteritems():</span><br><span class="line">        <span class="comment"># 数据库操作</span></span><br><span class="line">        <span class="attr">db</span> = mongodb_client[db_name]</span><br><span class="line">        <span class="attr">co</span> = db[collection_name]</span><br><span class="line">        <span class="comment"># 集合大小</span></span><br><span class="line">        <span class="attr">co_size</span> = round(float(db.command(<span class="string">"collstats"</span>, collection_name).get('size')) / <span class="number">1024</span> / <span class="number">1024</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 集合内数据条数</span></span><br><span class="line">        <span class="attr">current_count</span> = co.count()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化，当程序刚执行时，初始量就设置为第一次执行时获取的数据</span></span><br><span class="line">        <span class="attr">init_count</span> = _count_dict.get(collection_name, current_count)</span><br><span class="line">        <span class="comment"># 初始化，当程序刚执行时，初始量就设置为第一次执行时获取的数据大小</span></span><br><span class="line">        <span class="attr">init_size</span> = _size_dict.get(collection_name, co_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 条数增长量</span></span><br><span class="line">        <span class="attr">increase_amount</span> = current_count - init_count</span><br><span class="line">        <span class="comment"># 集合大小增长量</span></span><br><span class="line">        <span class="attr">increase_co_size</span> = co_size - init_size</span><br><span class="line"></span><br><span class="line">        <span class="attr">current_time</span> = datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%SZ')</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 赋值</span></span><br><span class="line">        _size_dict[collection_name] = co_size</span><br><span class="line">        _count_dict[collection_name] = current_count</span><br><span class="line"></span><br><span class="line">        <span class="attr">json_body</span> = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"measurement"</span>: <span class="string">"crawler"</span>,</span><br><span class="line">                <span class="string">"time"</span>: current_time,</span><br><span class="line">                <span class="string">"tags"</span>: &#123;</span><br><span class="line">                    <span class="string">"spider_name"</span>: collection_name</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"fields"</span>: &#123;</span><br><span class="line">                    <span class="string">"count"</span>: current_count,</span><br><span class="line">                    <span class="string">"increase_count"</span>: increase_amount,</span><br><span class="line">                    <span class="string">"size"</span>: co_size,</span><br><span class="line">                    <span class="string">"increase_size"</span>: increase_co_size</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        print json_body</span><br><span class="line">        client.write_points(json_body)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>完整代码，关注上面的公众号，发送“”可视化“”即可获取。 那么现在我们已经往数据里存了数据了，那么接下来要做的就是把存的数据展示出来。</p>
                  <h2 id="7-展示数据"><a href="#7-展示数据" class="headerlink" title="7.展示数据"></a>7.展示数据</h2>
                  <h3 id="7-1-配置数据源"><a href="#7-1-配置数据源" class="headerlink" title="7.1 配置数据源"></a>7.1 配置数据源</h3>
                  <p>以admin登录到Grafana的后台后，我们首先需要配置一下数据源。点击左边栏的最下面的按钮，然后点击DATA SOURCES，这样就可以进入下面的页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_167.png" alt=""> 点击ADD DATA SOURCE，进行配置即可，如下图： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_168.png" alt=""> 其中，name自行设定；Type 选择InfluxDB；url为默认的<a href="http://localhost:8086，">http://localhost:8086，</a> 其他的因为我前面没有进行配置，所以默认的即可。然后在InfluxDB Details里的填入Database名，最后点击测试，如果没有报错的话，则可以进入下一步的展示数据了；</p>
                  <h3 id="7-2-展示数据"><a href="#7-2-展示数据" class="headerlink" title="7.2 展示数据"></a>7.2 展示数据</h3>
                  <p>点击左边栏的+号，然后点击GRAPH <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_166.png" alt=""> 接着点击下图中的edit进入编辑页面： <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_169.png" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/08/Selection_170.png" alt=""> 从上图中可以发现：</p>
                  <ul>
                    <li>中间板块是最后的数据展示</li>
                    <li>下面是数据的设置项</li>
                    <li>右上角是展示时间的设置板块，在这里可以选择要展示多久的数据</li>
                  </ul>
                  <h4 id="7-2-1-配置数据"><a href="#7-2-1-配置数据" class="headerlink" title="7.2.1 配置数据"></a>7.2.1 配置数据</h4>
                  <ol>
                    <li>在Data Source中选择刚刚在配置数据源的时候配置的NAME字段，而不是database名。</li>
                    <li>接着在下面选择要展示的数据。看着就很熟悉是不是，完全是sql语句的可视化。同时，当我们的数据放到相关的字段上的时候，双击，就会把可以选择的项展示出来了，我们要做的就是直接选择即可；</li>
                    <li>设置右上角的时间，则可以让数据实时进行更新与展示</li>
                  </ol>
                  <p>因为下面的配置实质就是sql查询语句，所以大家按照自己的需求，进行选择配置即可，当配置完以后，就可以在中间的面板里面看到数据了。 </p>
                  <h2 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h2>
                  <p>到这里，本篇文章就结束了。其中，对于Grafana的操作我没有介绍的很详细，因为本篇主要讲的是怎么利用这几个工具完成我们的任务。 同时，里面的功能确实很多，还有可以安装的插件。我自己目前还是仅仅对于用到的部分比较了解，所以大家可以查询官方的或者别的教程资料来对Grafana进行更深入的了解，制作出更加好看的可视化作品来。 最后，关注公众号，回复“可视化” 即可获取本文代码哦</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-02 19:24:36" itemprop="dateCreated datePublished" datetime="2018-08-02T19:24:36+08:00">2018-08-02</time>
                </span>
                <span id="/6217.html" class="post-meta-item leancloud_visitors" data-flag-title="快来学习怎么可视化监控你的爬虫" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6214.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6214.html" class="post-title-link" itemprop="url">Elasticsearch 基本介绍及其与 Python 的对接实现</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="什么是-Elasticsearch"><a href="#什么是-Elasticsearch" class="headerlink" title="什么是 Elasticsearch"></a>什么是 Elasticsearch</h2>
                  <p>想查数据就免不了搜索，搜索就离不开搜索引擎，百度、谷歌都是一个非常庞大复杂的搜索引擎，他们几乎索引了互联网上开放的所有网页和数据。然而对于我们自己的业务数据来说，肯定就没必要用这么复杂的技术了，如果我们想实现自己的搜索引擎，方便存储和检索，Elasticsearch 就是不二选择，它是一个全文搜索引擎，可以快速地储存、搜索和分析海量数据。</p>
                  <h2 id="为什么要用-Elasticsearch"><a href="#为什么要用-Elasticsearch" class="headerlink" title="为什么要用 Elasticsearch"></a>为什么要用 Elasticsearch</h2>
                  <p>Elasticsearch 是一个开源的搜索引擎，建立在一个全文搜索引擎库 Apache Lucene™ 基础之上。 那 Lucene 又是什么？Lucene 可能是目前存在的，不论开源还是私有的，拥有最先进，高性能和全功能搜索引擎功能的库，但也仅仅只是一个库。要用上 Lucene，我们需要编写 Java 并引用 Lucene 包才可以，而且我们需要对信息检索有一定程度的理解才能明白 Lucene 是怎么工作的，反正用起来没那么简单。 那么为了解决这个问题，Elasticsearch 就诞生了。Elasticsearch 也是使用 Java 编写的，它的内部使用 Lucene 做索引与搜索，但是它的目标是使全文检索变得简单，相当于 Lucene 的一层封装，它提供了一套简单一致的 RESTful API 来帮助我们实现存储和检索。 所以 Elasticsearch 仅仅就是一个简易版的 Lucene 封装吗？那就大错特错了，Elasticsearch 不仅仅是 Lucene，并且也不仅仅只是一个全文搜索引擎。 它可以被下面这样准确的形容：</p>
                  <ul>
                    <li>一个分布式的实时文档存储，每个字段可以被索引与搜索</li>
                    <li>一个分布式实时分析搜索引擎</li>
                    <li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
                  </ul>
                  <p>总之，是一个相当牛逼的搜索引擎，维基百科、Stack Overflow、GitHub 都纷纷采用它来做搜索。</p>
                  <h2 id="Elasticsearch-的安装"><a href="#Elasticsearch-的安装" class="headerlink" title="Elasticsearch 的安装"></a>Elasticsearch 的安装</h2>
                  <p>我们可以到 Elasticsearch 的官方网站下载 Elasticsearch：<a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/downloads/elasticsearch</a>，同时官网也附有安装说明。 首先把安装包下载下来并解压，然后运行 bin/elasticsearch（Mac 或 Linux）或者 bin\elasticsearch.bat (Windows) 即可启动 Elasticsearch 了。 我使用的是 Mac，Mac 下个人推荐使用 Homebrew 安装：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Elasticsearch 默认会在 9200 端口上运行，我们打开浏览器访问 <a href="http://localhost:9200/" target="_blank" rel="noopener">http://localhost:9200/</a> 就可以看到类似内容：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span> : <span class="string">"atntrTf"</span>,</span><br><span class="line">  <span class="attr">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</span><br><span class="line">  <span class="attr">"cluster_uuid"</span> : <span class="string">"e64hkjGtTp6_G2h1Xxdv5g"</span>,</span><br><span class="line">  <span class="attr">"version"</span> : &#123;</span><br><span class="line">    <span class="attr">"number"</span>: <span class="string">"6.2.4"</span>,</span><br><span class="line">    <span class="attr">"build_hash"</span>: <span class="string">"ccec39f"</span>,</span><br><span class="line">    <span class="attr">"build_date"</span>: <span class="string">"2018-04-12T20:37:28.497551Z"</span>,</span><br><span class="line">    <span class="attr">"build_snapshot"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"lucene_version"</span>: <span class="string">"7.2.1"</span>,</span><br><span class="line">    <span class="attr">"minimum_wire_compatibility_version"</span>: <span class="string">"5.6.0"</span>,</span><br><span class="line">    <span class="attr">"minimum_index_compatibility_version"</span>: <span class="string">"5.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果看到这个内容，就说明 Elasticsearch 安装并启动成功了，这里显示我的 Elasticsearch 版本是 6.2.4 版本，版本很重要，以后安装一些插件都要做到版本对应才可以。 接下来我们来了解一下 Elasticsearch 的基本概念以及和 Python 的对接。</p>
                  <h2 id="Elasticsearch-相关概念"><a href="#Elasticsearch-相关概念" class="headerlink" title="Elasticsearch 相关概念"></a>Elasticsearch 相关概念</h2>
                  <p>在 Elasticsearch 中有几个基本的概念，如节点、索引、文档等等，下面来分别说明一下，理解了这些概念对熟悉 Elasticsearch 是非常有帮助的。</p>
                  <h3 id="Node-和-Cluster"><a href="#Node-和-Cluster" class="headerlink" title="Node 和 Cluster"></a>Node 和 Cluster</h3>
                  <p>Elasticsearch 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elasticsearch 实例。 单个 Elasticsearch 实例称为一个节点（Node）。一组节点构成一个集群（Cluster）。</p>
                  <h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3>
                  <p>Elasticsearch 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。 所以，Elasticsearch 数据管理的顶层单位就叫做 Index（索引），其实就相当于 MySQL、MongoDB 等里面的数据库的概念。另外值得注意的是，每个 Index （即数据库）的名字必须是小写。</p>
                  <h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3>
                  <p>Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。 Document 使用 JSON 格式表示，下面是一个例子。 同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。</p>
                  <h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3>
                  <p>Document 可以分组，比如 weather 这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document，类似 MySQL 中的数据表，MongoDB 中的 Collection。 不同的 Type 应该有相似的结构（Schema），举例来说，id 字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的一个区别。性质完全不同的数据（比如 products 和 logs）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。 根据规划，Elastic 6.x 版只允许每个 Index 包含一个 Type，7.x 版将会彻底移除 Type。</p>
                  <h3 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h3>
                  <p>即字段，每个 Document 都类似一个 JSON 结构，它包含了许多字段，每个字段都有其对应的值，多个字段组成了一个 Document，其实就可以类比 MySQL 数据表中的字段。 在 Elasticsearch 中，文档归属于一种类型（Type），而这些类型存在于索引（Index）中，我们可以画一些简单的对比图来类比传统关系型数据库：</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">R<span class="function"><span class="title">elational</span> DB -&gt;</span> D<span class="function"><span class="title">atabases</span> -&gt;</span> T<span class="function"><span class="title">ables</span> -&gt;</span> R<span class="function"><span class="title">ows</span> -&gt;</span> Columns</span><br><span class="line">E<span class="function"><span class="title">lasticsearch</span> -&gt;</span> I<span class="function"><span class="title">ndices</span>   -&gt;</span> T<span class="function"><span class="title">ypes</span>  -&gt;</span> D<span class="function"><span class="title">ocuments</span> -&gt;</span> Fields</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上就是 Elasticsearch 里面的一些基本概念，通过和关系性数据库的对比更加有助于理解。</p>
                  <h2 id="Python-对接-Elasticsearch"><a href="#Python-对接-Elasticsearch" class="headerlink" title="Python 对接 Elasticsearch"></a>Python 对接 Elasticsearch</h2>
                  <p>Elasticsearch 实际上提供了一系列 Restful API 来进行存取和查询操作，我们可以使用 curl 等命令来进行操作，但毕竟命令行模式没那么方便，所以这里我们就直接介绍利用 Python 来对接 Elasticsearch 的相关方法。 Python 中对接 Elasticsearch 使用的就是一个同名的库，安装方式非常简单：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> elasticsearch</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>官方文档是：<a href="https://elasticsearch-py.readthedocs.io/" target="_blank" rel="noopener">https://elasticsearch-py.readthedocs.io/</a>，所有的用法都可以在里面查到，文章后面的内容也是基于官方文档来的。</p>
                  <h3 id="创建-Index"><a href="#创建-Index" class="headerlink" title="创建 Index"></a>创建 Index</h3>
                  <p>我们先来看下怎样创建一个索引（Index），这里我们创建一个名为 news 的索引：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果创建成功，会返回如下结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'acknowledged</span>': <span class="literal">True</span>, <span class="symbol">'shards_acknowledged</span>': <span class="literal">True</span>, <span class="symbol">'index</span>': <span class="symbol">'news</span>'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果是 JSON 格式，其中的 acknowledged 字段表示创建操作执行成功。 但这时如果我们再把代码执行一次的话，就会返回如下结果：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'error'</span>: &#123;<span class="symbol">'root_cause'</span>: [&#123;<span class="symbol">'type'</span>: <span class="symbol">'resource_already_exists_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'index</span> [news/<span class="type">QM6yz2W8QE</span>-bflKhc5oThw] already exists', <span class="symbol">'index_uuid'</span>: <span class="symbol">'QM6yz2W8QE</span>-bflKhc5oThw', <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;], <span class="symbol">'type'</span>: <span class="symbol">'resource_already_exists_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'index</span> [news/<span class="type">QM6yz2W8QE</span>-bflKhc5oThw] already exists', <span class="symbol">'index_uuid'</span>: <span class="symbol">'QM6yz2W8QE</span>-bflKhc5oThw', <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;, <span class="symbol">'status'</span>: <span class="number">400</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它提示创建失败，status 状态码是 400，错误原因是 Index 已经存在了。 注意这里我们的代码里面使用了 ignore 参数为 400，这说明如果返回结果是 400 的话，就忽略这个错误不会报错，程序不会执行抛出异常。 假如我们不加 ignore 这个参数的话：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">es</span> = <span class="function"><span class="title">Elasticsearch</span>()</span></span><br><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">es.indices.create</span>(<span class="variable">index</span>=<span class="string">'news'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再次执行就会报错了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">raise <span class="module-access"><span class="module"><span class="identifier">HTTP_EXCEPTIONS</span>.</span></span>get(status_code, TransportError)(status_code, error_message, additional_info)</span><br><span class="line">elasticsearch.exceptions.RequestError: <span class="constructor">TransportError(400, '<span class="params">resource_already_exists_exception</span>', '<span class="params">index</span> [<span class="params">news</span><span class="operator">/</span>QM6yz2W8QE-<span class="params">bflKhc5oThw</span>] <span class="params">already</span> <span class="params">exists</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样程序的执行就会出现问题，所以说，我们需要善用 ignore 参数，把一些意外情况排除，这样可以保证程序的正常执行而不会中断。</p>
                  <h3 id="删除-Index"><a href="#删除-Index" class="headerlink" title="删除 Index"></a>删除 Index</h3>
                  <p>删除 Index 也是类似的，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.indices.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, ignore=[400, 404])</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里也是使用了 ignore 参数，来忽略 Index 不存在而删除失败导致程序中断的问题。 如果删除成功，会输出如下结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'acknowledged</span>': <span class="literal">True</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果 Index 已经被删除，再执行删除则会输出如下结果：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="symbol">'error'</span>: &#123;<span class="symbol">'root_cause'</span>: [&#123;<span class="symbol">'type'</span>: <span class="symbol">'index_not_found_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'no</span> such index', <span class="symbol">'resource</span>.type': <span class="symbol">'index_or_alias'</span>, <span class="symbol">'resource</span>.id': <span class="symbol">'news'</span>, <span class="symbol">'index_uuid'</span>: <span class="symbol">'_na_'</span>, <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;], <span class="symbol">'type'</span>: <span class="symbol">'index_not_found_exception'</span>, <span class="symbol">'reason'</span>: <span class="symbol">'no</span> such index', <span class="symbol">'resource</span>.type': <span class="symbol">'index_or_alias'</span>, <span class="symbol">'resource</span>.id': <span class="symbol">'news'</span>, <span class="symbol">'index_uuid'</span>: <span class="symbol">'_na_'</span>, <span class="symbol">'index'</span>: <span class="symbol">'news'</span>&#125;, <span class="symbol">'status'</span>: <span class="number">404</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个结果表明当前 Index 不存在，删除失败，返回的结果同样是 JSON，状态码是 400，但是由于我们添加了 ignore 参数，忽略了 400 状态码，因此程序正常执行输出 JSON 结果，而不是抛出异常。</p>
                  <h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3>
                  <p>Elasticsearch 就像 MongoDB 一样，在插入数据的时候可以直接插入结构化字典数据，插入数据可以调用 create() 方法，例如这里我们插入一条新闻数据：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>, <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>&#125;</span><br><span class="line">result = es.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">id</span>=1, <span class="attribute">body</span>=data)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先声明了一条新闻数据，包括标题和链接，然后通过调用 create() 方法插入了这条数据，在调用 create() 方法时，我们传入了四个参数，index 参数代表了索引名称，doc_type 代表了文档类型，body 则代表了文档具体内容，id 则是数据的唯一标识 ID。 运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">1</span>, 'result': 'created', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">0</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果中 result 字段为 created，代表该数据插入成功。 另外其实我们也可以使用 index() 方法来插入数据，但与 create() 不同的是，create() 方法需要我们指定 id 字段来唯一标识该条数据，而 index() 方法则不需要，如果不指定 id，会自动生成一个 id，调用 index() 方法的写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">es.index(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>create() 方法内部其实也是调用了 index() 方法，是对 index() 方法的封装。</p>
                  <h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3>
                  <p>更新数据也非常简单，我们同样需要指定数据的 id 和内容，调用 update() 方法即可，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>,</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>,</span><br><span class="line">    <span class="string">'date'</span>: <span class="string">'2011-12-16'</span></span><br><span class="line">&#125;</span><br><span class="line">result = es.update(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data, <span class="attribute">id</span>=1)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们为数据增加了一个日期字段，然后调用了 update() 方法，结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">2</span>, 'result': 'updated', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">1</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到返回结果中，result 字段为 updated，即表示更新成功，另外我们还注意到有一个字段 _version，这代表更新后的版本号数，2 代表这是第二个版本，因为之前已经插入过一次数据，所以第一次插入的数据是版本 1，可以参见上例的运行结果，这次更新之后版本号就变成了 2，以后每更新一次，版本号都会加 1。 另外更新操作其实利用 index() 方法同样可以做到，写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">es.index(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=data, <span class="attribute">id</span>=1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，index() 方法可以代替我们完成两个操作，如果数据不存在，那就执行插入操作，如果已经存在，那就执行更新操作，非常方便。</p>
                  <h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3>
                  <p>如果想删除一条数据可以调用 delete() 方法，指定需要删除的数据 id 即可，写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">id</span>=1)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': <span class="number">3</span>, 'result': 'deleted', '_shards': &#123;'total': <span class="number">2</span>, 'successful': <span class="number">1</span>, 'failed': <span class="number">0</span>&#125;, '_seq_no': <span class="number">2</span>, '_primary_term': <span class="number">1</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到运行结果中 result 字段为 deleted，代表删除成功，_version 变成了 3，又增加了 1。</p>
                  <h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3>
                  <p>上面的几个操作都是非常简单的操作，普通的数据库如 MongoDB 都是可以完成的，看起来并没有什么了不起的，Elasticsearch 更特殊的地方在于其异常强大的检索功能。 对于中文来说，我们需要安装一个分词插件，这里使用的是 elasticsearch-analysis-ik，GitHub 链接为：<a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a>，这里我们使用 Elasticsearch 的另一个命令行工具 elasticsearch-plugin 来安装，这里安装的版本是 6.2.4，请确保和 Elasticsearch 的版本对应起来，命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">elasticsearch-plugin install https:<span class="regexp">//gi</span>thub.com<span class="regexp">/medcl/</span>elasticsearch-analysis-ik<span class="regexp">/releases/</span>download<span class="regexp">/v6.2.4/</span>elasticsearch-analysis-ik-<span class="number">6.2</span>.<span class="number">4</span>.zip</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的版本号请替换成你的 Elasticsearch 的版本号。 安装之后重新启动 Elasticsearch 就可以了，它会自动加载安装好的插件。 首先我们新建一个索引并指定需要分词的字段，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> elasticsearch import Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">mapping = &#123;</span><br><span class="line">    <span class="string">'properties'</span>: &#123;</span><br><span class="line">        <span class="string">'title'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'text'</span>,</span><br><span class="line">            <span class="string">'analyzer'</span>: <span class="string">'ik_max_word'</span>,</span><br><span class="line">            <span class="string">'search_analyzer'</span>: <span class="string">'ik_max_word'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">es.indices.delete(<span class="attribute">index</span>=<span class="string">'news'</span>, ignore=[400, 404])</span><br><span class="line">es.indices.create(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">ignore</span>=400)</span><br><span class="line">result = es.indices.put_mapping(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=mapping)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先将之前的索引删除了，然后新建了一个索引，然后更新了它的 mapping 信息，mapping 信息中指定了分词的字段，指定了字段的类型 type 为 text，分词器 analyzer 和 搜索分词器 search_analyzer 为 ik_max_word，即使用我们刚才安装的中文分词插件。如果不指定的话则使用默认的英文分词器。 接下来我们插入几条新的数据：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">datas = [</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '美国留给伊拉克的是个烂摊子吗',</span><br><span class="line">        'url': 'http://view.news.qq.com/zt<span class="number">2011</span>/usa_iraq/index.htm',</span><br><span class="line">        'date': '<span class="number">2011-12-16</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '公安部：各地校车将享最高路权',</span><br><span class="line">        'url': 'http://www.chinanews.com/gn/<span class="number">2011/12-16/353607</span>7.shtml',</span><br><span class="line">        'date': '<span class="number">2011-12-16</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '中韩渔警冲突调查：韩警平均每天扣1艘中国渔船',</span><br><span class="line">        'url': 'https://news.qq.com/a/<span class="number">20111216/001044</span>.htm',</span><br><span class="line">        'date': '<span class="number">2011-12-17</span>'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        'title': '中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首',</span><br><span class="line">        'url': 'http://news.ifeng.com/world/detail_<span class="number">2011</span>_12/16/<span class="number">11372558</span>_0.shtml',</span><br><span class="line">        'date': '<span class="number">2011-12-18</span>'</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">for data in datas:</span><br><span class="line">    es.index(index='news', doc_type='politics', body=data)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们指定了四条数据，都带有 title、url、date 字段，然后通过 index() 方法将其插入 Elasticsearch 中，索引名称为 news，类型为 politics。 接下来我们根据关键词查询一下相关内容：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = es.search(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到查询出了所有插入的四条数据：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"c05G9mQBD9BuE5fdHOUT"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"美国留给伊拉克的是个烂摊子吗"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://view.news.qq.com/zt2011/usa_iraq/index.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-16"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dk5G9mQBD9BuE5fdHOUm"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击，嫌犯已自首"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-18"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dU5G9mQBD9BuE5fdHOUj"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"https://news.qq.com/a/20111216/001044.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-17"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dE5G9mQBD9BuE5fdHOUf"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"公安部：各地校车将享最高路权"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://www.chinanews.com/gn/2011/12-16/3536077.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-16"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到返回结果会出现在 hits 字段里面，然后其中有 total 字段标明了查询的结果条目数，还有 max_score 代表了最大匹配分数。 另外我们还可以进行全文检索，这才是体现 Elasticsearch 搜索引擎特性的地方：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">dsl = &#123;</span><br><span class="line">    <span class="string">'query'</span>: &#123;</span><br><span class="line">        <span class="string">'match'</span>: &#123;</span><br><span class="line">            <span class="string">'title'</span>: <span class="string">'中国 领事馆'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.search(<span class="attribute">index</span>=<span class="string">'news'</span>, <span class="attribute">doc_type</span>=<span class="string">'politics'</span>, <span class="attribute">body</span>=dsl)</span><br><span class="line"><span class="builtin-name">print</span>(json.dumps(result, <span class="attribute">indent</span>=2, <span class="attribute">ensure_ascii</span>=<span class="literal">False</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用 Elasticsearch 支持的 DSL 语句来进行查询，使用 match 指定全文检索，检索的字段是 title，内容是“中国领事馆”，搜索结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dk5G9mQBD9BuE5fdHOUm"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击，嫌犯已自首"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-18"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dU5G9mQBD9BuE5fdHOUj"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"https://news.qq.com/a/20111216/001044.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-17"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们看到匹配的结果有两条，第一条的分数为 2.54，第二条的分数为 0.28，这是因为第一条匹配的数据中含有“中国”和“领事馆”两个词，第二条匹配的数据中不包含“领事馆”，但是包含了“中国”这个词，所以也被检索出来了，但是分数比较低。 因此可以看出，检索时会对对应的字段全文检索，结果还会按照检索关键词的相关性进行排序，这就是一个基本的搜索引擎雏形。 另外 Elasticsearch 还支持非常多的查询方式，详情可以参考官方文档：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/query-dsl.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.3/query-dsl.html</a> 以上便是对 Elasticsearch 的基本介绍以及 Python 操作 Elasticsearch 的基本用法，但这仅仅是 Elasticsearch 的基本功能，它还有更多强大的功能等待着我们的探索，后面会继续更新，敬请期待。 本节代码：<a href="https://github.com/Germey/ElasticSearch" target="_blank" rel="noopener">https://github.com/Germey/ElasticSearch</a>。</p>
                  <h2 id="资料推荐"><a href="#资料推荐" class="headerlink" title="资料推荐"></a>资料推荐</h2>
                  <p>另外推荐几个不错的学习站点：</p>
                  <ul>
                    <li>Elasticsearch 权威指南：<a href="https://es.xiaoleilu.com/index.html" target="_blank" rel="noopener">https://es.xiaoleilu.com/index.html</a></li>
                    <li>全文搜索引擎 Elasticsearch 入门教程：<a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></li>
                    <li>Elastic 中文社区：<a href="https://www.elasticsearch.cn/" target="_blank" rel="noopener">https://www.elasticsearch.cn/</a></li>
                  </ul>
                  <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
                  <ul>
                    <li><a href="https://es.xiaoleilu.com/index.html" target="_blank" rel="noopener">https://es.xiaoleilu.com/index.html</a></li>
                    <li><a href="https://blog.csdn.net/y472360651/article/details/76468327" target="_blank" rel="noopener">https://blog.csdn.net/y472360651/article/details/76468327</a></li>
                    <li><a href="https://elasticsearch-py.readthedocs.io/en/master/" target="_blank" rel="noopener">https://elasticsearch-py.readthedocs.io/en/master/</a></li>
                    <li><a href="https://es.xiaoleilu.com/010_Intro/10_Installing_ES.html" target="_blank" rel="noopener">https://es.xiaoleilu.com/010_Intro/10_Installing_ES.html</a></li>
                    <li><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-08-02 01:14:22" itemprop="dateCreated datePublished" datetime="2018-08-02T01:14:22+08:00">2018-08-02</time>
                </span>
                <span id="/6214.html" class="post-meta-item leancloud_visitors" data-flag-title="Elasticsearch 基本介绍及其与 Python 的对接实现" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>11 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6182.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6182.html" class="post-title-link" itemprop="url">Python glom包初探</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，-我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。"><a href="#大家好，-我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。" class="headerlink" title="大家好， 我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。"></a>大家好， 我不是崔老师，我是四毛，下面是我的个人公众号，欢迎大家关注。</h1>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/02/201802111155445124jhQyer.yasuotu.gif" alt=""></p>
                  <h1 id="好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。"><a href="#好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。" class="headerlink" title="好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。"></a>好久没有写东西了，一直都记录在了自己的笔记上，这一篇是关于glom的一个介绍与初步使用，后期会将里面的各种API再给大家介绍下，同时，最近在搞爬虫的实时数据监控，也挺有意思，后面会和大家分享，敬请期待。</h1>
                  <p>猛然发现，英语水平巅峰就在高考那一天。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2016/12/吃惊表情1.jpg" alt=""> 因为是边看，边练习，然后翻译，所以个人理解可能有偏差，有错误的地方，请大家指正。 首先，这个库是用来处理一些嵌套的数据的，作者也在PyCon 2018上做了个分享，老美的PyCon还是有点质量的，不像国内的，搞的什么玩意。 视频地址：<a href="https://www.youtube.com/watch?v=bTAFl8P2DkE&amp;t=18m07s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=bTAFl8P2DkE&amp;t=18m07s</a> </p>
                  <h2 id="更新-2018年7月28日10-32-08"><a href="#更新-2018年7月28日10-32-08" class="headerlink" title="更新: 2018年7月28日10:32:08"></a>更新: 2018年7月28日10:32:08</h2>
                  <p>经过咨询库的作者，在最后留的那个问题的准确解法如下：</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> glom</span><br><span class="line"></span><br><span class="line">target = &#123;</span><br><span class="line">    <span class="string">'data'</span>: &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'just_test'</span>,</span><br><span class="line">        <span class="string">'likes'</span>: [&#123;<span class="string">'ball'</span>: <span class="string">'basketball'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'ball'</span>: <span class="string">'football'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'water'</span>: <span class="string">'swim'</span>&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">spec = &#123;</span><br><span class="line">    <span class="string">'name'</span> : (<span class="string">'data.name'</span>),</span><br><span class="line">    <span class="string">'likes'</span> : (<span class="string">'data'</span>, <span class="string">'likes'</span>, [glom.Coalesce(<span class="string">'ball'</span>, <span class="string">'water'</span>)])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print glom.glom(target, spec)</span><br><span class="line">####</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'just_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'swim'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>非常棒，准确来说就是得灵活运用Coalesce方法啊，不能太死板。非常Pythonic。 另附网址，作者有个很搞笑little four hair ,哈哈哈哈 <a href="https://github.com/mahmoud/glom/issues/46" target="_blank" rel="noopener">Issue地址</a> </p>
                  <h1 id="1-官方文档地址"><a href="#1-官方文档地址" class="headerlink" title="1. 官方文档地址"></a>1. 官方文档地址</h1>
                  <p><a href="https://glom.readthedocs.io/en/latest/tutorial.html" target="_blank" rel="noopener">文档地址</a></p>
                  <h1 id="2-安装方法"><a href="#2-安装方法" class="headerlink" title="2. 安装方法"></a>2. 安装方法</h1>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> glom</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h1 id="3-正式开始"><a href="#3-正式开始" class="headerlink" title="3. 正式开始"></a>3. 正式开始</h1>
                  <p>glom，官方的说法是用PYTHONIC的方式来处理内嵌的数据。对于现实世界中的数据处理更加给力，现实世界中的数据，我的理解就是AJAX越来越流行了，处理这类数据会越来越频繁。有如下特点：</p>
                  <ul>
                    <li>对于嵌套数据结构的基于路径式的访问</li>
                    <li>可读，有意义的错误消息</li>
                    <li>声明性数据转换，使用轻量级，Pythonic规范</li>
                    <li>内置数据探索和调试功能</li>
                  </ul>
                  <h2 id="3-1-原始处理嵌套数据"><a href="#3-1-原始处理嵌套数据" class="headerlink" title="3.1 原始处理嵌套数据"></a>3.1 原始处理嵌套数据</h2>
                  <p>下面的脚本包导入</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> glom <span class="keyword">import</span> glom</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面的data就是个简单的嵌套数据，一般都可以用下面几种方法进行处理</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: &#123;<span class="string">'c'</span>: <span class="string">'d'</span>&#125;&#125;&#125;</span><br><span class="line">data[<span class="string">'a'</span>][<span class="string">'b'</span>][<span class="string">'c'</span>]</span><br><span class="line">data.<span class="builtin-name">get</span>(<span class="string">'a'</span>).<span class="builtin-name">get</span>(<span class="string">'b'</span>).<span class="builtin-name">get</span>(<span class="string">'c'</span>)</span><br><span class="line">data.<span class="builtin-name">get</span>(<span class="string">'a'</span>, &#123;&#125;).<span class="builtin-name">get</span>(<span class="string">'b'</span>,&#123;&#125;).<span class="builtin-name">get</span>(<span class="string">'c'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是当我们的数据改变成下面的这样时：</p>
                  <figure class="highlight markdown">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data2 = &#123;'a': &#123;'b': None&#125;&#125;</span><br><span class="line">data2[<span class="string">'a'</span>][<span class="symbol">'b'</span>][<span class="string">'c'</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">TypeError: 'NoneType' object has no attribute '<span class="strong">__getitem__</span>'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>会报错，而且由于是嵌套数据，从错误信息里我们只知道有个None值，但是到底谁是呢，是a，是b呢，反正肯定不是我们的朋友小哪吒。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/07/4399_9165819336.jpg" alt=""></p>
                  <h2 id="3-2-glom出场"><a href="#3-2-glom出场" class="headerlink" title="3.2 glom出场"></a>3.2 glom出场</h2>
                  <p>那么glom怎么处理上面的数据呢？ 如其所言，路径式：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">data</span> = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: &#123;<span class="string">'c'</span>: <span class="string">'d'</span>&#125;&#125;&#125;</span><br><span class="line">print glom(<span class="keyword">data</span>, <span class="string">'a.b.c'</span>)  <span class="comment"># d</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看起来还是很优雅， 很Pythonic。</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data2 = &#123;<span class="string">'a'</span>: &#123;<span class="string">'b'</span>: None&#125;&#125;</span><br><span class="line"><span class="function"><span class="title">glom</span><span class="params">(data2, <span class="string">'a.b.c'</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>错误信息如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glom.core.<span class="string">PathAccessError:</span> could not access <span class="string">'c'</span>, part <span class="number">2</span> of Path(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>), got <span class="string">error:</span> AttributeError(<span class="string">"'NoneType' object has no attribute 'c'"</span>,)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很明显，这个错误就很直观。 难道仅仅只有这个？当然不是</p>
                  <h3 id="3-2-1-Going-Beyond-Access"><a href="#3-2-1-Going-Beyond-Access" class="headerlink" title="3.2.1  Going Beyond Access"></a>3.2.1 Going Beyond Access</h3>
                  <p>上面的是原标题，我的理解是不仅仅获取数据，还有别的呢。 首先，介绍两个基本的术语</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> <span class="string">目标数据，可以是字典，列表，或其他任意的对象</span></span><br><span class="line"><span class="attr">spec</span>  <span class="string">我们想要的输出格式 【specifications】， 定义你自己所需要的格式</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在让我们跟随宇航员的脚步，探索太阳系吧。</p>
                  <ul>
                    <li>获取某个行星的名字：</li>
                  </ul>
                  <figure class="highlight vala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'galaxy'</span>: &#123;<span class="string">'system'</span>: &#123;<span class="string">'planet'</span>: <span class="string">'jupiter'</span>&#125;&#125;&#125;</span><br><span class="line"><span class="meta"># 这个格式就是需要个字段值，所以输出的就是个字段值</span></span><br><span class="line">spec = <span class="string">'galaxy.system.planet'</span></span><br><span class="line">glom(target, spec)</span><br><span class="line"><span class="meta"># 'jupyter'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>现在，宇航员们想把行星的名字放进一个列表中，数据是这样：</li>
                  </ul>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>&#125;]&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>通常，处理这样的话，都要写个循环，或者搞个列表解析式，那么glom怎么处理呢？</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glom(target, (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]))</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是不是很简单。那么现在新需求又来了，宇航员想得到下面这个数据里面的行星的卫星的数:</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">target</span> = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;,</span><br><span class="line">                                  &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;]&#125;&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>glom解决方法：</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 自定义的格式</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]),</span><br><span class="line">        <span class="string">'moons'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>])&#125;</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">1</span>, <span class="number">69</span>], <span class="string">'names'</span>: [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-2-2-Changing-Requirements"><a href="#3-2-2-Changing-Requirements" class="headerlink" title="3.2.2  Changing Requirements"></a>3.2.2 Changing Requirements</h3>
                  <p>Coalesce 是glom定义的一种结构，允许我们对于spec中的子spec进行进一步的处理，你只要在子spec中将可能存在的值定义好就行了，听起来有点绕，现在来梳理一下。</p>
                  <ul>
                    <li>首先，子spec是什么？</li>
                  </ul>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>])&#125;</span><br><span class="line"># 以这个为例，这里面的<span class="keyword">system</span>.planets就是个子spec</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>然后，使用其解析数据：</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;</span><br><span class="line">    <span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;],</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'moons'</span>])&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">1</span>, <span class="number">69</span>], <span class="string">'names'</span>: [<span class="string">'earth'</span>, <span class="string">'jupiter'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>接着当我们的数据变成了这个以后</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;<span class="string">'dwarf_planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'pluto'</span>, <span class="string">'moons'</span>: <span class="number">5</span>&#125;,</span><br><span class="line">                                        &#123;<span class="string">'name'</span>: <span class="string">'ceres'</span>, <span class="string">'moons'</span>: <span class="number">0</span>&#125;]&#125;&#125;</span><br><span class="line">spec = &#123;<span class="string">'names'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'name'</span>]),</span><br><span class="line">         <span class="string">'moons'</span>: (<span class="symbol">Coalesce</span>(<span class="string">'system.planets'</span>, <span class="string">'system.dwarf_planets'</span>), [<span class="string">'moons'</span>])&#125;</span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'moons'</span>: [<span class="number">5</span>, <span class="number">0</span>], <span class="string">'names'</span>: [<span class="string">'pluto'</span>, <span class="string">'ceres'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，依然可以使用相同的spec来解析不同的目标数据。 有意思的是，你可以在target里面同时写入plantes和dwarf_plants数据试试看，会返回什么数据。 【这里应该是个惰性的匹配，只要匹配到一个，后面的就不再去匹配了】</p>
                  <h3 id="3-2-3-True-Python-Native"><a href="#3-2-3-True-Python-Native" class="headerlink" title="3.2.3  True Python Native"></a>3.2.3 True Python Native</h3>
                  <p>真正的原生python 在glom里面，你可以传值给python里面的任意的函数 举例：</p>
                  <ul>
                    <li>求和</li>
                  </ul>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">target = &#123;<span class="string">'system'</span>: &#123;<span class="string">'planets'</span>: [&#123;<span class="string">'name'</span>: <span class="string">'earth'</span>, <span class="string">'moons'</span>: <span class="number">1</span>&#125;,</span><br><span class="line">                                  &#123;<span class="string">'name'</span>: <span class="string">'jupiter'</span>, <span class="string">'moons'</span>: <span class="number">69</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, &#123;<span class="string">'moon_count'</span>: (<span class="string">'system.planets'</span>, [<span class="string">'moons'</span>], sum)&#125;)</span><br><span class="line"></span><br><span class="line"># &#123;<span class="string">'moon_count'</span>: <span class="number">70</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>原教程这里还有个案例，但是我还没有理解好，就不写出来了，大家可以点击链接自己看一下。 </p>
                  <h1 id="4-结论"><a href="#4-结论" class="headerlink" title="4. 结论"></a>4. 结论</h1>
                  <p>下一节，为大家带来其中一些重要的函数。 最后，在用的过程中，一直有个疑问，数据如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">target</span> = &#123;</span><br><span class="line">    <span class="string">'data'</span>: &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'just_test'</span>,</span><br><span class="line">        <span class="string">'likes'</span>: [&#123;<span class="string">'ball'</span>: <span class="string">'basketball'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'ball'</span>: <span class="string">'football'</span>&#125;,</span><br><span class="line">                  &#123;<span class="string">'water'</span>: <span class="string">'swim'</span>&#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在，我想返回的数据格式为：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'just_for_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'water'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一开始我以为可以这么用：</p>
                  <figure class="highlight sml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;</span><br><span class="line">    <span class="symbol">'name'</span>: (<span class="symbol">'data</span>.name'),</span><br><span class="line">    <span class="symbol">'likes'</span>: (<span class="symbol">'data</span>.likes', [<span class="symbol">'ball'</span>, <span class="symbol">'water'</span>] ),</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但是不行，这样会报错。后来用了另外的方法：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spec = &#123;</span><br><span class="line">    <span class="string">'name'</span>: (<span class="string">'data.name'</span>),</span><br><span class="line">    <span class="string">'likes'</span>: (<span class="string">'data.likes'</span>, [lambda <span class="symbol">x</span>: <span class="symbol">x</span>.values()[<span class="number">0</span>] <span class="keyword">if</span> <span class="string">'ball'</span> <span class="keyword">or</span> <span class="string">'water'</span> in <span class="symbol">x</span>.keys() <span class="keyword">else</span> <span class="string">''</span>] ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print glom(target, spec)</span><br><span class="line"># &#123;<span class="string">'name'</span>: <span class="string">'just_test'</span>, <span class="string">'likes'</span>: [<span class="string">'basketball'</span>, <span class="string">'football'</span>, <span class="string">'swim'</span>]&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样感觉很不爽啊，还望会的同学不吝赐教啊。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-28 18:19:35" itemprop="dateCreated datePublished" datetime="2018-07-28T18:19:35+08:00">2018-07-28</time>
                </span>
                <span id="/6182.html" class="post-meta-item leancloud_visitors" data-flag-title="Python glom包初探" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6173.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6173.html" class="post-title-link" itemprop="url">《Python3网络爬虫开发实战》第三波赠书活动来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="开门见山"><a href="#开门见山" class="headerlink" title="开门见山"></a>开门见山</h2>
                  <p>话不多说了！第三波送书活动来了！这次送 20 本签名版《Python3网络爬虫开发实战》。 本书目前上市三个月已经重印 6 次，上市三个月以来长期位居京东计算机类新书榜第一位（现已不算新书），目前在豆瓣的评分是 9.2 分。 <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/05/Python-3网格爬虫开发实战-立体图-857x1100.jpg" alt=""> <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG1030.jpeg" alt=""></p>
                  <h2 id="书籍介绍"><a href="#书籍介绍" class="headerlink" title="书籍介绍"></a><strong>书籍介绍</strong></h2>
                  <p>本书<strong>《Python3网络爬虫开发实战》</strong>全面介绍了利用 Python3 开发网络爬虫的知识，书中首先详细介绍了各种类型的环境配置过程和爬虫基础知识，还讨论了 urllib、requests 等请求库和 Beautiful Soup、XPath、pyquery 等解析库以及文本和各类数据库的存储方法，另外本书通过多个真实新鲜案例介绍了分析 Ajax 进行数据爬取，Selenium 和 Splash 进行动态网站爬取的过程，接着又分享了一些切实可行的爬虫技巧，比如使用代理爬取和维护动态代理池的方法、ADSL 拨号代理的使用、各类验证码（图形、极验、点触、宫格等）的破解方法、模拟登录网站爬取的方法及 Cookies 池的维护等等。 此外，本书的内容还远远不止这些，作者还结合移动互联网的特点探讨了使用 Charles、mitmdump、Appium 等多种工具实现 App 抓包分析、加密参数接口爬取、微信朋友圈爬取的方法。此外本书还详细介绍了 pyspider 框架、Scrapy 框架的使用和分布式爬虫的知识，另外对于优化及部署工作，本书还包括 Bloom Filter 效率优化、Docker 和 Scrapyd 爬虫部署、分布式爬虫管理框架Gerapy 的分享。 全书共 604 页，足足两斤重呢~ 定价为 99 元！</p>
                  <h2 id="作者介绍"><a href="#作者介绍" class="headerlink" title="作者介绍"></a><strong>作者介绍</strong></h2>
                  <p>看书就先看看谁写的嘛，我们来了解一下~ 崔庆才，静觅博客博主（<a href="https://cuiqingcai.com），博客" target="_blank" rel="noopener">https://cuiqingcai.com），博客</a> Python 爬虫博文阅读量已过千万，北京航空航天大学硕士，天善智能、网易云课堂讲师，微软小冰大数据工程师，有多个大型分布式爬虫项目经验，乐于技术分享，文章通俗易懂 ^<em>^ 附皂片一张 ~(@^</em>^@)~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG785-240x320.jpeg" alt=""></p>
                  <h2 id="图文介绍"><a href="#图文介绍" class="headerlink" title="图文介绍"></a><strong>图文介绍</strong></h2>
                  <p>呕心沥血设计的宣传图也得放一下~ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/WechatIMG556.jpeg" alt=""></p>
                  <h2 id="专家评论"><a href="#专家评论" class="headerlink" title="专家评论"></a><strong>专家评论</strong></h2>
                  <p>书是好是坏，得让专家看评一评呀，那么下面就是几位专家的精彩评论，快来看看吧~ 在互联网软件开发工程师的分类中，爬虫工程师是非常重要的。爬虫工作往往是一个公司核心业务开展的基础，数据抓取下来，才有后续的加工处理和最终展现。此时数据的抓取规模、稳定性、实时性、准确性就显得非常重要。早期的互联网充分开放互联，数据获取的难度很小。随着各大公司对数据资产日益看重，反爬水平也在不断提高，各种新技术不断给爬虫软件提出新的课题。本书作者对爬虫的各个领域都有深刻研究，书中探讨了Ajax数据的抓取、动态渲染页面的抓取、验证码识别、模拟登录等高级话题，同时也结合移动互联网的特点探讨了App的抓取等。更重要的是，本书提供了大量源码，可以帮助读者更好地理解相关内容。强烈推荐给各位技术爱好者阅读！</p>
                  <p><strong>——梁斌</strong>，八友科技总经理</p>
                  <p>数据既是当今大数据分析的前提，也是各种人工智能应用场景的基础。得数据者得天下，会爬虫者走遍天下也不怕！一册在手，让小白到老司机都能有所收获！</p>
                  <p><strong>——李舟军</strong>，北京航空航天大学教授，博士生导师</p>
                  <p>本书从爬虫入门到分布式抓取，详细介绍了爬虫技术的各个要点，并针对不同的场景提出了对应的解决方案。另外，书中通过大量的实例来帮助读者更好地学习爬虫技术，通俗易懂，干货满满。强烈推荐给大家！</p>
                  <p><strong>——宋睿华</strong>，微软小冰首席科学家</p>
                  <p>有人说中国互联网的带宽全给各种爬虫占据了，这说明网络爬虫的重要性以及中国互联网数据封闭垄断的现状。爬是一种能力，爬是为了不爬。</p>
                  <p><strong>——施水才</strong>，北京拓尔思信息技术股份有限公司总裁</p>
                  <h2 id="全书目录"><a href="#全书目录" class="headerlink" title="全书目录"></a><strong>全书目录</strong></h2>
                  <p>书的目录也有~ 看这里！</p>
                  <ul>
                    <li><strong>1-开发环境配置</strong></li>
                    <li>1.1-Python3的安装</li>
                    <li>1.2-请求库的安装</li>
                    <li>1.3-解析库的安装</li>
                    <li>1.4-数据库的安装</li>
                    <li>1.5-存储库的安装</li>
                    <li>1.6-Web库的安装</li>
                    <li>1.7-App爬取相关库的安装</li>
                    <li>1.8-爬虫框架的安装</li>
                    <li>1.9-部署相关库的安装</li>
                    <li><strong>2-爬虫基础</strong></li>
                    <li>2.1-HTTP基本原理</li>
                    <li>2.2-网页基础</li>
                    <li>2.3-爬虫的基本原理</li>
                    <li>2.4-会话和Cookies</li>
                    <li>2.5-代理的基本原理</li>
                    <li><strong>3-基本库的使用</strong></li>
                    <li>3.1-使用urllib</li>
                    <li>3.1.1-发送请求</li>
                    <li>3.1.2-处理异常</li>
                    <li>3.1.3-解析链接</li>
                    <li>3.1.4-分析Robots协议</li>
                    <li>3.2-使用requests</li>
                    <li>3.2.1-基本用法</li>
                    <li>3.2.2-高级用法</li>
                    <li>3.3-正则表达式</li>
                    <li>3.4-抓取猫眼电影排行</li>
                    <li><strong>4-解析库的使用</strong></li>
                    <li>4.1-使用XPath</li>
                    <li>4.2-使用Beautiful Soup</li>
                    <li>4.3-使用pyquery</li>
                    <li><strong>5-数据存储</strong></li>
                    <li>5.1-文件存储</li>
                    <li>5.1.1-TXT文本存储</li>
                    <li>5.1.2-JSON文件存储</li>
                    <li>5.1.3-CSV文件存储</li>
                    <li>5.2-关系型数据库存储</li>
                    <li>5.2.1-MySQL存储</li>
                    <li>5.3-非关系型数据库存储</li>
                    <li>5.3.1-MongoDB存储</li>
                    <li>5.3.2-Redis存储</li>
                    <li><strong>6-Ajax数据爬取</strong></li>
                    <li>6.1-什么是Ajax</li>
                    <li>6.2-Ajax分析方法</li>
                    <li>6.3-Ajax结果提取</li>
                    <li>6.4-分析Ajax爬取今日头条街拍美图</li>
                    <li><strong>7-动态渲染页面爬取</strong></li>
                    <li>7.1-Selenium的使用</li>
                    <li>7.2-Splash的使用</li>
                    <li>7.3-Splash负载均衡配置</li>
                    <li>7.4-使用Selenium爬取淘宝商品</li>
                    <li><strong>8-验证码的识别</strong></li>
                    <li>8.1-图形验证码的识别</li>
                    <li>8.2-极验滑动验证码的识别</li>
                    <li>8.3-点触验证码的识别</li>
                    <li>8.4-微博宫格验证码的识别</li>
                    <li><strong>9-代理的使用</strong></li>
                    <li>9.1-代理的设置</li>
                    <li>9.2-代理池的维护</li>
                    <li>9.3-付费代理的使用</li>
                    <li>9.4-ADSL拨号代理</li>
                    <li>9.5-使用代理爬取微信公众号文章</li>
                    <li><strong>10-模拟登录</strong></li>
                    <li>10.1-模拟登录并爬取GitHub</li>
                    <li>10.2-Cookies池的搭建</li>
                    <li><strong>11-App的爬取</strong></li>
                    <li>11.1-Charles的使用</li>
                    <li>11.2-mitmproxy的使用</li>
                    <li>11.3-mitmdump爬取“得到”App电子书信息</li>
                    <li>11.4-Appium的基本使用</li>
                    <li>11.5-Appium爬取微信朋友圈</li>
                    <li>11.6-Appium+mitmdump爬取京东商品</li>
                    <li><strong>12-pyspider框架的使用</strong></li>
                    <li>12.1-pyspider框架介绍</li>
                    <li>12.2-pyspider的基本使用</li>
                    <li>12.3-pyspider用法详解</li>
                    <li><strong>13-Scrapy框架的使用</strong></li>
                    <li>13.1-Scrapy框架介绍</li>
                    <li>13.2-Scrapy入门</li>
                    <li>13.3-Selector的用法</li>
                    <li>13.4-Spider的用法</li>
                    <li>13.5-Downloader Middleware的用法</li>
                    <li>13.6-Spider Middleware的用法</li>
                    <li>13.7-Item Pipeline的用法</li>
                    <li>13.8-Scrapy对接Selenium</li>
                    <li>13.9-Scrapy对接Splash</li>
                    <li>13.10-Scrapy通用爬虫</li>
                    <li>13.11-Scrapyrt的使用</li>
                    <li>13.12-Scrapy对接Docker</li>
                    <li>13.13-Scrapy爬取新浪微博</li>
                    <li><strong>14-分布式爬虫</strong></li>
                    <li>14.1-分布式爬虫原理</li>
                    <li>14.2-Scrapy-Redis源码解析</li>
                    <li>14.3-Scrapy分布式实现</li>
                    <li>14.4-Bloom Filter的对接</li>
                    <li><strong>15-分布式爬虫的部署</strong></li>
                    <li>15.1-Scrapyd分布式部署</li>
                    <li>15.2-Scrapyd-Client的使用</li>
                    <li>15.3-Scrapyd对接Docker</li>
                    <li>15.4-Scrapyd批量部署</li>
                    <li>15.5-Gerapy分布式管理</li>
                  </ul>
                  <h2 id="购买链接"><a href="#购买链接" class="headerlink" title="购买链接"></a><strong>购买链接</strong></h2>
                  <p>想必很多小伙伴已经等了很久了，之前预售那么久也一直迟迟没有货，发售就有不少网店又售空了，不过现在起不用担心了！</p>
                  <p>书籍现已在京东、天猫、当当等网店上架并全面供应啦，复制链接到浏览器打开或扫描二维码打开即可购买了！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/京东二维码.png" alt=""></p>
                  <p> 京东商城</p>
                  <p><a href="https://item.jd.com/12333540.html" target="_blank" rel="noopener">https://item.jd.com/12333540.html</a></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/天猫二维码.png" alt=""></p>
                  <p> 天猫商城</p>
                  <p><a href="https://detail.tmall.com/item.htm?id=566699703917" target="_blank" rel="noopener">https://detail.tmall.com/item.htm?id=566699703917</a></p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/当当二维码.png" alt=""></p>
                  <p>当当网</p>
                  <p><a href="http://product.dangdang.com/25249602.html" target="_blank" rel="noopener">http://product.dangdang.com/25249602.html</a></p>
                  <p>欢迎大家购买，谢谢支持！O(∩_∩)O</p>
                  <h2 id="免费预览"><a href="#免费预览" class="headerlink" title="免费预览"></a><strong>免费预览</strong></h2>
                  <p>不放心？想先看看有些啥，没问题！看这里： 免费章节试读： <a href="https://cuiqingcai.com/5052.html">https://cuiqingcai.com/5052.html</a> 将一直免费开放<strong>前7章节</strong>，欢迎大家试读！ 好了，接下来就是我们的福利环节啦~</p>
                  <h2 id="福利一：签名书！！！"><a href="#福利一：签名书！！！" class="headerlink" title="福利一：签名书！！！"></a><strong>福利一：签名书！！！</strong></h2>
                  <p>恭喜你看到这里了！那么接下来的福利时间就到了！后面还有两个福利不容错过~ 赠书活动第三波来袭，送 20 本作者亲笔签名书籍！！！ 活动流程（重要，请一定认真阅读）： <strong>公众号进击的Coder回复 “赠书” 获取序列码参与活动，2018.7.24 22:00 截止，逾期参与无效，请记住您的序列码，这是您的唯一标识。</strong> <strong>您可以转发活动页面邀请好友帮忙积攒人气值，最终取人气值前 20 位赠书，截止日期 2018.7.24 22:00，该时刻人气值前 20 位的朋友每人会获得签名书一本。</strong> 最终赠书名单会在微信公众号进击的Coder公布，届时请关注公众号消息！</p>
                  <h2 id="福利二：独家优惠！！！"><a href="#福利二：独家优惠！！！" class="headerlink" title="福利二：独家优惠！！！"></a><strong>福利二：独家优惠！！！</strong></h2>
                  <p>等等，你以为这就是全部福利吗？当然不是！除了抽奖送书，我们还拿到了拨号VPS知名品牌云立方的独家优惠，在公众号（进击的Coder ）中回复：“优惠券”，即可免费领取云立方50元主机优惠券，数量有限，先到先得！优惠券可在云立方官网（www.yunlifang.cn）购买动态IP拨号VPS时抵扣现金，有了它，爬虫代理易如反掌！ 你问我动态拨号VPS能做什么？应该怎么用在爬虫里？来这里了解一下： <a href="https://mp.weixin.qq.com/s?__biz=MzIzNzA4NDk3Nw==&amp;mid=2457735734&amp;idx=1&amp;sn=ca0d066d767570205daa9475e31cbc1f&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">轻松获得海量稳定代理！ADSL拨号代理的搭建</a></p>
                  <h2 id="福利三：视频课程！！！"><a href="#福利三：视频课程！！！" class="headerlink" title="福利三：视频课程！！！"></a><strong>福利三：视频课程！！！</strong></h2>
                  <p>当然除了书籍，也有配套的视频课程，目前半价促销中，作者同样是崔庆才，二者结合学习效果更佳！限时优惠折扣中！扫描下图中二维码即可了解详情！ <img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/课程宣传图.png" alt=""> 最后也是最重要的就是参与活动的地址了！！！快来扫码回复领取属于你的福利吧！！！</p>
                  <p><img src="https://qiniu.cuiqingcai.com/wp-content/uploads/2018/06/gzh.jpg" alt=""></p>
                  <h2 id="特别致谢"><a href="#特别致谢" class="headerlink" title="特别致谢"></a>特别致谢</h2>
                  <p>最后特别感谢云立方、天善智能对本活动的大力支持！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-15 16:16:59" itemprop="dateCreated datePublished" datetime="2018-07-15T16:16:59+08:00">2018-07-15</time>
                </span>
                <span id="/6173.html" class="post-meta-item leancloud_visitors" data-flag-title="《Python3网络爬虫开发实战》第三波赠书活动来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6160.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6160.html" class="post-title-link" itemprop="url">Python中异步协程的使用方法介绍</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2>
                  <p>在执行一些 IO 密集型任务的时候，程序常常会因为等待 IO 而阻塞。比如在网络爬虫中，如果我们使用 requests 库来进行请求的话，如果网站响应速度过慢，程序一直在等待网站响应，最后导致其爬取效率是非常非常低的。 为了解决这类问题，本文就来探讨一下 Python 中异步协程来加速的方法，此种方法对于 IO 密集型任务非常有效。如将其应用到网络爬虫中，爬取效率甚至可以成百倍地提升。 注：本文协程使用 async/await 来实现，需要 Python 3.5 及以上版本。</p>
                  <h2 id="2-基本了解"><a href="#2-基本了解" class="headerlink" title="2. 基本了解"></a>2. 基本了解</h2>
                  <p>在了解异步协程之前，我们首先得了解一些基础概念，如阻塞和非阻塞、同步和异步、多进程和协程。</p>
                  <h3 id="2-1-阻塞"><a href="#2-1-阻塞" class="headerlink" title="2.1 阻塞"></a>2.1 阻塞</h3>
                  <p>阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续干别的事情，则称该程序在该操作上是阻塞的。 常见的阻塞形式有：网络 I/O 阻塞、磁盘 I/O 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 CPU 切换上下文时，所有的进程都无法真正干事情，它们也会被阻塞。如果是多核 CPU 则正在执行上下文切换操作的核不可被利用。</p>
                  <h3 id="2-2-非阻塞"><a href="#2-2-非阻塞" class="headerlink" title="2.2 非阻塞"></a>2.2 非阻塞</h3>
                  <p>程序在等待某操作过程中，自身不被阻塞，可以继续运行干别的事情，则称该程序在该操作上是非阻塞的。 非阻塞并不是在任何程序级别、任何情况下都可以存在的。 仅当程序封装的级别可以囊括独立的子程序单元时，它才可能存在非阻塞状态。 非阻塞的存在是因为阻塞存在，正因为某个操作阻塞导致的耗时与效率低下，我们才要把它变成非阻塞的。</p>
                  <h3 id="2-3-同步"><a href="#2-3-同步" class="headerlink" title="2.3 同步"></a>2.3 同步</h3>
                  <p>不同程序单元为了完成某个任务，在执行过程中需靠某种通信方式以协调一致，称这些程序单元是同步执行的。 例如购物系统中更新商品库存，需要用“行锁”作为通信信号，让不同的更新请求强制排队顺序执行，那更新库存的操作是同步的。 简言之，同步意味着有序。</p>
                  <h3 id="2-4-异步"><a href="#2-4-异步" class="headerlink" title="2.4 异步"></a>2.4 异步</h3>
                  <p>为完成某个任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不相关的程序单元之间可以是异步的。 例如，爬虫下载网页。调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为。不同网页的下载、保存等操作都是无关的，也无需相互通知协调。这些异步操作的完成时刻并不确定。 简言之，异步意味着无序。</p>
                  <h3 id="2-5-多进程"><a href="#2-5-多进程" class="headerlink" title="2.5 多进程"></a>2.5 多进程</h3>
                  <p>多进程就是利用 CPU 的多核优势，在同一时间并行地执行多个任务，可以大大提高执行效率。</p>
                  <h3 id="2-6-协程"><a href="#2-6-协程" class="headerlink" title="2.6 协程"></a>2.6 协程</h3>
                  <p>协程，英文叫做 Coroutine，又称微线程，纤程，协程是一种用户态的轻量级线程。 协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此协程能保留上一次调用时的状态，即所有局部状态的一个特定组合，每次过程重入时，就相当于进入上一次调用的状态。 协程本质上是个单进程，协程相对于多进程来说，无需线程上下文切换的开销，无需原子操作锁定及同步的开销，编程模型也非常简单。 我们可以使用协程来实现异步操作，比如在网络爬虫场景下，我们发出一个请求之后，需要等待一定的时间才能得到响应，但其实在这个等待过程中，程序可以干许多其他的事情，等到响应得到之后才切换回来继续处理，这样可以充分利用 CPU 和其他资源，这就是异步协程的优势。</p>
                  <h2 id="3-异步协程用法"><a href="#3-异步协程用法" class="headerlink" title="3. 异步协程用法"></a>3. 异步协程用法</h2>
                  <p>接下来让我们来了解下协程的实现，从 Python 3.4 开始，Python 中加入了协程的概念，但这个版本的协程还是以生成器对象为基础的，在 Python 3.5 则增加了 async/await，使得协程的实现更加方便。 Python 中使用协程最常用的库莫过于 asyncio，所以本文会以 asyncio 为基础来介绍协程的使用。 首先我们需要了解下面几个概念：</p>
                  <ul>
                    <li>event_loop：事件循环，相当于一个无限循环，我们可以把一些函数注册到这个事件循环上，当满足条件发生的时候，就会调用对应的处理方法。</li>
                    <li>coroutine：中文翻译叫协程，在 Python 中常指代为协程对象类型，我们可以将协程对象注册到时间循环中，它会被事件循环调用。我们可以使用 async 关键字来定义一个方法，这个方法在调用时不会立即被执行，而是返回一个协程对象。</li>
                    <li>task：任务，它是对协程对象的进一步封装，包含了任务的各个状态。</li>
                    <li>future：代表将来执行或没有执行的任务的结果，实际上和 task 没有本质区别。</li>
                  </ul>
                  <p>另外我们还需要了解 async/await 关键字，它是从 Python 3.5 才出现的，专门用于定义协程。其中，async 定义一个协程，await 用来挂起阻塞方法的执行。</p>
                  <h3 id="3-1-定义协程"><a href="#3-1-定义协程" class="headerlink" title="3.1 定义协程"></a>3.1 定义协程</h3>
                  <p>首先我们来定义一个协程，体验一下它和普通进程在实现上的不同之处，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(<span class="string">'Number:'</span>, x)</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line">print(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line">print(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(coroutine)</span><br><span class="line">print(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x1034cf830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Number: 1</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们引入了 asyncio 这个包，这样我们才可以使用 async 和 await，然后我们使用 async 定义了一个 execute() 方法，方法接收一个数字参数，方法执行之后会打印这个数字。 随后我们直接调用了这个方法，然而这个方法并没有执行，而是返回了一个 coroutine 协程对象。随后我们使用 get_event_loop() 方法创建了一个事件循环 loop，并调用了 loop 对象的 run_until_complete() 方法将协程注册到事件循环 loop 中，然后启动。最后我们才看到了 execute() 方法打印了输出结果。 可见，async 定义的方法就会变成一个无法直接执行的 coroutine 对象，必须将其注册到事件循环中才可以执行。 上文我们还提到了 task，它是对 coroutine 对象的进一步封装，它里面相比 coroutine 对象多了运行状态，比如 running、finished 等，我们可以用这些状态来获取协程对象的执行情况。 在上面的例子中，当我们将 coroutine 对象传递给 run_until_complete() 方法的时候，实际上它进行了一个操作就是将 coroutine 封装成了 task 对象，我们也可以显式地进行声明，如下所示：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> execute(x):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Number:'</span>, x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">task</span> = loop.create_task(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x10e0f7830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Task: &lt;Task pending coro=&lt;execute() running at demo.py:4&gt;&gt;</span><br><span class="line">Number: 1</span><br><span class="line">Task: &lt;Task finished coro=&lt;execute() done, defined at demo.py:4&gt; result=1&gt;</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了 loop 对象之后，接着调用了它的 create_task() 方法将 coroutine 对象转化为了 task 对象，随后我们打印输出一下，发现它是 pending 状态。接着我们将 task 对象添加到事件循环中得到执行，随后我们再打印输出一下 task 对象，发现它的状态就变成了 finished，同时还可以看到其 result 变成了 1，也就是我们定义的 execute() 方法的返回结果。 另外定义 task 对象还有一种方式，就是直接通过 asyncio 的 ensure_future() 方法，返回结果也是 task 对象，这样的话我们就可以不借助于 loop 来定义，即使我们还没有声明 loop 也可以提前定义好 task 对象，写法如下：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> execute(x):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Number:'</span>, x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">coroutine = execute(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Coroutine:'</span>, coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling execute'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'After calling loop'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Coroutine: &lt;coroutine object<span class="built_in"> execute </span>at 0x10aa33830&gt;</span><br><span class="line">After calling execute</span><br><span class="line">Task: &lt;Task pending coro=&lt;execute() running at demo.py:4&gt;&gt;</span><br><span class="line">Number: 1</span><br><span class="line">Task: &lt;Task finished coro=&lt;execute() done, defined at demo.py:4&gt; result=1&gt;</span><br><span class="line">After calling loop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现其效果都是一样的。</p>
                  <h3 id="3-2-绑定回调"><a href="#3-2-绑定回调" class="headerlink" title="3.2 绑定回调"></a>3.2 绑定回调</h3>
                  <p>另外我们也可以为某个 task 绑定一个回调方法，来看下面的例子：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> callback(<span class="keyword">task</span>):</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Status:'</span>, <span class="keyword">task</span>.result())</span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">task</span>.add_done_callback(callback)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了一个 request() 方法，请求了百度，返回状态码，但是这个方法里面我们没有任何 print() 语句。随后我们定义了一个 callback() 方法，这个方法接收一个参数，是 task 对象，然后调用 print() 方法打印了 task 对象的结果。这样我们就定义好了一个 coroutine 对象和一个回调方法，我们现在希望的效果是，当 coroutine 对象执行完毕之后，就去执行声明的 callback() 方法。 那么它们二者怎样关联起来呢？很简单，只需要调用 add_done_callback() 方法即可，我们将 callback() 方法传递给了封装好的 task 对象，这样当 task 执行完毕之后就可以调用 callback() 方法了，同时 task 对象还会作为参数传递给 callback() 方法，调用 task 对象的 result() 方法就可以获取返回结果了。 运行结果：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt; cb=[callback() <span class="keyword">at</span> demo.py:<span class="number">11</span>]&gt;</span><br><span class="line">Status: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> finished coro=&lt;request() done, defined <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt; result=&lt;Response [<span class="number">200</span>]&gt;&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上不用回调方法，直接在 task 运行完毕之后也可以直接调用 result() 方法获取结果，如下所示：</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line"><span class="keyword">task</span> = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(<span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task:'</span>, <span class="keyword">task</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Task Result:'</span>, <span class="keyword">task</span>.result())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是一样的：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">4</span>&gt;&gt;</span><br><span class="line"><span class="keyword">Task</span>: &lt;<span class="keyword">Task</span> finished coro=&lt;request() done, defined <span class="keyword">at</span> demo.py:<span class="number">4</span>&gt; result=&lt;Response [<span class="number">200</span>]&gt;&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-3-多任务协程"><a href="#3-3-多任务协程" class="headerlink" title="3.3 多任务协程"></a>3.3 多任务协程</h3>
                  <p>上面的例子我们只执行了一次请求，如果我们想执行多次请求应该怎么办呢？我们可以定义一个 task 列表，然后使用 asyncio 的 wait() 方法即可执行，看下面的例子：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'https://www.baidu.com'</span></span><br><span class="line">    status = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line">print(<span class="string">'Tasks:'</span>, tasks)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">    print(<span class="string">'Task Result:'</span>, task.result())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用一个 for 循环创建了五个 task，组成了一个列表，然后把这个列表首先传递给了 asyncio 的 wait() 方法，然后再将其注册到时间循环中，就可以发起五个任务了。最后我们再将任务的运行结果输出出来，运行结果如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tasks: [&lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;, &lt;<span class="keyword">Task</span> pending coro=&lt;request() running <span class="keyword">at</span> demo.py:<span class="number">5</span>&gt;&gt;]</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="keyword">Task</span> Result: &lt;Response [<span class="number">200</span>]&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到五个任务被顺次执行了，并得到了运行结果。</p>
                  <h3 id="3-4-协程实现"><a href="#3-4-协程实现" class="headerlink" title="3.4 协程实现"></a>3.4 协程实现</h3>
                  <p>前面说了这么一通，又是 async，又是 coroutine，又是 task，又是 callback，但似乎并没有看出协程的优势啊？反而写法上更加奇怪和麻烦了，别急，上面的案例只是为后面的使用作铺垫，接下来我们正式来看下协程在解决 IO 密集型任务上有怎样的优势吧！ 上面的代码中，我们用一个网络请求作为示例，这就是一个耗时等待的操作，因为我们请求网页之后需要等待页面响应并返回结果。耗时等待的操作一般都是 IO 操作，比如文件读取、网络请求等等。协程对于处理这种操作是有很大优势的，当遇到需要等待的情况的时候，程序可以暂时挂起，转而去执行其他的操作，从而避免一直等待一个程序而耗费过多的时间，充分利用资源。 为了表现出协程的优势，我们需要先创建一个合适的实验环境，最好的方法就是模拟一个需要等待一定时间才可以获取返回结果的网页，上面的代码中使用了百度，但百度的响应太快了，而且响应速度也会受本机网速影响，所以最好的方式是自己在本地模拟一个慢速服务器，这里我们选用 Flask。 如果没有安装 Flask 的话可以执行如下命令安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> flask</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后编写服务器代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(<span class="string">'/'</span>)</span><br><span class="line">def <span class="keyword">index</span>():</span><br><span class="line">    <span class="type">time</span>.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(threaded=<span class="keyword">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一个 Flask 服务，主入口是 index() 方法，方法里面先调用了 sleep() 方法休眠 3 秒，然后接着再返回结果，也就是说，每次请求这个接口至少要耗时 3 秒，这样我们就模拟了一个慢速的服务接口。 注意这里服务启动的时候，run() 方法加了一个参数 threaded，这表明 Flask 启动了多线程模式，不然默认是只有一个线程的。如果不开启多线程模式，同一时刻遇到多个请求的时候，只能顺次处理，这样即使我们使用协程异步请求了这个服务，也只能一个一个排队等待，瓶颈就会出现在服务端。所以，多线程模式是有必要打开的。 启动之后，Flask 应该默认会在 127.0.0.1:5000 上运行，运行之后控制台输出结果如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"> * Running <span class="keyword">on</span> http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5000</span>/ (Press CTRL+C <span class="keyword">to</span> <span class="keyword">quit</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们再重新使用上面的方法请求一遍：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = requests.<span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们还是创建了五个 task，然后将 task 列表传给 wait() 方法并注册到时间循环中执行。 运行结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.049368143081665</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现和正常的请求并没有什么两样，依然还是顺次执行的，耗时 15 秒，平均一个请求耗时 3 秒，说好的异步处理呢？ 其实，要实现异步处理，我们得先要有挂起的操作，当一个任务需要等待 IO 结果的时候，可以挂起当前任务，转而去执行其他任务，这样我们才能充分利用好资源，上面方法都是一本正经的串行走下来，连个挂起都没有，怎么可能实现异步？想太多了。 要实现异步，接下来我们再了解一下 await 的用法，使用 await 可以将耗时等待的操作挂起，让出控制权。当协程执行的时候遇到 await，时间循环就会将本协程挂起，转而去执行别的协程，直到其他的协程挂起或执行完毕。 所以，我们可能会将代码中的 request() 方法改成如下的样子：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">()</span>:</span></span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = <span class="keyword">await</span> requests.get(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仅仅是在 requests 前面加了一个 await，然而执行以下代码，会得到如下报错：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.048935890197754</span></span><br><span class="line">Task exception was never retrieved</span><br><span class="line"><span class="string">future:</span> &lt;Task finished coro=&lt;request() done, defined at demo.<span class="string">py:</span><span class="number">7</span>&gt; exception=TypeError(<span class="string">"object Response can't be used in 'await' expression"</span>,)&gt;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"demo.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> request</span><br><span class="line">    status = await requests.get(url)</span><br><span class="line"><span class="string">TypeError:</span> object Response can<span class="string">'t be used in '</span>await<span class="string">' expression</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这次它遇到 await 方法确实挂起了，也等待了，但是最后却报了这么个错，这个错误的意思是 requests 返回的 Response 对象不能和 await 一起使用，为什么呢？因为根据官方文档说明，await 后面的对象必须是如下格式之一：</p>
                  <ul>
                    <li>A native coroutine object returned from a native coroutine function，一个原生 coroutine 对象。</li>
                    <li>A generator-based coroutine object returned from a function decorated with types.coroutine()，一个由 types.coroutine() 修饰的生成器，这个生成器可以返回 coroutine 对象。</li>
                    <li>An object with an await<strong> method returning an iterator，一个包含 </strong>await 方法的对象返回的一个迭代器。</li>
                  </ul>
                  <p>可以参见：<a href="https://www.python.org/dev/peps/pep-0492/#await-expression" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0492/#await-expression</a>。 reqeusts 返回的 Response 不符合上面任一条件，因此就会报上面的错误了。 那么有的小伙伴就发现了，既然 await 后面可以跟一个 coroutine 对象，那么我用 async 把请求的方法改成 coroutine 对象不就可以了吗？所以就改写成如下的样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def <span class="keyword">get</span>(url):</span><br><span class="line">    <span class="keyword">return</span> requests.<span class="keyword">get</span>(url)</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    response = await <span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, response.text)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将请求页面的方法独立出来，并用 async 修饰，这样就得到了一个 coroutine 对象，我们运行一下看看：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">15.134317874908447</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是不行，它还不是异步执行，也就是说我们仅仅将涉及 IO 操作的代码封装到 async 修饰的方法里面是不可行的！我们必须要使用支持异步操作的请求方式才可以实现真正的异步，所以这里就需要 aiohttp 派上用场了。</p>
                  <h3 id="3-5-使用-aiohttp"><a href="#3-5-使用-aiohttp" class="headerlink" title="3.5 使用 aiohttp"></a>3.5 使用 aiohttp</h3>
                  <p>aiohttp 是一个支持异步请求的库，利用它和 asyncio 配合我们可以非常方便地实现异步请求操作。 安装方式如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiohttp</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>官方文档链接为：<a href="https://aiohttp.readthedocs.io/" target="_blank" rel="noopener">https://aiohttp.readthedocs.io/</a>，它分为两部分，一部分是 Client，一部分是 Server，详细的内容可以参考官方文档。 下面我们将 aiohttp 用上来，将代码改成如下样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">async def <span class="keyword">get</span>(url):</span><br><span class="line">    <span class="keyword">session</span> = aiohttp.ClientSession()</span><br><span class="line">    response = await <span class="keyword">session</span>.<span class="keyword">get</span>(url)</span><br><span class="line">    result = await response.text()</span><br><span class="line">    <span class="keyword">session</span>.<span class="keyword">close</span>()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">async def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = await <span class="keyword">get</span>(url)</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line">tasks = [asyncio.ensure_future(request()) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="keyword">loop</span>.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们将请求库由 requests 改成了 aiohttp，通过 aiohttp 的 ClientSession 类的 get() 方法进行请求，结果如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Waiting <span class="keyword">for</span> <span class="string">http:</span><span class="comment">//127.0.0.1:5000</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Get response from <span class="string">http:</span><span class="comment">//127.0.0.1:5000 Result: Hello!</span></span><br><span class="line">Cost <span class="string">time:</span> <span class="number">3.0199508666992188</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>成功了！我们发现这次请求的耗时由 15 秒变成了 3 秒，耗时直接变成了原来的 1/5。 代码里面我们使用了 await，后面跟了 get() 方法，在执行这五个协程的时候，如果遇到了 await，那么就会将当前协程挂起，转而去执行其他的协程，直到其他的协程也挂起或执行完毕，再进行下一个协程的执行。 开始运行时，时间循环会运行第一个 task，针对第一个 task 来说，当执行到第一个 await 跟着的 get() 方法时，它被挂起，但这个 get() 方法第一步的执行是非阻塞的，挂起之后立马被唤醒，所以立即又进入执行，创建了 ClientSession 对象，接着遇到了第二个 await，调用了 session.get() 请求方法，然后就被挂起了，由于请求需要耗时很久，所以一直没有被唤醒，好第一个 task 被挂起了，那接下来该怎么办呢？事件循环会寻找当前未被挂起的协程继续执行，于是就转而执行第二个 task 了，也是一样的流程操作，直到执行了第五个 task 的 session.get() 方法之后，全部的 task 都被挂起了。所有 task 都已经处于挂起状态，那咋办？只好等待了。3 秒之后，几个请求几乎同时都有了响应，然后几个 task 也被唤醒接着执行，输出请求结果，最后耗时，3 秒！ 怎么样？这就是异步操作的便捷之处，当遇到阻塞式操作时，任务被挂起，程序接着去执行其他的任务，而不是傻傻地等着，这样可以充分利用 CPU 时间，而不必把时间浪费在等待 IO 上。 有人就会说了，既然这样的话，在上面的例子中，在发出网络请求后，既然接下来的 3 秒都是在等待的，在 3 秒之内，CPU 可以处理的 task 数量远不止这些，那么岂不是我们放 10 个、20 个、50 个、100 个、1000 个 task 一起执行，最后得到所有结果的耗时不都是 3 秒左右吗？因为这几个任务被挂起后都是一起等待的。 理论来说确实是这样的，不过有个前提，那就是服务器在同一时刻接受无限次请求都能保证正常返回结果，也就是服务器无限抗压，另外还要忽略 IO 传输时延，确实可以做到无限 task 一起执行且在预想时间内得到结果。 我们这里将 task 数量设置成 100，再试一下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">tasks</span> = [asyncio.ensure_future(request()) for _ in range(<span class="number">100</span>)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>耗时结果如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">3.106252670288086</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后运行时间也是在 3 秒左右，当然多出来的时间就是 IO 时延了。 可见，使用了异步协程之后，我们几乎可以在相同的时间内实现成百上千倍次的网络请求，把这个运用在爬虫中，速度提升可谓是非常可观了。</p>
                  <h3 id="3-6-与单进程、多进程对比"><a href="#3-6-与单进程、多进程对比" class="headerlink" title="3.6 与单进程、多进程对比"></a>3.6 与单进程、多进程对比</h3>
                  <p>可能有的小伙伴非常想知道上面的例子中，如果 100 次请求，不是用异步协程的话，使用单进程和多进程会耗费多少时间，我们来测试一下： 首先来测试一下单进程的时间：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">start = <span class="type">time</span>.time()</span><br><span class="line"></span><br><span class="line">def request():</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    print(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = requests.<span class="keyword">get</span>(url).text</span><br><span class="line">    print(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    request()</span><br><span class="line"></span><br><span class="line">end = <span class="type">time</span>.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后耗时：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">305.16639709472656</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们使用多进程来测试下，使用 multiprocessing 库：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"></span><br><span class="line">def request(_):</span><br><span class="line">    url = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Waiting for'</span>, url)</span><br><span class="line">    result = requests.<span class="builtin-name">get</span>(url).text</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Get response from'</span>, url, <span class="string">'Result:'</span>, result)</span><br><span class="line"></span><br><span class="line">cpu_count = multiprocessing.cpu_count()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'Cpu count:'</span>, cpu_count)</span><br><span class="line">pool = multiprocessing.Pool(cpu_count)</span><br><span class="line">pool.map(request, range(100))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'Cost time:'</span>, end - start)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我使用了multiprocessing 里面的 Pool 类，即进程池。我的电脑的 CPU 个数是 8 个，这里的进程池的大小就是 8。 运行时间：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">48.17306900024414</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见 multiprocessing 相比单线程来说，还是可以大大提高效率的。</p>
                  <h3 id="3-7-与多进程的结合"><a href="#3-7-与多进程的结合" class="headerlink" title="3.7 与多进程的结合"></a>3.7 与多进程的结合</h3>
                  <p>既然异步协程和多进程对网络请求都有提升，那么为什么不把二者结合起来呢？在最新的 PyCon 2018 上，来自 Facebook 的 John Reese 介绍了 asyncio 和 multiprocessing 各自的特点，并开发了一个新的库，叫做 aiomultiprocess，感兴趣的可以了解下：<a href="https://www.youtube.com/watch?v=0kXaLh8Fz3k" target="_blank" rel="noopener">https://www.youtube.com/watch?v=0kXaLh8Fz3k</a>。 这个库的安装方式是：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiomultiprocess</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>需要 Python 3.6 及更高版本才可使用。 使用这个库，我们可以将上面的例子改写如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import asyncio</span><br><span class="line">import aiohttp</span><br><span class="line">import time</span><br><span class="line">from aiomultiprocess import Pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> = time.time()</span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> <span class="keyword">get</span>(<span class="keyword">url</span>):</span><br><span class="line">    <span class="keyword">session</span> = aiohttp.ClientSession()</span><br><span class="line">    response = await session.get(<span class="keyword">url</span>)</span><br><span class="line">    <span class="keyword">result</span> = await response.text()</span><br><span class="line">    session.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">result</span></span><br><span class="line"></span><br><span class="line">async <span class="keyword">def</span> request():</span><br><span class="line">    <span class="keyword">url</span> = <span class="string">'http://127.0.0.1:5000'</span></span><br><span class="line">    urls = [<span class="keyword">url</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="keyword">range</span>(<span class="number">100</span>)]</span><br><span class="line">    async <span class="keyword">with</span> Pool() <span class="keyword">as</span> pool:</span><br><span class="line">        <span class="keyword">result</span> = await pool.map(<span class="keyword">get</span>, urls)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">result</span></span><br><span class="line"></span><br><span class="line">coroutine = request()</span><br><span class="line">task = asyncio.ensure_future(coroutine)</span><br><span class="line"><span class="keyword">loop</span> = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(task)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> = time.time()</span><br><span class="line">print(<span class="string">'Cost time:'</span>, <span class="keyword">end</span> - <span class="keyword">start</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就会同时使用多进程和异步协程进行请求，当然最后的结果其实和异步是差不多的：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Cost</span> <span class="type">time</span>: <span class="number">3.1156570434570312</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为我的测试接口的原因，最快的响应也是 3 秒，所以这部分多余的时间基本都是 IO 传输时延。但在真实情况下，我们在做爬取的时候遇到的情况千变万化，一方面我们使用异步协程来防止阻塞，另一方面我们使用 multiprocessing 来利用多核成倍加速，节省时间其实还是非常可观的。 以上便是 Python 中协程的基本用法，希望对大家有帮助。</p>
                  <h2 id="4-参考来源"><a href="#4-参考来源" class="headerlink" title="4. 参考来源"></a>4. 参考来源</h2>
                  <ul>
                    <li><a href="http://python.jobbole.com/87310/" target="_blank" rel="noopener">http://python.jobbole.com/87310/</a></li>
                    <li><a href="https://www.cnblogs.com/xybaby/p/6406191.html" target="_blank" rel="noopener">https://www.cnblogs.com/xybaby/p/6406191.html</a></li>
                    <li><a href="http://python.jobbole.com/88291/" target="_blank" rel="noopener">http://python.jobbole.com/88291/</a></li>
                    <li><a href="http://lotabout.me/2017/understand-python-asyncio/" target="_blank" rel="noopener">http://lotabout.me/2017/understand-python-asyncio/</a></li>
                    <li><a href="https://segmentfault.com/a/1190000008814676" target="_blank" rel="noopener">https://segmentfault.com/a/1190000008814676</a></li>
                    <li><a href="https://www.cnblogs.com/animalize/p/4738941.html" target="_blank" rel="noopener">https://www.cnblogs.com/animalize/p/4738941.html</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-06 01:38:16" itemprop="dateCreated datePublished" datetime="2018-07-06T01:38:16+08:00">2018-07-06</time>
                </span>
                <span id="/6160.html" class="post-meta-item leancloud_visitors" data-flag-title="Python中异步协程的使用方法介绍" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>16k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6146.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6146.html" class="post-title-link" itemprop="url">推荐一些Mac上比较好用的软件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近有一个朋友刚入手了 Mac，准备专门搞开发用，让我给他推荐几款软件，然后我就把我的 Launchpad 截图发给了他，他看到这密密麻麻的软件完全不知所措。<a href="https://github.com/Germey/AI/blob/master/assets/2018-07-03-01-51-59.jpg" target="_blank" rel="noopener"><img src="https://github.com/Germey/AI/raw/master/assets/2018-07-03-01-51-59.jpg" alt=""></a> 于是乎，我就大略整理了一些我比较推荐的几款软件，同时分享给大家，希望对大家有所帮助！ 下面的一些软件都是我个人比较喜欢的，其实还有很多其他的恕不能一一列举了，如果大家有其他推荐的欢迎留言给我，谢谢！</p>
                  <h2 id="日常工具"><a href="#日常工具" class="headerlink" title="日常工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>日常工具</h2>
                  <p>一些日常工具在这里我就不一一列举了，大部分使用 Mac 的小伙伴都会安装，比如 QQ、微信、Chrome 浏览器、网易云音乐、迅雷等等，这些在 Windows 上也几乎都是必备软件，这里就不再展开说明了。</p>
                  <h2 id="效率工具"><a href="#效率工具" class="headerlink" title="效率工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>效率工具</h2>
                  <p>效率工具顾名思义，可以方便和简化 Mac 的操作，提高生产工作效率的工具，下面推荐几款我比较常用的。</p>
                  <h3 id="Alfred"><a href="#Alfred" class="headerlink" title="Alfred"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#alfred" target="_blank" rel="noopener"></a>Alfred</h3>
                  <p>首推 Alfred，可以说是 Mac 必备软件，利用它我们可以快速地进行各种操作，大幅提高工作效率，如快速打开某个软件、快速打开某个链接、快速搜索某个文档，快速定位某个文件，快速查看本机 IP，快速定义某个色值，几乎你能想到的都能对接实现。 这些快速功能是怎么实现的呢？实际上是 Alfred 对接了很多 Workflow，我们可以使用 Workflow 方便地进行功能扩展，一些比较优秀的 Workflow 已经有人专门做过整理了，可以参见：<a href="https://github.com/zenorocha/alfred-workflows" target="_blank" rel="noopener">https://github.com/zenorocha/alfred-workflows</a>。 推荐指数：★★★★★</p>
                  <h3 id="Todoist"><a href="#Todoist" class="headerlink" title="Todoist"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#todoist" target="_blank" rel="noopener"></a>Todoist</h3>
                  <p>大家肯定也在使用各种 Todo List 的软件，这种软件其实也是五花八门，经过我本人试用，我觉得 Todoist 这款软件是最方便的。 它支持各种类型的任务定制，还可以设置分组、优先级、Deadline、执行人员、提醒、协作、效率统计等功能。另外它的各个平台支持真是异常地全啊，网页、PC、移动端就不用说了，都必须有的，另外它还有浏览器插件版、电邮版、可穿戴设备（如 Apple Watch、Google Wear）版，另外他还可以和 Mac 的日历事件进行同步，日历添加的事件也会自动添加到 Todoist 里面，非常方便，是目前我体验过的最好用的一款。 这款软件个人推荐购买专业版解锁全部功能，一个月 3 刀，但个人觉得确实非常值。 推荐指数：★★★★☆</p>
                  <h3 id="Paste"><a href="#Paste" class="headerlink" title="Paste"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#paste" target="_blank" rel="noopener"></a>Paste</h3>
                  <p>Mac 上默认只有一个粘贴板，当我们新复制了一段文字之后，如果我们想再找寻之前复制的历史记录就找不到了，这其实是很反人类的。 好在 Paste 这款软件帮我们解决了这个问题，它可以保存我们粘贴板的历史记录，等需要粘贴某个内容的时候只需要呼出 Paste 历史粘贴板，然后选择某个特定的内容粘贴就好了，另外它还支持文本格式调整粘贴板分类和搜索，还可以支持快速便捷粘贴。有了它，妈妈再也不用担心我的粘贴板丢失了！ 推荐指数：★★★★★</p>
                  <h3 id="Synergy"><a href="#Synergy" class="headerlink" title="Synergy"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#synergy" target="_blank" rel="noopener"></a>Synergy</h3>
                  <p>工作时我会使用公司的台式机，是 Windows 系统，另外自己的个人笔记本 Mac 也会放在旁边，两台 PC 有时候会交替使用，但是我总不能配两套键盘和鼠标吧，这样就显得累赘了，而且也没那么多地方放啊。 有了 Synergy，我们可以将两台 PC 关联，实现键盘鼠标共享。我们可以使用一套键盘和鼠标来操作两台 PC，注意这是两个完全独立的 PC，各自有各自的屏幕和系统，使用 Synergy 我们可以做到一套键鼠同时控制两台电脑，鼠标可以直接从一台电脑的屏幕滑动到另一台电脑屏幕上，同时键盘、粘贴板也都是共享的。 设想这么个情景，我在我的台式机 Windows 上打开了一个页面，需要让我输入一个很长的序列号，而这个序列号又恰巧存在 Mac 上，这时如果有了 Synergy 将二者关联，我们只需要把鼠标从 Windows 的屏幕上直接滑动到 Mac 的屏幕上，选中序列号，然后键盘按下复制的快捷键，然后再把鼠标移回 Windows，粘贴即可，一气呵成。而不必再想办法发消息传输了，大大提高效率。 推荐指数：★★★★</p>
                  <h3 id="Feedly、Reeder"><a href="#Feedly、Reeder" class="headerlink" title="Feedly、Reeder"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#feedlyreeder" target="_blank" rel="noopener"></a>Feedly、Reeder</h3>
                  <p>博客现在已经越来越多了，越来越多的人开始在博客上发表文章，而当我们遇到优质的博客时，我们还想随时知道博客的发表动态，一旦有新文章发表我们想立马得到相关动态，这样可以实现吗？ 肯定是可行的，现在绝大多数博客都有 RSS 订阅功能，有了它我们可以订阅自己喜欢的博客，这里我使用的 RSS 订阅工具就是 Feedly，利用它我可以很轻松地添加自己喜欢的博客或论坛到自己的 Feed 流里面，一旦有文章更新，我就会收到相应提示。 但是 Feedly 有个小问题，就是在国内速度太慢了，所以我又使用 Reeder 将 Feedly 里面的 Feed 流做了转接，它可以添加 Feedly 源，并带有灵活的分类、标记等管理功能，还支持各种预览方式，还支持存储到 Pocket，还有各种分享方式，功能十分齐全。 总之，推荐 Feedly 来添加自己喜欢的博客，用 Reeder 来阅读订阅的内容，双剑合璧，另外 Reeder 对移动版的支持也很不错，可以体验一下。 推荐指数：★★★★</p>
                  <h3 id="Mindnode"><a href="#Mindnode" class="headerlink" title="Mindnode"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#mindnode" target="_blank" rel="noopener"></a>Mindnode</h3>
                  <p>有时候在思考问题的时候我们想要把一些思路记录下来，另外在做一些概要设计的时候需要把概要图大体描述出来，这时候画一个思维导图再合适不过了，比如你现在读的这篇文章就很适合用一个思维导图画一下。 画思维导图我个人比较喜欢的一款软件是 Mindnode，觉得比较简洁好用，当然也有不少人使用 XMind，也很不错。可能是先入为主，也可能是界面设计风格，我个人更加偏向于使用 Mindnode。 推荐指数：★★★★</p>
                  <h3 id="1Password"><a href="#1Password" class="headerlink" title="1Password"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#1password" target="_blank" rel="noopener"></a>1Password</h3>
                  <p>随着年龄的增长，我们可能变得越来越忘事了。另外还有些反人类的网站密码必须要至少大写、小写、数字、特殊符号，有的还要求不少于多少位，有的还要求我么能定时更换密码，还不能与之前用过的相同！这会使得我们之前预想设计的很多密码都没法用了。另外网站又这么多，谁又能把网站的密码都记下来啊？ 这时候我们就需要一款专门管理密码的软件，我个人推荐一款叫做 1Password，有了它我们可以将各个平台的密码保存起来，同时它还可以根据我们的要求帮我们随机生成一些密码并保存，这对注册一些新网站非常有用，同时使用随机的密码还降低了撞库的风险，不然一个平台的密码被盗了，其他平台用的同样的密码的话，就很不安全了。 1Password 还支持各种平台，如网页、PC、移动版都通通完美支持，实现密码云同步，妈妈再也不用担心我忘记密码了！ 推荐指数：★★★★</p>
                  <h2 id="系统工具"><a href="#系统工具" class="headerlink" title="系统工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%B3%BB%E7%BB%9F%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>系统工具</h2>
                  <p>下面介绍的两款系统工具软件几乎是装机必备的。</p>
                  <h3 id="Tuxera-NTFS-For-Mac"><a href="#Tuxera-NTFS-For-Mac" class="headerlink" title="Tuxera NTFS For Mac"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tuxera-ntfs-for-mac" target="_blank" rel="noopener"></a>Tuxera NTFS For Mac</h3>
                  <p>用了 Mac，我们在使用移动硬盘的时候可能会遇到一个无法传输数据（如拷贝文件）的问题，这是因为部分移动硬盘是 NTFS 格式的，而 Mac 的磁盘不是这个格式，因此就会导致二者之间无法拷贝文件。有一个解决方法就是使用 Tuxera NTFS For Mac，有了它，我们就可以比较顺利地拷贝文件了。 另外还有其他品牌的 NTFS For Mac 软件，也可以尝试使用一下。 推荐指数：★★★★☆</p>
                  <h3 id="VMware、Parallels-Desktop"><a href="#VMware、Parallels-Desktop" class="headerlink" title="VMware、Parallels Desktop"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#vmwareparallels-desktop" target="_blank" rel="noopener"></a>VMware、Parallels Desktop</h3>
                  <p>用了 Mac 之后，难免会有些情况下也还会不得不使用 Windows，毕竟很多软件可能只有 Windows 版本，但用 Mac 我就不推荐装双系统了，直接装虚拟机就好了，Mac 上虚拟机软件有两款比较好用，一个就是著名的 VMware，另一个就是 Parallels Desktop，这两款我都使用过，觉得都非常不错，现在用的是 VMware。 推荐指数：★★★★☆</p>
                  <h3 id="CleanMyMac"><a href="#CleanMyMac" class="headerlink" title="CleanMyMac"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#cleanmymac" target="_blank" rel="noopener"></a>CleanMyMac</h3>
                  <p>很多时候用着用着磁盘就不够用了，如果你的 Mac 硬盘是 512GB 的倒还好，256GB 的你就得多注意一下了，另外 1T 定制版土豪请绕道，这款软件不适合你。 CleanMyMac 可以非常方便地帮助我们扫描缓存、大文件、废纸篓、残留项等内容，清理这些内容之后我们可以节省很多硬盘空间，另外它还支持软件卸载和残留清扫功能，可以帮我们非常干净地移除 Mac 中的软件，目前应该是出到第三版了，非常推荐。 推荐指数：★★★★☆</p>
                  <h2 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%BC%96%E8%BE%91%E5%99%A8" target="_blank" rel="noopener"></a>编辑器</h2>
                  <p>既然做程序开发嘛，不配置好自己的开发环境怎么行，下面推荐一下我平常使用的开发软件。</p>
                  <h3 id="JetBrains"><a href="#JetBrains" class="headerlink" title="JetBrains"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#jetbrains" target="_blank" rel="noopener"></a>JetBrains</h3>
                  <p>我目前使用的 IDE 是 JetBrains 全家桶，目前我编写 Python 比较多，所以主要使用 PyCharm，另外写前端的时候也会使用 WebStorm，写 Java 就用 IntelliJ IDEA，C、C++ 用 CLion，PHP 的话就用 PhpStorm，Ruby 的话就用 RubyMine，其他的语言用的就少了，就没有装了。 当然有的小伙伴会说 JetBrains 系列的 IDE 需要购买啊？我只想说，国人的力量是无穷的，在网上其实可以搜到各种破解方法，如 License Server 验证，你能搜到各种五花八门的 License Server。另外 JetBrains 还有专门的 Educational Programs，可以来这里申请：<a href="https://www.jetbrains.com/education/programs/?fromMenu" target="_blank" rel="noopener">https://www.jetbrains.com/education/programs/?fromMenu</a>，学生、老师或教育工作者可以使用学校的 edu 邮箱申请免费的 License，如果你还是学生的话，那么申请是十分方便的，因为我还是个学生，我目前就在使用学生套餐，当然如果你已经工作的话也可以向正在上学的弟弟妹妹们借一下嘛。 总之我个人比较喜欢 JetBrains 全家桶，不论是页面风格还是开发习惯我都比较喜欢，推荐使用。 推荐指数：★★★★☆</p>
                  <h3 id="Sublime"><a href="#Sublime" class="headerlink" title="Sublime"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#sublime" target="_blank" rel="noopener"></a>Sublime</h3>
                  <p>有时候我们可能下载了或接收了一些单个的文本文件，我们只想看看文本文件内容是什么，或者对其再做一些简单的修改操作，这时候就没必要单独用 JetBrains 的 IDE 打开了，显得有点重了。或者有时候需要修改某个配置文件，这时候也需要一个比较好用的编辑器。我使用的就是 Sublime，对于一些日常的文本编辑是足够了，另外 Sublime 还可以扩展好多插件，配置好了功能上基本不输 JetBrains IDE，非常推荐。 推荐指数：★★★★</p>
                  <h3 id="MarkEditor"><a href="#MarkEditor" class="headerlink" title="MarkEditor"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#markeditor" target="_blank" rel="noopener"></a>MarkEditor</h3>
                  <p>现在越来越多的写作平台开始支持 MarkDown，不得不说这确实是一门提高文字生产效率的语言，写 MarkDown 我强烈推荐 MarkEditor，我之前尝试过各种 MarkDown 写作软件，觉得都不如这款好用，如 Typora、MWeb、GitBook 等等。 MarkEditor 支持写作及预览模式，更重要的是支持文件管理，很多软件如 Typora 只能打开单个的 Makrdown 文件，不能打开整个文件夹，这就很鸡肋了。另外 MarkEditor 支持直接插入图片，如我们截了一张图或者刚从网上复制了一张图，在 MarkEditor 里面直接粘贴就可以了，它会自动把这张图保存到当前目录下，同时生成 Makrdown 格式的的图片链接，不能更方便了！另外还支持主题自定义、样式自定义，还可以快速插入某些 Makrdown 元素，还支持 Latex 公式，还可以快速导出电子书，快速生成文稿网页，快速局域网共享，功能应有尽有，强烈推荐！ 这个软件我购买了 Pro 版，解锁了全部功能，订购地址：<a href="https://www.markeditor.com/" target="_blank" rel="noopener">https://www.markeditor.com/</a>，个人觉得物超所值！ 推荐指数：★★★★★</p>
                  <h3 id="SnippetLab"><a href="#SnippetLab" class="headerlink" title="SnippetLab"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#snippetlab" target="_blank" rel="noopener"></a>SnippetLab</h3>
                  <p>在写代码的时候，我们经常会有一些常用代码或者精华代码，或者一些常用的配置，想要单独保存下来复用，这时我们可能会把它保存到某个文本文件里面，更高级点可以使用云笔记，如有道云笔记或者印象笔记，用过 GitHub Gists 的小伙伴可能会选择 GitHub Gists，但我觉得这些都不是最佳的。 首先文本文件、云笔记里面其实并不是专门为了保存代码使用的，另外 GitHub Gists 保存操作并没有那么便捷，而且打开速度也很慢，影响体验。在这里推荐一款专门用来保存代码的软件叫做 SnippetLab，涉设计初衷就是为了保存短代码片的，它支持几乎所有编程语言，另外支持分类、分级、加标签、加描述等，另外它还可以和 Alfred 对接实现快速搜索查找，另外还支持备份、导出、云同步等各种功能，非常适合做代码片的管理。 推荐指数：★★★★</p>
                  <h3 id="Beyond-Compare"><a href="#Beyond-Compare" class="headerlink" title="Beyond Compare"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#beyond-compare" target="_blank" rel="noopener"></a>Beyond Compare</h3>
                  <p>有时候我们需要比较两个文件的不同之处，以便于快速得知两个版本的修改内容，我使用的软件是 Beyond Compare，个人觉得比较简洁好用，同时删除和添加的内容有对应的红绿颜色标识，推荐给大家使用。 推荐指数：★★★☆</p>
                  <h2 id="管理工具"><a href="#管理工具" class="headerlink" title="管理工具"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7" target="_blank" rel="noopener"></a>管理工具</h2>
                  <p>有时候我们需要管理很多文件，或者还需要远程管理很多终端设备，在这里推荐几款比较好用的工具。</p>
                  <h3 id="Filezlla"><a href="#Filezlla" class="headerlink" title="Filezlla"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#filezlla" target="_blank" rel="noopener"></a>Filezlla</h3>
                  <p>有时候我们需要管理一些远程的服务器，比如 Linux 服务器。那么如何和这些服务器之间传递数据和文件呢？这里推荐一个轻便简洁的软件 Filezlla，它支持 FTP、SFTP 等协议类型，使用它我们可以方便地进行文件传输和远程文件管理。 推荐指数：★★★</p>
                  <h3 id="ForkLift"><a href="#ForkLift" class="headerlink" title="ForkLift"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#forklift" target="_blank" rel="noopener"></a>ForkLift</h3>
                  <p>Mac 上的 Finder 你是不是已经受够了？在一些方面做得相当不友好，例如在当前打开的目录下新建一个空白文件，在当前的目录下打开命令行工具等等，有了 ForkLift 这些都是小意思了。另外 ForkLift 还集成了 Filezlla 的功能，利用它我们还可以像普通文件管理器一样管理远程的主机内容，它还支持 FTP、SFTP、SMB、WebDAV、NFS 等等各种协议。同时界面也非常美观，有了它，几乎可以抛弃 Finder 和 Filezlla 了，强烈推荐！ 推荐指数：★★★★☆</p>
                  <h3 id="SSH-Shell"><a href="#SSH-Shell" class="headerlink" title="SSH Shell"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#ssh-shell" target="_blank" rel="noopener"></a>SSH Shell</h3>
                  <p>我们经常会和各种服务器打交道，例如我们经常使用 SSH 来远程连接某台 Linux 服务器，原生 Terminal 是支持 SSH 的，但你会发现原生带的这个太难用了。可能很多小伙伴使用 iTerm，不得不说这确实是个神器，大大方便了远程管理流程。但我在这里还要推荐一个我经常使用的 SSH Shell，没错，它的名字就是 SSH Shell，它的页面操作简洁，同时管理和记录远程主机十分方便，另外还支持秘钥管理、自动重连、自定义主题等等功能，个人用起来十分顺手，强烈推荐！ 推荐指数：★★★★☆</p>
                  <h3 id="HomeBrew、CakeBrew"><a href="#HomeBrew、CakeBrew" class="headerlink" title="HomeBrew、CakeBrew"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#homebrewcakebrew" target="_blank" rel="noopener"></a>HomeBrew、CakeBrew</h3>
                  <p>对于开发者来说，这个软件几乎是 Mac 上必备的一个软件，它的官方简介就是 “The missing package manager for macOS”，算是 Mac 上的一个软件包平台，它里面包含着非常多的 Mac 开发软件包，比如 Python、PHP、Redis、MySQL、RabbitMQ、HBase 等等，几乎你能想到的开发软件都集成在里面了，堪称神器！ 它的安装也非常简单，参见这里：<a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a>，另外 HomeBrew 也有对应的图形界面，叫做 CakeBrew，如果不喜欢命令行操作的话可以使用 CakeBrew 来代替。 推荐指数：★★★★★</p>
                  <h2 id="影音图像"><a href="#影音图像" class="headerlink" title="影音图像"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E5%BD%B1%E9%9F%B3%E5%9B%BE%E5%83%8F" target="_blank" rel="noopener"></a>影音图像</h2>
                  <h3 id="IINA"><a href="#IINA" class="headerlink" title="IINA"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#iina" target="_blank" rel="noopener"></a>IINA</h3>
                  <p>这个必须要赞一下，非常强大简洁好用的视频播放器，是 GitHub 上的一个开源软件，链接是：<a href="https://lhc70000.github.io/iina/" target="_blank" rel="noopener">https://lhc70000.github.io/iina/</a>，播放控制、视频设置、音频设置、字幕设置、文件操作，几乎你能想到的应有尽有，而且无广告，简洁清爽，支持的视频格式也十分广泛，推荐使用！ 推荐指数：★★★★</p>
                  <h3 id="ScreenFlow"><a href="#ScreenFlow" class="headerlink" title="ScreenFlow"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#screenflow" target="_blank" rel="noopener"></a>ScreenFlow</h3>
                  <p>之前我曾录制过一些 Python 的视频课程，本来尝试过 QuickTime 录制，可是实在是太难用了，另外视频剪辑、音频剪辑等又是个麻烦事。后来我就使用了 ScreenFlow，它集录制、剪辑、配音、字幕、特效等功能于一体，另外录制质量，渲染质量也是一流，大大提高了我的效率，堪称神器！ 推荐指数：★★★★☆</p>
                  <h3 id="iPic"><a href="#iPic" class="headerlink" title="iPic"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#ipic" target="_blank" rel="noopener"></a>iPic</h3>
                  <p>有时候我们在写 MarkDown 的时候，可能突然需要一张插入一张图片，比如我们想插入一张屏幕截图，我们就需要把这张图片先存下来，然后加上图片的路径，如果转发给别人还需要连着图片一并发给对方，这其实是不怎么方便的，倘若这张图片是一张来自网络的图片，我们直接用 HTTP 访问的话，那岂不是方便太多了？ 要将图片传到网上分几步？三步。第一步，把上传页面打开，第二步，把图片传到网上并把传后链接拷贝下来，第三步，把上传页面关闭。简直是太麻烦了对不对？另外找个合适的图床也是个麻烦事啊，七牛？又拍？你不得又得申请和注册。那么有了 iPic，一切就不是难事了，它可以监听 Mac 的粘贴板，一旦我们复制了一张图或者新截了一张图，它就能显示到待上传队列里面，我们点一下它就会把图片上传到网络上，然后生成上传后的链接，默认使用的是新浪的图床，网速也非常快。有了它，传图什么的都不是事了！另外付费版还支持各种自定义图床，如七牛云、又拍云、阿里云、腾讯云等等。 推荐指数：★★★★☆</p>
                  <h3 id="PixelMator"><a href="#PixelMator" class="headerlink" title="PixelMator"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#pixelmator" target="_blank" rel="noopener"></a>PixelMator</h3>
                  <p>在 Windows 上我们常用 PS 来修改和处理图片，Mac 上我是没有使用 PS，使用了 PixelMator，个人觉得使用这款软件能完全胜任 PS 的工作，一般的图片设计、排版、抠图、特效、蒙版等操作都支持，我个人比较喜欢使用这款软件做设计。 推荐指数：★★★★</p>
                  <h3 id="Polarr-Photo-Editor"><a href="#Polarr-Photo-Editor" class="headerlink" title="Polarr Photo Editor"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#polarr-photo-editor" target="_blank" rel="noopener"></a>Polarr Photo Editor</h3>
                  <p>这个软件又名“泼辣修图”，类似 Mac 上的美图秀秀，它自带了各种后期滤镜，还带有 Lightroom 的很多调光调色的工具，能够帮我们快速对照片进行后期处理，效果也还不错，当然比不上 Photoshop 和 Lightroom 那么专业，但对于快速进行后处理的小伙伴来说不失为一个好的选择。 推荐指数：★★★★</p>
                  <h3 id="Boom2"><a href="#Boom2" class="headerlink" title="Boom2"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#boom2" target="_blank" rel="noopener"></a>Boom2</h3>
                  <p>我有边工作边听歌的习惯，所以音乐几乎离不开我的生活，入了个好耳机，那当然就得配上好音乐。大家肯定也听说过音效均衡器，我们可以调整不同的音效参数来达到不同的声音效果，如电子音、人声、环绕、重低音等等，在 Mac 上我觉得最好用的就是 Boom2 了，它内置了各种音效均衡器，还有一些高保真效果的渲染，效果非常给力。我一般听歌的时候就会把 Boom2 开起来，享受不一样的音效感觉，美哉。 推荐指数：★★★★</p>
                  <h2 id="趣味扩展"><a href="#趣味扩展" class="headerlink" title="趣味扩展"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#%E8%B6%A3%E5%91%B3%E6%89%A9%E5%B1%95" target="_blank" rel="noopener"></a>趣味扩展</h2>
                  <p>另外还有几个比较有意思的工具推荐下。</p>
                  <h3 id="Tickeys"><a href="#Tickeys" class="headerlink" title="Tickeys"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tickeys" target="_blank" rel="noopener"></a>Tickeys</h3>
                  <p>使用过机械键盘吗？按键感觉和声音很爽吧，但是用了 Mac，你如果不使用外接键盘的话，想必手感就差上不少，但这款软件或许可以拯救一下，它可以模拟机械键盘的按键声，每次按键都有有机械键盘清脆的声音，我平时戴耳机撸代码的时候就会开着这个软件，感觉体验还是不错的，建议尝试一下。 推荐指数：★★★☆</p>
                  <h3 id="Duet"><a href="#Duet" class="headerlink" title="Duet"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#duet" target="_blank" rel="noopener"></a>Duet</h3>
                  <p>Duet 这款软件可以将 iPad 或 iPhone 变成电脑的扩展屏幕，如果你有一个大屏的比如 12.9 寸的 iPad 的话，非常建议你尝试一下这款软件，这样如果正你在用 Mac 不用 iPad 的话，完全可以用 Duet 把 iPad 和电脑屏幕连接起来来扩展显示，充分利用资源。 推荐指数：★★★☆ 好了，暂时推荐这么多，其实还有很多很多，尤其是专门针对于开发者的一些工具，这些就太偏极客化了，后面再为大家整理一些好用的开发者工具，敬请期待。 还不尽兴的小伙伴可以关注 GitHub 上的一个仓库叫 awesome-mac，里面列出来了 Mac 上推荐的非常多的软件，总结得非常非常详细，链接是：<a href="https://github.com/jaywcjlove/awesome-mac" target="_blank" rel="noopener">https://github.com/jaywcjlove/awesome-mac</a>，大家可以去看下。</p>
                  <h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a><a href="https://github.com/Germey/AI/blob/master/%E3%80%90Mac%E3%80%91Mac%E4%B8%8A%E6%8E%A8%E8%8D%90%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88.md#tips" target="_blank" rel="noopener"></a>Tips</h2>
                  <p>可能有的小伙伴好奇我的 Launchpad 为啥能放那么多图标，是怎么做到的？其实很简单，几行代码就搞定了。 调整每列显示图标数量，这里以 7 为例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock springboard-<span class="keyword">rows</span> -<span class="type">int</span> <span class="number">7</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>调整每行显示图标的数量，这里以 8 为例：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock springboard-<span class="keyword">columns</span> -<span class="type">int</span> <span class="number">8</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面两行代码最后的数字可以自行修改。 修改完了之后还需要重置一下 Launchpad，代码如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">defaults <span class="keyword">write</span> com.apple.dock ResetLaunchPad -<span class="type">bool</span> <span class="keyword">TRUE</span>;killall Dock</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，这样我们就可以自由定制我们的 Launchpad 图标数量啦！ 另外，还有的小伙伴会说，很多软件都需要花钱购买啊，咋办？告诉你个网址：<a href="http://xclient.info/" target="_blank" rel="noopener">http://xclient.info/</a>，几乎你想找的破解版都有，别说别的了，雷锋也别叫了，省下的钱打赏给我一点就行哈哈。 以上就是我的一些 Mac 常用软件分享及 Tips，希望对大家有帮助！ 另外大家如有还有推荐的软件，欢迎留言给我，非常感谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-07-03 02:35:47" itemprop="dateCreated datePublished" datetime="2018-07-03T02:35:47+08:00">2018-07-03</time>
                </span>
                <span id="/6146.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐一些Mac上比较好用的软件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">崔庆才的个人站点，记录生活的瞬间，分享学习的心得。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">519</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">21</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">122</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.abuyun.com/http-proxy/introduce.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/88au8.jpg" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ikkq9.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/599/" style="font-size: 10px;">599</a> <a href="/tags/Bootstrap/" style="font-size: 11.25px;">Bootstrap</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11.25px;">Eclipse</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/GitHub/" style="font-size: 11.25px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 11.25px;">PHP</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/PySpider/" style="font-size: 10px;">PySpider</a> <a href="/tags/Python/" style="font-size: 16.25px;">Python</a> <a href="/tags/Python3/" style="font-size: 12.5px;">Python3</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 10px;">Selenium</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/Ubuntu/" style="font-size: 11.25px;">Ubuntu</a> <a href="/tags/Vue/" style="font-size: 11.25px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13.75px;">WordPress</a> <a href="/tags/object-Object/" style="font-size: 10px;">[object Object]</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11.25px;">matlab</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/style/" style="font-size: 10px;">style</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/uwsgi/" style="font-size: 10px;">uwsgi</a> <a href="/tags/validate-cert/" style="font-size: 10px;">validate_cert</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/wamp/" style="font-size: 10px;">wamp</a> <a href="/tags/wineQQ/" style="font-size: 10px;">wineQQ</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 11.25px;">七牛</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 10px;">上海</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/" style="font-size: 10px;">个人网站</a> <a href="/tags/%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">主题</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 10px;">云存储</a> <a href="/tags/%E4%BA%AC%E4%B8%9C%E4%BA%91/" style="font-size: 10px;">京东云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 10px;">人工智能</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">代码</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size: 10px;">位运算</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 10px;">分享</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 10px;">创业</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 11.25px;">前端</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%8E%9F%E7%94%9FAPP/" style="font-size: 10px;">原生APP</a> <a href="/tags/%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 12.5px;">反爬虫</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80/" style="font-size: 10px;">响应式布局</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A/" style="font-size: 10px;">域名绑定</a> <a href="/tags/%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84/" style="font-size: 10px;">大众点评</a> <a href="/tags/%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">字体反爬虫</a> <a href="/tags/%E5%AE%9E%E7%94%A8/" style="font-size: 10px;">实用</a> <a href="/tags/%E5%B4%94%E5%BA%86%E6%89%8D/" style="font-size: 18.75px;">崔庆才</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE/" style="font-size: 10px;">手机访问</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">旅游</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9D%9C%E5%85%B0%E7%89%B9/" style="font-size: 10px;">杜兰特</a> <a href="/tags/%E6%A1%8C%E9%9D%A2/" style="font-size: 10px;">桌面</a> <a href="/tags/%E6%B1%9F%E5%8D%97/" style="font-size: 10px;">江南</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 10px;">环境变量</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">生活笔记</a> <a href="/tags/%E7%99%BB%E5%BD%95/" style="font-size: 10px;">登录</a> <a href="/tags/%E7%9F%A5%E4%B9%8E/" style="font-size: 10px;">知乎</a> <a href="/tags/%E7%9F%AD%E4%BF%A1/" style="font-size: 10px;">短信</a> <a href="/tags/%E7%BA%B8%E5%BC%A0/" style="font-size: 10px;">纸张</a> <a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 10px;">网站</a> <a href="/tags/%E8%82%89%E5%A4%B9%E9%A6%8D/" style="font-size: 10px;">肉夹馍</a> <a href="/tags/%E8%A5%BF%E5%B0%91%E7%88%B7/" style="font-size: 10px;">西少爷</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">远程</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">配置</a> <a href="/tags/%E9%87%8D%E8%A3%85/" style="font-size: 10px;">重装</a> <a href="/tags/%E9%9D%99%E8%A7%85/" style="font-size: 17.5px;">静觅</a> <a href="/tags/%E9%A2%A0%E8%A6%86/" style="font-size: 10px;">颠覆</a> <a href="/tags/%E9%A3%9E%E4%BF%A1/" style="font-size: 10px;">飞信</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">13</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">38</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">256</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">10</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">75</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ou6mm.jpg">
                  </span>
                  <span class="link">
                    <a href="https://diygod.me/" target="_blank" rel="noopener">DIYgod</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.jankl.com/img/titleshu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.jankl.com/" target="_blank" rel="noopener">liberalist</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/4i7yf.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lizenghai.com/" target="_blank" rel="noopener">Python量化投资</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/22uv1.png">
                  </span>
                  <span class="link">
                    <a href="http://www.cenchong.com/" target="_blank" rel="noopener">岑冲博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ev9kl.png">
                  </span>
                  <span class="link">
                    <a href="http://www.zxiaoji.com/" target="_blank" rel="noopener">张小鸡</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.chrafz.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.chrafz.com/" target="_blank" rel="noopener">张弦先生</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://seofangfa.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://seofangfa.com/" target="_blank" rel="noopener">方法SEO</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lfmj3.png">
                  </span>
                  <span class="link">
                    <a href="http://frankchen.xyz/" target="_blank" rel="noopener">不正经数据科学家</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/129d8.png">
                  </span>
                  <span class="link">
                    <a href="https://www.bysocket.com/" target="_blank" rel="noopener">泥瓦匠BYSocket</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/262r1.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.ysir308.com/" target="_blank" rel="noopener">程序员虾说</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">2.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">37:35</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": null,
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
