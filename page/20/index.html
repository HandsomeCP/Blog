<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": true,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "天验",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "华为云",
            "enable": false,
            "url": "https://activity.huaweicloud.com/2020_618_promotion/index.html?bpName=5f9f98a29e2c40b780c1793086f29fe2&bindType=1&salesID=wangyubei",
            "src": "https://qiniu.cuiqingcai.com/y42ik.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "张小鸡",
            "enable": false,
            "url": "http://www.zxiaoji.com/",
            "src": "https://qiniu.cuiqingcai.com/fm72f.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "Luminati",
            "src": "https://qiniu.cuiqingcai.com/ikkq9.jpg",
            "url": "https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095",
            "width": "100%",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/20/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="崔庆才">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="PHP">
  <meta property="article:tag" content="Java">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Spider">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Web">
  <meta property="article:tag" content="Kubernetes">
  <meta property="article:tag" content="深度学习">
  <meta property="article:tag" content="机器学习">
  <meta property="article:tag" content="数据分析">
  <meta property="article:tag" content="网络">
  <meta property="article:tag" content="IT">
  <meta property="article:tag" content="技术">
  <meta property="article:tag" content="博客">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/20/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://cuiqingcai.com/5052.html"><img title="Python3网络爬虫开发实战教程" src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/1052.html"><img title="Python2爬虫学习系列教程" src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 20 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2353.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/2353.html" class="post-title-link" itemprop="url">关于HTML内联元素一侧留白的浅谈</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h2>
                  <p>在写代码的时候遇到了如下问题： 使用了bootstrap框架来编写了一个页面，其中input元素两侧留有空白。然而用JS动态添加的同样的元素却不会出现这种情况。具体截图表现如下： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226212230.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226212230.png" alt="20151226212230"></a> 我们可以发现，第一行和而三行的代码是完全一样的，可是呈现的结果是截然不同的。 <a href="http://res.cuiqingcai.com/demo/inline.html" target="_blank" rel="noopener">在线测试样例</a> 大家是不是觉得很奇怪？没错，我也是。中间的那个缝隙是哪里来的呢？</p>
                  <h2 id="刨根问底"><a href="#刨根问底" class="headerlink" title="刨根问底"></a>刨根问底</h2>
                  <p>在这里感谢 <a href="http://wonderlee.me" target="_blank" rel="noopener">wonder</a> 同学的大力相助，才得以找到问题的所在。 出现此问题的原因在于：</p>
                  <blockquote>
                    <p>html中的内联元素在书写代码时，如果两元素代码之间有换行，浏览器会将其解释为空格。而这个空格是会被当作一个空白节点（nodeType等于3的节点，就是文字节点）</p>
                  </blockquote>
                  <p>所以，因为代码中我使元素呈现 inline 的属性，然后两个代码之间具有换行，所以二者之间出现了空白。正常情况下，二者之间是不应该出现空白的。然而用 jQuery 生成元素的时候，因为是用的 + 连接符，所以换行符被忽略了。也就是代码是连接起来的，所以二者之间便不会出现空白。 解决方法： 1.将原代码中的input写到一行。如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;div <span class="keyword">class</span>="form-group"&gt;</span><br><span class="line">    &lt;<span class="keyword">input</span> <span class="keyword">class</span>="form-control inline span3" <span class="type">name</span>="education[school][]" <span class="keyword">type</span>="text" <span class="keyword">value</span>="123"&gt;&lt;<span class="keyword">input</span> <span class="keyword">class</span>="form-control inline span3" <span class="type">name</span>="education[date][]" <span class="keyword">type</span>="text" <span class="keyword">value</span>="456"&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>2.或者在JS代码中加入换行符。如下：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="symbol">'butto</span>n').on(<span class="symbol">'clic</span>k', function() &#123;</span><br><span class="line">        $('&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-group"</span>&gt;'+</span><br><span class="line">            '&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control inline span3"</span> name=<span class="string">"education[school][]"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> value=<span class="string">""</span>&gt;\n'+</span><br><span class="line">            '&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control inline span3"</span> name=<span class="string">"education[date][]"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> value=<span class="string">""</span>&gt;'+</span><br><span class="line">        '&lt;/div&gt;').appendTo($(<span class="string">".content"</span>));</span><br><span class="line">    &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上两种方式，解决方法都比较简单实用。其他的改变 padding 或者 margin 的方法就不推荐了。 好了，那么明白了之后，我们肯定要可以举一反三的，来探究一下如果是块级元素会不会这样呢？</p>
                  <h2 id="举一反三"><a href="#举一反三" class="headerlink" title="举一反三"></a>举一反三</h2>
                  <p>好的，让我们试一下块级元素如果设置为 inline的话会不会也这样。 把 input 标签改成 div，然后给它加上 display: inline 属性，加一下背景颜色区分，观察一下效果。 代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>点击按钮添加元素<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">        display: inline;</span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#555</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>观察一下效果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220135.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220135.png" alt="20151226220135"></a> 嗯，果然，它的间距还是出现了。 那么改成 display: inline-block 呢？</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#555</span>;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220326.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220326.png" alt="20151226220326"></a> 可见间距还是有的。 我们把 div 的换行去掉，看一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220443.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151226220443.png" alt="20151226220443"></a> Perfect！它已经消失不见了！ 以上，在chrome，edge，ie11测试通过。</p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>通过以上研究我们可以得出如下结论： 内联元素，代码中带有换行，会出现空白间距。块级元素，设置了内联样式，且代码中带有换行，也会出现空白间距。 解决方法是删除代码中的换行即可。 以上是在写程序过程中发现的现象，希望能对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-01-02 22:08:42" itemprop="dateCreated datePublished" datetime="2016-01-02T22:08:42+08:00">2016-01-02</time>
                </span>
                <span id="/2353.html" class="post-meta-item leancloud_visitors" data-flag-title="关于HTML内联元素一侧留白的浅谈" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/455.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/455.html" class="post-title-link" itemprop="url">干货！IT小伙伴们实用的网站及工具大集合！持续更新！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>1.Git 还在担心自己辛辛苦苦写的代码被误删了吗？还在担心自己改错了代码不能挽回吗？还在苦恼于多人开发合作找不到一个好的工具吗？那么用Git就对了，Git是一个开源的分布式版本控制系统，用以有效、高速的处理从很小到非常大的项目版本管理。有了它，代码托管不是问题，版本控制不再苦恼，多人开发变得简单易行。 链接：<a href="http://git-scm.com/" target="_blank" rel="noopener">http://git-scm.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142208-e1416810150194.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142208-1024x341.jpg" alt="QQ截图20141124142208"></a> 2.GitHub 学会了Git之后，我们把代码托管到哪里呢？在此推荐给大家两个网站，GitHub，一个是国外免费的代码托管平台。许许多多的开源项目几乎都托管在上面，你也可以在上面搜一些你需要的源代码，丰富资源应有尽有，如果还不知道这个，是不是已经Out了呢？ 链接：<a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142704-e1416810453291.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142704-1024x415.jpg" alt="QQ截图20141124142704"></a> 3.GitCafe 和GitHub一样，也是一个免费的代码托管平台。GitHub是国外的，GitCafe是国内的。两者功能几乎相同，不喜欢英文版的朋友可以来GitCafe尝尝鲜。 链接：<a href="http://gitcafe.com/" target="_blank" rel="noopener">http://gitcafe.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143049-e1416810670667.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143049-1024x484.jpg" alt="QQ截图20141124143049"></a> 4.七牛云存储 还在为自己项目的图片等资源没处存放而着急吗？还在担心图片加载耗费你主机大量流量吗？还在为你自己的网站加载速度过慢而揪心吗？云时代，就要用云存储。 比如我有一个虚拟主机是每月限流量的，而大量的图片加载占据了我网站访问流量的大部分，这时我们就可以考虑将图片移植到七牛云存储上，图片通过七牛来加载，节省宝贵的主机空间和流量。比如我的个人网站已经移植到了七牛，所有网页图片的加载都是从七牛上获取，速度快而且省流量。而且免费的七牛还提供了图片处理，比如压缩，水印等各种图片加工方式，想要什么有什么。 链接：<a href="http://www.qiniu.com/" target="_blank" rel="noopener">http://www.qiniu.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143837-e1416811137547.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143837-1024x432.jpg" alt="QQ截图20141124143837"></a> 5.云适配 有时候我们做出的网站没有用到响应式布局，也可能我们的网站DIV的像素宽度已经规定成具体的多少像素了。所以，用手机访问的时候可能就会出现这样那样的问题，或者显示得很小，或者整个布局全都乱掉了。这时，我们需要把自己的网站适配一下，那么在此推荐一个网站，云适配。插入一行代码，通过在线修改和生成手机适配效果，得到手机访问的网页最佳适配效果，方便而又快捷。这时电脑和手机均能看到最佳适配效果了。 链接：<a href="http://www.yunshipei.com/" target="_blank" rel="noopener">http://www.yunshipei.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124144434-e1416811549465.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124144434-1024x404.jpg" alt="QQ截图20141124144434"></a> 6.聚合数据 大家在开发过程中，可能会用到各种各样的数据，想找一些接口来提供一些数据。比如天气预报查询，火车时刻表查询，彩票查询，身份证查询等等。有了这个接口，直接调用即可。各种各样的API接口满足你。 链接：<a href="http://www.juhe.cn/" target="_blank" rel="noopener">http://www.juhe.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150336-e1416812634424.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150336-1024x439.jpg" alt="QQ截图20141124150336"></a> 7.够快云库 够快云库，是基于云存储的团队协作性文件管理平台。 团队成员可以同步共享资料，即时沟通交流，便捷移动办公，从而实现团队的100％高效运作。比如团队开发过程中有什么要共享的资料，就可以放到里面。支持在线编辑和修改，小组讨论合作等方式。 链接：<a href="http://www.gokuai.com/" target="_blank" rel="noopener">http://www.gokuai.com/</a><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150727-e1416812868208.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150727-1024x370.jpg" alt="QQ截图20141124150727"></a> 8.SAE SAE的强大不用多说了，强大的虚拟主机提供商。提供各种各样的编程语言在线运行，同时提供云存储Storage，各种数据库，应用十分广泛。不仅提供代码托管，还提供在线服务器运行，JAVA，PHP，Python等等的支持应有尽有，在这里你可以假设你自己的网站，你的应用接口，你的创意应用。好不好，用用就知道。另外还有JAE（京东），BAE（百度），功能类似，也推荐一下。 链接：<a href="http://sae.sina.com.cn/" target="_blank" rel="noopener">http://sae.sina.com.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124151607-e1416813413924.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124151607-1024x360.jpg" alt="QQ截图20141124151607"></a> 9.多备份 多备份提供了主机的文件备份及数据库的备份。可能对于文件的备份大家都已经有其他方法了，不过数据库的自动备份现在还没有多少有效的解决方法，人工备份又显得比较麻烦。如果数据库有数据丢失，那就不好找回了。在此推荐一个网站：多备份。提供主机的文件自动备份和数据库自动备份，方便快捷。 链接：<a href="http://www.dbfen.com/" target="_blank" rel="noopener">http://www.dbfen.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152121-e1416813698270.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152121-1024x410.jpg" alt="QQ截图20141124152121"></a> 10.慕课网 学习IT知识哪家强？在此为大家推荐一个全免费的学习网站，资源丰富，还提供了比较创新的学习和练习相结合的方式。感觉非常不错，讲解得也很有条理，推荐一下。 链接：<a href="http://www.imooc.com/" target="_blank" rel="noopener">http://www.imooc.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152408-e1416813887400.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152408-1024x410.jpg" alt="QQ截图20141124152408"></a> 11.W3SCHOOL 这也是一个非常棒的学习网站，讲解简单易懂，我的PHP入门，HTML，JS，CSS入门都是从这里学到的，感觉讲解非常不错。 链接：<a href="http://www.w3school.com.cn/" target="_blank" rel="noopener">http://www.w3school.com.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152659-e1416814040907.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152659-1024x393.jpg" alt="QQ截图20141124152659"></a> 12.阿里云 感觉比较不错的主机提供商，提供免费备案，对于ECS的管理做得非常好，数据恢复和备份及监控也应有尽有，另外提供了SLB，RDS，CDN等等的支持，个人感觉很不错的主机提供商。就是价格略贵！ 链接：<a href="http://www.aliyun.com/" target="_blank" rel="noopener">http://www.aliyun.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153235.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153235-1024x322.jpg" alt="QQ截图20141124153235"></a> 13.DNSPod 免费的域名解析提供商，管理方便，简洁高效。非常人性化的提示，还提供域名D监控等功能，方便实用。 链接：<a href="https://www.dnspod.cn/" target="_blank" rel="noopener">https://www.dnspod.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153637-e1416814632344.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153637.jpg" alt="QQ截图20141124153637"></a> 14.WordPress 一款开源的PHP框架，搭建个人博客网站最实用的选择之一。我的个人网站就是基于此搭建，甚至你都不需要懂PHP你就可以搭建自己的个人网站。提供强大的后台文章管理和插件及主题管理，几乎可以满足个人网站所有需求。 P.S.找个好的网站模板，你就相当于成功了一大半。 链接：<a href="http://cn.wordpress.org/" target="_blank" rel="noopener">http://cn.wordpress.org/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154227-e1416814969553.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154227.jpg" alt="QQ截图20141124154227"></a> 15.BootStrap 一个强大的前端框架，有了它你再也不需要敲那么多行的样式表，再也不用一点点地调试难看的DIV了。直接调用各种CSS样式，分分钟写出好看的网页界面。按钮、表格、进度条、提示框、输入框、菜单，应有尽有。 链接：<a href="http://www.bootcss.com/" target="_blank" rel="noopener">http://www.bootcss.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154554.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154554-1024x428.jpg" alt="QQ截图20141124154554"></a> 16.芒果广告 如果你开发了自己的移动应用，想添加广告来赚钱，推荐芒果广告。它是一个综合的移动广告平台，聚合了百度广告、多盟广告、易传媒等等广大广告商，可以自己定制广告显示的内容及样式，可以选择各种广告的投放比例。广告点击量、展现量详细报告、收入分析详细数据应有尽有。推荐一下。 链接：<a href="http://www.adsmogo.com/" target="_blank" rel="noopener">http://www.adsmogo.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154953.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154953-1024x488.jpg" alt="QQ截图20141124154953"></a> 17.极光推送 极光推送，使得开发者可以即时地向其应用程序的用户推送通知或者消息，与用户保持互动，从而有效地提高留存率，提升用户体验</p>
                  <p>平台提供整合了Android推送、iOS推送的统一推送服务。让用户可以更好地接收你推送的内容。 链接：<a href="https://www.jpush.cn/" target="_blank" rel="noopener">https://www.jpush.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155237.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155237-1024x434.jpg" alt="QQ截图20141124155237"></a> 18.Bmob 提供强大的后台接口支持，移动开发过程中可能需要各种各样的后台接口，直接利用这个，你可以创建自己的后台接口。它还提供了强大的游戏后端支持数据，文档和教程也是非常的完备，为移动开发带来相当大的便利。 链接：<a href="http://www.bmob.cn/" target="_blank" rel="noopener">http://www.bmob.cn/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155600.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155600-1024x560.jpg" alt="QQ截图20141124155600"></a></p>
                  <p>19.有道云笔记 大多数人都听说过吧？在学习或者开发过程中可能会有各种各样的知识点，好记性不如烂笔头。最好的方式就是记录下来。在此推荐一个笔记，有道云笔记。在使用了各种笔记工具之后，发现还是有道好用。它提供了个人云笔记，云协作等功能，做到PC、手机、平板等多处同步。占用小，界面美观，使用方便。 链接：<a href="http://note.youdao.com/" target="_blank" rel="noopener">http://note.youdao.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124160008.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124160008-1024x496.jpg" alt="QQ截图20141124160008"></a> 20.Coding 集合了GitHub和SAE的功能，利用Git上传代码，并对代码进行托管，而且提供了一键部署和运行的功能。提供了代码监控功能，通过自动化静态代码分析等管理工具，发现代码问题，获取代码度量信息，及时了解代码质量状况。一个新兴网站，推荐一下！ 链接：<a href="https://coding.net" target="_blank" rel="noopener">https://coding.net</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161059.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161059-1024x349.jpg" alt="QQ截图20141124161059"></a> 21.SendCloud 开发过程中你可能会遇到邮件发送的功能，用了SendCloud，一切都方便多了，它提供免费的邮件代发功能。邮件发送的难题，就交给它来解决吧。 链接：<a href="http://sendcloud.sohu.com/" target="_blank" rel="noopener">http://sendcloud.sohu.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161409.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161409-1024x403.jpg" alt="QQ截图20141124161409"></a> 22.蒲公英 有时候你发布Android市场，发布Appstore，会花费相当多的时间才能得到审核通过。那么在团队之间，想团队之间提供内测功能，那么就可以用到它啦，这里提供了一个发布应用的平台，发布之后，生成链接和二维码，即可实现下载测试，简单方便。 链接：<a href="http://www.pgyer.com/" target="_blank" rel="noopener">http://www.pgyer.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161757.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161757-1024x396.jpg" alt="QQ截图20141124161757"></a> 23.DCloud HTML5现在已经定稿，用HTML5开发APP的浪潮即将袭来，在此提供一个免费的开发网站。它提供了一个HBuilder的工具，以及H5APP开发文档及H5APP的开发框架MUI框架，有了它，H5APP的开发变得相当简单，而我也在蠢蠢欲动。 链接：<a href="http://www.dcloud.io/" target="_blank" rel="noopener">http://www.dcloud.io/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162042.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162042-1024x485.jpg" alt="QQ截图20141124162042"></a> 24.青云 提供免费的云服务器、云存储、云数据库的功能。同时提供多个开放API，功能实用，非常强大。 链接：<a href="https://www.qingcloud.com/" target="_blank" rel="noopener">https://www.qingcloud.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162338.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162338-1024x425.jpg" alt="QQ截图20141124162338"></a> 25.云测 开发了应用之后到哪里去测试？选择云测没错。它提供应用云测试、手机游戏测试，提供崩溃分析。一切测试由它来搞定。 链接：<a href="http://www.testin.cn" target="_blank" rel="noopener">http://www.testin.cn</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162721.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162721-1024x403.jpg" alt="QQ截图20141124162721"></a> 26.Meteor Meteor 是一个构建在 Node.js 之上的平台，用来开发实时网页程序。Meteor 位于程序数据库和用户界面之间，保持二者之间的数据同步更新。 链接：<a href="https://www.meteor.com/" target="_blank" rel="noopener">https://www.meteor.com/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/屏幕快照-2016-02-21-14.04.17.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/屏幕快照-2016-02-21-14.04.17-1024x462.png" alt="屏幕快照 2016-02-21 14.04.17"></a> 暂时先分享给大家这么多！如果有好的网站或者应用推荐，欢迎与我交流，可以评论，可以留言！以上是一些比较实用的网站和工具的分享！希望能给大家的生活和开发带来一定的便利！Thanks！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-12-24 16:32:36" itemprop="dateCreated datePublished" datetime="2015-12-24T16:32:36+08:00">2015-12-24</time>
                </span>
                <span id="/455.html" class="post-meta-item leancloud_visitors" data-flag-title="干货！IT小伙伴们实用的网站及工具大集合！持续更新！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2322.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2322.html" class="post-title-link" itemprop="url">使用PGP加密你的文件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>有时候，一些文件是不想公开让被人看到的，或者只想某些特定的人看到。 比如说，你要上交一个实验报告啦，老师给了一个FTP上传目录，但是你只想让老师看到报告，而不想公开给同学们看。这时候，就需要加密一下你的文件啦。 那么有什么好的加密方式呢？PGP，你的不二之选。</p>
                  <h2 id="PGP加密原理"><a href="#PGP加密原理" class="headerlink" title="PGP加密原理"></a>PGP加密原理</h2>
                  <p>用直白的话来讲就是 对方给你一个公钥，他自己也保存了一个私钥，你利用他的公钥来加密，只有对方自己用自己私钥才能解密。由于其他的人没有拿到私钥，所以解不开的，即使是你自己，也解不开的。所以，这样就保证了，只有你和对方可以查看内容。 引用详解原理：</p>
                  <blockquote>
                    <p>PGP(Pretty Good Privacy)，是一个基于RSA公钥加密体系的邮件加密软件。可以用它对邮件保密以防止非授权者阅读，它还能对邮件加上数字签名从而使收信人可以确认邮件的发送者，并能确信邮件没有被篡改。它可以提供一种安全的通讯方式，而事先并不需要任何保密的渠道用来传递密匙。它采用了一种RSA和传统加密的杂合算法，用于数字签名的邮件文摘算法，加密前压缩等，还有一个良好的人机工程设计。它的功能强大，有很快的速度。 PGP是一种供大众使用的加密软件。电子邮件通过开放的网络传输，网络上的其他人都可以监听或者截取邮件，来获得邮件的内容，因而邮件的安全问题就比较突出了。保护信息不被第三者获得，这就需要加密技术。还有一个问题就是信息认证，如何让收信人确信邮件没有被第三者篡改，这就需要数字签名技术。RSA公钥体系的特点使它非常适合用来满足上述两个要求：保密性（Privacy)和认证性（Authentication）。 RSA（Rivest-Shamir-Adleman）算法是一种基于大数不可能质因数分解假设的公匙体系。简单地说就是找两个很大的质数，一个公开即公钥，另一个不告诉任何人，即私钥。这两个密匙是互补的，就是说用公匙加密的密文可以用私匙解密，反过来也一样。 假设甲要寄信给乙，他们互相知道对方的公匙。甲就用乙的公匙加密邮件寄出，乙收到后就可以用自己的私匙解密出甲的原文。由于没别人知道乙的私匙，所以即使是甲本人也无法解密那封信，这就解决了信件保密的问题。另一方面由于每个人都知道乙的公匙，他们都可以给乙发信，那么乙就无法确信是不是甲的来信。这时候就需要用数字签名来认证。</p>
                  </blockquote>
                  <h2 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h2>
                  <p>在 Windows 下，有一个非常强大的工具，叫做 PGP Desktop，可以利用这个来加密。 <a href="http://pan.baidu.com/s/1dEznwe1" target="_blank" rel="noopener">下载链接</a> 这个是 64 位的安装包，安装过程我就不详细描述了，比较简单。如果你的系统是 32 位，那么请再寻找一下其他的安装包。 安装之后，搜索一下开始菜单或者安装目录，找到 PGP Desktop，打开它。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003158.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003158.png" alt="20151215003158"></a> 打开之后界面是这个样子的 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003312.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003312-1024x664.png" alt="20151215003312"></a> 恩，别人应该给了你公钥了对吧，比如，这次老师的公钥是</p>
                  <figure class="highlight excel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">Versi<span class="symbol">on:</span> PGPfreeware <span class="number">6.5</span>.<span class="number">8</span> for non-commercial use &lt;ht<span class="symbol">tp:</span>//www.pgp.com&gt;</span><br><span class="line"></span><br><span class="line">mQCNA1NKJuwAAAEEAMvdBmw1TTTkLTL6w9C28MhtVnsWtNeHVJl98CFCzOveyKDH</span><br><span class="line">KGPf/RA4moDUE1IkkUelRKJV1O2JlcqBZPOGI/FII/<span class="number">6</span>yq/DbNHKOKhz6fgbbdgxh</span><br><span class="line">UArjUSthA/BPnodTcEtGZHlGSvK7n3TcWmGY700YB9crWpbyHfVQ7KLGc3SlAAUR</span><br><span class="line">tCF0ZXN0NGNyeXB0byA8dGVzdDRjcnlwdG9AMTYzLmNvbT6JAJUDBRBTSibs9VDs</span><br><span class="line">osZzdKUBAQzxBACr3UpakH7SMtU9OgHHZCARE4xKVChTBCh9kquhhU5Kr9Er0AHy</span><br><span class="line">UWO1BD+z58VTu9XPR2/NSrCOGNwfZVqZTY8eTUTuQVJKpAR9CNtRi0B6yQa8pQVm</span><br><span class="line"><span class="number">7</span>vfEqzBcsWcPkOzfRU75Ubdc+IxZkdMcPfPnzn1kU2cTKUIlM5+cy/+qvw==</span><br><span class="line">=nNyG</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>来，添加一下，有一个非常简单的方法就是直接右键粘贴，然后确定就好了。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003737.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003737.png" alt="20151215003737"></a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003953.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215003953.png" alt="20151215003953"></a> 然后，你可以把这个公钥加到你的 Master Keys 里。 点击，菜单中的 Tools -&gt; PGP Options -&gt; Master Keys -&gt; Add -&gt; add -&gt; OK，按照图示箭头操作即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011210.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011210-1024x596.png" alt="20151215011210"></a> 然后，确定，邮件点一下 添加到 Master Keys。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011305.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011305.png" alt="20151215011305"></a> 会提示成功添加。然后接下来就进行加密吧。 点左侧的 PGP ZIP，然后 New PGP Zip，然后选择文件，点击确定。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215004710.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215004710.png" alt="20151215004710"></a> 然后直接下一步 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215004802.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215004802.png" alt="20151215004802"></a> 直接下一步 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011736.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011736.png" alt="20151215011736"></a> 然后下一步，选择导出路径即可 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011755.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151215011755.png" alt="20151215011755"></a> 下一步，导出成功，加密完成。 导出的文件格式就是原文件名加了 pgp 后缀，只有对方的私钥可以解开。 当然如果有不死心的小伙伴想破解，自己试试咯~</p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>以上，为了便于演示，我直接将秘钥添加到了 Master Key 中，其实这个 Master Key 当然最好是你自己专属的秘钥咯，不过无所谓啦，我们只是为了演示一下加密过程，利用这个公钥加密，不要在意这些细节。 小伙伴们体验一下吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-12-15 01:23:40" itemprop="dateCreated datePublished" datetime="2015-12-15T01:23:40+08:00">2015-12-15</time>
                </span>
                <span id="/2322.html" class="post-meta-item leancloud_visitors" data-flag-title="使用PGP加密你的文件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2286.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2286.html" class="post-title-link" itemprop="url">计算机网络探究四之使用FreeNAS提供网络硬盘</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="FreeNAS简介"><a href="#FreeNAS简介" class="headerlink" title="FreeNAS简介"></a>FreeNAS简介</h2>
                  <p>FreeNAS 是什么？ FreeNAS 是一款广受赞誉的开源免费 NAS 操作系统。它能把普通台式机瞬间变成一台多功能 NAS 服务器。不但适用于企业文件共享，同样适用于打造家庭媒体中心。 FreeNAS 支持多种共享协议，包括 SMB/CIFS、NFS、AFP、WebDAV、iSCSI、FTP/TFTP、RSync等。 <a href="http://www.getnas.com/" target="_blank" rel="noopener">官方网站</a></p>
                  <h2 id="iSCSI"><a href="#iSCSI" class="headerlink" title="iSCSI"></a>iSCSI</h2>
                  <p>iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI技术是一种新储存技术，该技术是将现有SCSI接口与以太网络(Ethernet)技术结合，使服务器可与使用IP网络的储存装置互相交换资料。 iSCSI：Internet 小型计算机系统接口 （iSCSI：Internet Small Computer System Interface）。</p>
                  <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
                  <p>那么本篇文章的目标就是记录一下怎样使用 FreeNAS 配置一个输入我们的网络存储服务。</p>
                  <h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2>
                  <p>首先我们要下载 FreeNAS的镜像，由于FreeNAS 9 对系统的要求比较高，在这里我们用到的是 FreeNAS 8。 <a href="http://pan.baidu.com/s/1geb2C1t" target="_blank" rel="noopener">镜像下载</a> 下载完成之后我们利用 VMware安装即可。 安装界面提供了四个选项：</p>
                  <ol>
                    <li>Install/Upgrade 安装/升级</li>
                    <li>Shell 终端</li>
                    <li>Reboot System 重启系统</li>
                    <li>Shutdown System 关闭系统</li>
                  </ol>
                  <p><img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171248.png" alt="20150129171248"> 使用键盘上的方向键切换菜单，选择第一项，按回车键确认。 接下来系统会提示选择 FreeNAS 系统盘，在如下图所示的界面中会显示出所有可以用作安装 FreeNAS 系统的设备。你需要根据自己界面上显示的实际内容进行选择，此处应该选择我们准备作为 FreeNAS 系统盘的另一块U盘，选择好以后按回车键确认。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171601.png" alt="20150129171601"> 此时，界面上显示了一些警告信息，大意为“你选择作为 FreeNAS 系统盘的设备上的所有数据都会被清空，而且该设备将完全被系统占用，不能用作数据存储。” 按回车键确认。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171850.png" alt="20150129171850"> 确认后，系统开始执行安装，如下图所示。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172137.png" alt="20150129172137"> 系统安装完成后会给出成功提示，提醒我们移除安装盘，如下图。不用理会，按回车键继续。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172300.png" alt="20150129172300"> 此时，系统又回到了最初的安装界面，如下图所示。用方向键切换选择第四项，按回车键关闭系统。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172526.png" alt="20150129172526"> 待系统完全关闭以后，再次启动电脑，并设置从 U盘系统盘引导，成功启动以后，看到如下所示的界面，代表系统已经安装完成。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171035.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171035.png" alt="20151213171035"></a> 接下来，你可以使用浏览器访问界面中给出的 IP 地址打开 FreeNAS 的 WebGUI 管理界面了。</p>
                  <h2 id="网页配置"><a href="#网页配置" class="headerlink" title="网页配置"></a>网页配置</h2>
                  <p>接下来，我们就可以通过浏览器来配置我们的 FreeNAS了。 通过系统的提示，我们访问以下链接即可： <a href="http://192.168.231.131/" target="_blank" rel="noopener">http://192.168.231.131/</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171159.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171159-1024x549.png" alt="20151213171159"></a> 访问之后，可以看到如上内容。 点击 setting，先切换一下语言，简体中文。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171352.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171352.png" alt="20151213171352"></a> 接下来我们便开始iSCSI的配置啦。</p>
                  <h2 id="iSCSI配置"><a href="#iSCSI配置" class="headerlink" title="iSCSI配置"></a>iSCSI配置</h2>
                  <p>1.首先开启iSCSI服务，然后点击右侧的设置图标进入设置界面。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213173030.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213173030.png" alt="20151213173030"></a> 2.添加iSCSI端口，选择默认设置即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171558.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171558.png" alt="20151213171558"></a> 3.添加网络授权信息 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171648.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171648.png" alt="20151213171648"></a> 两个全部填写为ALL即可。 4.添加iSCSI用户信息 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171733.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171733.png" alt="20151213171733"></a> 填入用户信息和秘钥即可，下方的输入框是加密可选的。 5.添加iSCSI属性信息 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171855.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171855.png" alt="20151213171855"></a> 6.添加存储设备 在这里我们首先要添加一块磁盘，在VMware中的设置里添加一块磁盘，在这里分配为20G。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171951.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213171951.png" alt="20151213171951"></a><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172007.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172007.png" alt="20151213172007"></a> 在FreeNAS设置界面中，添加扩展设备。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172115.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172115.png" alt="20151213172115"></a> 7.关联目标 将用户信息和磁盘信息关联起来。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172143.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172143.png" alt="20151213172143"></a> 通过以上流程，我们便完成了一个网络硬盘的配置。</p>
                  <h2 id="Windows使用"><a href="#Windows使用" class="headerlink" title="Windows使用"></a>Windows使用</h2>
                  <p>好，配置好了网络硬盘，那么我们就在Windows下使用一下吧，Windows 7 以上的系统自带了 iSCSI 服务。 我们可以直接在控制面板里面找到它。在控制面板中搜索。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172329.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172329.png" alt="20151213172329"></a> 然后，会出现一个属性设置窗口。点击发现，发现门户，输入刚才FreeNAS的地址即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172518.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172518.png" alt="20151213172518"></a> 接下来在目标的选项卡中我们会看到刚才配置的一个目标，点击下方的连接即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172541.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172541.png" alt="20151213172541"></a> 连接成功之后，我们便可以完成连接了。 打开磁盘设置，我们便可以看到那个20G的磁盘了，然后新建简单卷。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172806.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172806.png" alt="20151213172806"></a> 格式化为NTFS系统，刷新一下，打开计算机。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172840.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151213172840.png" alt="20151213172840"></a> 我们可以发现，一个新的网络磁盘便安装成功啦。 可以向其中放置任何文件，与其他的磁盘没有任何区别！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>FreeNAS是一个非常强大的工具，在这里我们只涉及到了 iSCSI 服务的使用，还有更多等待着我们的探索，小伙伴们快来试验一下吧。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-12-13 17:42:50" itemprop="dateCreated datePublished" datetime="2015-12-13T17:42:50+08:00">2015-12-13</time>
                </span>
                <span id="/2286.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究四之使用FreeNAS提供网络硬盘" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2266.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/2266.html" class="post-title-link" itemprop="url">VS中OpenSSL环境配置示例</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近在研究信息安全，需要用到OpenSSL库，我用到的开发IDE是VS2012，所以，在这里也记录一下我配置VS2012的OpenSSL库的过程。</p>
                  <h2 id="下载OpenSSL库"><a href="#下载OpenSSL库" class="headerlink" title="下载OpenSSL库"></a>下载OpenSSL库</h2>
                  <p>OpenSSL库大家可以自行下载源码然后用ruby进行编译，另外我们也可以选择直接下载编译好的类库。 这里我们利用的后者，在此提供一个下载链接。 <a href="http://pan.baidu.com/s/1dEs1nxR" target="_blank" rel="noopener">OpenSSL-Win32</a> 下载完成之后解压，比如我的放到了D盘。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162627.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162627.png" alt="20151207162627"></a></p>
                  <h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2>
                  <p>首先，我们找一段测试代码，在此利用的是 AES 算法的示例。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/aes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>+<span class="number">1</span>] = <span class="string">"my-key-i-choosed"</span>; <span class="comment">// 128bits key (应该是真正的随机数才好)</span></span><br><span class="line">	<span class="keyword">char</span> pt1[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>] = <span class="string">"0123456789abcdef12345"</span>;   <span class="comment">// 明文</span></span><br><span class="line">	<span class="keyword">char</span> ct[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>];  <span class="comment">// 密文</span></span><br><span class="line">	<span class="keyword">char</span> pt2[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>]; <span class="comment">// 解密后的明文</span></span><br><span class="line"></span><br><span class="line">	AES_KEY k;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> iv1[<span class="number">16</span>+<span class="number">1</span>] = &#123;<span class="string">"1023456789abcdef"</span>&#125;; <span class="comment">// 16+1，加密用</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> iv2[<span class="number">16</span>+<span class="number">1</span>] = &#123;<span class="string">"1023456789abcdef"</span>&#125;; <span class="comment">// 16+1，解密用</span></span><br><span class="line"></span><br><span class="line">	&#123;	<span class="comment">// single blcok test</span></span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k); </span><br><span class="line">		AES_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt1, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, &amp;k);</span><br><span class="line"></span><br><span class="line">		AES_set_decrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k);</span><br><span class="line">		AES_decrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt2, &amp;k);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">memcmp</span>(pt1, pt2, <span class="number">16</span>)==<span class="number">0</span>)</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES block ok"</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES block err"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#123;	<span class="comment">// cfb mode (stream mode)</span></span><br><span class="line">		<span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k); </span><br><span class="line">		AES_cfb128_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt1, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct,</span><br><span class="line">			<span class="number">16</span>+<span class="number">5</span>, &amp;k, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)iv1, &amp;num, AES_ENCRYPT);</span><br><span class="line"></span><br><span class="line">		num=<span class="number">0</span>;</span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k); <span class="comment">// MUST as enc</span></span><br><span class="line">		AES_cfb128_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt2,</span><br><span class="line">			<span class="number">16</span>+<span class="number">5</span>, &amp;k, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)iv2, &amp;num, AES_DECRYPT);		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">memcmp</span>(pt1, pt2, <span class="number">16</span>+<span class="number">5</span>)==<span class="number">0</span>)</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES CFB mode ok"</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES CFB mode err"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来新建一个项目，win32控制台程序，空项目，完成。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207161749.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207161749.png" alt="20151207161749"></a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207161824.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207161824.png" alt="20151207161824"></a> 新建源文件，我取名叫做 aes.cpp，将代码复制进去，可以看到代码最初是在报错的。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162418.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162418.png" alt="20151207162418"></a> 好，接下来我们进行环境配置。</p>
                  <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
                  <p>右键项目名称，弹出一个菜单，选择属性。 在VC++目录选项卡中，添加包含目录和库目录。 在这里，我的包含目录就是刚才解压的OpenSSL目录的include目录，库目录则是lib目录。 <strong>注意：分号要是英文分号，英文分号！</strong> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162929.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207162929.png" alt="20151207162929"></a> 接下来选择连接器选项卡，输入libeay.lib和ssleay32.lib两个附加依赖项。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207163915.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207163915.png" alt="20151207163915"></a> 现在右击项目，重新生成。 我们可以看到，程序可以正常生成exe了。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164034.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164034.png" alt="20151207164034"></a> 但是直接运行的话会报错，是因为缺少dll文件。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164304.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164304.png" alt="20151207164304"></a> 之后，将项目中的libeay32.dll和ssleay32.dll文件放入项目的debug目录即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164444.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164444.png" alt="20151207164444"></a> 最后项目的debug目录如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164405.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164405.png" alt="20151207164405"></a> 重新运行exe程序，发现已经正常运行。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164736.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/12/20151207164736.png" alt="20151207164736"></a> 至此，VS配置OpenSSL环境的过程已经全部完成。 其他项目类似，大家可以试着配一下。 如有问题，欢迎留言交流~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-12-07 16:50:54" itemprop="dateCreated datePublished" datetime="2015-12-07T16:50:54+08:00">2015-12-07</time>
                </span>
                <span id="/2266.html" class="post-meta-item leancloud_visitors" data-flag-title="VS中OpenSSL环境配置示例" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2249.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/2249.html" class="post-title-link" itemprop="url">WordPress从Apache迁移到Apache过程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近服务器要过期了，需要进行迁移，新服务器如果上面配置的是Apache服务器该怎么办呢？ 系统：Ubuntu 14.04</p>
                  <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
                  <p>首先新主机上配置好apache环境，这个就不多说了，直接执行下面的命令即可。</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get install apache2</span><br><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br><span class="line">sudo apt-get install mysql-server mysql-client</span><br><span class="line">sudo apt-get install libapache2-mod-php5</span><br><span class="line">sudo apt-get install libapache2-mod-auth-mysql</span><br><span class="line">sudo apt-get install phpmyadmin</span><br><span class="line">sudo ln -s /usr/share/phpmyadmin/ /var/www/html/phpmyadmin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上配置，新主机便可以实现lamp环境的配置了。</p>
                  <h2 id="代码迁移"><a href="#代码迁移" class="headerlink" title="代码迁移"></a>代码迁移</h2>
                  <p>首先旧主主机上打包一下代码，比如一个文件夹名字叫 wonder</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zcvf</span> <span class="selector-tag">wonder</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> <span class="selector-tag">wonder</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后，打包完成之后，便会出现一个名字叫做 wonder.tar.gz 的文件 可以利用wget方式直接下载。</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget <span class="string">http:</span><span class="comment">//xxx.xxx.xxx.xxx/wonder.tar.gz</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下载完成之后，直接解压即可。 这样代码就取到了。</p>
                  <h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2>
                  <p>数据库迁移无非就是在phpmyadmin之间导入导出，这个很简单。 但是重要的一点是，需要把 wp-options 表中的两个URL配置改掉，比如原来是一个域名链接，现在需要改为 IP+文件名。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128144223.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128144223-1024x351.png" alt="20151128144223"></a> 否则，浏览器会提示重定向循环的问题。</p>
                  <h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2>
                  <p>首先我们需要将域名解析到这个主机。 配置示例域名：wonderlee.me <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128144413.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128144413.png" alt="20151128144413"></a> 然后配置一下，vhost，在apache下配置是这样的 首先在 /etc/apache2/apache2.conf 中加入如下两行</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># <span class="meta-keyword">Include</span> all the user configurations:</span></span><br><span class="line">Include httpd.conf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后我们需要在 httpd.conf 配置一下域名解析 新建一个 /etc/apach2/httpd.conf，加入如下内容</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ServerName <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span>&gt; </span><br><span class="line">  DocumentRoot /var/www/html</span><br><span class="line">  ServerName   <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span></span><br><span class="line">&lt;/VirtualHost&gt; </span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span>&gt; </span><br><span class="line">  DocumentRoot /var/www/html/wonder</span><br><span class="line">  ServerName   wonderlee.me</span><br><span class="line">  ServerAlias  wonderlee.me</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后执行服务器重启操作。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>apache2 restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，这样的话我们的域名配置解析就好了。 输入 wonderlee.me 即可解析到 wonder 文件夹啦。 可以输入你的域名试试看，已经可以了吧。 然后我们需要开启 rewrite模块。 输入命令</p>
                  <figure class="highlight coq">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo a2enmod <span class="built_in">rewrite</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后修改 /etc/apache2/apache2.conf 文件</p>
                  <figure class="highlight apache">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">	<span class="attribute">AllowOverride</span> None</span><br><span class="line">	<span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>改为</p>
                  <figure class="highlight apache">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">	<span class="attribute">AllowOverride</span> <span class="literal">All</span></span><br><span class="line">	<span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可，结束之后重启一下服务器。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>apache2 restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在项目目录下新建一个文件 .htaccess，来支持重写</p>
                  <figure class="highlight apache">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># BEGIN WordPress</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /wonder/</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^index\.php$ -<span class="meta"> [L]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> . /wonder/index.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># END WordPress</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，这样，重写过程就完成啦。</p>
                  <h2 id="网站配置"><a href="#网站配置" class="headerlink" title="网站配置"></a>网站配置</h2>
                  <p>最后，需要将网站的配置修改一下，比如固定链接 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128145507.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128145507.png" alt="20151128145507"></a> 比如网站的基地址 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128145620.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151128145620.png" alt="20151128145620"></a> 至此，网站配置工作全部完成，欢乐地上网体验一下吧 如有问题，欢迎留言。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-11-28 14:59:07" itemprop="dateCreated datePublished" datetime="2015-11-28T14:59:07+08:00">2015-11-28</time>
                </span>
                <span id="/2249.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress从Apache迁移到Apache过程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2227.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/2227.html" class="post-title-link" itemprop="url">WordPress从Apache迁移到Nginx过程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>之前一直都用Apache服务器，由于网站访问量比较大，另外加上旧服务器快到期了，准备迁移到新的服务器上，所以决定采用Nginx服务器。 迁移过程比较心酸，之前一直用apache，对nginx服务器配置不熟悉，踩了很多坑。下面说一下我的网站从旧主机（配有apache服务器）迁移到新主机（配有nginx服务器）的过程。</p>
                  <h2 id="代码迁移"><a href="#代码迁移" class="headerlink" title="代码迁移"></a>代码迁移</h2>
                  <p>这个过程其实也是比较心酸的，查看了一下目录结构占用空间已经足足快1个G了，可想而知里面占用的大部分空间是上传的图片素材。 不过要是迁移全部图片的话工程量实在是巨大。不过，好消息是我从开始就使用了七牛CDN加速，所以，上传的图片会自动存放到七牛，只不过也在主机本地留了备份而已，所以，我可以安心地删掉它们了。 那么对代码进行瘦身之后，这里就有两种方法来迁移了： 1.可以用git上传到github，然后用另一台主机把代码拉下来即可，在此不再赘述。 2.打包上传，然后直接在另一台主机上下载下来，由于我的两台主机在同一局域网内，所以我直接采用了这种方式，传输速度快。</p>
                  <h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3>
                  <p>由于代码中含有 .git 目录，所以这部分我们不需要打包，那么压缩时我们就需要排除这个文件夹。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151113155701-e1447401563242.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/11/20151113155701-e1447401563242.png" alt="20151113155701"></a> 文件夹名叫cqc，那么我们就打包一下，排除.git目录，使用如下命令</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tar -zcvf cqc<span class="selector-class">.tar</span><span class="selector-class">.gz</span> --exclude=cqc/<span class="selector-class">.git</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结束后会出现 cqc.tar.gz 文件，这就是目录压缩包。 然后我们只需要在另一台主机上输入</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget <span class="string">http:</span><span class="comment">//xxx.xxx.xxx.xxx/cqc.tar.gz</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可完成下载，速度可是嗖嗖的 然后解压即可，代码便完成了迁移。</p>
                  <h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2>
                  <p>数据库用二者的phpmyadmin导出和上传即可。我导出 .sql 文件，大小为9M，而phpMyAdmin的上传限制大小是2M，怎么办？其实我们可以压缩 .sql 文件为 zip格式，压缩之后就有了1.4M了，分分钟完成上传。要知道 phpMyAdmin 可是支持 .sql.zip 文件的。 接下来是一个比较重要的部分，那就是配置一下站点信息。直接修改数据库的两个URL。 分别是 siteurl 和 home，一定要修改为 <a href="http://xxx.xxx.xxx.xxx/cqc" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx/cqc</a> 的形式，也就是把原来的域名改成IP加目录的形式，要不然网站是无法访问的，会出现多重循环定向的提示。 好，其他的没什么问题，连接数据库错误的话就修改一下目录的 wp-config.php 文件吧，连接数据库的信息修改正确就好了。</p>
                  <h2 id="配置vhosts"><a href="#配置vhosts" class="headerlink" title="配置vhosts"></a>配置vhosts</h2>
                  <p>和 apache 一样，我们多个域名肯定要可以解析到不同的目录吧，nginx 当然也是支持的。 接下来我们需要把新域名解析到 cqc 目录，在 nginx 下怎么做呢？其实还是比较简单的。 在 /etc/nginx 目录下可以新建一个 vhosts文件夹。在这里我们要解析 cqc 目录，那么我就新建一个 cqc.conf 文件。 现在例如我要把 blog.cuiqingcai.com 解析到 cqc 文件夹，配置如下</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span> cuiqingcai.com blog.cuiqingcai.com;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">	<span class="attribute">root</span> /var/www/cqc;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/wp-.*)</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/.*\.php)$</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php <span class="literal">last</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">		<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">	<span class="comment">#	# With php5-fpm:</span></span><br><span class="line">	<span class="comment">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">		<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">		<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www/cqc<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">		<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/wp-.*)</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/.*\.php)$</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php <span class="literal">last</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这一部分是伪静态重写，因为我的博客用的是wordpress，所以伪静态重写是这样的。当然还有其他的重写方式可以尝试。 之后在 /etc/nginx/nginx.conf 中的 http{} 中添加一行</p>
                  <figure class="highlight gradle">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">include</span> <span class="regexp">/etc/</span>nginx<span class="regexp">/vhosts/</span>cqc.conf;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则代表引用了这个文件。 注意，还要把 域名设置一下，添加一条A记录到主机上。 好了，一切大功告成了。</p>
                  <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
                  <p>迁移和配置的过程坑实在是太多了，列列吧，警醒世人呐。 （1）代码迁移过程上传git，整个项目差不多1个G，由于数据量太大，导致内存不够无法正常上传。后来删除了图片，发现项目还是很大，结果发现是 .git 目录已经占用了上百兆，后来打包排除这个目录迁移的。 （2）数据库迁移的时候由于phpMyAdmin上传大小限制，修改了一番上传大小结果发现没生效，还倒腾了一下php-fpm，后来发现可以直接上传压缩包，那就分分钟完成了。 （3）配置完之后发现网站首页正常访问了，可是其他页面全部出现了404错误，后来配置了一番伪静态解析发现配置代码直接写在了 localhost server里面，后来发现可以直接新写一个 server，然后配置域名servername，然后配置伪静态重写才成功。 总之，坎坷是多，但是，自己慢慢摸索出来，也是一种不错的体验。 当你成功之后，会觉得世界又是那么美好。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-11-13 16:59:27" itemprop="dateCreated datePublished" datetime="2015-11-13T16:59:27+08:00">2015-11-13</time>
                </span>
                <span id="/2227.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress从Apache迁移到Nginx过程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2200.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Java <i class="label-arrow"></i>
                  </a>
                  <a href="/2200.html" class="post-title-link" itemprop="url">Android开发之2048安卓版</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>之前是在eclipse上写的，后面换成了android sudio。 2048游戏的UI整体可以采用线性布局，即LinearLayout，其中嵌套一个线性布局和一个GridLayout，内嵌的线性布局填充文本框，以显示分数，GridLayout中填充4x4的继承自FrameLayout的card类作为主要的游戏界面。由于大部分操作都在GridLayout中进行，可以自定义一个继承自GridLayout的类GameView，类中定义判定上下左右滑动的方法和每次滑动后自动添加一个随机数字的方法以及每次滑动后判断游戏是否可以继续进行的方法。 主布局activity_main.xml代码如下</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">    android:id=<span class="string">"@+id/container"</span></span><br><span class="line">	<span class="comment">//match_parent表示布局充满整个屏幕</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    tools:context=<span class="string">"com.example.administractor.game2048.MainActivity"</span></span><br><span class="line">	<span class="comment">//里面的组件垂直放置</span></span><br><span class="line">    android:orientation=<span class="string">"vertical"</span></span><br><span class="line">    tools:ignore=<span class="string">"MergeRootFrame"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">	<span class="comment">//宽度充满整个屏幕，高度自适应。</span></span><br><span class="line">        android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:orientation=<span class="string">"horizontal"</span> &gt;</span><br><span class="line">		<span class="comment">//显示当前分数的文本框</span></span><br><span class="line">        &lt;TextView android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:text=<span class="string">"Your Score:"</span>/&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvScore"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span>/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">	<span class="comment">//使用自定义的GridLayout</span></span><br><span class="line">    &lt;com<span class="selector-class">.example</span><span class="selector-class">.administractor</span><span class="selector-class">.game2048</span>.GameView</span><br><span class="line">        android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"0dp"</span></span><br><span class="line">        android:layout_weight=<span class="string">"1"</span></span><br><span class="line">        android:id=<span class="string">"@+id/GameView"</span> &gt;</span><br><span class="line">    &lt;/com<span class="selector-class">.example</span><span class="selector-class">.administractor</span><span class="selector-class">.game2048</span>.GameView&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>GameView.java：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">package com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import android.app.AlertDialog;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.DialogInterface;</span><br><span class="line">import android.graphics.Point;</span><br><span class="line">import android.util.AttributeSet;</span><br><span class="line">import android.view.MotionEvent;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.GridLayout;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> GameView extends GridLayout &#123;</span><br><span class="line"><span class="comment">//调用类构造方法</span></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>, <span class="params">int</span> <span class="params">defStyle</span>)</span> &#123;</span><br><span class="line">        super(context, attrs, defStyle);</span><br><span class="line">        <span class="comment">//初始化游戏</span></span><br><span class="line">		<span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>)</span> &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        <span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>)</span> &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        <span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> void <span class="constructor">InitGameView()</span>&#123;</span><br><span class="line">		<span class="comment">//设置为4x4个方格</span></span><br><span class="line">        set<span class="constructor">ColumnCount(4)</span>;</span><br><span class="line">		<span class="comment">//设置背景颜色</span></span><br><span class="line">        set<span class="constructor">BackgroundColor(0xffeee4da)</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//判定滑动方向</span></span><br><span class="line">        set<span class="constructor">OnTouchListener(<span class="params">new</span> OnTouchListener()</span> &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="built_in">float</span> startx,starty,offsetx,offsety;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean on<span class="constructor">Touch(View <span class="params">v</span>, MotionEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">                switch(event.get<span class="constructor">Action()</span>)&#123;</span><br><span class="line">                    case MotionEvent.ACTION_DOWN:</span><br><span class="line">                        startx=event.get<span class="constructor">X()</span>;</span><br><span class="line">                        starty=event.get<span class="constructor">Y()</span>;</span><br><span class="line">                        break;</span><br><span class="line">                    case MotionEvent.ACTION_UP:</span><br><span class="line">                        offsetx=event.get<span class="constructor">X()</span>-startx;</span><br><span class="line">                        offsety=event.get<span class="constructor">Y()</span>-starty;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(offsetx)&gt;<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(offsety))&#123;</span><br><span class="line">                            <span class="keyword">if</span>(offsetx&lt;-<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Left()</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetx&gt;<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Right()</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="keyword">if</span>(offsety&lt;-<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Up()</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetx&gt;<span class="number">3</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Down()</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">                return <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//适应不同大小的屏幕</span></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">SizeChanged(<span class="params">int</span> <span class="params">w</span>, <span class="params">int</span> <span class="params">h</span>, <span class="params">int</span> <span class="params">oldw</span>, <span class="params">int</span> <span class="params">oldh</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">SizeChanged(<span class="params">w</span>, <span class="params">h</span>, <span class="params">oldw</span>, <span class="params">oldh</span>)</span>;</span><br><span class="line">        <span class="built_in">int</span> cardWidth=(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>min(h, w))/<span class="number">4</span>;</span><br><span class="line">        add<span class="constructor">Cards(<span class="params">cardWidth</span>,<span class="params">cardWidth</span>)</span>;</span><br><span class="line">        start<span class="constructor">Game()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//在4x4的方格上添加满卡片</span></span><br><span class="line">    public void add<span class="constructor">Cards(<span class="params">int</span> <span class="params">cardwidth</span>,<span class="params">int</span> <span class="params">cardheight</span>)</span>&#123;</span><br><span class="line">        Card c;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                c=<span class="keyword">new</span> <span class="constructor">Card(<span class="params">getContext</span>()</span>);</span><br><span class="line">                c.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                add<span class="constructor">View(<span class="params">c</span>, <span class="params">cardwidth</span>, <span class="params">cardheight</span>)</span>;</span><br><span class="line">                cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>=c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//游戏开始时每个卡片默认值设为0，并随机添加两张带数字的卡片</span></span><br><span class="line">    <span class="keyword">private</span> void start<span class="constructor">Game()</span>&#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.clear<span class="constructor">Score()</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        add<span class="constructor">RandomNum()</span>;</span><br><span class="line">        add<span class="constructor">RandomNum()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> void add<span class="constructor">RandomNum()</span> &#123;</span><br><span class="line">		<span class="comment">//使用emptypoints将数字为0的card提取出来，并随即选择一个空card赋值</span></span><br><span class="line">        emptyPoints.clear<span class="literal">()</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    emptyPoints.add(<span class="keyword">new</span> <span class="constructor">Point(<span class="params">x</span>,<span class="params">y</span>)</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Point p=emptyPoints.remove((<span class="built_in">int</span>)(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>random<span class="literal">()</span>*emptyPoints.size<span class="literal">()</span>));</span><br><span class="line">		<span class="comment">//2和4出现的概率控制在1：9</span></span><br><span class="line">        cardmap<span class="literal">[<span class="identifier">p</span>.<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">p</span>.<span class="identifier">y</span>]</span>.set<span class="constructor">Num(Math.<span class="params">random</span>()</span>&gt;<span class="number">0.1</span>?<span class="number">2</span>:<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//左滑方法</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Left()</span>&#123;</span><br><span class="line">		<span class="comment">//merge作为判断能否滑动的flag</span></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                for (<span class="built_in">int</span> x1 = x+<span class="number">1</span>; x1 &lt;<span class="number">4</span>; x1++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x1</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                            x--;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>))&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(merge)&#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//下滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Down()</span>&#123;</span><br><span class="line"></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> y = <span class="number">3</span>; y &gt;=<span class="number">0</span>; y--) &#123;</span><br><span class="line"></span><br><span class="line">                for (<span class="built_in">int</span> y1 = y-<span class="number">1</span>; y1 &gt;=<span class="number">0</span>; y1--) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y1</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line"></span><br><span class="line">                            y++;</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>)) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (merge) &#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//上滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Up()</span>&#123;</span><br><span class="line"></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line"></span><br><span class="line">                for (<span class="built_in">int</span> y1 = y+<span class="number">1</span>; y1 &lt; <span class="number">4</span>; y1++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y1</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line"></span><br><span class="line">                            y--;</span><br><span class="line"></span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>)) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (merge) &#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//右滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Right()</span>&#123;</span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">3</span>; x &gt;=<span class="number">0</span>; x--) &#123;</span><br><span class="line">                for (<span class="built_in">int</span> x1 = x-<span class="number">1</span>; x1 &gt;=<span class="number">0</span>; x1--) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x1</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            x++;</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>))&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(merge)&#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//如果有空卡片或者相邻的值相同卡片则游戏还能进行</span></span><br><span class="line">    public void check<span class="constructor">Complete()</span>&#123;</span><br><span class="line">        boolean complete=<span class="literal">true</span>;</span><br><span class="line">        ALL:</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt;<span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt;<span class="number">4</span>; x++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>==<span class="number">0</span><span class="pattern-match"><span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        x&gt;0<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x-1][y])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        x&lt;3<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x+1][y])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        y&gt;0<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x][y-1])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        y&lt;3<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x][y+1]))&#123;</span></span><br><span class="line"><span class="pattern-match">                    complete=<span class="literal">false</span>;</span></span><br><span class="line"><span class="pattern-match">                    break <span class="constructor">ALL</span>;</span></span><br><span class="line"><span class="pattern-match">                &#125;</span></span><br><span class="line"><span class="pattern-match">            &#125;</span></span><br><span class="line"><span class="pattern-match">        &#125;</span></span><br><span class="line"><span class="pattern-match">		<span class="operator">/</span><span class="operator">/</span>游戏结束弹出alert提示窗口</span></span><br><span class="line"><span class="pattern-match">        <span class="keyword">if</span>(complete)&#123;</span></span><br><span class="line"><span class="pattern-match">            <span class="keyword">new</span> <span class="constructor">AlertDialog</span>.<span class="constructor">Builder(<span class="params">getContext</span>()</span>).set<span class="constructor">Title(<span class="string">"大林哥温馨提示"</span>)</span>.set<span class="constructor">Message(<span class="string">"游戏结束"</span>)</span>.set<span class="constructor">PositiveButton(<span class="string">"重来"</span>,<span class="params">new</span> DialogInterface.OnClickListener()</span> &#123;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">                @<span class="constructor">Override</span></span></span><br><span class="line"><span class="pattern-match">                public void on<span class="constructor">Click(DialogInterface <span class="params">arg0</span>, <span class="params">int</span> <span class="params">arg1</span>)</span> &#123;</span></span><br><span class="line"><span class="pattern-match">                    start<span class="constructor">Game()</span>;</span></span><br><span class="line"><span class="pattern-match">                &#125;</span></span><br><span class="line"><span class="pattern-match">            &#125;).show();</span></span><br><span class="line"><span class="pattern-match">        &#125;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">    &#125;</span></span><br><span class="line"><span class="pattern-match">    <span class="keyword">private</span> <span class="constructor">Card</span>[][] cardmap=<span class="keyword">new</span> <span class="constructor">Card</span>[4][4];</span></span><br><span class="line"><span class="pattern-match">    <span class="keyword">private</span> <span class="constructor">List</span>&lt;<span class="constructor">Point</span>&gt; empty<span class="constructor">Points</span>=<span class="keyword">new</span> <span class="constructor">ArrayList</span>&lt;<span class="constructor">Point</span>&gt;();</span></span><br><span class="line"><span class="pattern-match">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>主类MainActivity.java：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">package</span> com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivity</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mainActivity=<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        tvscore = (TextView) findViewById(R.id.tvScore);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearScore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        score=<span class="number">0</span>;</span><br><span class="line">        showScore();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showScore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        tvscore.setText(score+<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addScore</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">        score+=s;</span><br><span class="line">        showScore();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TextView tvscore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MainActivity mainActivity=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MainActivity <span class="title">getMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mainActivity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Card.java：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">package com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Card</span> <span class="symbol">extends</span> <span class="symbol">FrameLayout</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Card(Context context) &#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        LayoutParams lp = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        View background = new View(getContext());</span><br><span class="line">		<span class="comment">//参数-1表示layoutparams填充满整个父容器</span></span><br><span class="line">        lp = new LayoutParams(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">		<span class="comment">//设置卡片之间有10像素的间隔</span></span><br><span class="line">        lp.setMargins(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        background.setBackgroundColor(<span class="number">0x33ffffff</span>);</span><br><span class="line">        addView(background, lp);</span><br><span class="line"></span><br><span class="line">        label = new TextView(getContext());</span><br><span class="line">        label.setTextSize(<span class="number">28</span>);</span><br><span class="line">        label.setGravity(Gravity.CENTER);</span><br><span class="line"></span><br><span class="line">        lp = new LayoutParams(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">        lp.setMargins(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        addView(label, lp);</span><br><span class="line"></span><br><span class="line">        setNum(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> n=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> getNum()&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//设置数字及对应的背景颜色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> setNum(<span class="built_in">int</span> n)&#123;</span><br><span class="line">        <span class="keyword">this</span>.n=n;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            label.setText(<span class="string">""</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            label.setText(n+<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (n) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0x00000000</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffeee4da</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffede0c8</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff2b179</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff59563</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff67c5f</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff65e3b</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">128</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedcf72</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">256</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedcc61</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">512</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc850</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1024</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc53f</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2048</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc22e</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xff3c3a32</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//判断卡片是否相等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span>ean equal(Card o)&#123;</span><br><span class="line">        <span class="keyword">return</span> getNum()==o.getNum();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TextView label;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> <img src="http://img.blog.csdn.net/20151031225217834?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""> <img src="http://img.blog.csdn.net/20151031225316437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/大龄锅" class="author" itemprop="url" rel="index">大龄锅</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-11-07 15:06:58" itemprop="dateCreated datePublished" datetime="2015-11-07T15:06:58+08:00">2015-11-07</time>
                </span>
                <span id="/2200.html" class="post-meta-item leancloud_visitors" data-flag-title="Android开发之2048安卓版" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2188.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Net <i class="label-arrow"></i>
                  </a>
                  <a href="/2188.html" class="post-title-link" itemprop="url">计算机网络探究三之搭建并连接VPN服务器</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="openvpn原理"><a href="#openvpn原理" class="headerlink" title="openvpn原理"></a>openvpn原理</h2>
                  <p>VPN直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道，OpenVPN无疑是Linux下开源VPN的先锋，提供了良好的性能和友好的用户GUI。 它大量使用了OpenSSL加密库中的SSLv3/TLSv1协议函数库。 目前OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Microsoft Windows以及Android和iOS上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。 openvpn通过使用公开密钥（非对称密钥，加密解密使用不同的key，一个称为Publice key，另外一个是Private key）对数据进行加密的。这种方式称为TLS加密。 openvpn使用TLS加密的工作过程是，首先VPN Sevrver端和VPN Client端要有相同的CA证书，双方通过交换证书验证双方的合法性，用于决定是否建立VPN连接。 然后使用对方的CA证书，把自己目前使用的数据加密方法加密后发送给对方，由于使用的是对方CA证书加密，所以只有对方CA证书对应的Private key才能解密该数据，这样就保证了此密钥的安全性，并且此密钥是定期改变的，对于窃听者来说，可能还没有破解出此密钥，VPN通信双方可能就已经更换密钥了。 扩展阅读： <a href="http://baike.baidu.com/link?url=ssl8SkkfVHTcjm9UCzJ8AsJOhIHMYcxuIisO4pqyqaZF6llwP1r0fgLvYEmAg_zYhFWauFzfEyXmEmFcaprG2K" target="_blank" rel="noopener">openvpn</a></p>
                  <h2 id="安装openvpn"><a href="#安装openvpn" class="headerlink" title="安装openvpn"></a>安装openvpn</h2>
                  <p>首先，你需要有一台长期运行的服务器，大家可以用自己的闲置的电脑或者买一台阿里云啦。 我的服务器是Ubuntu 14.04，下面就演示一下我的配置过程。 安装</p>
                  <figure class="highlight q">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="built_in">get</span> -y install openvpn libssl-<span class="built_in">dev</span> openssl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看下版本并记录下来</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">openvpn <span class="comment">--version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030145358.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030145358.jpg" alt="20151030145358"></a> 在这里我们的版本是2.3.2</p>
                  <h2 id="安装easy-rsa"><a href="#安装easy-rsa" class="headerlink" title="安装easy-rsa"></a>安装easy-rsa</h2>
                  <p>easy-rsa是用来制作openvpn相关证书的，使用如下命令安装</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> -y install easy-rsa</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，一切准备就绪后，我们就开始制作证书啦，我们需要制作的有三个证书 CA证书、Server端证书、Client端证书。行动起来。</p>
                  <h2 id="制作CA证书"><a href="#制作CA证书" class="headerlink" title="制作CA证书"></a>制作CA证书</h2>
                  <p>openvpn与easy-rsa安装完毕后，我们需要在/etc/openvpn/目录下创建easy-rsa文件夹，如下</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mkdir <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后把/usr/share/easy-rsa/目录下的所有文件全部复制到/etc/openvpn/easy-rsa/下</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo cp -r <span class="regexp">/usr/</span>share<span class="regexp">/easy-rsa/</span>* <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，我们也可以直接在/usr/share/easy-rsa/制作相关的证书，但是为了后续的管理证书的方便，我们还是把easy-rsa放在了openvpn的启动目录下。 <strong>注意：由于我们现在使用的是ubuntu系统，所以我们必须切换到root用户下才能制作相关证书，否则easy-rsa会报错。如果是centos系统，则不存在此问题。</strong> 切换到root用户下，使用如下命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo su</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在开始制作CA证书之前，我们还需要编辑vars文件，修改如下相关选项内容即可</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo vi <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span>vars</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_COUNTRY</span>=<span class="string">"CN"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_PROVINCE</span>=<span class="string">"SD"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_CITY</span>=<span class="string">"JiNan"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_ORG</span>=<span class="string">"germy"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_EMAIL</span>=<span class="string">"cqc@cuiqingcai.com"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_OU</span>=<span class="string">"germy"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_NAME</span>=<span class="string">"germy"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如图所示 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030150125.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030150125.jpg" alt="20151030150125"></a> 之后，我们需要利用这个文件来制作我们的证书，保存一下。 然后一个很重要的一步，赋予权限，否则在制作证书的时候，值还是初始化的值。</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span>vars</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>vars文件主要用于设置证书的相关组织信息，红色部分的内容可以根据自己的实际情况自行修改。 其中export KEY_NAME=”germy” 这个要记住下，我们下面在制作Server端证书时，会使用到。 <strong>注意：以上内容，我们也可以使用系统默认的，也就是说不进行修改也是可以使用的。</strong> 然后使用source vars命令使其生效，如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">source</span> vars</span><br><span class="line">./clean-<span class="keyword">all</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意：执行clean-all命令会删除，当前目录下的keys文件夹。 现在开始正式制作CA证书，使用如下命令：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> <span class="string">/etc/openvpn/easy-rsa/</span></span><br><span class="line"><span class="string">./build-ca</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一路回车即可。 制作完成后，我们可以查看keys目录里有什么东西。 如果你的目录下出现了ca.crt和ca.key两个文件，其中ca.crt就是我们所说的CA证书。如此，CA证书制作完毕。 现在把该CA证书的ca.crt文件复制到openvpn的启动目录/etc/openvpn下，如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cp</span> <span class="built_in">keys</span>/<span class="keyword">ca</span>.crt /etc/openvpn/</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="制作Server端证书"><a href="#制作Server端证书" class="headerlink" title="制作Server端证书"></a>制作Server端证书</h2>
                  <p>CA证书制作完成后，我们现在开始制作Server端证书。如下：</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">./<span class="keyword">build</span>-<span class="keyword">key</span>-server germy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上述命令中germy，就是我们前面vars文件中设置的KEY_NAME 查看 keys 目录 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030150704.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030150704.jpg" alt="20151030150704"></a> 如果可以发现出现了 germy.crt，germy.csr，germy.key 文件，就说明成功了。 现在再为服务器生成加密交换时的Diffie-Hellman文件，如下：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">./build-dh</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你会发现目录下多了一个 dh2048.pem 文件。 以上操作完毕后，把germy.crt，germy.key，dh2048.pem 复制到 /etc/openvpn/ 目录下，如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cd <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br><span class="line">cp keys<span class="regexp">/germy.crt keys/g</span>ermy.key keys<span class="regexp">/dh2048.pem /</span>etc<span class="regexp">/openvpn/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如此，Server端证书就制作完毕。</p>
                  <h2 id="制作Client端证书"><a href="#制作Client端证书" class="headerlink" title="制作Client端证书"></a>制作Client端证书</h2>
                  <p>Server端证书制作完成后，我们现在开始制作Client端证书，如下：</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">./<span class="keyword">build</span>-<span class="keyword">key</span> cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中上述命令的cqc就是客户端证书名称，可以自定义 如果发现keys目录已经生成了cqc.csr、cqc.crt和cqc.key这个三个文件。其中cqc.crt和cqc.key两个文件是我们要使用的。 如此，Client端证书就制作完毕。</p>
                  <h2 id="配置Server端"><a href="#配置Server端" class="headerlink" title="配置Server端"></a>配置Server端</h2>
                  <p>所有证书制作完毕后，我们现在开始配置Server端。Server端的配置文件，我们可以从openvpn自带的模版中进行复制。如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cp <span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>openvpn<span class="regexp">/examples/</span>sample-config-files<span class="regexp">/server.conf.gz /</span>etc<span class="regexp">/openvpn/</span></span><br><span class="line">cd <span class="regexp">/etc/</span>openvpn<span class="regexp">/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>解压server.conf.gz 文件，使用如下命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">gzip</span> <span class="selector-tag">-d</span> <span class="selector-tag">server</span><span class="selector-class">.conf</span><span class="selector-class">.gz</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意：上述命令的意思是解压server.conf.gz文件后，然后删除原文件。 现在我们来修改server.conf文件 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030151728.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030151728.jpg" alt="20151030151728"></a> 一共要修改3处文件 （1）修改了openvpn运行时使用的协议，由原来的UDP协议修改为TCP协议。生成环境建议使用TCP协议。 （2）修改了openvpn服务器的相关证书，由原来的server.csr、server.key修改为germy.crt、germy.key。 （3）修改了Diffie-Hellman文件，由原来的dh1024.pem修改为dh2048.pem。 配置文件修改完毕后，我们现在来启动openvpn，使用如下命令：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/openvpn start</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>至此，服务器端的VPN已经配置完毕了。</p>
                  <h2 id="客户端的配置"><a href="#客户端的配置" class="headerlink" title="客户端的配置"></a>客户端的配置</h2>
                  <p>服务器端配置好了，我们需要用另一台机器来连接，这里我们的客户端依然是Ubuntu 14.04 首先我们需要从服务器上取到刚才生成的证书文件，那么我们需要的有什么呢？ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030152200.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030152200.jpg" alt="20151030152200"></a> 首先这三个，ca.crt，cqc.crt，cqc.key 另外是一个模板，它是 /usr/share/doc/openvpn/examples/sample-config-files/client.conf 把这四个文件下载下来，然后放到客户端里。 比如我们保存到客户机的 home/user 文件夹下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030152421.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151030152421.jpg" alt="20151030152421"></a> 把 client.conf 文件重命名为 client.ovpn 然后修改下面4处</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">proto</span> <span class="selector-tag">tcp</span></span><br><span class="line"><span class="selector-tag">remote</span> 121<span class="selector-class">.42</span><span class="selector-class">.14</span><span class="selector-class">.158</span> 1194</span><br><span class="line"><span class="selector-tag">ca</span> <span class="selector-tag">ca</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">cert</span> <span class="selector-tag">cqc</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">key</span> <span class="selector-tag">cqc</span><span class="selector-class">.key</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 remote 就是你的服务器地址 配置好了之后，我们运行</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo openvpn <span class="comment">--config client.ovpn</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果最后的结果是 Sequence Completed 那就证明连接成功啦。 输入</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">ifconfig</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你会发现多了一个tun0适配器，这就是openvpn的适配器。 至此，openvpn的配置和连接就全部完成啦。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
                  <p><a href="http://www.myhack58.com/Article/sort099/sort0102/2015/65155_4.htm" target="_blank" rel="noopener">参考文献</a> 如有问题，欢迎留言交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-10-30 15:33:28" itemprop="dateCreated datePublished" datetime="2015-10-30T15:33:28+08:00">2015-10-30</time>
                </span>
                <span id="/2188.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究三之搭建并连接VPN服务器" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2185.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/2185.html" class="post-title-link" itemprop="url">HTML5中Device Orientation的特性</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>HTML5中包含一个帮助检测device orientation的特性，使用这个特性可以在移动设备浏览器中判断用户设备的旋转重力方向。</p>
                  <h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2>
                  <p>Alpha, Beta, Gamma角度旋转。 当用户旋转手机的时候，HTML5中定义了三个轴方向的旋转，如下： <a href="http://www.gbtags.com/gb/networks/uploadimg/48ca06d6-fef5-4c18-9379-a49b6b9db3af.png" target="_blank" rel="noopener"><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/48ca06d6-fef5-4c18-9379-a49b6b9db3af.png" alt=""></a> 上图可以看考，分别是z，x，y轴，对应分别是：Alpha，Beta，Gamma，下面图将更清楚的展示： <a href="http://www.gbtags.com/gb/networks/uploadimg/13a73e08-da9a-47a0-be1d-9d8dea6c2f98.png" target="_blank" rel="noopener"><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/13a73e08-da9a-47a0-be1d-9d8dea6c2f98.png" alt=""></a> 上图是Alpha旋转，　围绕Z轴旋转（绿线旋转方向，水平） <img src="http://www.gbtags.com/gb/networks/uploadimgthumb/3803a433-29b7-48e8-8abe-b9c48270047c.png" alt=""> 上图是Beta旋转，　围绕X轴旋转（绿线旋转方向，前后） <img src="http://www.gbtags.com/gb/networks/uploadimgthumb/cbb478f5-4490-48f1-af44-0b9e73844057.png" alt=""> 上图是Beta旋转，　围绕Y轴旋转（绿线旋转方向，左右）</p>
                  <h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2>
                  <ul>
                    <li>alpha: <em>(float 类型 )</em>以z方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为0到360（不等于360）。</li>
                    <li>beta: <em>(float 类型 )</em>以x方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为-180到180（不等于180）。</li>
                    <li>gamma: <em>(float 类型 )</em>以y方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为-180到180（不等于180）。</li>
                  </ul>
                  <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>
                  <p><a href="http://www.gbtags.com/gb/share/4247.htm" target="_blank" rel="noopener">原文链接</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-10-28 19:24:09" itemprop="dateCreated datePublished" datetime="2015-10-28T19:24:09+08:00">2015-10-28</time>
                </span>
                <span id="/2185.html" class="post-meta-item leancloud_visitors" data-flag-title="HTML5中Device Orientation的特性" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>440</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2138.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Net <i class="label-arrow"></i>
                  </a>
                  <a href="/2138.html" class="post-title-link" itemprop="url">计算机网络探究二之利用PHP实现登录验证之后上网</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一篇文章中，客户机可以借助路由机直接上网，并没有什么登录限制。接下来我们将加入上网登录验证，只有输入了正确的用户名和密码才可以通过验证，然后才可以访问互联网。 接下来，就跟随我用PHP来实现登录验证吧。</p>
                  <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
                  <p>在这之前，你需要配置一下LAMP环境，也就是Apache，MySQL，PHP开发环境，依次执行如下命令即可。</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get install apache2</span><br><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br><span class="line">sudo apt-get install mysql-server mysql-client</span><br><span class="line">sudo apt-get install libapache2-mod-php5</span><br><span class="line">sudo apt-get install libapache2-mod-auth-mysql</span><br><span class="line">sudo apt-get install phpmyadmin</span><br><span class="line">sudo ln -s /usr/share/phpmyadmin/ /var/www/html/phpmyadmin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果配置出现问题，请查阅相关资料。 apache默认的目录为 /var/www/html，我们这时访问 <a href="http://localhost" target="_blank" rel="noopener">localhost</a> 或者 <a href="http://192.168.122.4" target="_blank" rel="noopener">192.168.122.4</a>，都可以出现apache的欢迎界面，就证明我们配置成功了。</p>
                  <h2 id="路由初始设置"><a href="#路由初始设置" class="headerlink" title="路由初始设置"></a>路由初始设置</h2>
                  <p>为了在登录之前限制主机的上网，我们需要利用iptables规则来对数据包的转发加以限制。同时，将网页重定向到本机的登录界面。 初始路由设置如下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -F</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F</span><br><span class="line">iptables -t<span class="built_in"> mangle </span>-F</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-A FORWARD -s 192.168.122.0/24 -o eth0 -j REJECT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-A FORWARD -s 192.168.122.0/24 -d 119.29.29.29/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A PREROUTING -s 192.168.122.0/24 -p tcp -j DNAT --to 192.168.122.4</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先清除所有的iptables规则，然后设置前一篇我们说的IP伪装，这时可以客户机可以通过主机上网。 接下来的一条规则则禁用了来自 192.168.122.0 网段的所有IP的数据包转发，然后设置可访问DNS服务器，最后一条则设置了所有的tcp连接自动跳转到 192.168.122.4，也就是我们刚才配置的服务器。 可以把以上规则保存为脚本，比如叫 init.sh 来运行，也可以添加到 /etc/rc.local 中，开机自动运行。</p>
                  <h2 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h2>
                  <p>访问到192.168.122.4时，我们需要给用户呈现的当然不是刚才显示的apache欢迎页面，而是登录的输入框以及登录按钮界面。 所以，登录界面代码如下</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Auth Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"auth"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span> <span class="attr">id</span>=<span class="string">"basic-addon1"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">aria-describedby</span>=<span class="string">"basic-addon1"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span> <span class="attr">id</span>=<span class="string">"basic-addon1"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">aria-describedby</span>=<span class="string">"basic-addon1"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Login"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"logout"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Logout"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    form &#123;</span><br><span class="line"><span class="css">      <span class="selector-tag">max-width</span><span class="selector-pseudo">:400px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">margin</span><span class="selector-pseudo">:0</span> <span class="selector-tag">auto</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.input-group</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">margin-bottom</span><span class="selector-pseudo">:20px</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">"#login"</span>).on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).attr(<span class="string">"action"</span>, <span class="string">"/login.php"</span>);</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).submit();</span></span><br><span class="line">		&#125;);</span><br><span class="line"><span class="javascript">		$(<span class="string">"#logout"</span>).on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).attr(<span class="string">"action"</span>, <span class="string">"/logout.php"</span>);</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).submit();</span></span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中的js，jquery文件请大家自行引入。 预览一下效果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008151728.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008151728.png" alt="20151008151728"></a> 在这里我们设置了两个按钮，一个是登录，一个是下线。</p>
                  <h2 id="数据库查询验证"><a href="#数据库查询验证" class="headerlink" title="数据库查询验证"></a>数据库查询验证</h2>
                  <p>接下来我们新建一个数据库，例如我新建了一个数据库叫auth，然后数据表user，里面有三个字段。分别是id，username，password，我插入了一条数据。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008152059.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008152059.png" alt="20151008152059"></a> 接下来我们就尝试一下登录，提交到 login.php 文件验证一下。</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysql_server_name = <span class="string">"localhost"</span>;</span></span><br><span class="line"><span class="php">	$mysql_username = <span class="string">"root"</span>;</span></span><br><span class="line"><span class="php">	$mysql_password = <span class="string">"123456"</span>;</span></span><br><span class="line"><span class="php">	$mysql_database = <span class="string">"auth"</span>; </span></span><br><span class="line"><span class="php">	$username = @$_POST[<span class="string">'username'</span>];</span></span><br><span class="line"><span class="php">	$password = @$_POST[<span class="string">'password'</span>];</span></span><br><span class="line"><span class="php">	$ip=$_SERVER[<span class="string">"REMOTE_ADDR"</span>];	</span></span><br><span class="line"><span class="php">	$conn=mysql_connect($mysql_server_name, $mysql_username,</span></span><br><span class="line"><span class="php">                        $mysql_password);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($conn) &#123;</span></span><br><span class="line"><span class="php">		$sql = <span class="string">"select * from user where username = '"</span>.$username.<span class="string">"'"</span>;</span></span><br><span class="line"><span class="php">		$result = mysql_fetch_array(mysql_db_query($mysql_database, $sql, $conn));</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($result[<span class="string">'password'</span>] == $password) &#123;</span></span><br><span class="line"><span class="php">				$status = <span class="number">-1</span>;</span></span><br><span class="line"><span class="php">				system(<span class="string">"sudo ./bash/login.sh $ip"</span>, $status);</span></span><br><span class="line"><span class="php">				<span class="keyword">if</span> ($status == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Successfully"</span>;				</span></span><br><span class="line"><span class="php">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Failed"</span>;</span></span><br><span class="line"><span class="php">				&#125;</span></span><br><span class="line"><span class="php">			&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> <span class="string">"Wrong Password"</span>;</span></span><br><span class="line"><span class="php">			&#125;	</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">"Not"</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"Could Not Connect"</span>);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中，最重要的部分莫过于</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">system</span>(<span class="string">"sudo ./bash/login.sh $ip"</span>, $status);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这一行代码了，此处便是登录验证用户名和密码之后执行的一个 Linux 脚本命令。 在这里我把要执行的脚本写入了login.sh文件中，传入的参数便是ip地址。 那么login.sh里面发生了什么事情呢，我们来看一下。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-D FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-I FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>$1的意思就是获取第一个参数，在这里就是IP地址，脚本主要做的事情就是放行来自这个IP地址的数据包，让其正常访问互联网。 保存脚本后，记得给脚本赋予权限</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> login.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>-D的意思就是删除，因为iptables是可以添加多次相同的规则的，在添加之前删除一下，以防止多次添加。 在这里</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">sudo</span> ./<span class="keyword">bash/login.sh </span>$<span class="built_in">ip</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行命令脚本前，我们加了sudo，意思就是管理员身份运行，但是仍然可能导致权限问题，因为命令的执行者是PHP（其实是www-data），而并不是root用户，所以我们需要修改一下执行权限。 首先通过PHP文件获取执行该命令的用户是叫什么，比如新建一个 info.php 文件，输入如下内容：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> shell_exec(<span class="string">"id -a"</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看一下运行结果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008153424.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008153424.png" alt="20151008153424"></a> 嗯，果然，执行用户是www-data，这样我们只需要给www-data添加一个执行权限就好了。 修改 /etc/sudoers 文件 添加一行</p>
                  <figure class="highlight fortran">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">www-<span class="keyword">data</span> <span class="built_in">ALL</span>=(<span class="built_in">ALL</span>) NOPASSWD:<span class="built_in">ALL</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思是www-data以root身份运行并且不需要密码。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008153700.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008153700.png" alt="20151008153700"></a> 好，保存之后，我们尝试一下，就可以登录啦。</p>
                  <h2 id="测试登录"><a href="#测试登录" class="headerlink" title="测试登录"></a>测试登录</h2>
                  <p>在路由主机（Ubuntu Route）里面，初始化一下iptables规则，然后查看当前规则。 我们发现当前访问都是被阻止的，而且tcp连接会自动跳转到 192.168.122.4 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008154216.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008154216.png" alt="20151008154216"></a> 现在我们登录客户机，随机打开一个网址，比如百度，就发现自动跳转到了登录界面 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008154629.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008154629.png" alt="20151008154629"></a> 输入用户名密码，尝试登陆，比如之前插入数据库的是cqc，123456，输入之后登录。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008162712.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008162712.png" alt="20151008162712"></a> 提示登录成功之后，我们便可以欢乐地上网啦。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008162926.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151008162926.png" alt="20151008162926"></a> 好，这样我们就完成了验证之后上网啦。</p>
                  <h2 id="下线操作"><a href="#下线操作" class="headerlink" title="下线操作"></a>下线操作</h2>
                  <p>同样的，下线操作我们同样写一个logout.php</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysql_server_name = <span class="string">"localhost"</span>;</span></span><br><span class="line"><span class="php">	$mysql_username = <span class="string">"root"</span>;</span></span><br><span class="line"><span class="php">	$mysql_password = <span class="string">"123456"</span>;</span></span><br><span class="line"><span class="php">	$mysql_database = <span class="string">"auth"</span>; </span></span><br><span class="line"><span class="php">	$username = @$_POST[<span class="string">'username'</span>];</span></span><br><span class="line"><span class="php">	$password = @$_POST[<span class="string">'password'</span>];</span></span><br><span class="line"><span class="php">	$ip=$_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $ip;	</span></span><br><span class="line"><span class="php">	$conn=mysql_connect($mysql_server_name, $mysql_username,</span></span><br><span class="line"><span class="php">                        $mysql_password);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($conn) &#123;</span></span><br><span class="line"><span class="php">		$sql = <span class="string">"select * from user where username = '"</span>.$username.<span class="string">"'"</span>;</span></span><br><span class="line"><span class="php">		$result = mysql_fetch_array(mysql_db_query($mysql_database, $sql, $conn));</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($result[<span class="string">'password'</span>] == $password) &#123;</span></span><br><span class="line"><span class="php">				$status = <span class="number">-1</span>;</span></span><br><span class="line"><span class="php">				system(<span class="string">"sudo ./bash/logout.sh $ip"</span>, $status);</span></span><br><span class="line"><span class="php">				<span class="keyword">if</span> ($status == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Successfully"</span>;				</span></span><br><span class="line"><span class="php">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Failed"</span>;</span></span><br><span class="line"><span class="php">				&#125;</span></span><br><span class="line"><span class="php">			&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> <span class="string">"Wrong Password"</span>;</span></span><br><span class="line"><span class="php">			&#125;	</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">"Not"</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"Could Not Connect"</span>);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>登出的脚本如下，其实就是单纯去除了刚才添加的路由规则</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-D FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置方式和登录一样，大家可以尝试下。</p>
                  <h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2>
                  <p>在这里提供大家源代码下载 <a href="https://github.com/cqcre/PHPLogin" target="_blank" rel="noopener">源码下载</a> 如有问题，欢迎交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-10-08 00:27:44" itemprop="dateCreated datePublished" datetime="2015-10-08T00:27:44+08:00">2015-10-08</time>
                </span>
                <span id="/2138.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究二之利用PHP实现登录验证之后上网" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2126.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Net <i class="label-arrow"></i>
                  </a>
                  <a href="/2126.html" class="post-title-link" itemprop="url">计算机网络探究一之利用双网卡主机共享上网</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>大家好，这次我们需要实现的是实现双网卡主机共享上网，就是一台主机通过连接另一台可以访问外网的双网卡主机来正常上网。所以我们需要两台机器来进行测试，在这里我们用的是两台Ubuntu 14.04，其中一台是单网卡，一台是双网卡。废话不多说，行动起来吧。</p>
                  <h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2>
                  <p>博主使用了Vmware来安装了两台Ubuntu主机，一台当路由机，名称是Ubuntu Route，另一台是客户机，名称是Ubuntu Desktop，具体的网络配置如下： Ubuntu Route： 一个网卡eth0通过NAT方式来与外部主机共享上网，这个网卡也就是VMnet8网卡，网段是192.168.231.0 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" alt="20151007164043"></a> 另一个网卡eth1连接了一个自定义的仅主机模式的网卡VMnet2，网段是192.168.122.0 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" alt="20151007164114"></a> 网络适配器设置如下，eth0开启了DHCP，ech1没有开启DHCP <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" alt="20151007164343"></a> Ubuntu Desktop： 一个网卡eth0连接刚才那个自定义的仅主机模式的网卡VMnet2，网段是192.168.122.0 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" alt="20151007164821"></a> 好了，以上就是基本硬件的配置</p>
                  <h2 id="设置IP"><a href="#设置IP" class="headerlink" title="设置IP"></a>设置IP</h2>
                  <p>接下来我们设置一下Ubuntu Route的IP地址，修改 /etc/network/interfaces</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.122.4</span><br><span class="line">netmask 255.255.255.0</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里，eth0因为我们在VMware里面设置了DHCP，所以这里我们设置dhcp即可，eth1需要手动配置一下，我们分配了 192.168.122.4 这个IP地址，当然你可以随意指定，子网掩码如上，不需要写网关，因为它本身作为一个路由。 可以通过执行如下命令来使之生效</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d<span class="regexp">/networking restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果上述方法不行，则可以尝试使用关闭网卡和开启网卡的命令。</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">ifup eth0</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">ifdown eth0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>eth1的开启和关闭同上</p>
                  <h2 id="开启路由转发"><a href="#开启路由转发" class="headerlink" title="开启路由转发"></a>开启路由转发</h2>
                  <p>修改 /etc/sysctl.conf 文件，将</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">net.ipv4.ip_forward</span>=<span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这一行取消注释，代表开启了路由转发功能。 也可以通过执行</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/ip_forward</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令来实现</p>
                  <h2 id="设置iptables规则"><a href="#设置iptables规则" class="headerlink" title="设置iptables规则"></a>设置iptables规则</h2>
                  <p>iptables是非常重要的一个环节，如果大家不熟悉，可以去搜相关资料了解一下。 执行如下命令，来设置一下iptables规则，可以直接在命令行逐条执行，也可以写成一个脚本来执行。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -F</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F</span><br><span class="line">iptables -t<span class="built_in"> mangle </span>-F</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -o eth0 -j MASQUERADE</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中最后一条是最重要的，代表将数据包通过eth0网卡来转发，也是IP伪装的一个常用方法，有了这条指令，从eth1网卡流经的一些数据包可以通过eth0来转发，这样就相当于连通了两个网卡，这样与eth1网卡连接的主机便可以上网了。</p>
                  <h2 id="客户主机设置"><a href="#客户主机设置" class="headerlink" title="客户主机设置"></a>客户主机设置</h2>
                  <p>因为客户机的eth0连接了VMnet2网卡，而VMnet2网卡又与路由主机的eth1连接，我们只需要简单设置一下IP地址就好了。 修改 /etc/network/interfaces</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">auto</span> eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">192.168</span><span class="number">.122</span><span class="number">.5</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">gateway <span class="number">192.168</span><span class="number">.122</span><span class="number">.4</span></span><br><span class="line">dns-nameservers <span class="number">119.29</span><span class="number">.29</span><span class="number">.29</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里很重要的一个设置就是网关，设置成路由主机的IP地址。 设置完了同样重启一下网卡使其生效。 还可以选择性设置下DNS服务器。 至此，所有配置都完成了，测试一下吧。</p>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>我们在客户机里打开浏览器，输入随意一个网页测试一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" alt="20151007172000"></a> 嗯，客户机可以正常上网啦，一切都是那么轻松加愉快！ 如有问题，欢迎留言交流~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-10-07 17:23:37" itemprop="dateCreated datePublished" datetime="2015-10-07T17:23:37+08:00">2015-10-07</time>
                </span>
                <span id="/2126.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究一之利用双网卡主机共享上网" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2083.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2083.html" class="post-title-link" itemprop="url">Python爬虫实战三之实现山东大学无线网络掉线自动重连</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>最近山大软件园校区QLSC_STU无线网掉线掉的厉害，连上之后平均十分钟左右掉线一次，很是让人心烦，还能不能愉快地上自习了？能忍吗？反正我是不能忍了，嗯，自己动手，丰衣足食！写个程序解决掉它！ 假若你不能连这个无线，那就照照思路啦～</p>
                  <h2 id="决战前夕"><a href="#决战前夕" class="headerlink" title="决战前夕"></a>决战前夕</h2>
                  <p>首先我们看一下那个验证页面是咋样滴，上个图先 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" alt="20150920192557"></a> 嘿，这界面还算可以把，需要我们输入的东西就是俩，一个就是学号，另一个是身份证号后六位，然后就可以登录，享受免费的无线网啦。 不过不知道谁设置了个登录时长，一段时间后就会掉线了，于是，自动模拟登陆系统就要应运而生啦。 来，我们先点击一下连接，看一下浏览器怎么工作的。 按下F12，监听网络，我们点击第一个响应，也就是login.jsp，看一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957-1024x661.png" alt="20150920192957"></a> 我们具体看一下headers，里面form提交了什么东西，真的是茫茫多的数据啊。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" alt="20150920193146"></a> 嗯，一目了然POST的数据和提交的地址。 让我们来分析几个数据吧：</p>
                  <blockquote>
                    <p>ClientIP：当前客户端的IP地址，在山大软件园校区这个地址是211.87开头的</p>
                    <p>timeoutvalue：连接等待时间，也就是俗话说的timeout</p>
                    <p>StartTime：登录时间，也就是在你登录的那一刻的时间戳，这个时间戳是13位的，精确到了毫秒，不过一般是10位的，我们加3个0就好了</p>
                    <p>shkOvertime：登录持续时间，这个数据默认是720，也就是12分钟之后，登录就失效了，自动掉线，我们可以手动更改</p>
                    <p>username：学号</p>
                    <p>password：密码，也就是我们身份证号后六位</p>
                  </blockquote>
                  <p>我们需要在登录的时候把form表单中的所有信息都POST一下，然后就可以完成登录啦。 万事俱备，只欠东风，来来来，程序写起来！</p>
                  <h2 id="一触即发"><a href="#一触即发" class="headerlink" title="一触即发"></a>一触即发</h2>
                  <p>说走咱就走啊，天上的星星参北斗啊！ 登陆地址：Request URL:<a href="http://192.168.8.10/portal/login.jsp?Flag=0" target="_blank" rel="noopener">http://192.168.8.10/portal/login.jsp?Flag=0</a> 首先，我们需要验证一下IP地址，先写一个获取IP地址的函数，首先判断当前IP是不是211.87开头的，如果是的话，证明连接的IP是有效的。 首先我们写一个获取本机IP的方法：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">self.ip_pre</span> = <span class="string">"211.87"    </span></span><br><span class="line"><span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getIP(self):</span></span><br><span class="line">        <span class="attr">local_iP</span> = <span class="string">socket.gethostbyname(socket.gethostname())</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">self.ip_pre in str(local_iP):</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">str(local_iP)</span></span><br><span class="line">        <span class="attr">ip_lists</span> = <span class="string">socket.gethostbyname_ex(socket.gethostname())</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">for</span> <span class="string">ip_list in ip_lists:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">isinstance(ip_list, list):</span></span><br><span class="line">                <span class="attr">for</span> <span class="string">i in ip_list:</span></span><br><span class="line">                    <span class="attr">if</span> <span class="string">self.ip_pre in str(i):</span></span><br><span class="line">                        <span class="attr">return</span> <span class="string">str(i)</span></span><br><span class="line">            <span class="attr">elif</span> <span class="string">type(ip_list) is types.StringType:</span></span><br><span class="line">                <span class="attr">if</span> <span class="string">self.ip_pre in ip_list:</span></span><br><span class="line">                    <span class="attr">return</span> <span class="string">ip_list</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法利用了gethostbyname和gethostbyname_ex方法，获取了各个网卡的IP地址，遍历一下，找到那个211.87开头的IP，返回 接下来，获取到IP之后，我们便可以构建form，然后进行模拟登陆了。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print <span class="keyword">self</span>.getCurrentTime(), u<span class="string">"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = <span class="keyword">self</span>.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: <span class="keyword">self</span>.username,</span><br><span class="line">            <span class="string">"password"</span>: <span class="keyword">self</span>.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: False,</span><br><span class="line">            <span class="string">"StartTime"</span>: <span class="keyword">self</span>.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: <span class="keyword">self</span>.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span><span class="symbol">:</span><span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比较多的内容就在于form表单的数据内容以及请求头，后来利用urllib2的urlopen方法实现模拟登陆。 如果大家对此不熟悉，可以参见 <a href="http://cuiqingcai.com/947.html">Urllib的基本使用</a> 这样，登录后的结果就会保存在result变量中，我们只需要从result中提取出我们需要的数据就可以了。</p>
                  <h2 id="乘胜追击"><a href="#乘胜追击" class="headerlink" title="乘胜追击"></a>乘胜追击</h2>
                  <p>接下来，我们就分析一下数据啦，结果有这么几种：</p>
                  <blockquote>
                    <p>1.登录成功 2.已经登录 3.用户不存在 4.密码错误 5.未知错误</p>
                  </blockquote>
                  <p>好，利用result分析一下结果</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过字符串匹配和正则表达式，我们分辨并提取出了上述五种情况。 增加循环检测 既然是检测网络是否断开，那么我们只需要每隔一段时间检测一下就好了，那就10秒吧。 因为这个10秒是可配置的，为了方便配置，统一配置到<strong>init</strong>方法里面。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line"><span class="attr">self.every</span> = <span class="number">10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后，我们写一个循环来检测一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中我们用到了canConnect方法，这个就是检测网络是否已经断开的方法，我们可以利用ping百度的方法来检测一下。 方法实现如下</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    def canConnect(self):</span><br><span class="line">        fnull = <span class="built_in">open</span>(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        <span class="built_in">result</span> = subprocess.call(<span class="string">'ping www.baidu.com'</span>, <span class="built_in">shell</span> = True, <span class="keyword">stdout</span> = fnull, <span class="keyword">stderr</span> = fnull)</span><br><span class="line">        fnull.<span class="built_in">close</span>()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">result</span>:</span><br><span class="line">            <span class="literal">return</span> False</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="literal">return</span> True</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好啦，所有的要点我们已经逐一击破，等着凯旋吧</p>
                  <h2 id="收拾战场"><a href="#收拾战场" class="headerlink" title="收拾战场"></a>收拾战场</h2>
                  <p>好了，所有的代码要点已经被我们攻破了，接下来就整理一下，让他们组合起来，变成一个应用程序吧。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#学号密码</span></span><br><span class="line">        self.username = <span class="string">'201200131012'</span></span><br><span class="line">        self.password = <span class="string">'XXXXXX'</span></span><br><span class="line">        <span class="comment">#山大无线STU的IP网段</span></span><br><span class="line">        self.ip_pre = <span class="string">'211.87'</span></span><br><span class="line">        <span class="comment">#登录时长</span></span><br><span class="line">        self.overtime = <span class="number">720</span></span><br><span class="line">        <span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line">        self.every = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = self.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: self.username,</span><br><span class="line">            <span class="string">"password"</span>: self.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">"StartTime"</span>: self.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: self.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        self.getLoginResult(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间戳，13位</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getNowTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(int(time.time()))+<span class="string">"000"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIP</span><span class="params">(self)</span>:</span></span><br><span class="line">        local_iP = socket.gethostbyname(socket.gethostname())</span><br><span class="line">        <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(local_iP):</span><br><span class="line">            <span class="keyword">return</span> str(local_iP)</span><br><span class="line">        ip_lists = socket.gethostbyname_ex(socket.gethostname())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ip_list <span class="keyword">in</span> ip_lists:</span><br><span class="line">            <span class="keyword">if</span> isinstance(ip_list, list):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(i):</span><br><span class="line">                        <span class="keyword">return</span> str(i)</span><br><span class="line">            <span class="keyword">elif</span> type(ip_list) <span class="keyword">is</span> types.StringType:</span><br><span class="line">                <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">return</span> ip_list</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">canConnect</span><span class="params">(self)</span>:</span></span><br><span class="line">        fnull = open(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        result = subprocess.call(<span class="string">'ping www.baidu.com'</span>, shell = <span class="literal">True</span>, stdout = fnull, stderr = fnull)</span><br><span class="line">        fnull.close()</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"您好，欢迎使用模拟登陆系统"</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br><span class="line"></span><br><span class="line">login = Login()</span><br><span class="line">login.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>来，我们来运行一下，看下效果吧！ 执行</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> login.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当前是可以联网的，我分别在网页上操作执行了断开，操作，程序自动检测到掉线，自动重新连接。 接下来我直接断开了QLSC_STU网络的链接，程序同样检测到QLSC_STU这个热点没有连接上，提示用户链接。 接下来我重新连接上了这个热点，由于刚才已经登录上线，且持续时间较短，网络自动恢复正常。 下面是运行结果： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" alt="20150920205618"></a> 嗯，这样我们就是实现了自动掉线的检测和模拟登录。</p>
                  <h2 id="凯旋而归"><a href="#凯旋而归" class="headerlink" title="凯旋而归"></a>凯旋而归</h2>
                  <p>咿呀伊尔哟，想约妹子上自习吗？那就赶紧来试试吧！一网在手，天下我有！追男神女神都不再是梦想！ 如果有问题，欢迎留言讨论，代码肯定有不完善的地方，仅供参考。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-20 21:01:06" itemprop="dateCreated datePublished" datetime="2015-09-20T21:01:06+08:00">2015-09-20</time>
                </span>
                <span id="/2083.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战三之实现山东大学无线网络掉线自动重连" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2076.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2076.html" class="post-title-link" itemprop="url">浅谈CSRF攻击方式</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="CSRF是什么？"><a href="#CSRF是什么？" class="headerlink" title="CSRF是什么？"></a><strong>CSRF是什么？</strong></h2>
                  <p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p>
                  <h2 id="CSRF可以做什么？"><a href="#CSRF可以做什么？" class="headerlink" title="CSRF可以做什么？"></a><strong>CSRF可以做什么？</strong></h2>
                  <p>你这可以这么理解CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账……造成的问题包括：个人隐私泄露以及财产安全。</p>
                  <h2 id="CSRF漏洞现状"><a href="#CSRF漏洞现状" class="headerlink" title="CSRF漏洞现状"></a><strong>CSRF漏洞现状</strong></h2>
                  <p>CSRF这种攻击方式在2000年已经被国外的安全人员提出，但在国内，直到06年才开始被关注，08年，国内外的多个大型社区和交互网站分别爆出CSRF漏洞，如：NYTimes.com（纽约时报）、Metafilter（一个大型的BLOG网站），YouTube和百度HI……而现在，互联网上的许多站点仍对此毫无防备，以至于安全业界称CSRF为“沉睡的巨人”。</p>
                  <h2 id="CSRF的原理"><a href="#CSRF的原理" class="headerlink" title="CSRF的原理"></a><strong>CSRF的原理</strong></h2>
                  <p>下图简单阐述了CSRF攻击的思想： <img src="http://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg" alt=""> 从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤：</p>
                  <blockquote>
                    <p>　　1.登录受信任网站A，并在本地生成Cookie。 2.在不登出A的情况下，访问危险网站B。</p>
                  </blockquote>
                  <p>看到这里，你也许会说：“如果我不满足以上两个条件中的一个，我就不会受到CSRF的攻击”。是的，确实如此，但你不能保证以下情况不会发生：</p>
                  <blockquote>
                    <p>　　1.你不能保证你登录了一个网站后，不再打开一个tab页面并访问另外的网站。 2.你不能保证你关闭浏览器了后，你本地的Cookie立刻过期，你上次的会话已经结束。（事实上，关闭浏览器不能结束一个会话，但大多数人都会错误的认为关闭浏览器就等于退出登录/结束会话了……） 3.上图中所谓的攻击网站，可能是一个存在其他漏洞的可信任的经常被人访问的网站。</p>
                  </blockquote>
                  <p>上面大概地讲了一下CSRF攻击的思想，下面我将用几个例子详细说说具体的CSRF攻击，这里我以一个银行转账的操作作为例子（仅仅是例子，真实的银行网站没这么傻:&gt;）</p>
                  <h3 id="示例1："><a href="#示例1：" class="headerlink" title="示例1："></a><strong>示例1：</strong></h3>
                  <p>银行网站A，它以GET请求来完成银行转账的操作，如：<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a> 危险网站B，它里面有一段HTML的代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，你登录了银行网站A，然后访问危险网站B，噢，这时你会发现你的银行账户少了1000块…… 为什么会这样呢？原因是银行网站A违反了HTTP规范，使用GET请求更新资源。在访问危险网站B的之前，你已经登录了银行网站A，而B中的<img>以GET的方式请求第三方资源（这里的第三方就是指银行网站了，原本这是一个合法的请求，但这里被不法分子利用了），所以你的浏览器会带上你的银行网站A的Cookie发出Get请求，去获取资源“<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作</a>……</p>
                  <h3 id="示例2："><a href="#示例2：" class="headerlink" title="　　示例2："></a>　　<strong>示例2：</strong></h3>
                  <p>为了杜绝上面的问题，银行决定改用POST请求完成转账操作。 银行网站A的WEB表单如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"Transfer.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>ToBankId: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>Money: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"money"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Transfer"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>后台处理页面Transfer.php如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_REQUEST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_REQUEST[<span class="string">'toBankId'</span>],　$_REQUEST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>危险网站B，仍然只是包含那句HTML代码：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和示例1中的操作一样，你首先登录了银行网站A，然后访问危险网站B，结果…..和示例1一样，你再次没了1000块～T_T，这次事故的原因是：银行后台使用了$_REQUEST去获取请求的数据，而$_REQUEST既可以获取GET请求的数据，也可以获取POST请求的数据，这就造成了在后台处理程序无法区分这到底是GET请求的数据还是POST请求的数据。在PHP中，可以使用$_GET和$_POST分别获取GET请求和POST请求的数据。在JAVA中，用于获取请求数据request一样存在不能区分GET请求数据和POST数据的问题。</p>
                  <h3 id="示例3："><a href="#示例3：" class="headerlink" title="　　示例3："></a>　　<strong>示例3：</strong></h3>
                  <p>经过前面2个惨痛的教训，银行决定把获取请求数据的方法也改了，改用$_POST，只获取POST请求的数据，后台处理页面Transfer.php代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_POST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_POST[<span class="string">'toBankId'</span>],　$_POST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然而，危险网站B与时俱进，它改了一下代码：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">　　　　　　<span class="function"><span class="keyword">function</span> <span class="title">steal</span><span class="params">()</span></span></span></span><br><span class="line">　　　　　　&#123;</span><br><span class="line"><span class="javascript">          　　　　 iframe = <span class="built_in">document</span>.frames[<span class="string">"steal"</span>];</span></span><br><span class="line"><span class="actionscript">　　     　　      iframe.document.Submit(<span class="string">"transfer"</span>);</span></span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">　　<span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"steal()"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"steal"</span> <span class="attr">display</span>=<span class="string">"none"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">name</span>=<span class="string">"transfer"</span>　<span class="attr">action</span>=<span class="string">"http://www.myBank.com/Transfer.php"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"money"</span> <span class="attr">value</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果用户仍是继续上面的操作，很不幸，结果将会是再次不见1000块……因为这里危险网站B暗地里发送了POST请求到银行! 总结一下上面3个例子，CSRF主要的攻击模式基本上是以上的3种，其中以第1,2种最为严重，因为触发条件很简单，一个<img>就可以了，而第3种比较麻烦，需要使用JavaScript，所以使用的机会会比前面的少很多，但无论是哪种情况，只要触发了CSRF攻击，后果都有可能很严重。 理解上面的3种攻击模式，其实可以看出，CSRF攻击是源于WEB的隐式身份验证机制！WEB的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的！</p>
                  <h2 id="CSRF的防御"><a href="#CSRF的防御" class="headerlink" title="CSRF的防御"></a><strong>CSRF的防御</strong></h2>
                  <p>我总结了一下看到的资料，CSRF的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p>
                  <h3 id="1-服务端进行CSRF防御"><a href="#1-服务端进行CSRF防御" class="headerlink" title="　　1.服务端进行CSRF防御"></a>　　<strong>1.服务端进行CSRF防御</strong></h3>
                  <p>服务端的CSRF方式方法很多样，但总的思想都是一致的，就是在客户端页面增加伪随机数。 (1).Cookie Hashing(所有表单都包含同一个伪随机值)： 这可能是最简单的解决方案了，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了:&gt;</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　<span class="comment">//构造加密的Cookie信息</span></span></span><br><span class="line"><span class="php">　　　　$value = “DefenseSCRF”;</span></span><br><span class="line"><span class="php">　　　　setcookie(”cookie”, $value, time()+<span class="number">3600</span>);</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在表单里增加Hash值，以认证这确实是用户发送的请求。</p>
                  <figure class="highlight django">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="xml">　　<span class="php"><span class="meta">&lt;?php</span></span></span></span><br><span class="line"><span class="xml">　　　　$hash = md5($_COOKIE['cookie']);</span></span><br><span class="line"><span class="xml">　　?&gt;</span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">”POST”</span> <span class="attr">action</span>=<span class="string">”transfer.php”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”toBankId”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”money”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”hidden”</span> <span class="attr">name</span>=<span class="string">”hash”</span> <span class="attr">value</span>=<span class="string">”</span>&lt;?=<span class="string">$hash;?</span>&gt;</span>”&gt;</span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”submit”</span> <span class="attr">name</span>=<span class="string">”submit”</span> <span class="attr">value</span>=<span class="string">”Submit”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后在服务器端进行Hash值验证</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">      <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　      <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'check'</span>])) &#123;</span></span><br><span class="line"><span class="php">     　　      $hash = md5($_COOKIE[<span class="string">'cookie'</span>]);</span></span><br><span class="line"><span class="php">          　　 <span class="keyword">if</span>($_POST[<span class="string">'check'</span>] == $hash) &#123;</span></span><br><span class="line"><span class="php">               　　 doJob();</span></span><br><span class="line"><span class="php">　　           &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">          　　 &#125;</span></span><br><span class="line"><span class="php">　　      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">　　      &#125;</span></span><br><span class="line"><span class="php">      <span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢….由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就另外的1%。一般的攻击者看到有需要算Hash值，基本都会放弃了，某些除外，所以如果需要100%的杜绝，这个不是最好的方法。</p>
                  <h3 id="2-验证码"><a href="#2-验证码" class="headerlink" title="2.验证码"></a>2.验证码</h3>
                  <p>这个方案的思路是：每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，厄….这个方案可以完全解决CSRF，但个人觉得在易用性方面似乎不是太好，还有听闻是验证码图片的使用涉及了一个被称为MHTML的Bug，可能在某些版本的微软IE中受影响。</p>
                  <h2 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h2>
                  <p>在网上发现这篇文章说得很明了，转载啦，非常感谢原作者的辛苦付出。 <a href="http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html" target="_blank" rel="noopener">原文出处</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-17 23:08:41" itemprop="dateCreated datePublished" datetime="2015-09-17T23:08:41+08:00">2015-09-17</time>
                </span>
                <span id="/2076.html" class="post-meta-item leancloud_visitors" data-flag-title="浅谈CSRF攻击方式" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2057.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2057.html" class="post-title-link" itemprop="url">怎样把你的SAE利用起来</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>博主没事就喜欢瞎倒腾，今天登录自己的SAE一看，很久之前挂的几个应用早已杳无人烟，才消耗几个云豆，真是觉得太浪费了。所以博主就瞎倒腾一下，准备好好利用起自己的云豆，尽可能地为我提供服务。 好了，废话不多说，让我们开始动起来！</p>
                  <h2 id="新建应用"><a href="#新建应用" class="headerlink" title="新建应用"></a>新建应用</h2>
                  <p>既然想利用好里面的服务，那么我们就需要新建一个专属应用，取个专属名称，那么我名字叫崔庆才，那就叫cuiqingcai好了，幸运的是，并没有同名应用，可以使用，不错不错。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" alt="20150912153748"></a></p>
                  <h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2>
                  <p>SAE上最近出了一种独享数据库，不像之前的数据库一样每建一个应用自动生成一个数据库，这个数据库就像平常我们用到的phpMyAdmin一样一样的。可以新建好多个数据库，可以远程连接，可以登录网页设置。 有了这个，如果你没有VPS，也不需要去买个RDS来用啦！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" alt="20150912152842"></a> 首先建立好应用之后，到应用管理界面去，点击你的MySQL，然后就会让你选择是哪一种数据库，右边的独享型MySQL是SAE新出的，功能也非常强，可以建立数据库，可以建用户，授权数据库，监控数据等等。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909-1024x538.png" alt="20150912153909"></a> 点击独享型MySQL，创建属于自己的数据库吧。创建好了，建立自己的账户，登进来，一切都是那么轻松加愉快，以后有什么需要数据库，扔到这里就好了。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219-1024x432.png" alt="20150912154219"></a> 好，相信这个一定非常简单，小伙伴们快试一下吧！</p>
                  <h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2>
                  <p>新浪云中提供了SCS，也是一个云存储服务，但是费用太坑了，而且不是消耗云豆的，然而应用中的Storage是使用云豆的，如果不是什么私密存储的话，还是可以利用一下的。 在这里我想让它发挥SCS的作用并绑定到我的域名上，这样通过scs.cuiqingcai.com便可以访问了。 我们新建一个Storage Domain <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842-1024x368.png" alt="20150912155842"></a> 上传一张图片进去，比如1.jpg，上传后访问一下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" alt="20150912160138"></a> 恩，轻松加愉快！接下来，我发现这个域名简直太难记了，我要换成自己的域名，比如 scs.cuiqingcai.com 这样，图片就可以通过 scs.cuiqingcai.com/1.jpg 来访问了。那么怎么配置呢？</p>
                  <h3 id="1-绑定域名"><a href="#1-绑定域名" class="headerlink" title="1.绑定域名"></a>1.绑定域名</h3>
                  <p>到应用首页里面，点击域名绑定，SAE会告诉你两条要解析的内容，自己设置一下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" alt="20150912160935"></a> 接下来我们需要配置一下代码</p>
                  <h3 id="2-修改config-yaml"><a href="#2-修改config-yaml" class="headerlink" title="2.修改config.yaml"></a>2.修改config.yaml</h3>
                  <p>需要在代码管理中，更改一下config.yaml文件，让它做一个跳转。 比如我的代码中 config.yaml 文件就更改为</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">name:</span> cuiqingcai</span><br><span class="line"><span class="string">version:</span> <span class="number">1</span></span><br><span class="line"><span class="string">handle:</span></span><br><span class="line">	- <span class="string">rewrite:</span> <span class="keyword">if</span> (path ~ <span class="string">"/(.*)"</span>) goto <span class="string">"http://cuiqingcai-scs.stor.sinaapp.com/$1"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实就是加了一条reweite语句，把所有的路径定位到新地址的新路径中。 接下来，我访问一下 scs.cuiqingcai.com/1.jpg，嗯，图片出来了！这样，又一个免费的CDN建好了！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" alt="20150912161437"></a> 嗯，如果有什么图片需要存放，它会是你的一个非常好的选择！ 上传的话，SAE提供了上传的客户端，大家可以自行下载尝试。 之后博主将研究一下怎样配置上传的接口，这样我们就可以通过程序来上传了，我也很期待呢！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上是博主瞎倒腾的，可以为自己提供一些方便，大家尝试下吧，如有问题，欢迎留言交流！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-12 16:17:41" itemprop="dateCreated datePublished" datetime="2015-09-12T16:17:41+08:00">2015-09-12</time>
                </span>
                <span id="/2057.html" class="post-meta-item leancloud_visitors" data-flag-title="怎样把你的SAE利用起来" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2036.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/2036.html" class="post-title-link" itemprop="url">Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>博主之前一直用的是apache，随着网站负荷量增高，感觉apache稍微有点力不从心了。随着nginx越来越流行，而且其功能强大，博主准备采用nginx作为自己的服务器啦。 每当到了环境配置的时候，博主便会去网上各种搜集资料，然而感觉他们讲的都条理不一，有的地方并不符合自己的配置习惯，所以博主习惯自己配置的同时把配置过程总结一下，方便自己，也方便大家。 好，接下来我们就开始我们的环境配置之旅吧。</p>
                  <h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2>
                  <h3 id="1-更新源"><a href="#1-更新源" class="headerlink" title="1.更新源"></a>1.更新源</h3>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2-安装nginx"><a href="#2-安装nginx" class="headerlink" title="2.安装nginx"></a>2.安装nginx</h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install nginx</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-检查是否安装成功"><a href="#3-检查是否安装成功" class="headerlink" title="3.检查是否安装成功"></a>3.检查是否安装成功</h3>
                  <p>输入localhost或者远程地址，若出现Welcome To Nginx则证明安装成功。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" alt="20150911144903"></a> 如果没有看到，可以运行</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> killall apache2</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>杀掉apache进程，因为可能80端口被占用了。</p>
                  <h3 id="4-更改运行目录"><a href="#4-更改运行目录" class="headerlink" title="4.更改运行目录"></a>4.更改运行目录</h3>
                  <p>默认的nginx目录是/usr/share/nginx/html，我们将其修改为/var/www，当然可以根据个人习惯灵活更改。 修改/etc/nginx/sites-available/default文件</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更改为</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root /<span class="keyword">var</span>/www</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再将</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.htm;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更改为</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.php <span class="keyword">index</span>.htm;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>重启nginx</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们在/var/www目录下新建index.html文件，写入一些测试文字。 重新访问localhost或者远程地址，可以看到刚才设置的index.html文件中的内容，说明目录已经更改成功了。</p>
                  <h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2>
                  <p>安装PHP以及相关扩展。</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行上述指令即可。 此时有的小伙伴想要测试运行PHP文件了，然而很悲剧地告诉你是不可以的，因为你还没有配置fastcgi，继续往下看。</p>
                  <h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2>
                  <p>执行如下命令，安装MySQL服务端和客户端。</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get <span class="keyword">install</span> mysql-<span class="keyword">server</span> mysql-<span class="keyword">client</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在安装时可能提示你输入root用户的密码，设置即可。</p>
                  <h2 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h2>
                  <p>执行如下命令，安装phpMyAdmin。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install phpmyadmin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建软连接</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>share<span class="regexp">/phpmyadmin/</span> <span class="regexp">/var/</span>www<span class="regexp">/phpmyadmin</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们将创建一个根目录为/var/www，链接名为phpmyadmin的文件，指向/usr/share/phpmyadmin</p>
                  <h2 id="spawn-fcgi"><a href="#spawn-fcgi" class="headerlink" title="spawn-fcgi"></a>spawn-fcgi</h2>
                  <h3 id="1-安装fastcgi"><a href="#1-安装fastcgi" class="headerlink" title="1.安装fastcgi"></a>1.安装fastcgi</h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install spawn-fcgi</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2-配置fastcgi"><a href="#2-配置fastcgi" class="headerlink" title="2.配置fastcgi"></a>2.配置fastcgi</h3>
                  <p>修改 /etc/nginx/fastcgi_params文件，增加下面一行</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改/etc/php5/cgi/php.ini文件，将下面一行取消注释</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">cgi.fix_pathinfo</span>=<span class="number">1</span><span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样php-cgi方能正常使用SCRIPT_FILENAME这个变量 修改/etc/nginx/sites-available/default文件，我们之前修改的目录地址是/var/www，将</p>
                  <figure class="highlight vala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="meta">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="meta">#	# NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#	# With php5-cgi alone:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="meta">#	# With php5-fpm:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line"><span class="meta">#	fastcgi_index index.php;</span></span><br><span class="line"><span class="meta">#	include fastcgi_params;</span></span><br><span class="line"><span class="meta">#&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改为</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line"><span class="comment">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="comment">#	# <span class="doctag">NOTE:</span> You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	# With php5-cgi alone:</span></span><br><span class="line">	<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="comment">#	# With php5-fpm:</span></span><br><span class="line"><span class="comment">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">	<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">	<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">	<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-开启fastcgi进程"><a href="#3-开启fastcgi进程" class="headerlink" title="3.开启fastcgi进程"></a>3.开启fastcgi进程</h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo /usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数含义如下</p>
                  <blockquote>
                    <p>　　<em> -f 指定调用FastCGI的进程的执行程序位置，根据系统上所装的PHP的情况具体设置 </em> -a 绑定到地址addr <em> -p 绑定到端口port </em> -s 绑定到unix socket的路径path <em> -C 指定产生的FastCGI的进程数，默认为5（仅用于PHP） </em> -P指定产生的进程的PID文件路径 * -u和-g FastCGI使用什么身份（-u 用户 -g 用户组）运行，Ubuntu下可以使用www-data,其他的根据情况配置，如nobody、apache等现在可以在web根目录下放个探针或php文件测试一下了</p>
                  </blockquote>
                  <p>运行结果类似如下</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spawn-<span class="string">fcgi:</span> child spawned <span class="string">successfully:</span> <span class="string">PID:</span> <span class="number">11775</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="4-设置开机启动fastcgi"><a href="#4-设置开机启动fastcgi" class="headerlink" title="4.设置开机启动fastcgi"></a>4.设置开机启动fastcgi</h3>
                  <p>修改/etc/rc.local文件，添加下面一行</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改完之后，重启nginx</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以在/var/www目录下新建index.php文件测试运行，发现已经可以运行PHP文件了。</p>
                  <h2 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h2>
                  <p>所有配置已经完毕，现在我们输入localhost和localhost/phpmyadmin便可以轻松加愉快地访问了。 如有问题，欢迎交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-11 15:23:36" itemprop="dateCreated datePublished" datetime="2015-09-11T15:23:36+08:00">2015-09-11</time>
                </span>
                <span id="/2036.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1972.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1972.html" class="post-title-link" itemprop="url">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括：</p>
                  <ul>
                    <li>Urllib的用法及异常处理</li>
                    <li>Beautiful Soup的简单应用</li>
                    <li>MySQLdb的基础用法</li>
                    <li>正则表达式的简单应用</li>
                  </ul>
                  <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
                  <p>在这之前，我们需要先配置一下环境，我的Python的版本为2.7，需要额外安装的库有两个，一个是Beautiful Soup，一个是MySQLdb，在这里附上两个库的下载地址， <a href="https://pypi.python.org/pypi/beautifulsoup4/4.3.2" target="_blank" rel="noopener">Beautiful Soup</a> <a href="http://sourceforge.net/projects/mysql-python/" target="_blank" rel="noopener">MySQLdb</a> 大家可以下载之后通过如下命令安装</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> setup.<span class="keyword">py</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>环境配置好之后，我们便可以开心地撸爬虫了</p>
                  <h2 id="框架思路"><a href="#框架思路" class="headerlink" title="框架思路"></a>框架思路</h2>
                  <p>首先我们随便找一个分类地址，<a href="http://iask.sina.com.cn/c/978-all-1.html" target="_blank" rel="noopener">外语学习 - 爱问知识人</a>，打开之后可以看到一系列的问题列表。 我们在这个页面需要获取的东西有： 总的页码数，每一页的所有问题链接。 接下来我们需要遍历所有的问题，来抓取每一个详情页面，提取问题，问题内容，回答者，回答时间，回答内容。 最后，我们需要把这些内容存储到数据库中。</p>
                  <h2 id="要点简析"><a href="#要点简析" class="headerlink" title="要点简析"></a>要点简析</h2>
                  <p>其实大部分内容相信大家会了前面的内容，这里的爬虫思路已经融汇贯通了，这里就说一下一些扩展的功能</p>
                  <h3 id="1-日志输出"><a href="#1-日志输出" class="headerlink" title="1.日志输出"></a>1.日志输出</h3>
                  <p>日志输出，我们要输出时间和爬取的状态，比如像下面这样：</p>
                  <blockquote>
                    <p>[2015-08-10 03:05:20] 113011 号问题存在其他答案 我个人认为应该是樱桃沟很美的 [2015-08-10 03:05:20] 保存到数据库,此问题的ID为 113011 [2015-08-10 03:05:20] 当前爬取第 2 的内容,发现一个问题 百度有一个地方，花儿带着芳香，水儿流淌奔腾是什么意思 多多帮忙哦 回答数量 1 [2015-08-10 03:05:19] 保存到数据库,此问题的ID为 113010</p>
                  </blockquote>
                  <p>所以，我们需要引入时间函数，然后写一个获取当前时间的函数</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentTime(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br><span class="line">    </span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentDate(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'%Y-%m-%d'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上分别是获取带具体时间和获取日期的函数，在输出时，我们可以在输出语句的前面调用这函数即可。 然后我们需要将缓冲区设置输出到log中，在程序的最前面加上这两句即可</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">f_handler</span>=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>) </span><br><span class="line"><span class="attr">sys.stdout</span>=f_handler</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，所有的print语句输出的内容就会保存到out.log文件中了。</p>
                  <h3 id="2-页码保存"><a href="#2-页码保存" class="headerlink" title="2.页码保存"></a>2.页码保存</h3>
                  <p>爬虫爬取过程中可能出现各种各样的错误，这样会导致爬虫的中断，如果我们重新运行爬虫，那么就会导致爬虫从头开始运行了，这样显然是不合理的。所以，我们需要把当前爬取的页面保存下来，比如可以保存到文本中，假如爬虫中断了，重新运行爬虫，读取文本文件的内容，接着爬取即可。 大家可以稍微参考一下函数的实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#主函数</span></span><br><span class="line">def main(self):</span><br><span class="line">    <span class="attribute">f_handler</span>=open('out.log', <span class="string">'w'</span>) </span><br><span class="line">    sys.<span class="attribute">stdout</span>=f_handler</span><br><span class="line">   <span class="built_in"> page </span>= open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">    content = page.readline()</span><br><span class="line">    start_page = int(content.strip()) - 1</span><br><span class="line">    page.close()     </span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">    self.total_num = self.getTotalPageNum()</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">        start_page = self.total_num</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(1,start_page):</span><br><span class="line">        <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+1,<span class="string">"个页面"</span></span><br><span class="line">        try:</span><br><span class="line">            self.getQuestions(start_page-x+1)</span><br><span class="line">        except urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">        except Exception,e:  </span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">        <span class="keyword">if</span> start_page-x+1 &lt; start_page:</span><br><span class="line">            <span class="attribute">f</span>=open('page.txt','w')</span><br><span class="line">            f.write(str(start_page-x+1))</span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+1</span><br><span class="line">            f.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，不管我们爬虫中途遇到什么错误，妈妈也不会担心了</p>
                  <h3 id="3-页面处理"><a href="#3-页面处理" class="headerlink" title="3.页面处理"></a>3.页面处理</h3>
                  <p>页面处理过程中，我们可能遇到各种各样奇葩的HTML代码，和上一节一样，我们沿用一个页面处理类即可。</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line">    </span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用一段含有HTML代码的文字，经过调用replace方法之后，各种冗余的HTML代码就会处理好了。 比如我们这么一段代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;article <span class="class"><span class="keyword">class</span></span>=<span class="string">"article-content"</span>&gt;</span><br><span class="line">&lt;h2&gt;前言&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;好了，闲言碎语不多讲，开始我们的配置之旅。&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;运行环境：&lt;strong&gt;Ubuntu Linux 14.04&lt;/</span>strong&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;h2&gt;编写Shell脚本&lt;/</span>h2&gt;</span><br><span class="line">&lt;p&gt;首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下：&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;&lt;a href="http:/</span><span class="regexp">/wiki.ubuntu.org.cn/</span>Shell%E7%BC%<span class="number">96</span>%E7%A8%<span class="number">8</span>B%E5%<span class="number">9</span>F%BA%E7%A1%<span class="number">80</span><span class="string">" data-original-title="</span><span class="string">" title="</span><span class="string">"&gt;Ubuntu Shell 编程基础&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;执行如下命令：&lt;/p&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过处理后便会变成如下的样子：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">前言</span><br><span class="line">最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。</span><br><span class="line">好了，闲言碎语不多讲，开始我们的配置之旅。</span><br><span class="line">运行环境：UbuntuLinux14.<span class="number">04</span></span><br><span class="line">编写<span class="keyword">Shell</span><span class="bash">脚本</span></span><br><span class="line">首先，我们要编写一个<span class="keyword">shell</span><span class="bash">脚本，脚本主要执行的逻辑如下：</span></span><br><span class="line">显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。</span><br><span class="line">可能大家对于<span class="keyword">shell</span><span class="bash">脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下</span></span><br><span class="line">UbuntuShell编程基础</span><br><span class="line"><span class="keyword">shell</span><span class="bash">脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在/etc/mysql目录下新建一个listen.sh文件。</span></span><br><span class="line">执行如下命令：</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过上面的处理，所有乱乱的代码都会被处理好了。</p>
                  <h3 id="4-保存到数据库"><a href="#4-保存到数据库" class="headerlink" title="4.保存到数据库"></a>4.保存到数据库</h3>
                  <p>在这里，我们想实现一个通用的方法，就是把存储的一个个内容变成字典的形式，然后执行插入语句的时候，自动构建对应的sql语句，插入数据。 比如我们构造如下的字典：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#构造最佳答案的字典</span><br><span class="line">good_ans_dict = &#123;</span><br><span class="line">        <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">        <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">        <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">        <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">        <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">        &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>构造sql语句并插入到数据库的方法如下：</p>
                  <figure class="highlight php">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#插入数据</span></span><br><span class="line">    def insertData(<span class="keyword">self</span>, table, my_dict):</span><br><span class="line">         <span class="keyword">try</span>:</span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="keyword">try</span>:</span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> result:</span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,e:</span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> in e.args[<span class="number">1</span>]:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,e:</span><br><span class="line">             <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们只需要传入那个字典，便会构建出对应字典键值和键名的sql语句，完成插入。</p>
                  <h3 id="5-PHP读取日志"><a href="#5-PHP读取日志" class="headerlink" title="5.PHP读取日志"></a>5.PHP读取日志</h3>
                  <p>我们将运行结果输出到了日志里，那么怎么查看日志呢？很简单，在这里提供两种方法 方法一： PHP倒序输出所有日志内容</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">            $fp = file(<span class="string">"out.log"</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> ($fp) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">for</span>($i = count($fp) - <span class="number">1</span>;$i &gt;= <span class="number">0</span>; $i --) </span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> $fp[$i].<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        <span class="meta">?&gt;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此方法可以看到所有的输入日志，但是如果日志太大了，那么就会报耗费内存太大，无法输出。为此我们就有了第二种方法，利用linux命令，输出后十行内容。 方法二：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">			$ph = popen(<span class="string">'tail -n 100 out.log'</span>,<span class="string">'r'</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">while</span>($r = fgets($ph))&#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> $r.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			pclose($ph);</span></span><br><span class="line"><span class="php">		<span class="meta">?&gt;</span></span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面两种方法都是5秒刷新一次网页来查看最新的日志。</p>
                  <h2 id="源代码放送"><a href="#源代码放送" class="headerlink" title="源代码放送"></a>源代码放送</h2>
                  <p>好了，闲言碎语不多讲，直接上源码了</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">spider</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> page</span><br><span class="line"><span class="keyword">import</span> mysql</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.page_num = <span class="number">1</span></span><br><span class="line">        self.total_num = <span class="literal">None</span></span><br><span class="line">        self.page_spider = page.Page()</span><br><span class="line">        self.mysql = mysql.Mysql()</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentDate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'%Y-%m-%d'</span>,time.localtime(time.time()))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#通过网页的页码数来构建网页的URL</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageURLByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        page_url = <span class="string">"http://iask.sina.com.cn/c/978-all-"</span> + str(page_num) + <span class="string">".html"</span></span><br><span class="line">        <span class="keyword">return</span> page_url</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#通过传入网页页码来获取网页的HTML</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        request = urllib2.Request(self.getPageURLByNum(page_num))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"code"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,错误代号"</span>, e.code</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,原因"</span>, e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page =  response.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">            <span class="keyword">return</span> page</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取所有的页码数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTotalPageNum</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在获取目录页面个数,请稍候"</span></span><br><span class="line">        page = self.getPageByNum(<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#匹配所有的页码数,\u4e0b\u4e00\u9875是下一页的UTF8编码</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span class="more".*?&gt;.*?&lt;span.*?&lt;a href.*?class=""&gt;(.*?)&lt;/a&gt;\s*&lt;a.*?\u4e0b\u4e00\u9875&lt;/a&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, page)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取总页码失败"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#分析问题的代码,得到问题的提问者,问题内容,回答个数,提问时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestionInfo</span><span class="params">(self, question)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> type(question) <span class="keyword">is</span> types.StringType:</span><br><span class="line">            question = str(question)</span><br><span class="line">        <span class="comment">#print question</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span.*?question-face.*?&gt;.*?&lt;img.*?alt="(.*?)".*?&lt;/span&gt;.*?&lt;a href="(.*?)".*?&gt;(.*?)&lt;/a&gt;.*?answer_num.*?&gt;(\d*).*?&lt;/span&gt;.*?answer_time.*?&gt;(.*?)&lt;/span&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, question)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="comment">#获得提问者</span></span><br><span class="line">            author = match.group(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#问题链接</span></span><br><span class="line">            href = match.group(<span class="number">2</span>)</span><br><span class="line">            <span class="comment">#问题详情</span></span><br><span class="line">            text = match.group(<span class="number">3</span>)</span><br><span class="line">            <span class="comment">#回答个数</span></span><br><span class="line">            ans_num = match.group(<span class="number">4</span>)</span><br><span class="line">            <span class="comment">#回答时间</span></span><br><span class="line">            time = match.group(<span class="number">5</span>)</span><br><span class="line">            time_pattern = re.compile(<span class="string">'\d&#123;4&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;'</span>, re.S)</span><br><span class="line">            time_match = re.search(time_pattern, time)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> time_match:</span><br><span class="line">                time = self.getCurrentDate()</span><br><span class="line">            <span class="keyword">return</span> [author, href, text, ans_num, time]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#获取全部问题</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestions</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        <span class="comment">#获得目录页面的HTML</span></span><br><span class="line">        page = self.getPageByNum(page_num)</span><br><span class="line">        soup = BeautifulSoup(page)</span><br><span class="line">        <span class="comment">#分析获得所有问题</span></span><br><span class="line">        questions = soup.select(<span class="string">"div.question_list ul li"</span>)</span><br><span class="line">        <span class="comment">#遍历每一个问题</span></span><br><span class="line">        <span class="keyword">for</span> question <span class="keyword">in</span> questions:</span><br><span class="line">            <span class="comment">#获得问题的详情</span></span><br><span class="line">            info = self.getQuestionInfo(question)</span><br><span class="line">            <span class="keyword">if</span> info:</span><br><span class="line">                <span class="comment">#得到问题的URL</span></span><br><span class="line">                url = <span class="string">"http://iask.sina.com.cn/"</span> + info[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#通过URL来获取问题的最佳答案和其他答案</span></span><br><span class="line">                ans = self.page_spider.getAnswer(url)</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"当前爬取第"</span>,page_num,<span class="string">"的内容,发现一个问题"</span>,info[<span class="number">2</span>],<span class="string">"回答数量"</span>,info[<span class="number">3</span>]</span><br><span class="line">                <span class="comment">#构造问题的字典,插入问题</span></span><br><span class="line">                ques_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: info[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"questioner"</span>: info[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"date"</span>: info[<span class="number">4</span>],</span><br><span class="line">                            <span class="string">"ans_num"</span>: info[<span class="number">3</span>],</span><br><span class="line">                            <span class="string">"url"</span>: url</span><br><span class="line">                            &#125;</span><br><span class="line">                <span class="comment">#获得插入的问题的自增ID </span></span><br><span class="line">                insert_id = self.mysql.insertData(<span class="string">"iask_questions"</span>,ques_dict)</span><br><span class="line">                <span class="comment">#得到最佳答案</span></span><br><span class="line">                good_ans = ans[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存到数据库,此问题的ID为"</span>,insert_id</span><br><span class="line">                <span class="comment">#如果存在最佳答案,那么就插入</span></span><br><span class="line">                <span class="keyword">if</span> good_ans:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在最佳答案"</span>,good_ans[<span class="number">0</span>]</span><br><span class="line">                    <span class="comment">#构造最佳答案的字典</span></span><br><span class="line">                    good_ans_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">                            <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">                            <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                            &#125;</span><br><span class="line">                    <span class="comment">#插入最佳答案</span></span><br><span class="line">                    <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,good_ans_dict):</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案成功"</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案失败"</span></span><br><span class="line">                <span class="comment">#获得其他答案</span></span><br><span class="line">                other_anses = ans[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#遍历每一个其他答案</span></span><br><span class="line">                <span class="keyword">for</span> other_ans <span class="keyword">in</span> other_anses:</span><br><span class="line">                    <span class="comment">#如果答案存在</span></span><br><span class="line">                    <span class="keyword">if</span> other_ans:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在其他答案"</span>,other_ans[<span class="number">0</span>]</span><br><span class="line">                        <span class="comment">#构造其他答案的字典</span></span><br><span class="line">                        other_ans_dict = &#123;</span><br><span class="line">                                <span class="string">"text"</span>: other_ans[<span class="number">0</span>],</span><br><span class="line">                                <span class="string">"answerer"</span>: other_ans[<span class="number">1</span>],</span><br><span class="line">                                <span class="string">"date"</span>: other_ans[<span class="number">2</span>],</span><br><span class="line">                                <span class="string">"is_good"</span>: str(other_ans[<span class="number">3</span>]),</span><br><span class="line">                                <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                                &#125;</span><br><span class="line">                        <span class="comment">#插入这个答案</span></span><br><span class="line">                        <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,other_ans_dict):</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案成功"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案失败"</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        f_handler=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>) </span><br><span class="line">        sys.stdout=f_handler</span><br><span class="line">        page = open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">        content = page.readline()</span><br><span class="line">        start_page = int(content.strip()) - <span class="number">1</span></span><br><span class="line">        page.close()     </span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">        self.total_num = self.getTotalPageNum()</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">            start_page = self.total_num</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>,start_page):</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+<span class="number">1</span>,<span class="string">"个页面"</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.getQuestions(start_page-x+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">                <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">            <span class="keyword">except</span> Exception,e:  </span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">            <span class="keyword">if</span> start_page-x+<span class="number">1</span> &lt; start_page:</span><br><span class="line">                f=open(<span class="string">'page.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line">                f.write(str(start_page-x+<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+<span class="number">1</span></span><br><span class="line">                f.close()</span><br><span class="line"></span><br><span class="line">spider = Spider()</span><br><span class="line">spider.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">page</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib2</span></span><br><span class="line"><span class="attr">import</span> <span class="string">re</span></span><br><span class="line"><span class="attr">import</span> <span class="string">time</span></span><br><span class="line"><span class="attr">import</span> <span class="string">types </span></span><br><span class="line"><span class="attr">import</span> <span class="string">tool</span></span><br><span class="line"><span class="attr">from</span> <span class="string">bs4 import BeautifulSoup</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取分析某一问题和答案</span></span><br><span class="line"><span class="attr">class</span> <span class="string">Page:</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">def</span> <span class="string">__init__(self):</span></span><br><span class="line">        <span class="meta">self.tool</span> = <span class="string">tool.Tool()</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentDate(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('%Y-%m-%d',time.localtime(time.time()))</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentTime(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #通过页面的URL来获取页面的代码</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getPageByURL(self, url):</span></span><br><span class="line">        <span class="attr">try</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">request</span> = <span class="string">urllib2.Request(url)</span></span><br><span class="line">            <span class="attr">response</span> = <span class="string">urllib2.urlopen(request)</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">response.read().decode("utf-8") </span></span><br><span class="line">        <span class="attr">except</span> <span class="string">urllib2.URLError, e:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "code"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,错误代号", e.code</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "reason"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,原因", e.reason</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #传入一个List,返回它的标签里的内容,如果为空返回None</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getText(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line"><span class="comment">        #提取出&lt;pre&gt;标签里的内容</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('&lt;pre.*?&gt;(.*?)&lt;/pre&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配成功</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">match.group(1)</span></span><br><span class="line">        <span class="attr">else</span>: <span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #传入最佳答案的HTML,分析出回答者和回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"answer_tip.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?&lt;span class="time.*?&gt;.*?\|(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配,返回回答者和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #获得最佳答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswer(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">text</span> = <span class="string">soup.select("div.good_point div.answer_text pre")</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">len(text) &gt; 0:</span></span><br><span class="line"><span class="comment">            #获得最佳答案的内容</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得最佳答案的回答者信息</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">soup.select("div.good_point div.answer_tip")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getGoodAnswerInfo(str(info[0]))</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],1]</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">answer</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line"><span class="comment">            #如果不存在最佳答案,那么就返回空</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">    #传入回答者HTML,分析出回答者,回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"author_name.*?&gt;(.*?)&lt;/a&gt;.*?answer_t"&gt;(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #获得每一个回答的回答者信息和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line"><span class="comment">    #获得其他答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswers(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">results</span> =  <span class="string">soup.select("div.question_box li.clearfix .answer_info")</span></span><br><span class="line"><span class="comment">        #所有答案,包含好多个List,每个List包含了回答内容,回答者,回答时间</span></span><br><span class="line">        <span class="attr">answers</span> = <span class="string">[]</span></span><br><span class="line">        <span class="attr">for</span> <span class="string">result in results:</span></span><br><span class="line"><span class="comment">            #获得回答内容</span></span><br><span class="line">            <span class="attr">ansSoup</span> = <span class="string">BeautifulSoup(str(result))</span></span><br><span class="line">            <span class="attr">text</span> = <span class="string">ansSoup.select(".answer_txt span pre")</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得回答者和回答时间</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">ansSoup.select(".answer_tj")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getOtherAnswerInfo(info[0])</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],0]</span></span><br><span class="line"><span class="comment">            #加入到answers</span></span><br><span class="line">            <span class="attr">answers.append(answer)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">answers</span></span><br><span class="line">     </span><br><span class="line"><span class="comment">     #主函数</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getAnswer(self, url):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not url:</span></span><br><span class="line">            <span class="attr">url</span> = <span class="string">"http://iask.sina.com.cn/b/gQiuSNCMV.html"</span></span><br><span class="line">        <span class="attr">page</span> = <span class="string">self.getPageByURL(url)</span></span><br><span class="line">        <span class="attr">good_ans</span> = <span class="string">self.getGoodAnswer(page)</span></span><br><span class="line">        <span class="attr">other_ans</span> = <span class="string">self.getOtherAnswers(page)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">[good_ans,other_ans]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">page</span> = <span class="string">Page()</span></span><br><span class="line"><span class="attr">page.getAnswer(None)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">tool</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#-*- coding:utf-8 -*-</span></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line">    </span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">mysql</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#数据库初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            <span class="keyword">self</span>.db = MySQLdb.connect(<span class="string">'ip'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'db_name'</span>)</span><br><span class="line">            <span class="keyword">self</span>.cur = <span class="keyword">self</span>.db.cursor()</span><br><span class="line">        except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"连接数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#插入数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertData</span><span class="params">(<span class="keyword">self</span>, table, my_dict)</span></span><span class="symbol">:</span></span><br><span class="line">         <span class="symbol">try:</span></span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="symbol">try:</span></span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="symbol">result:</span></span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> <span class="keyword">in</span> e.args[<span class="number">1</span>]<span class="symbol">:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>数据库建表SQL如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_answers`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'自增ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答内容'</span>,</span><br><span class="line">  <span class="string">`question_id`</span> <span class="built_in">int</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`answerer`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答时间'</span>,</span><br><span class="line">  <span class="string">`is_good`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'是否是最佳答案'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_questions`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题内容'</span>,</span><br><span class="line">  <span class="string">`questioner`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问时间'</span>,</span><br><span class="line">  <span class="string">`ans_num`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答数量'</span>,</span><br><span class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题链接'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行的时候执行如下命令即可</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nohup <span class="keyword">python</span> spider.<span class="keyword">py</span> &amp;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码写的不好，仅供大家学习参考使用，如有问题，欢迎留言交流。</p>
                  <h2 id="运行结果查看"><a href="#运行结果查看" class="headerlink" title="运行结果查看"></a>运行结果查看</h2>
                  <p>我们把PHP文件和log文件放在同一目录下，运行PHP文件，便可以看到如下的内容： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" alt="20150908222744"></a> 小伙伴们赶快试一下吧。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-08 22:24:33" itemprop="dateCreated datePublished" datetime="2015-09-08T22:24:33+08:00">2015-09-08</time>
                </span>
                <span id="/1972.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>17k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>16 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1981.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/1981.html" class="post-title-link" itemprop="url">Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。 好了，闲言碎语不多讲，开始我们的配置之旅。 运行环境：<strong>Ubuntu Linux 14.04</strong></p>
                  <h2 id="编写Shell脚本"><a href="#编写Shell脚本" class="headerlink" title="编写Shell脚本"></a>编写Shell脚本</h2>
                  <p>首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下： 显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。 可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下 <a href="http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">Ubuntu Shell 编程基础</a> shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。 执行如下命令：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> /etc/mysql</span><br><span class="line">touch listen.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">vi</span> listen.<span class="keyword">sh</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>进入到vi中，我们添加如下脚本内容：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span></span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 pgrep mysqld 是监测mysqld服务的运行状态，&amp;&gt; /dev/null 是将其结果输出到空文件，也就是不保存输出信息 $? 是拿到上一条命令的运行结果，-gt 0 是判断是否大于0，后面则是输出时间到日志文件，然后启动mysql，否则不启动mysql 保存好了，那么我们执行如下的命令，来测试一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" alt="20150816164552"></a> 贴心的命令文字版本：</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># vi listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># pgrep mysqld</span></span><br><span class="line"><span class="number">3359</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># chmod 777 listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">44:58</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># sudo service mysql stop</span></span><br><span class="line">mysql stop/waiting</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:17</span> CST <span class="number">2015</span> mysql is stop</span><br><span class="line">mysql start/running, process <span class="number">4084</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:24</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment">#</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，编辑完了.sh文件之后，我们首先要对其进行授权，增加可执行的权限。</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> <span class="section">listen</span>.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后运行脚本测试一下，显示mysql正在运行。把mysql关掉，运行脚本，便会检测到mysql已关闭，然后重新启动了mysql，再次运行，便会发现mysql正常运行了。 <strong>注：这里我比较纳闷shell脚本中pgrep mysqld的返回结果是什么。为什么它大于0便代表mysql服务挂掉了呢？感觉逻辑有点是相反的，不过实测可用有效。如果大家明白为什么，非常希望您可以给我一个解释。</strong></p>
                  <h2 id="修改日志输出"><a href="#修改日志输出" class="headerlink" title="修改日志输出"></a>修改日志输出</h2>
                  <p>好，接下来我们把输出的内容保存到日志里。修改脚本文件如下</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，每执行一次脚本，输出结果都会被保存到 /var/log/mysql_listen.log 中了。</p>
                  <h2 id="添加定时任务"><a href="#添加定时任务" class="headerlink" title="添加定时任务"></a>添加定时任务</h2>
                  <p>好了，脚本可以顺利执行了，那么我们就需要定时调用一下这个脚本来运行了，我们需要用到 cron。 首先我们需要编辑一下corn调度表格，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">crontab -e</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你是第一次编辑这个，他会让你选择文件打开方式，随便选一个数字就好了。 比如我们用GNU打开的，我们就在它的最后一行添加下面的一句话即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" alt="20150816165506"></a>、 文字版本：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">*<span class="regexp">/5 * * * * /</span>etc<span class="regexp">/mysql/my</span>sql_listen.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>/5代表五分钟执行一次，后面的四个点依次代表了，小时，日，月，星期。如果想要时间长一些，比如一小时调度一次，那就设置一下后面第一个*就好了。 好，保存一下，重启cron服务。</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">service cron restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，调度任务已经添加进去了，这样，每五分钟系统就会调用一下刚才写的那个脚本。 过一段时间，我们来看一下运行效果，嗯，监控跑的很顺利呐。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" alt="20150816165858"></a> 文字版本：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">12</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">45</span>:<span class="number">02</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">55</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">05</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">25</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">35</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">04</span> CST <span class="number">2015</span> mysql running</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>哈哈，是不是五分钟监测了一次呢？大功告成。</p>
                  <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
                  <p>这样，我们就实现了五分钟定时检测MySQL进程服务，妈妈再也不用担心我的网站会宕掉啦。 如有问题，欢迎留言交流，谢谢啦。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-08-16 17:06:30" itemprop="dateCreated datePublished" datetime="2015-08-16T17:06:30+08:00">2015-08-16</time>
                </span>
                <span id="/1981.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1934.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1934.html" class="post-title-link" itemprop="url">C语言小知识点练习总结</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近在准备C语言的上级考试，之前对C接触不多，在练习过程中把一些小知识点记录下来。</p>
                  <h2 id="1-字符串的截取"><a href="#1-字符串的截取" class="headerlink" title="1.字符串的截取"></a>1.字符串的截取</h2>
                  <p>利用strncpy函数，传入三个参数，分别为目标字符串，起始位置，长度。 例如将日期字符串转化为数字，如20120112</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> date1[<span class="number">20</span>],date2[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date1);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date2);</span><br><span class="line">    <span class="keyword">char</span> temp[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">int</span> year1 = atoi(<span class="built_in">strncpy</span>(temp,date1,<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">int</span> year2 = atoi(<span class="built_in">strncpy</span>(temp,date2,<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year1:%d\n"</span>,year1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year2:%d\n"</span>,year2);</span><br><span class="line">    <span class="keyword">char</span> temp2[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> month1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> month2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month1:%d\n"</span>,month1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month2:%d\n"</span>,month2);</span><br><span class="line">    <span class="keyword">int</span> day1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> day2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day1:%d\n"</span>,day1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day2:%d\n"</span>,day2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便实现了输入一个日期然后对其进行分割的操作。</p>
                  <h2 id="2-二维数组的动态声明"><a href="#2-二维数组的动态声明" class="headerlink" title="2.二维数组的动态声明"></a>2.二维数组的动态声明</h2>
                  <p>利用malloc可以实现数组的动态声明</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> **a;</span><br><span class="line">    a = (<span class="built_in">int</span> **)malloc(<span class="number">2</span>*sizeof(<span class="built_in">int</span> *));</span><br><span class="line">    <span class="built_in">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        a[i] = (<span class="built_in">int</span> *)malloc(<span class="number">3</span>*sizeof(<span class="built_in">int</span>));</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            scanf(<span class="string">"%d"</span>,&amp;a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便实现了动态数组的分配，利用scanf为数组赋值</p>
                  <h2 id="3-二维数组的声明和初始化"><a href="#3-二维数组的声明和初始化" class="headerlink" title="3.二维数组的声明和初始化"></a>3.二维数组的声明和初始化</h2>
                  <p>头文件</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>初始化和测试</p>
                  <figure class="highlight matlab">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">int result[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    memset(result,<span class="number">0</span>,sizeof(int)*<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">4196944 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">4195696 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上述是数组的非动态声明</p>
                  <h2 id="4-快速排序"><a href="#4-快速排序" class="headerlink" title="4.快速排序"></a>4.快速排序</h2>
                  <p>假设要排序的数组是A[1]……A[N]，首先任意选取一个数据（通常选用第一个数据）作为关键数据，然后将所有比它的数都放到它前面，所有比它大的数都放到它后面，这个过程称为一趟快速排序。一趟快速排序的算法是： 1）设置两个变量I、J，排序开始的时候 I=0，J=N-1； 2）以第一个数组元素作为关键数据，赋值给X，即X=A[0]； 3）从J开始向前搜索，即由后开始向前搜索，找到第一个小于X的值，两者交换； 4）从I开始向后搜索，即由前开始向后搜索，找到第一个大于X的值，两者交换； 5）重复第3、4步，直到I=J； 例如：待排序的数组A的值分别是：（初始关键数据X：=49） A[0] A[1] A[2] A[3] A[4] A[5] A[6] 49 38 65 97 76 13 27 进行第一次交换后： 27 38 65 97 76 13 49 ( 按照算法的第三步从后面开始找 ） 进行第二次交换后： 27 38 49 97 76 13 65 ( 按照算法的第四步从前面开始找&gt;X的值，65&gt;49,两者交换，此时I=3 ) 进行第三次交换后： 27 38 13 97 76 49 65 ( 按照算法的第五步将又一次执行算法的第三步从后开始找） 进行第四次交换后： 27 38 13 49 76 97 65 ( 按照算法的第四步从前面开始找大于X的值，97&gt;49,两者交换，此时J=4 ) 此时再执行第三不的时候就发现I=J，从而结束一躺快速排序，那么经过一躺快速排序之后： 27 38 13 49 76 97 65 即所有大于49的数全部在49的后面，所有小于49的数全部在49的前面。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> quiksort(<span class="built_in">int</span> a[],<span class="built_in">int</span> low,<span class="built_in">int</span> high)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i = low;</span><br><span class="line">    <span class="built_in">int</span> j = high;  </span><br><span class="line">    <span class="built_in">int</span> temp = a[i]; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>( low &lt; high)</span><br><span class="line">    &#123;          </span><br><span class="line">        <span class="keyword">while</span>(i &lt; j) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>((a[j] &gt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123; </span><br><span class="line">                j--; </span><br><span class="line">            &#125;</span><br><span class="line">            a[i] = a[j];</span><br><span class="line">            <span class="keyword">while</span>((a[i] &lt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123;</span><br><span class="line">                i++; </span><br><span class="line">            &#125;  </span><br><span class="line">            a[j]= a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i] = temp;</span><br><span class="line">        quiksort(a,low,i<span class="number">-1</span>);</span><br><span class="line">        quiksort(a,j+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">23</span>,<span class="number">1</span>,<span class="number">21</span>,<span class="number">4</span>,<span class="number">19</span>&#125;;</span><br><span class="line">    quiksort(arr,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">"%d "</span>,arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>快速排序代码如上</p>
                  <h2 id="5-字符串拷贝"><a href="#5-字符串拷贝" class="headerlink" title="5.字符串拷贝"></a>5.字符串拷贝</h2>
                  <p>小例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：world，即把后者完全覆盖前者。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果一致 某一长度的字符串截取</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strncpy</span>(str,a+<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：orld</p>
                  <h2 id="6-字符串的拼接"><a href="#6-字符串的拼接" class="headerlink" title="6.字符串的拼接"></a>6.字符串的拼接</h2>
                  <p>小例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strcat</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果： hello world hello world 此函数既返回结果，又将目标字符串赋值</p>
                  <h2 id="7-字符串查找匹配"><a href="#7-字符串查找匹配" class="headerlink" title="7.字符串查找匹配"></a>7.字符串查找匹配</h2>
                  <p>例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strchr</span>(str,<span class="string">'e'</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, x - str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果： 1 ello</p>
                  <h2 id="8-字符串比较"><a href="#8-字符串比较" class="headerlink" title="8.字符串比较"></a>8.字符串比较</h2>
                  <p>例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"hello2"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = <span class="built_in">strcmp</span>(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果-1 忽略大小写</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"Hello"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = stricmp(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果0</p>
                  <h2 id="9-字符串分割"><a href="#9-字符串分割" class="headerlink" title="9.字符串分割"></a>9.字符串分割</h2>
                  <p>示例如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">char</span> test1[] = <span class="string">"feng,ke,wei"</span>;  </span><br><span class="line">	  <span class="keyword">char</span> x[<span class="number">3</span>][<span class="number">30</span>];</span><br><span class="line">      <span class="keyword">char</span> *p;  </span><br><span class="line">      p = strtok(test1, <span class="string">","</span>);</span><br><span class="line">	  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (p) &#123;   </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, p);   </span><br><span class="line">		<span class="built_in">strcpy</span>(x[count],p);</span><br><span class="line">		count++;</span><br><span class="line">		p = strtok(<span class="literal">NULL</span>, <span class="string">","</span>);     </span><br><span class="line">      &#125;    </span><br><span class="line">	  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;count; i ++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s "</span>, x[i]);</span><br><span class="line">	  &#125;</span><br><span class="line">	  system(<span class="string">"pause"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 feng ke wei feng ke wei</p>
                  <h2 id="10-格式化输出几位小数"><a href="#10-格式化输出几位小数" class="headerlink" title="10.格式化输出几位小数"></a>10.格式化输出几位小数</h2>
                  <p>例如</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%.5f"</span>,<span class="number">18.223</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则是输出5位小数 又如</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">printf</span>(<span class="string">"%5.1f"</span>,<span class="number">1.2345</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则是控制总位数为5，小数点后为1位，不够的在前面补空格</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-18 21:52:01" itemprop="dateCreated datePublished" datetime="2015-07-18T21:52:01+08:00">2015-07-18</time>
                </span>
                <span id="/1934.html" class="post-meta-item leancloud_visitors" data-flag-title="C语言小知识点练习总结" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1922.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1922.html" class="post-title-link" itemprop="url">Winpcap网络编程六之两台主机通过中间主机通信</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="本节任务"><a href="#本节任务" class="headerlink" title="本节任务"></a>本节任务</h2>
                  <p>本次我们需要完成的任务是 完成两台主机通过中间主机的数据通信（网络层）</p>
                  <ul>
                    <li>增加基于IP地址的转发功能</li>
                    <li>增加网络层封装</li>
                  </ul>
                  <p>其实最主要的就是基于IP地址的转发功能，网络层的封装其实我们在初级功能中就已经做好了。</p>
                  <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2>
                  <p>首先，实验的思路是A通过中间主机B向C发送数据。那么B则作为一个路由器，B要监听两个网卡，一个网卡发来的数据通过另一个网卡发出去。 示意图如下： A————-&gt;B1===B2——————&gt;C 从图上可以看出，B主机的两个网卡数据互通，A和B1则处于一个局域网内，B2和C处于另一个局域网内。 就比如这样，现在室友A在用有线上网，我的电脑B也在用有线上网，我们的有线处在同一局域网，我的电脑B同时散着一个无线网，我的手机C又连接到了这个无线上。 那么要实现A到C的数据传送，即模拟室友A要发送数据到我的手机C，那么流程则是这样的： 室友A在有线局域网发送数据到我的网卡B1，B1将数据通过网卡B2转发到无线局域网，通过无线局域网到达我的手机C。 A的发送要构建一个帧，目的MAC地址为B1,目的IP为C。B则要开启两个网卡，B1监听接收数据，B2网卡则要用ARP协议扫描所在无线局域网内的IP和MAC,B获取到了A发来的帧之后，解析它的IP地址和MAC地址，匹配刚才扫描得到的IP和MAC对应表，将源MAC换成B2网卡MAC，目的MAC换成C的MAC，IP不变，数据data不变。构建新帧之后发送出去。 好啦，思路大体就是这样。</p>
                  <h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2>
                  <p>需要三个程序，一个是发送，一个路由，一个接收。所以一共三个程序要同时运行起来执行。 以上是我的大体思路，如有错误，还请指正。现已用代码实现完毕。 代码暂不公开，只提供部分重点代码解析：</p>
                  <h3 id="一、发送端"><a href="#一、发送端" class="headerlink" title="一、发送端"></a>一、发送端</h3>
                  <p>其实发送端和初级功能的发送差不多 个人编写的交互流程如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.221</span>   MAC地址:<span class="number">3</span>c970e4b56d6con:<span class="number">127</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.227</span>   MAC地址:<span class="number">089e01</span>b948f4con:<span class="number">128</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.228</span>   MAC地址:<span class="number">10</span>bf48705aeecon:<span class="number">129</span></span><br><span class="line"></span><br><span class="line">获取MAC地址完毕,请输入你要发送对方的IP地址:</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">请输入你要发送的内容:</span><br><span class="line">im cqc</span><br><span class="line">要发送的内容:im cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>具体代码不再解析，同上一篇初级功能。</p>
                  <h3 id="二、路由端"><a href="#二、路由端" class="headerlink" title="二、路由端"></a>二、路由端</h3>
                  <p>首先要开启两个网卡，声明两个网卡对象和处理器</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">pcap_if_t</span>  *d,*d2;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle,*adhandle2;           <span class="comment">//捕捉实例,是pcap_open返回的对象,adhandle是用来发送数据，adhandle2是用来接收数据</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一个用来接收一个用来发送，这里定义了adhandle是用来发送，adhandle2是用来接收数据。 那么打开适配器就在main方法中，提前打开两个网卡</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">int num;</span><br><span class="line">	printf(<span class="string">"请输入你要转发数据的网卡代号:\n"</span>);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行转发</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的，找到发送数据网卡</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">    <span class="comment">// 释放设备列表 </span></span><br><span class="line">    pcap_freealldevs(alldevs);</span><br><span class="line">    return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num2;</span><br><span class="line">	printf(<span class="string">"请输入你要接收数据的网卡代号:"</span>);</span><br><span class="line">	<span class="comment">//让用户选择用哪个网卡来收数据</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num2);</span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d2=alldevs, i=0; i&lt; num2-1 ; d2=d2-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle2 = pcap_open(d2-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d2-&gt;</span><span class="keyword">name</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来用用于发送的handle处理器来扫描它的局域网IP，获得局域网内的MAC地址，记录在一个表中,存放IP和MAC的对应关系。 这个表可以用结构体数组来保存，比如可以这样:</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">struct ip_mac_list&#123;</span><br><span class="line">	IpAddress ip;</span><br><span class="line">	unsigned char mac[6];</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ip_mac_list  list[<span class="number">256</span>];                       <span class="comment">//存储IP和MAC地址的对应表</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么以上便是准备工作，我们完成了两个网卡的打开，发送网卡扫描获取局域网MAC，接下来便是最重要的监听加转发。 那么这个怎办？那就开一个新线程。 让我们声明一个新的路由线程。</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">DWORD WINAPI RouteThread(<span class="name">LPVOID</span> lpParameter)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么线程要接收进来什么参数呢？ 首先必须要的是两个网卡处理器，在main方法中已经做好初始化的adhandle和adhandle2，另外还有alldevs，可以持有这个指针来释放设备列表，出现错误时释放资源并退出。 初级功能中声明过了 struct sparam sp; struct gparam gp; 这两个就是发送ARP线程和接收ARP线程中的两个参数，那么仿照这个功能，我们定义一个新的结构体</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rparam</span>&#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_rec;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_send;</span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main方法中把它来初始化赋值</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">rp.adhandle_send = adhandle<span class="comment">;</span></span><br><span class="line">	rp.adhandle_rec = adhandle2<span class="comment">;</span></span><br><span class="line">	rp.alldevs = alldevs<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当做参数传入这个线程</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">routethread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) RouteThread, <span class="symbol">&amp;rp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中第四个参数就是传递了这个结构体进去。注意这个语句最好不要直接放在main方法中直接调用，可以在全部获取完MAC地址之后再开启这个线程。 那么接下来就说一下这个线程都干了些什么，只简略说一下核心部分。 首先开启了这个线程之后会一直都在执行，那么就可以加入</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">while((<span class="name">res</span> = pcap_next_ex(<span class="name">adhandle2</span>,<span class="symbol">&amp;header</span>,<span class="symbol">&amp;pkt_data</span>))&gt;=0)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的while判断语句来一直监听数据包的接收，然后解析数据。</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ethernet =  (EthernetHeader *)(pkt_data);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				sou_mac[i] = ethernet-&gt;SourMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				des_mac[i] = ethernet-&gt;DestMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			// 获得IP数据包头部的位置</span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="regexp">//</span><span class="number">14</span>为以太网帧头部长度</span><br><span class="line">			//获得TCP头部的位置</span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			data = (char *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"data:%s\n"</span>,data);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"ip:"</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d -&gt; %d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4);</span><br><span class="line">			 <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后接下来每接收到一个数据，就进行构建新的帧转发出去，目的MAC先匹配list表，如果list没有找到，那么我让他指定了一个mac，比如广播MAC。源MAC地址则赋值网卡的MAC地址。 注意，传统以太网中数据长度为45-1500，那么我在构建前把解析出的data作了下判断长度再构建，因为我已经把sendbuffer声明为一个固定长度了，为了防止越界，我先进行一个长度判断。</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//以下开始构建帧发送</span></span><br><span class="line">		<span class="comment">//首先判断data最大值小于1500</span></span><br><span class="line">		if(strlen(data)&lt;<span class="number">1500</span>)&#123;</span><br><span class="line">			<span class="comment">//目的MAC</span></span><br><span class="line">			BYTE send_destmac[<span class="number">6</span>];</span><br><span class="line">			bool findMac = false;</span><br><span class="line">			for(int c = <span class="number">0</span>;c&lt;con;c++)&#123;</span><br><span class="line">				if(ip-&gt;DestinationAddr.byte1 ==  <span class="type">list</span>[c].ip.byte1&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte2 == <span class="type">list</span>[c].ip.byte2&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte3 == <span class="type">list</span>[c].ip.byte3&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte4 == <span class="type">list</span>[c].ip.byte4)</span><br><span class="line">				&#123;</span><br><span class="line">					printf(<span class="string">"Find its MAC!<span class="subst">\n</span>"</span>);</span><br><span class="line">					findMac = true;</span><br><span class="line">					send_destmac[<span class="number">0</span>] = <span class="type">list</span>[c].mac[<span class="number">0</span>];   </span><br><span class="line">					send_destmac[<span class="number">1</span>] = <span class="type">list</span>[c].mac[<span class="number">1</span>];</span><br><span class="line">					send_destmac[<span class="number">2</span>] = <span class="type">list</span>[c].mac[<span class="number">2</span>];</span><br><span class="line">					send_destmac[<span class="number">3</span>] = <span class="type">list</span>[c].mac[<span class="number">3</span>];</span><br><span class="line">					send_destmac[<span class="number">4</span>] = <span class="type">list</span>[c].mac[<span class="number">4</span>];</span><br><span class="line">					send_destmac[<span class="number">5</span>] = <span class="type">list</span>[c].mac[<span class="number">5</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			if(!findMac)&#123;</span><br><span class="line">				send_destmac[<span class="number">0</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">1</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">2</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">3</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">4</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">5</span>] = <span class="number">0xff</span>;   </span><br><span class="line">			&#125;</span><br><span class="line">			printf(<span class="string">"destmac:%02x-%02x-%02x-%02x-%02x-%02x<span class="subst">\n</span>"</span>,</span><br><span class="line">				send_destmac[<span class="number">0</span>],send_destmac[<span class="number">1</span>],send_destmac[<span class="number">2</span>],</span><br><span class="line">				send_destmac[<span class="number">3</span>],send_destmac[<span class="number">4</span>],send_destmac[<span class="number">5</span>]</span><br><span class="line">				);</span><br><span class="line">			memcpy(send_ethernet.DestMAC, send_destmac, <span class="number">6</span>);</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			BYTE send_hostmac[<span class="number">6</span>];</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">0</span>] = local_mac[<span class="number">0</span>];     <span class="comment">//赋值本地MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">1</span>] = local_mac[<span class="number">1</span>];</span><br><span class="line">			send_hostmac[<span class="number">2</span>] = local_mac[<span class="number">2</span>];</span><br><span class="line">			send_hostmac[<span class="number">3</span>] = local_mac[<span class="number">3</span>];</span><br><span class="line">			send_hostmac[<span class="number">4</span>] = local_mac[<span class="number">4</span>];</span><br><span class="line">			send_hostmac[<span class="number">5</span>] = local_mac[<span class="number">5</span>];</span><br><span class="line">			<span class="comment">//赋值源MAC地址</span></span><br><span class="line">			memcpy(send_ethernet.SourMAC, send_hostmac, <span class="number">6</span>);</span><br><span class="line">			send_ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">			<span class="comment">//赋值SendBuffer</span></span><br><span class="line">			memcpy(&amp;SendBuffer, &amp;send_ethernet, sizeof(struct EthernetHeader));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上只是赋值了帧头，至于IP头，TCP头，数据的赋值就参照初级功能的来赋值吧，不要忘了校验和的检验。好，大体上就是这样，接受来数据包并转发出去的原理就是这样。</p>
                  <h3 id="三、接收"><a href="#三、接收" class="headerlink" title="三、接收"></a>三、接收</h3>
                  <p>不用多改，就是初级功能中的接收，在此写一写小小的优化措施，防止接收到过多的数据帧而造成不断乱蹦，导致你看不到接收的东西。 在打印的时候加一个过滤就好了。部分代码如下： 在main方法中提示用户输入要接收的IP地址</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">printf(<span class="string">"请输入要接收的IP地址,输入0.0.0.0代表全部接收,请输入\n"</span>);</span><br><span class="line">	<span class="built_in">bool</span> receiveAll = <span class="literal">false</span>;</span><br><span class="line">	u_int ip1,ip2,ip3,ip4;</span><br><span class="line">	<span class="built_in">bool</span> legal = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">while</span>(!legal)&#123;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">if</span>(ip1==<span class="number">0</span>&amp;&amp;ip2==<span class="number">0</span>&amp;&amp;ip3==<span class="number">0</span>&amp;&amp;ip4==<span class="number">0</span>)&#123;</span><br><span class="line">			receiveAll = <span class="literal">true</span>;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ip1&lt;<span class="number">0</span>||ip1&gt;<span class="number">255</span>||ip2&lt;<span class="number">0</span>||ip2&gt;<span class="number">255</span>||ip3&lt;<span class="number">0</span>||ip3&gt;<span class="number">255</span>||ip4&lt;<span class="number">1</span>||ip4&gt;<span class="number">254</span>)&#123;</span><br><span class="line">			legal = <span class="literal">false</span>;</span><br><span class="line">			printf(<span class="string">"对不起,IP输入不合法,请重新输入:\n"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>打印时的判断</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span>(receiveAll||(ip-&gt;SourceAddr.byte1==ip1&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte2==ip2&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte3==ip3&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte4==ip4))&#123;</span><br><span class="line">					<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			    <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"-----------------------------------------------------\n"</span>);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，代码就先放送这么多，具体的实现只要有了思路我相信肯定不难，如有问题，欢迎与我交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:19:22" itemprop="dateCreated datePublished" datetime="2015-07-13T01:19:22+08:00">2015-07-13</time>
                </span>
                <span id="/1922.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程六之两台主机通过中间主机通信" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">崔庆才的个人站点，记录生活的瞬间，分享学习的心得。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">518</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">21</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">121</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.abuyun.com/http-proxy/introduce.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/88au8.jpg" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ikkq9.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/599/" style="font-size: 10px;">599</a> <a href="/tags/Bootstrap/" style="font-size: 11.25px;">Bootstrap</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11.25px;">Eclipse</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/GitHub/" style="font-size: 11.25px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 11.25px;">PHP</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/PySpider/" style="font-size: 10px;">PySpider</a> <a href="/tags/Python/" style="font-size: 16.25px;">Python</a> <a href="/tags/Python3/" style="font-size: 12.5px;">Python3</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 10px;">Selenium</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/Ubuntu/" style="font-size: 11.25px;">Ubuntu</a> <a href="/tags/Vue/" style="font-size: 11.25px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13.75px;">WordPress</a> <a href="/tags/object-Object/" style="font-size: 10px;">[object Object]</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11.25px;">matlab</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/style/" style="font-size: 10px;">style</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/uwsgi/" style="font-size: 10px;">uwsgi</a> <a href="/tags/validate-cert/" style="font-size: 10px;">validate_cert</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/wamp/" style="font-size: 10px;">wamp</a> <a href="/tags/wineQQ/" style="font-size: 10px;">wineQQ</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 11.25px;">七牛</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 10px;">上海</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/" style="font-size: 10px;">个人网站</a> <a href="/tags/%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">主题</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 10px;">云存储</a> <a href="/tags/%E4%BA%AC%E4%B8%9C%E4%BA%91/" style="font-size: 10px;">京东云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 10px;">人工智能</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">代码</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size: 10px;">位运算</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 10px;">分享</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 10px;">创业</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 11.25px;">前端</a> <a href="/tags/%E5%8E%9F%E7%94%9FAPP/" style="font-size: 10px;">原生APP</a> <a href="/tags/%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 12.5px;">反爬虫</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80/" style="font-size: 10px;">响应式布局</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A/" style="font-size: 10px;">域名绑定</a> <a href="/tags/%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84/" style="font-size: 10px;">大众点评</a> <a href="/tags/%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">字体反爬虫</a> <a href="/tags/%E5%AE%9E%E7%94%A8/" style="font-size: 10px;">实用</a> <a href="/tags/%E5%B4%94%E5%BA%86%E6%89%8D/" style="font-size: 18.75px;">崔庆才</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE/" style="font-size: 10px;">手机访问</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">旅游</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9D%9C%E5%85%B0%E7%89%B9/" style="font-size: 10px;">杜兰特</a> <a href="/tags/%E6%A1%8C%E9%9D%A2/" style="font-size: 10px;">桌面</a> <a href="/tags/%E6%B1%9F%E5%8D%97/" style="font-size: 10px;">江南</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 10px;">环境变量</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">生活笔记</a> <a href="/tags/%E7%99%BB%E5%BD%95/" style="font-size: 10px;">登录</a> <a href="/tags/%E7%9F%A5%E4%B9%8E/" style="font-size: 10px;">知乎</a> <a href="/tags/%E7%9F%AD%E4%BF%A1/" style="font-size: 10px;">短信</a> <a href="/tags/%E7%BA%B8%E5%BC%A0/" style="font-size: 10px;">纸张</a> <a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 10px;">网站</a> <a href="/tags/%E8%82%89%E5%A4%B9%E9%A6%8D/" style="font-size: 10px;">肉夹馍</a> <a href="/tags/%E8%A5%BF%E5%B0%91%E7%88%B7/" style="font-size: 10px;">西少爷</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">远程</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">配置</a> <a href="/tags/%E9%87%8D%E8%A3%85/" style="font-size: 10px;">重装</a> <a href="/tags/%E9%9D%99%E8%A7%85/" style="font-size: 17.5px;">静觅</a> <a href="/tags/%E9%A2%A0%E8%A6%86/" style="font-size: 10px;">颠覆</a> <a href="/tags/%E9%A3%9E%E4%BF%A1/" style="font-size: 10px;">飞信</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">13</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">38</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">256</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">10</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">74</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ou6mm.jpg">
                  </span>
                  <span class="link">
                    <a href="https://diygod.me/" target="_blank" rel="noopener">DIYgod</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.jankl.com/img/titleshu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.jankl.com/" target="_blank" rel="noopener">liberalist</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/4i7yf.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lizenghai.com/" target="_blank" rel="noopener">Python量化投资</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/22uv1.png">
                  </span>
                  <span class="link">
                    <a href="http://www.cenchong.com/" target="_blank" rel="noopener">岑冲博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ev9kl.png">
                  </span>
                  <span class="link">
                    <a href="http://www.zxiaoji.com/" target="_blank" rel="noopener">张小鸡</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.chrafz.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.chrafz.com/" target="_blank" rel="noopener">张弦先生</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://seofangfa.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://seofangfa.com/" target="_blank" rel="noopener">方法SEO</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lfmj3.png">
                  </span>
                  <span class="link">
                    <a href="http://frankchen.xyz/" target="_blank" rel="noopener">不正经数据科学家</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/129d8.png">
                  </span>
                  <span class="link">
                    <a href="https://www.bysocket.com/" target="_blank" rel="noopener">泥瓦匠BYSocket</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/262r1.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.ysir308.com/" target="_blank" rel="noopener">程序员虾说</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">2.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">37:31</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": null,
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
