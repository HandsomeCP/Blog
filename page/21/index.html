<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": true,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "天验",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "华为云",
            "enable": false,
            "url": "https://activity.huaweicloud.com/2020_618_promotion/index.html?bpName=5f9f98a29e2c40b780c1793086f29fe2&bindType=1&salesID=wangyubei",
            "src": "https://qiniu.cuiqingcai.com/y42ik.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "张小鸡",
            "enable": false,
            "url": "http://www.zxiaoji.com/",
            "src": "https://qiniu.cuiqingcai.com/fm72f.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "Luminati",
            "src": "https://qiniu.cuiqingcai.com/ikkq9.jpg",
            "url": "https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095",
            "width": "100%",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/21/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="崔庆才">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="PHP">
  <meta property="article:tag" content="Java">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Spider">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Web">
  <meta property="article:tag" content="Kubernetes">
  <meta property="article:tag" content="深度学习">
  <meta property="article:tag" content="机器学习">
  <meta property="article:tag" content="数据分析">
  <meta property="article:tag" content="网络">
  <meta property="article:tag" content="IT">
  <meta property="article:tag" content="技术">
  <meta property="article:tag" content="博客">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/21/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://cuiqingcai.com/5052.html"><img title="Python3网络爬虫开发实战教程" src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/1052.html"><img title="Python2爬虫学习系列教程" src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 20 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1918.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1918.html" class="post-title-link" itemprop="url">Winpcap网络编程五之ARP协议获得MAC表及主机通信</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="学习文档"><a href="#学习文档" class="headerlink" title="学习文档"></a>学习文档</h2>
                  <p>这里我们直接进入正题吧，关于Winpcap的基础知识讲解这里就不再赘述了。在这里给大家提供一些学习网址 <a href="http://blog.csdn.net/column/details/winpcap.html" target="_blank" rel="noopener">Winpcap网络编程及通信教程</a><a href="http://www.ferrisxu.com/WinPcap/html/" target="_blank" rel="noopener">Winpcap中文技术文档</a></p>
                  <h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2>
                  <ul>
                    <li>获取设备列表</li>
                    <li>获取已安装设备的高级信息</li>
                    <li>打开适配器并捕获数据包</li>
                    <li>不用回调方法捕获数据包</li>
                    <li>过滤数据包</li>
                    <li>分析数据包</li>
                    <li>处理脱机堆文件</li>
                    <li>发送数据包</li>
                    <li>收集并统计网络流量</li>
                  </ul>
                  <p>这些内容，在上述两个链接中均已经有了比较详细的讲解，希望对大家有帮助。</p>
                  <h2 id="两台主机通信实战"><a href="#两台主机通信实战" class="headerlink" title="两台主机通信实战"></a>两台主机通信实战</h2>
                  <p>完成两台主机之间的数据通信（数据链路层）</p>
                  <ul>
                    <li>仿真ARP协议获得网段内主机的MAC表</li>
                    <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
                  </ul>
                  <p>首先我们要理解ARP是干嘛的，ARP主要作用就是通过IP地址来获取MAC地址。那么怎样获取呢？本机向局域网内主机发送ARP包，ARP包内包含了目的IP，源IP，目的MAC，源MAC，其中目的MAC地址为广播地址,FF-FF-FF-FF-FF-FF,即向局域网内所有主机发送一个ARP请求，那么其他主机收到这个请求之后则会向请求来源返回一个数据包。在这个返回的数据包中包含了自身的MAC地址。那么本机收到这些返回的数据包进行解析之后便会得到局域网内所有主机的MAC地址了.. 编程开始： 新建一个C++项目，配好环境，引入Winpcap相关的库，这些不再赘述。 头文件引入</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WPCAP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main函数中首先声明一系列变量如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">char</span> *ip_addr;                                    <span class="comment">//IP地址</span></span><br><span class="line"><span class="keyword">char</span> *ip_netmask;                             <span class="comment">//子网掩码</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac;          <span class="comment">//本机MAC地址</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为这三个变量分配地址空间</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ip_addr = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放IP地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_addr == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放IP地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_netmask = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放NETMASK地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_netmask == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放NETMASK地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_mac = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">char</span>) * <span class="number">6</span>); <span class="comment">//申请内存存放MAC地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_mac == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放MAC地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就是烂大街的程序,获取适配器列表并选中相应的适配器,注释已经在代码中了,如果还有不明白的请参照前几次的讲解。</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,NULL,&amp;alldevs,errbuf) == -<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		fprintf(stderr,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		exit(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">for</span>(d = alldevs;d !=NULL;d = d-&gt;</span>next)&#123;</span><br><span class="line">		<span class="function"><span class="title">printf</span>("-----------------------------------------------------------------\nnumber:%d\nname:%s\n",++i,d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">		<span class="function"><span class="title">if</span>(d-&gt;</span>description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="function"><span class="title">printf</span>("description:%s\n",d-&gt;</span>description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			printf(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		 <span class="function"><span class="title">printf</span>("\tLoopback: %s\n",(d-&gt;</span>flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		 <span class="comment">/**</span></span><br><span class="line"><span class="comment">		 pcap_addr *  next     指向下一个地址的指针</span></span><br><span class="line"><span class="comment">		 sockaddr *  addr       IP地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  netmask  子网掩码</span></span><br><span class="line"><span class="comment">		 sockaddr *  broadaddr   广播地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  dstaddr        目的地址</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		 pcap_addr_t *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="function"><span class="title">for</span>(a = d-&gt;</span><span class="function"><span class="title">addresses</span>;a;a = a-&gt;</span>next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="function"><span class="title">switch</span> (a-&gt;</span><span class="function"><span class="title">addr</span>-&gt;</span>sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 case AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="function"><span class="title">if</span>(a-&gt;</span>addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="function"><span class="title">printf</span>("Address:%s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">addr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>netmask)&#123;</span><br><span class="line">						 <span class="function"><span class="title">printf</span>("\tNetmask: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">netmask</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>broadaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tBroadcast Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">broadaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="function"><span class="title">if</span> (a-&gt;</span>dstaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tDestination Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">dstaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 break;</span><br><span class="line">				 case AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 printf(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 break;</span><br><span class="line">				 default:</span><br><span class="line">					 break;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		printf(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num;</span><br><span class="line">	printf(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	printf(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		printf(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														NULL,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == NULL)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上述代码中需要另外声明的有：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line"><span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line">#define IPTOSBUFFERS    <span class="number">12</span></span><br><span class="line">char *iptos(u_long <span class="keyword">in</span>)</span><br><span class="line">&#123;</span><br><span class="line">    static char output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    static short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;<span class="keyword">in</span>;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到此程序应该会编译通过，可以试着编译一下运行。 GO ON… 接下来我们首先要用ifget方法获取自身的IP和子网掩码 函数声明：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ifget</span><span class="params">(<span class="keyword">pcap_if_t</span> *d, <span class="keyword">char</span> *ip_addr, <span class="keyword">char</span> *ip_netmask)</span></span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">//获取IP和子网掩码赋值为ip_addr和ip_netmask</span></span><br><span class="line"><span class="regexp">void ifget(pcap_if_t *d, char *ip_addr, char *ip_netmask) &#123;</span></span><br><span class="line"><span class="regexp">	pcap_addr_t *a;</span></span><br><span class="line"><span class="regexp">	//</span>遍历所有的地址,a代表一个pcap_addr</span><br><span class="line">	<span class="keyword">for</span> (a = d-&gt;addresses; a; a = a-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family) &#123;</span><br><span class="line">		<span class="keyword">case</span> AF_INET:  <span class="regexp">//sa_family ：是2字节的地址家族，一般都是“AF_xxx”的形式。通常用的都是AF_INET。代表IPV4</span></span><br><span class="line"><span class="regexp">			if (a-&gt;addr) &#123;</span></span><br><span class="line"><span class="regexp">				char *ipstr;</span></span><br><span class="line"><span class="regexp">				//</span>将地址转化为字符串</span><br><span class="line">				ipstr = iptos<span class="function"><span class="params">(((struct sockaddr_in *) a-&gt;addr)-&gt;sin_addr.s_addr)</span>; //*<span class="title">ip_addr</span></span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"ipstr:%s\n"</span>,ipstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_addr, ipstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">			<span class="title">if</span> <span class="params">(a-&gt;netmask)</span> &#123;</span></span><br><span class="line"><span class="function">				<span class="title">char</span> *<span class="title">netmaskstr</span>;</span></span><br><span class="line"><span class="function">				<span class="title">netmaskstr</span> = <span class="title">iptos</span><span class="params">(((struct sockaddr_in *) a-&gt;netmask)-&gt;sin_addr.s_addr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"netmask:%s\n"</span>,netmaskstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_netmask, netmaskstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">		<span class="title">case</span> <span class="title">AF_INET6</span>:</span></span><br><span class="line"><span class="function">			<span class="title">break</span>;</span></span><br><span class="line"><span class="function">		&#125;</span></span><br><span class="line"><span class="function">	&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>main函数继续写，如下调用，之前声明的ip_addr和ip_netmask就已经被赋值了</p>
                  <figure class="highlight brainfuck">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">ifget(d</span><span class="string">,</span> <span class="comment">ip_addr</span><span class="string">,</span> <span class="comment">ip_netmask);</span> <span class="comment">//获取所选网卡的基本信息</span>--<span class="comment">掩码</span>--<span class="comment">IP地址</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在我们已经获取到了本机的IP和子网掩码，下一步发送一个ARP请求来获取自身的MAC地址 这个ARP请求的源IP地址就随便指定了，就相当于你构造了一个外来的ARP请求，本机捕获到了请求，然后发送回应给对方的数据包也被本机捕获到了并解析出来了。解析了自己发出去的数据包而已。 那么我们就声明一个函数并实现：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> <span class="constructor">GetSelfMac(<span class="params">pcap_t</span> <span class="operator">*</span><span class="params">adhandle</span>, <span class="params">const</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_addr</span>, <span class="params">unsigned</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_mac</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 获取自己主机的MAC地址</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetSelfMac</span><span class="params">(<span class="keyword">pcap_t</span> *adhandle, <span class="keyword">const</span> <span class="keyword">char</span> *ip_addr, <span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	EthernetHeader eh; <span class="comment">//以太网帧头</span></span><br><span class="line">	Arpheader ah;  <span class="comment">//ARP帧头</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="comment">//将已开辟内存空间 eh.dest_mac_add 的首 6个字节的值设为值 0xff。</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>); <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.SourMAC, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.SourceMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="comment">//htons将一个无符号短整型的主机数值转换为网络字节顺序</span></span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType= htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(<span class="string">"100.100.100.100"</span>); <span class="comment">//随便设的请求方ip</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	ah.DestIpAdd = inet_addr(ip_addr);</span><br><span class="line">	<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,sendbuf);</span><br><span class="line">	<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\nPacketSend succeed\n"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//从interface或离线记录文件获取一个报文</span></span><br><span class="line">	<span class="comment">//pcap_next_ex(pcap_t* p,struct pcap_pkthdr** pkt_header,const u_char** pkt_data)</span></span><br><span class="line">	<span class="keyword">while</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> short*) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> <span class="keyword">long</span>*) (pkt_data + <span class="number">38</span>)</span><br><span class="line">						== inet_addr(<span class="string">"100.100.100.100"</span>)) &#123;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">				ip_mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取自己主机的MAC地址成功!\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (i == <span class="number">6</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中我们需要定义一下常量如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_ARP         0x0806  <span class="comment">//以太网帧类型表示后面数据的类型，对于ARP请求或应答来说，该字段的值为x0806</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_HARDWARE    1  <span class="comment">//硬件类型字段值为表示以太网地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_IP          0x0800  <span class="comment">//协议类型字段表示要映射的协议地址类型值为x0800表示IP地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REQUEST     1   <span class="comment">//ARP请求</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REPLY       2      <span class="comment">//ARP应答</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HOSTNUM         255   <span class="comment">//主机数量</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外发送ARP请求少不了帧头和ARP头的结构，我们需要声明出来，另外我们构建发送包需要再声明两个结构体sparam和gparam</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//28字节ARP帧结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Arpheader</span> &#123;</span></span><br><span class="line">	<span class="keyword">unsigned</span> short HardwareType; <span class="comment">//硬件类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> short ProtocolType; <span class="comment">//协议类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> HardwareAddLen; <span class="comment">//硬件地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> ProtocolAddLen; <span class="comment">//协议地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> short OperationField; <span class="comment">//操作字段</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> SourceMacAdd[<span class="number">6</span>]; <span class="comment">//源mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> SourceIpAdd; <span class="comment">//源ip地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> DestMacAdd[<span class="number">6</span>]; <span class="comment">//目的mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> DestIpAdd; <span class="comment">//目的ip地址</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//arp包结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ArpPacket</span> &#123;</span></span><br><span class="line">	EthernetHeader ed;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> <span class="title">sp</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> <span class="title">gp</span>;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在代码也是完整可以运行的，如果有问题请检查上述代码完整性和位置。 可能出现的BUG： 只显示ARP发送成功，没有接受到并解析打印。可能的原因是帧构造有问题，字节没有对齐，有偏差，像#define一样 写入如下代码：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)  <span class="comment">//按一个字节内存对齐</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>GO ON.. 获取到了自身的MAC地址之后，就可以在本机上构建ARP广播请求，向局域网内的所有主机发送ARP请求，得到回应之后解析回应的数据包并进行解析，得到对方的MAC地址。在这里我们需要开启两个线程，一个用来发送一个用来接收。好，我们继续.. 先声明两个线程</p>
                  <figure class="highlight lasso">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">HANDLE</span> sendthread;      <span class="comment">//发送ARP包线程</span></span><br><span class="line"><span class="keyword">HANDLE</span> recvthread;       <span class="comment">//接受ARP包线程</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main方法中继续写，对sp和gp两个ARP请求所需要的结构体进行赋值。赋值什么？就是你之前用ifget获取来的IP地址和子网掩码以及用getSelfMac获取来的MAC地址。</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sp.adhandle = adhandle<span class="comment">;</span></span><br><span class="line">	sp.ip = ip_addr<span class="comment">;</span></span><br><span class="line">	sp.mac = ip_mac<span class="comment">;</span></span><br><span class="line">	sp.netmask = ip_netmask<span class="comment">;</span></span><br><span class="line">	gp.adhandle = adhandle<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来直接创建两个线程，一个是发送一个接受，分别调用两个方法。</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sendthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) SendArpPacket,</span><br><span class="line">			<span class="symbol">&amp;sp</span>, <span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	recvthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) GetLivePC, <span class="symbol">&amp;gp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	printf(<span class="string">"\nlistening on 网卡%d ...\n"</span>, i)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么发送数据包的方法和接收解析数据包的方法怎样实现呢？ 发送数据包，发送数据包先对结构体数据进行赋值，就像getSelfMac方法一样，然后声明了一个buffer用来存储每一个字节内容。 利用memset方法对buffer进行赋值。再利用一个for循环对255个主机进行发送，指定他们的IP地址。另外定义了一个flag,当发送成功之后将flag设置为1</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 向局域网内所有可能的IP地址发送ARP请求包线程 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">SendArpPacket</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle,char *ip,unsigned char *mac,char *netmask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sparam *spara = (sparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = spara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip = spara-&gt;ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac = spara-&gt;mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask = spara-&gt;netmask;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"ip_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>],</span><br><span class="line">			mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"自身的IP地址为:%s\n"</span>, ip);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"地址掩码NETMASK为:%s\n"</span>, netmask);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	EthernetHeader eh;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">	<span class="comment">//赋值MAC地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>);       <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memcpy</span>(eh.SourMAC, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(ah.SourceMacAdd, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType = htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(ip); <span class="comment">//请求方的IP地址为自身的IP地址</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	<span class="comment">//向局域网内广播发送arp包</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> myip = inet_addr(ip);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> mynetmask = inet_addr(netmask);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> hisip = htonl((myip &amp; mynetmask));</span><br><span class="line">	<span class="comment">//向255个主机发送</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; HOSTNUM; i++) &#123;</span><br><span class="line">		ah.DestIpAdd = htonl(hisip + i);</span><br><span class="line">		<span class="comment">//构造一个ARP请求</span></span><br><span class="line">		<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">		<span class="comment">//如果发送成功</span></span><br><span class="line">		<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//printf("\nPacketSend succeed\n");</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">50</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	Sleep(<span class="number">1000</span>);</span><br><span class="line">	flag = TRUE;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注: 此函数和flag变量在前面别忘了声明一下… 然后是接收数据包并打印MAC地址:</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 分析截留的数据包获取活动的主机IP地址 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">GetLivePC</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gparam *gpara = (gparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = gpara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> Mac[<span class="number">6</span>];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取MAC地址完毕,请输入你要发送对方的IP地址:\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)) &#123;</span><br><span class="line">				ArpPacket *recv = (ArpPacket *) pkt_data;</span><br><span class="line">				<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"-------------------------------------------\n"</span>);</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"IP地址:%d.%d.%d.%d   MAC地址:"</span>,</span><br><span class="line">						     recv-&gt;ah.SourceIpAdd &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">8</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">16</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">24</span> &amp; <span class="number">255</span>);</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">						Mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">"%02x"</span>, Mac[i]);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上暂告一段落，通过整合以上代码，我们可以得到如下运行结果：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">--------------------------------------------------</span><br><span class="line">number:1</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;5AC72F8D-019C-4003-B51B-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:2</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;C17EB3F6-1E86-40E5-8790-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.95.1</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:3</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;33E23A2F-F791-409B-8452-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Qualcomm Atheros Ar81</span></span><br><span class="line"><span class="emphasis">oller' on local host</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:121.250.216.237</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:4</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;DCCF036F-A9A8-4225-B980-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:5</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;D62A0060-F424-46FC-83A5-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:192.168.191.1</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:6</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;B5224A53-8450-4537-AB3B-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.191.2</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">Enter the interface number(1-6):3</span><br><span class="line"></span><br><span class="line">ipstr:121.250.216.237</span><br><span class="line">netmask:255.255.255.0</span><br><span class="line"></span><br><span class="line">PacketSend succeed</span><br><span class="line">获取自己主机的MAC地址成功!</span><br><span class="line"></span><br><span class="line">listening on 网卡2 ...</span><br><span class="line">ip<span class="emphasis">_mac:dc-0e-a1-ec-53-c3</span></span><br><span class="line"><span class="emphasis">自身的IP地址为:121.250.216.237</span></span><br><span class="line"><span class="emphasis">地址掩码NETMASK为:255.255.255.0</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">请按任意键继续. . . ------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.1   MAC地址:000fe28e6100</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.3   MAC地址:089e012d20d5</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.5   MAC地址:5404a6af5f2d</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.6   MAC地址:28d244248d81</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.7   MAC地址:80fa5b0283f3</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.8   MAC地址:14dae9005b9e</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.9   MAC地址:b82a72bf8bce</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.12   MAC地址:84c9b2fefeed</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.15   MAC地址:28d2440b4b1b</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.16   MAC地址:bcee7b969beb</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">........此处省略一万字....</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们让用户输入要发送的IP地址和要发送的数据</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">u_int ip1,ip2,ip3,ip4;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"请输入你要发送的内容:\n"</span>);</span><br><span class="line">		getchar();</span><br><span class="line">		gets_s(TcpData);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"要发送的内容:%s\n"</span>,TcpData);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>声明一下TcpData</p>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">char TcpData<span class="selector-attr">[20]</span>;   <span class="comment">//发送内容</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就是重头戏了，需要声明各种结构体，我们发送的是TCP数据，这样，TCP的TcpData 就作为真正的内容，然后在前面加上TCP头，IP头，帧头，还有校验和要正确。 最后构成一个完整的帧，那么另外声明的结构体如下，前面代码声明过的帧头部结构体就去掉了。</p>
                  <figure class="highlight objectivec">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//IP地址格式</span></span><br><span class="line"><span class="keyword">struct</span> IpAddress</span><br><span class="line">&#123;</span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="keyword">struct</span> EthernetHeader</span><br><span class="line">&#123;</span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> IpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    <span class="keyword">short</span> Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    <span class="keyword">short</span> Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    <span class="keyword">short</span> Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                   <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;          <span class="comment">//协议类型  1字节</span></span><br><span class="line">    <span class="keyword">short</span> Checksum;                       <span class="comment">//首部校验和 2字节</span></span><br><span class="line">	IpAddress SourceAddr;       <span class="comment">//源IP地址   4字节</span></span><br><span class="line">	IpAddress DestinationAddr; <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> TcpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="keyword">struct</span> PsdTcpHeader</span><br><span class="line">&#123;</span><br><span class="line">	IpAddress SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">	IpAddress DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>继续main函数中对各种结构体的数据进行初始化赋值，并计算校验和。</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//结构体初始化为0序列</span></span><br><span class="line">		<span class="built_in">memset</span>(&amp;ethernet, <span class="number">0</span>, <span class="keyword">sizeof</span>(ethernet));</span><br><span class="line">		BYTE destmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//目的MAC地址,此处没有对帧的MAC地址进行赋值，因为网卡设置的混杂模式，可以接受经过该网卡的所有帧。当然最好的方法是赋值为ARP刚才获取到的MAC地址，当然不赋值也可以捕捉到并解析，在此处仅做下说明。</span></span><br><span class="line">		destmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		destmac[<span class="number">1</span>] = <span class="number">0x11</span>;</span><br><span class="line">		destmac[<span class="number">2</span>] = <span class="number">0x22</span>;</span><br><span class="line">		destmac[<span class="number">3</span>] = <span class="number">0x33</span>;</span><br><span class="line">		destmac[<span class="number">4</span>] = <span class="number">0x44</span>;</span><br><span class="line">		destmac[<span class="number">5</span>] = <span class="number">0x55</span>;</span><br><span class="line">		<span class="comment">//赋值目的MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.DestMAC, destmac, <span class="number">6</span>);</span><br><span class="line">		BYTE hostmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//源MAC地址</span></span><br><span class="line">		hostmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		hostmac[<span class="number">1</span>] = <span class="number">0x1a</span>;</span><br><span class="line">		hostmac[<span class="number">2</span>] = <span class="number">0x4d</span>;</span><br><span class="line">		hostmac[<span class="number">3</span>] = <span class="number">0x70</span>;</span><br><span class="line">		hostmac[<span class="number">4</span>] = <span class="number">0xa3</span>;</span><br><span class="line">		hostmac[<span class="number">5</span>] = <span class="number">0x89</span>;</span><br><span class="line">		<span class="comment">//赋值源MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.SourMAC, hostmac, <span class="number">6</span>);</span><br><span class="line">		<span class="comment">//上层协议类型,0x0800代表IP协议</span></span><br><span class="line">		ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer, ðernet, <span class="keyword">sizeof</span>(struct EthernetHeader));</span><br><span class="line">		<span class="comment">//赋值IP头部信息</span></span><br><span class="line">		ip.Version_HLen = <span class="number">0x45</span>;</span><br><span class="line">		ip.TOS = <span class="number">0</span>;</span><br><span class="line">		ip.Length = htons(<span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		ip.Ident = htons(<span class="number">1</span>);</span><br><span class="line">		ip.Flags_Offset = <span class="number">0</span>;</span><br><span class="line">		ip.TTL = <span class="number">128</span>;</span><br><span class="line">		ip.Protocol = <span class="number">6</span>;</span><br><span class="line">		ip.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//源IP地址</span></span><br><span class="line">		ip.SourceAddr.byte1 = <span class="number">127</span>;</span><br><span class="line">		ip.SourceAddr.byte2 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte3 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte4 = <span class="number">1</span>;</span><br><span class="line">		<span class="comment">//目的IP地址</span></span><br><span class="line">		ip.DestinationAddr.byte1 = ip1;</span><br><span class="line">		ip.DestinationAddr.byte2 = ip2;</span><br><span class="line">		ip.DestinationAddr.byte3 = ip3;</span><br><span class="line">		ip.DestinationAddr.byte4 = ip4;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader)], &amp;ip, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值TCP头部内容</span></span><br><span class="line">		tcp.DstPort = htons(<span class="number">102</span>);</span><br><span class="line">		tcp.SrcPort = htons(<span class="number">1000</span>);</span><br><span class="line">		tcp.SequenceNum = htonl(<span class="number">11</span>);</span><br><span class="line">		tcp.Acknowledgment = <span class="number">0</span>;</span><br><span class="line">		tcp.HdrLen = <span class="number">0x50</span>;</span><br><span class="line">		tcp.Flags = <span class="number">0x18</span>;</span><br><span class="line">		tcp.AdvertisedWindow = htons(<span class="number">512</span>);</span><br><span class="line">		tcp.UrgPtr = <span class="number">0</span>;</span><br><span class="line">		tcp.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="number">20</span>], &amp;tcp, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值伪首部</span></span><br><span class="line">		ptcp.SourceAddr = ip.SourceAddr;</span><br><span class="line">		ptcp.DestinationAddr = ip.DestinationAddr;</span><br><span class="line">		ptcp.Zero = <span class="number">0</span>;</span><br><span class="line">		ptcp.Protcol = <span class="number">6</span>;</span><br><span class="line">		ptcp.TcpLen = htons(<span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//声明临时存储变量，用来计算校验和</span></span><br><span class="line">		<span class="keyword">char</span> TempBuffer[<span class="number">65535</span>];</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ptcp, <span class="keyword">sizeof</span>(struct PsdTcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//计算TCP的校验和</span></span><br><span class="line">		tcp.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，因为此时校验和已经改变，赋值新的</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//初始化TempBuffer为0序列，存储变量来计算IP校验和</span></span><br><span class="line">		<span class="built_in">memset</span>(TempBuffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(TempBuffer));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//计算IP校验和</span></span><br><span class="line">		ip.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，IP校验和已经改变</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader), &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//发送序列的长度</span></span><br><span class="line">		<span class="keyword">int</span> <span class="built_in">size</span> = <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData);</span><br><span class="line">		<span class="keyword">int</span> result = pcap_sendpacket(adhandle, SendBuffer,<span class="built_in">size</span>);</span><br><span class="line">		<span class="keyword">if</span> (result != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Error!\n"</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send TCP Packet.\n"</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Dstination Port:%d\n"</span>, ntohs(tcp.DstPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Source Port:%d\n"</span>, ntohs(tcp.SrcPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Sequence:%d\n"</span>, ntohl(tcp.SequenceNum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Acknowledgment:%d\n"</span>, ntohl(tcp.Acknowledgment));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Header Length:%d*4\n"</span>, tcp.HdrLen &gt;&gt; <span class="number">4</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Flags:0x%0x\n"</span>, tcp.Flags);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"AdvertiseWindow:%d\n"</span>, ntohs(tcp.AdvertisedWindow));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"UrgPtr:%d\n"</span>, ntohs(tcp.UrgPtr));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Checksum:%u\n"</span>, ntohs(tcp.Checksum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Successfully!\n"</span>);</span><br><span class="line">		&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>校验和方法如下：</p>
                  <figure class="highlight objectivec">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//获得校验和的方法</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> checksum(<span class="keyword">unsigned</span> <span class="keyword">short</span> *data, <span class="keyword">int</span> length)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        temp +=  *data++;</span><br><span class="line">        length -= <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">short</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length)</span><br><span class="line">    &#123;</span><br><span class="line">        temp += *(<span class="keyword">unsigned</span> <span class="keyword">short</span>*)data;</span><br><span class="line">    &#125;</span><br><span class="line">    temp = (temp &gt;&gt; <span class="number">16</span>) + (temp &amp;<span class="number">0xffff</span>);</span><br><span class="line">    temp += (temp &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">short</span>)(~temp);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>记得在声明一下这个方法。如果放在main函数前当然就不用声明啦。 另外需要声明的变量有</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span> <span class="title">ethernet</span>;</span>    <span class="comment">//以太网帧头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span> <span class="title">ip</span>;</span>                            <span class="comment">//IP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span> <span class="title">tcp</span>;</span>                      <span class="comment">//TCP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span> <span class="title">ptcp</span>;</span>             <span class="comment">//TCP伪首部</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> SendBuffer[<span class="number">200</span>];       <span class="comment">//发送队列</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来的运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">获取MAC地址完毕,请输</span><br><span class="line"><span class="number">121.250</span><span class="number">.216</span><span class="number">.112</span></span><br><span class="line">请输入你要发送的内容</span><br><span class="line">what <span class="keyword">is</span> tcp</span><br><span class="line">要发送的内容:what i</span><br><span class="line">Send TCP Packet.</span><br><span class="line">Dstination Port:<span class="number">102</span></span><br><span class="line">Source Port:<span class="number">1000</span></span><br><span class="line">Sequence:<span class="number">11</span></span><br><span class="line">Acknowledgment:<span class="number">0</span></span><br><span class="line">Header Length:<span class="number">5</span>*<span class="number">4</span></span><br><span class="line">Flags:<span class="number">0x18</span></span><br><span class="line">AdvertiseWindow:<span class="number">512</span></span><br><span class="line">UrgPtr:<span class="number">0</span></span><br><span class="line">Checksum:<span class="number">17149</span></span><br><span class="line">Send Successfully!</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>截图如下： <img src="http://img.blog.csdn.net/20141018211905731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，发送帧到此就告一段落啦！如果有疑问请留言。 帧的接收很简单，直接贴源码如下：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">packet_handler</span><span class="params">(u_char *param, <span class="keyword">const</span> struct pcap_pkthdr *header, <span class="keyword">const</span> u_char *pkt_data)</span></span>;</span><br><span class="line"><span class="comment">//struct tm *ltime;					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpAddress</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    short Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    short Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    short Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                    <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;           <span class="comment">//协议类型  1字节</span></span><br><span class="line">    short Checksum;                        <span class="comment">//首部校验和 2字节</span></span><br><span class="line">    IpAddress SourceAddr;           <span class="comment">//源IP地址   4字节</span></span><br><span class="line">    IpAddress DestinationAddr;   <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> short SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> short AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	EthernetHeader *ethernet;    <span class="comment">//以太网帧头</span></span><br><span class="line">    IpHeader *ip;                            <span class="comment">//IP头</span></span><br><span class="line">    TcpHeader *tcp;                      <span class="comment">//TCP头</span></span><br><span class="line">    PsdTcpHeader *ptcp;             <span class="comment">//TCP伪首部</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line">	<span class="keyword">char</span> source[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> *<span class="title">header</span>;</span>    <span class="comment">//接收到的数据包的头部</span></span><br><span class="line">    <span class="keyword">const</span> u_char *pkt_data;			  <span class="comment">//接收到的数据包的内容</span></span><br><span class="line">	<span class="keyword">int</span> res;                                    <span class="comment">//表示是否接收到了数据包</span></span><br><span class="line">	u_int netmask;                       <span class="comment">//过滤时用的子网掩码</span></span><br><span class="line">	<span class="keyword">char</span> packet_filter[] = <span class="string">"tcp"</span>;        <span class="comment">//过滤字符</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bpf_program</span> <span class="title">fcode</span>;</span>                     <span class="comment">//pcap_compile所调用的结构体</span></span><br><span class="line"></span><br><span class="line">	u_int ip_len;                                       <span class="comment">//ip地址有效长度</span></span><br><span class="line">	u_short sport,dport;                        <span class="comment">//主机字节序列</span></span><br><span class="line">	u_char packet[<span class="number">100</span>];                       <span class="comment">//发送数据包目的地址</span></span><br><span class="line">	<span class="keyword">pcap_dumper_t</span> *dumpfile;         <span class="comment">//堆文件</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//time_t local_tv_sec;				//和时间处理有关的变量</span></span><br><span class="line">    <span class="comment">//char timestr[16];					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,<span class="literal">NULL</span>,&amp;alldevs,errbuf) == <span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//打印设备列表信息</span></span><br><span class="line">	<span class="keyword">for</span>(d = alldevs;d !=<span class="literal">NULL</span>;d = d-&gt;next)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"-----------------------------------------------------------------\nnumber:%d\nname:%s\n"</span>,++i,d-&gt;name);</span><br><span class="line">		<span class="keyword">if</span>(d-&gt;description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s\n"</span>,d-&gt;description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\tLoopback: %s\n"</span>,(d-&gt;flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">pcap_addr_t</span> *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="keyword">for</span>(a = d-&gt;addresses;a;a = a-&gt;next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="keyword">if</span>(a-&gt;addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"Address:%s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;addr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;netmask)&#123;</span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"\tNetmask: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;netmask)-&gt;sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;broadaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tBroadcast Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;broadaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="keyword">if</span> (a-&gt;dstaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tDestination Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;dstaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">default</span>:</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> num;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; num<span class="number">-1</span> ; d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="keyword">if</span>((adhandle = pcap_open(d-&gt;name,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														<span class="literal">NULL</span>,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印输出,正在监听中</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nlistening on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//所在网络不是以太网,此处只取这种情况</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_datalink(adhandle) != DLT_EN10MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nThis program works only on Ethernet networks.\n"</span>);</span><br><span class="line">        <span class="comment">//释放列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//先获得地址的子网掩码</span></span><br><span class="line">	<span class="keyword">if</span>(d-&gt;addresses != <span class="literal">NULL</span>)</span><br><span class="line">        <span class="comment">//获得接口第一个地址的掩码 </span></span><br><span class="line">        netmask=((struct sockaddr_in *)(d-&gt;addresses-&gt;netmask))-&gt;sin_addr.S_un.S_addr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 如果接口没有地址，那么我们假设一个C类的掩码</span></span><br><span class="line">        netmask=<span class="number">0xffffff</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//pcap_compile()的原理是将高层的布尔过滤表</span></span><br><span class="line">	<span class="comment">//达式编译成能够被过滤引擎所解释的低层的字节码</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_compile(adhandle,	<span class="comment">//适配器处理对象</span></span><br><span class="line">										&amp;fcode,</span><br><span class="line">										packet_filter,   <span class="comment">//过滤ip和UDP</span></span><br><span class="line">										<span class="number">1</span>,                       <span class="comment">//优化标志</span></span><br><span class="line">										netmask           <span class="comment">//子网掩码</span></span><br><span class="line">										)&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//过滤出现问题</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to compile the packet filter. Check the syntax.\n"</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置过滤器</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_setfilter(adhandle, &amp;fcode)&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nError setting the filter.\n"</span>);</span><br><span class="line">        <span class="comment">//释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//利用pcap_next_ex来接受数据包</span></span><br><span class="line">	<span class="keyword">while</span>((res = pcap_next_ex(adhandle,&amp;header,&amp;pkt_data))&gt;=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(res ==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//返回值为0代表接受数据包超时，重新循环继续接收</span></span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//运行到此处代表接受到正常从数据包</span></span><br><span class="line">			<span class="comment">//header为帧的头部</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%.6ld len:%d "</span>, header-&gt;ts.tv_usec, header-&gt;len);</span><br><span class="line">			<span class="comment">// 获得IP数据包头部的位置</span></span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="comment">//14为以太网帧头部长度</span></span><br><span class="line">			<span class="comment">//获得TCP头部的位置</span></span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"ip_length:%d "</span>,ip_len);</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			<span class="keyword">char</span> * data;</span><br><span class="line">			 data = (<span class="keyword">char</span> *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			 <span class="comment">//将网络字节序列转换成主机字节序列</span></span><br><span class="line">			sport = ntohs( tcp-&gt;SrcPort );</span><br><span class="line">			dport = ntohs( tcp-&gt;DstPort );</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"srcport:%d desport:%d\n"</span>,sport,dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//释放网络适配器列表</span></span><br><span class="line">	pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	int pcap_loop  ( pcap_t *  p,  </span></span><br><span class="line"><span class="comment">								  int  cnt,  </span></span><br><span class="line"><span class="comment">								  pcap_handler  callback,  </span></span><br><span class="line"><span class="comment">								  u_char *  user   </span></span><br><span class="line"><span class="comment">								 );</span></span><br><span class="line"><span class="comment">     typedef void (*pcap_handler)(u_char *, const struct pcap_pkthdr *,</span></span><br><span class="line"><span class="comment">                 const u_char *);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//开始捕获信息,当捕获到数据包时,会自动调用这个函数</span></span><br><span class="line">	<span class="comment">//pcap_loop(adhandle,0,packet_handler,NULL);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	scanf_s(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 每次捕获到数据包时，libpcap都会自动调用这个回调函数 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">pcap_loop()函数是基于回调的原理来进行数据捕获的，如技术文档所说，这是一种精妙的方法，并且在某些场合下，</span></span><br><span class="line"><span class="comment">它是一种很好的选择。但是在处理回调有时候会并不实用，它会增加程序的复杂度，特别是在多线程的C++程序中</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void packet_handler(u_char *param, const struct pcap_pkthdr *header, const u_char *pkt_data)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    struct tm *ltime = NULL;</span></span><br><span class="line"><span class="comment">    char timestr[16];</span></span><br><span class="line"><span class="comment">    time_t local_tv_sec;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 将时间戳转换成可识别的格式</span></span><br><span class="line"><span class="comment">    local_tv_sec = header-&gt;ts.tv_sec;</span></span><br><span class="line"><span class="comment">    localtime_s(ltime,&amp;local_tv_sec);</span></span><br><span class="line"><span class="comment">    strftime( timestr, sizeof timestr, "%H:%M:%S", ltime);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    printf("%s,%.6ld len:%d\n", timestr, header-&gt;ts.tv_usec, header-&gt;len);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IPTOSBUFFERS    12</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">static</span> short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;in;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> 运行截图如下 <img src="http://img.blog.csdn.net/20141018212813479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141018212943896?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> Thank You 如有问题，欢迎留言~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:14:21" itemprop="dateCreated datePublished" datetime="2015-07-13T01:14:21+08:00">2015-07-13</time>
                </span>
                <span id="/1918.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程五之ARP协议获得MAC表及主机通信" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>28k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>26 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1913.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1913.html" class="post-title-link" itemprop="url">Winpcap网络编程四之环境配置，VS配置Winpcap环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一篇我们介绍了Eclipse配置Winpcap环境。但是美中不足的是Eclipse编写Winpcap会出现各种各样神奇的错误… 本文原文地址： <a href="http://blog.csdn.net/cqcre/article/details/40429517" target="_blank" rel="noopener">我的CSDN博客</a> 其实也不是不能用，就是总是报一些函数不能识别的错误，每次不能识别的函数就是因为缺少了各种各样的头文件或者宏定义…让我比较纠结，心中不由得萌生了一个想法，换个环境试试吧，于是VS环境配置就这么神奇的产生了…. 好，接下来我以VS2012为例为大家讲解Winpcap环境配置，其实VS2010，VS2013等等的版本都是通用哒.. 首先你要有一个VS…这不是废话么… 首先，按照 <a href="http://cuiqingcai.com/1906.html">Eclipse配置Winpcap环境</a> 配置好Winpcap和下载好相关的SDK，这里就不再赘述了 好，文件-新建-项目-Win32控制台应用程序，可以修改下面的路径和项目名称，然后确定 <img src="http://img.blog.csdn.net/20141024163401921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就会蹦出一个窗口..点击下一步 <img src="http://img.blog.csdn.net/20141024163542249?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，勾选空项目，然后点击确定，空项目一定要勾选，不然会生成一些不必要的文件。 <img src="http://img.blog.csdn.net/20141024163702870?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击完成，现在看到的界面如下： <img src="http://img.blog.csdn.net/20141024163856875?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 在项目名上右键单击，选择属性 链接器选项卡—输入—附加依赖项中在前面输入ws2_32.lib;wpcap.lib; 两个类库，截图如下 <img src="http://img.blog.csdn.net/20141024164256328?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> C/C++选项卡—-预处理器—-预处理器定义键入HAVE_REMOTE;WPCAP; 如图所示 <img src="http://img.blog.csdn.net/20141024164409203?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> VC++目录，加入你的Winpcap类库路径，文件夹应该叫WpdPack，一个是Include,一个是lib,这是绝对路径，你的可能与我的不一样，截图如下 <img src="http://img.blog.csdn.net/20141024164629073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了。点击确定，环境就配好啦。 接下来新建一个cpp文件，运行程序就OK了… <img src="http://img.blog.csdn.net/20141024164828671?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 如有问题，欢迎留言交流</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:02:24" itemprop="dateCreated datePublished" datetime="2015-07-13T01:02:24+08:00">2015-07-13</time>
                </span>
                <span id="/1913.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程四之环境配置，VS配置Winpcap环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>662</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1906.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1906.html" class="post-title-link" itemprop="url">Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，本节为大家带来在Eclipse下配置Winpcap环境，欢迎大家收看。 本文原文地址来自： <a href="http://blog.csdn.net/cqcre/article/details/39754917" target="_blank" rel="noopener">我的CSDN博客</a> 首先，配置Winpcap环境的前提是你必须配置好了Eclipse下的C/C++环境。如果你还没有配置，欢迎大家收看上节内容进行配置。 链接地址： <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">Eclipse配置C/C++环境</a> 若链接失效，请自行查看上一篇文章或者百度其他文章。 废话不多说啦，开始我们的Winpcap的配置。</p>
                  <h2 id="Winpcap下载"><a href="#Winpcap下载" class="headerlink" title="Winpcap下载"></a>Winpcap下载</h2>
                  <p>Winpcap官网： <a href="http://www.winpcap.org/" target="_blank" rel="noopener">Winpcap官网</a> Winpcap目前最新版为4.1.3,首先你要下载exe文件并安装，直接双击运行安装即可。 下载地址： <a href="http://www.winpcap.org/install/default.htm" target="_blank" rel="noopener">Winpcap4.1.3.exe</a> 然后你需要下载开发包，首先必须注意的是，目前最新版本是没有开发包的，最新的开发包为4.1.2，先见下图 <img src="http://img.blog.csdn.net/20141003120936027?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下面的红色框说明了目前没有提供Winpcap4.1.3的开发包，最新版本的开发包是4.1.2，他可以与4.1.3的Winpcap配套使用。 所以下载4.1.2的开发包。 下载地址： <a href="http://www.winpcap.org/devel.htm" target="_blank" rel="noopener">Winpcap Developer’s Pack 4.1.2</a></p>
                  <h2 id="Eclipse相关配置"><a href="#Eclipse相关配置" class="headerlink" title="Eclipse相关配置"></a>Eclipse相关配置</h2>
                  <p>首先新建一个C 的项目，具体的建立过程可以参见上一节的内容。 我们加入一个测试代码如下：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>把代码拷贝到你的项目程序里面，可以发现现在是编译错误，有些对象根本无法识别，截图如下： <img src="http://img.blog.csdn.net/20141003121756538?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就需要我们对类库进行配置啦。 首先解压你下载的开发包，随便放硬盘的某个位置，我放在了D盘的eclipse_plugins文件夹中，当然你可以随便放哪里都行。 <img src="http://img.blog.csdn.net/20141003122134034?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来配置Eclipse，右键项目-&gt;属性-&gt;C/C++常规-&gt;项目和符号。 <img src="http://img.blog.csdn.net/20141003122332235?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 首先添加你的include库，在包含这个选项卡中添加你的库，点击添加-&gt;选择文件系统-&gt;选择你刚才的开发库的include文件夹，按照图中的顺序来 <img src="http://img.blog.csdn.net/20141003122614796?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003122856279?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加，同理在库路径选项卡中进行库路径的配置，这次添加的是lib文件夹。按照图片中的顺序来做 <img src="http://img.blog.csdn.net/20141003123234570?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003123311433?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加。 然后在库的选项卡中添加wpcap和Packet两个库，注意这次不能选择文件系统了，因为你指定了库路径之后它会自动搜索路径中库的名字，这次你只需要指定库的名字就好了。我之前添加的是文件系统，然后它总是提示找不到这个库，所以一定要直接填写这两个库的名字。如图所示： <img src="http://img.blog.csdn.net/20141003123715375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 添加完毕之后，出现这个样子： <img src="http://img.blog.csdn.net/20141003123823109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，点击确定，全部配置已经完毕啦。 重新构建项目，运行即可。 注意，构建过程可能出现如下问题：</p>
                  <ul>
                    <li>error C2065: “PCAP_SRC_IF_STRING”: 未声明的标识符</li>
                    <li>error C3861: “pcap_findalldevs_ex”: 找不到标识符</li>
                    <li>error C2065: “PCAP_OPENFLAG_PROMISCUOUS”: 未声明的标识符</li>
                    <li>error C3861: “pcap_open”: 找不到标识符</li>
                  </ul>
                  <p>因为新的版本里WinPcap支持远程数据包获取，所以还应当添加一个头文件remote-ext.h ，即#include “remote-ext.h”（记住这条语句要放在#include “pcap.h”之后，否则会出错！） <img src="http://img.blog.csdn.net/20141003124531280?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了，一切问题都解决了，运行成功啦！ 运行结果如下： <img src="http://img.blog.csdn.net/20141003124547093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 再附测试代码一例：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1</span>. rpcap://\Device\NPF_&#123;5AC72F8D-<span class="number">019C</span>-<span class="number">4003</span>-B51B-7ABB67AF392A&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">2</span>. rpcap://\Device\NPF_&#123;33E23A2F-F791-<span class="number">409B-8452</span>-A3FB5A78B73E&#125; (Network adapter 'Qualcomm Atheros Ar81xx series PCI-E Ethernet Controller' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">3</span>. rpcap://\Device\NPF_&#123;DCCF036F-A9A8-<span class="number">4225</span>-B980-D3A3F0575F5B&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">4</span>. rpcap://\Device\NPF_&#123;D62A0060-F424-46FC-83A5-3394081685FD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">5</span>. rpcap://\Device\NPF_&#123;B5224A53-<span class="number">8450</span>-<span class="number">4537</span>-AB3B-9869158121CD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么环境配好了，我们接下来就要进行计算机网络编程学习阶段了，后期的文章将会记录我计算机网络编程学习的一些内容，欢迎大家收看。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:54:24" itemprop="dateCreated datePublished" datetime="2015-07-13T00:54:24+08:00">2015-07-13</time>
                </span>
                <span id="/1906.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1898.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1898.html" class="post-title-link" itemprop="url">Winpcap网络编程二之环境配置，Eclipse配置C/C++环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本次为大家带来的是用Eclipse配置C/C++环境的具体步骤，希望对大家有帮助哦。 <strong>声明：如果你希望用Eclipse开发，可以参考本文章配置环境，如若想用VS开发，请看后面的文章。</strong> 本文原文地址来自 <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">我的CSDN博客</a> Eclipse 配置C/C++开发环境讲解</p>
                  <h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2>
                  <p>如果没有安装JDK环境的小伙伴请自行去官网下载安装啦，安装之后的就可以跳过此步. 下载地址： <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">JDK下载</a><a href="http://jingyan.baidu.com/article/6dad5075d1dc40a123e36ea3.html" target="_blank" rel="noopener">JDK环境配置</a></p>
                  <h2 id="Eclipse"><a href="#Eclipse" class="headerlink" title="Eclipse"></a>Eclipse</h2>
                  <p>当然，下载JDK的目的是在Eclipse下先运行起Java程序，这样才能方便我们下一步的操作，没有Eclipse的也去下载。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/eclipse/downloads/drops/R-3.7-201106131736/eclipse-SDK-3.7-win32.zip" target="_blank" rel="noopener">Eclipse下载</a> 上面两步我想难度都很小，而且大部分同学已经配置了，我就不一一讲解了。</p>
                  <h2 id="CDT"><a href="#CDT" class="headerlink" title="CDT"></a>CDT</h2>
                  <p>CDT是什么？它就是Eclipse的一个插件，我们需要安装了之后才可以新建C/C++项目。 注意：下载的CDT必须和Eclipse的版本对应。 下载地址： <a href="http://www.eclipse.org/cdt/" target="_blank" rel="noopener">CDT下载</a> 上面下载的Eclipse是3.7版本，在此给出适配CDT 8.0的下载链接。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;url=http://mirrors.ustc.edu.cn/eclipse/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;mirror_id=1093" target="_blank" rel="noopener">CDT 8.0下载</a> 如果上述链接已失效，请自行百度适配你Eclipse版本的CDT进行下载。 下载之后它是一个压缩包zip格式。 不要解压直接安装即可，安装讲解如下： 打开Eclipse，进入菜单Help，选择Install New Software…，点击右边Add按钮，在Add Repository对话框中点击右下角的Archive…，浏览到你之前下载保存路径，选中cdt-master-8.0.0.zip并双击，勾选所有CDT部件，然后点击Next&gt;，继续Next&gt;，选中“I accept the terms of the license agreement – Finish”，点击Finish开始安装CDT。 <img src="http://img.blog.csdn.net/20141003110738384?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 安装完CDT后重启Eclipse。 <img src="http://img.blog.csdn.net/20141003110647109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 这样我们的Eclipse的CDT插件就安装好啦，这时你会发现可以新建C/C++项目了，但是还是不能编译运行，为什么？因为没有安装编译器。接下来我们需要下载mingw编译器。</p>
                  <h2 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h2>
                  <p>这是一个配套Eclipse的C/C++编译器，首先我们下载下来。 官网下载地址： <a href="http://sourceforge.net/projects/mingw/files/MinGW/" target="_blank" rel="noopener">mingw官网下载</a> 现在发现最新版本下载是： <a href="http://sourceforge.net/projects/mingw/files/latest/download?source=files" target="_blank" rel="noopener">mingw-get-setup.exe</a> 双击运行，选择安装路径，我的路径为：D:\mingw，安装完成之后你会发现出现一个下载库的窗口，叫Mingw Installation Manager 注意： 1. 我的类库已经安装完毕，所以每个类库前面都显示为绿色的方框，没安装之前是白色的，你需要都勾选上，然后下载安装。在每个类库上邮件单击选择make for installation即可勾选。再点击菜单中的Installation中的Update Catalogue即可安装你所勾选的类库了。 2. 安装下载可能花费不少时间，请耐心等待。 <img src="http://img.blog.csdn.net/20141003111834646?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 大家可以发现最左边有Basic Steup和All Packages两个分类。 第一个Basic Steup即为必须要安装的编译类库，All Packages即为所有的类库。为了保险起见，我把所有的类库都安装了。全部安装完之后即会显示绿色。 安装完之后的目录结构如下： <img src="http://img.blog.csdn.net/20141003112632413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
                  <h2 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h2>
                  <p>环境变量配置： 计算机– 属性 – 高级系统设置 – 环境变量 在上方的用户变量中进行如下操作： 注意：mingw的位置不同，环境变量的配置不同，可以看最底层目录比对着来配置。我的环境变量配置如下：</p>
                  <blockquote>
                    <p>（1）编辑PATH变量，在最后面加入 D:\mingw\bin D:\mingw\msys\1.0\bin D:\mingw\mingw32\bin （2）添加LIBRARY_PATH变量，内容为： D:\mingw\lib （3）添加C_INCLUDE_PATH变量，内容为： D:\mingw\include （4）添加CPLUS_INCLUDE_PATH变量，内容为： D:\mingw\lib\gcc\mingw32\4.8.1\include\c++</p>
                  </blockquote>
                  <p>修改：</p>
                  <blockquote>
                    <p>进入D:\mingw\bin下将mingw32-make.exe复制成make.exe。因为Eclipse使用时预设是用系统里的”make”这个文件名，而不是”mingw32-make”。</p>
                  </blockquote>
                  <p>Eclipse中的配置： 窗口 -&gt; 首选项 -&gt; C/C++ -&gt; New CDT Project Wizard 在右边的首选工具链的右边，工具链栏目内选择MinGW GCC，确定，如图所示： <img src="http://img.blog.csdn.net/20141003113658894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 还是在原来的 New CDT Project Wizard选项卡中，展开，Makefile项目，二进制解析器，勾选PE windows解析器，确定，如图所示。 <img src="http://img.blog.csdn.net/20141003113807484?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，配置工作完成，我们来测试一下新C语言项目。</p>
                  <h2 id="测试项目"><a href="#测试项目" class="headerlink" title="测试项目"></a>测试项目</h2>
                  <p>右键新建-&gt;项目-&gt;C项目 <img src="http://img.blog.csdn.net/20141003114106872?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，选择可执行文件，Hello World ANCI C Project 编译器选择 MinGw GCC 完成，如图所示： <img src="http://img.blog.csdn.net/20141003114126625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 完成之后的界面应该是如下所示，点击构建项目，图中的红色圆圈，构建完成之后，右键运行程序 <img src="http://img.blog.csdn.net/20141003114748589?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003114637750?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 运行结果： <img src="http://img.blog.csdn.net/20141003115048145?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 欢呼吧小伙伴们 ! Eclipse 配置C/C++环境到此完全结束，如果有问题欢迎交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:45:39" itemprop="dateCreated datePublished" datetime="2015-07-13T00:45:39+08:00">2015-07-13</time>
                </span>
                <span id="/1898.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程二之环境配置，Eclipse配置C/C++环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1890.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1890.html" class="post-title-link" itemprop="url">Winpcap网络编程一之前言，实验要求，实验目标</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Hi，大家好，现在计算机网络课程设计开始啦，本次为大家带来计算机网络实验的系列讲解，希望对于小伙伴们的计网课设有一定帮助哦。</p>
                  <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2>
                  <p>首先，博主来自山东大学，这次计网课程设计的实验学校为山东大学，年级为2012级，请对号入座。 另外，对于上学期学的计算机网络课程知识，可以说我就是为了应付考试最后狂背下来的，感觉对于计算机网络里的一些原理真的没有理解。纯粹看一些概念性的东西真的是太抽象啦，这次计网课设的目的就是让我们用编程实现网络分析技术和网络功能仿真，来深入了解计算机网络知识。可以说这些才是学习计算机网络最重要的一环，大家加油。</p>
                  <h2 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h2>
                  <p>1、基本任务（达标任务） 完成两台主机之间的数据通信（数据链路层）</p>
                  <ul>
                    <li>仿真ARP协议获得网段内主机的MAC表</li>
                    <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
                  </ul>
                  <p>2、高端任务（优秀任务） 完成两台主机通过中间主机的数据通信（网络层）</p>
                  <ul>
                    <li>增加基于IP地址的转发功能</li>
                    <li>增加网络层封装</li>
                  </ul>
                  <p>本次任务呢分为基本任务和高端任务，当然我们的目标当然不仅限于基本任务咯。</p>
                  <h2 id="实验概述"><a href="#实验概述" class="headerlink" title="实验概述"></a>实验概述</h2>
                  <p>一句话，我们需要利用winpcap这个库用C语言编程来实现以上的任务。</p>
                  <h2 id="winpcap讲解"><a href="#winpcap讲解" class="headerlink" title="winpcap讲解"></a>winpcap讲解</h2>
                  <p>那么winpcap是什么？ 大多数网络应用程序通过被广泛使用的操作系统原件来访问网络，如socket。由于操作系统已经处理了底层的细节问题（如协议的处理、数据包的封装等），并提供了与读写文件类似的函数接口，因此使用该方法可以很容易的访问网络中的数据 然而有些时候，这种简单的方式并不能满足任务要求，有些应用程序需要直接访问网络中的数据包，也就是说，需要访问哪些没有被操作系统处理过的数据包 WinPcap就是为Windows平台的应用程序提供这种访问方式，提供下列功能：</p>
                  <ul>
                    <li>捕获原始数据包。无论是发送到运行WinPcap的机器上的数据包，还是在其它主机（存在网络共享介质上的主机）上进行交换的数据包，都可以被捕获</li>
                    <li>在数据包传递给应用程序之前，根据用户指定的规则过滤数据包</li>
                    <li>将原始数据包发送到网络上</li>
                    <li>收集网络流量与网络状态的统计信息</li>
                  </ul>
                  <p>它提供给我们什么呢？</p>
                  <p>它包含一个内核空间数据包过滤器（Netgroup Packet Filter, NPF)，一个底层动态链接库（Packet.dll)和一个高层独立于操作系统的动态链接库(wpcap.dll)。各部分关系见下图</p>
                  <p><img src="http://img.blog.csdn.net/20141003103218640?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> NPF：为了能够访问网络上传输的原始数据，数据包捕获系统需要绕过操作系统的协议栈。这就需要有一部分程序运行在操作系统的内核中，只有这样才能与网络接口驱动直接交互。在WinPcap中，与操作系统密切相关的是一个名为NPF的设备驱动程序，同时对不同版本的操作系统提供了不同版本的驱动程序。这些驱动程序提供了数据包捕获与发送的基本功能，同时提供了一个可编程的数据包过滤系统、一个网络监视引擎等高级功能。 动态链接库：为了让应用程序能够使用内核驱动提供的功能，数据包捕获系统必须导出相关的接口。对此，WinPcap提供两个不同层次的动态链接库：Packet.dll和wpcap.dll。 Packet.dll提供底层的API，用来直接访问驱动程序的函数，用来提供独立于微软公司不同操作系统的编程接口。 wpcap.dll库导出了更强大、更高层的捕获函数接口，具有与UNIX捕获库libpcap的兼容性。这两个库可使数据包的捕获独立于底层的网络硬件与操作系统。</p>
                  <h2 id="实验流程"><a href="#实验流程" class="headerlink" title="实验流程"></a>实验流程</h2>
                  <p>了解了winpcap之后，我们要做的就是利用它提供的类库来实现网络传输，网络解析等一系列的功能。</p>
                  <p>需要我们做好的准备有：</p>
                  <ul>
                    <li>C语言的相关基础</li>
                    <li>计算机网络的基础知识</li>
                    <li>对开发环境的相关了解</li>
                  </ul>
                  <p>如果对于上述中任何一个不熟悉，请先去补习一下基础知识吧。</p>
                  <h2 id="参考书目"><a href="#参考书目" class="headerlink" title="参考书目"></a>参考书目</h2>
                  <ul>
                    <li>吴功宜等，《计算机网络高级软件编程技术》（第2版），清华大学出版社</li>
                    <li>徐恪等， 《高级计算机网络》，清华大学出版社</li>
                    <li>A.S. Tannenbaum，《计算机网络》（第5版），清华大学出版社</li>
                    <li>吕雪峰等， 《网络分析技术揭秘（原理、实践与WinPcap深入解析》，机械工业出版社</li>
                  </ul>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>下一节，我们将讲解在Eclipse环境下搭建winpcap环境的具体步骤。本次讲解到此结束，谢谢大家。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:35:59" itemprop="dateCreated datePublished" datetime="2015-07-13T00:35:59+08:00">2015-07-13</time>
                </span>
                <span id="/1890.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程一之前言，实验要求，实验目标" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1883.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/1883.html" class="post-title-link" itemprop="url">假期到啦，重新回归代码之路</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>二零一五年七月九日，伴随着最后一门图形学交卷铃声的想起，我的大三正式结束了。首先很抱歉，最近一段时间一直在忙考试复习，时间也比较紧张，另外就是整理各种材料，还有准备一些面试，也算是忙得不亦乐乎，所以，这段时间也没有去编代码，大约也有一个月的时间没有更新博客了，有好多热心的朋友在我博客留言评论，也没有及时回复，在这里向大家说一声抱歉。放假回家之后，我会好好研究一下大家提出的意见和建议，给予大家回复的。 恩，接下来的日子应该会稍微轻松那么一点，自己的研究生路大体有了轮廓，有了规划。将来想从事的方向为信息安全方向，自己也做过一些项目和网站，对一些安全性问题要求也是比较高的，自己也对安全问题比较感兴趣，嗯。 现在时间是二零一五年七月十二日，昨天回家，收拾整顿一番，今天假期正式开始啦！ 上学期是我大学的第六个学期了，对于保研来说，也着实是最后的一个重要的学期了，学习上也要更加重视。仔细回想起来，这个学期实际的项目开发没有做过多少，和同学开发了一个演唱会支付系统，又完善了一下自己之前的项目。学期后期，基本上就是准备一些面试和靠前复习，另外还有一些研究生招生的面试咨询等等，结果就不透露啦，自我感觉还是不错。 本来有好多话想说，然而这个时间，却不想多言了。 心里的石头还没落地，最近的日子，好好准备即将到来的面试。暑假到了，想要学习的东西还有很多，重新开启我的代码之路！Come On！</p>
                  <p>崔庆才</p>
                  <p>2015/7/12</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-12 11:08:25" itemprop="dateCreated datePublished" datetime="2015-07-12T11:08:25+08:00">2015-07-12</time>
                </span>
                <span id="/1883.html" class="post-meta-item leancloud_visitors" data-flag-title="假期到啦，重新回归代码之路" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>599</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1867.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1867.html" class="post-title-link" itemprop="url">OpenGL绘图实例十之绘制3D机器人</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>通过上一节说的绘制3D图形基础，我们应该对绘制3D图形有了基本的认识，接下来我们就进行一个实例，绘制一个3D机器人。 本节我们要完成的任务有：</p>
                  <blockquote>
                    <p>1.绘制一个仿真3D机器人(样式自选，参考例图)，至少包含头、躯干、四肢三个部分. 2.对机器人填充颜色。 3.增加点光源，使得机器人更加真实。 4.实现交互，使得能够控制机器人进行旋转、前进、后退等动作。 键盘”w”:前进 键盘”s”:后退 键盘”a”:顺时针旋转 键盘”d”:逆时针旋转</p>
                  </blockquote>
                  <p>接下来我们就一步步实现机器人的绘制吧。</p>
                  <h2 id="绘制球体"><a href="#绘制球体" class="headerlink" title="绘制球体"></a>绘制球体</h2>
                  <p>绘制球体我们有两种方法，一个叫glutSolidSphere，另一个叫glutWireSphere，这两个的区别在于，一个绘制的是实心的球体，另一个绘制的是现状描绘而成的球体，在绘制过程中，我们可以通过一个参数来对其进行控制。 glutSolidSphere是GLUT工具包中的一个函数，该函数用于渲染一个球体。球体球心位于原点。在OpenGL中默认的原点就是窗口客户区的中心。 函数原型</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">void glutSolidSphere(GLdouble<span class="built_in"> radius </span>, GLint slices , GLint stacks);</span><br><span class="line">void glutWireSphere(GLdouble radius, GLint slices, GLint stacks );</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>radius，球体的半径 slices，以Z轴上线段为直径分布的圆周线的条数（将Z轴看成地球的地轴，类似于经线） stacks，围绕在Z轴周围的线的条数（类似于地球上纬线） 一般而言， 后两个参数赋予较大的值， 渲染花费的时间要长， 效果更逼真。 然而我们可以发现，这里并没有定义球中心的参数，所以，我们可以利用平移函数组合实现。即利用glTranslated函数来实现。最后，我们定义的画球体的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画球</span></span><br><span class="line">void draw<span class="constructor">Ball(<span class="params">double</span> R, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>,<span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidSphere(R,20,20)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中两个常量定义如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SOLID 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIRE 2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们还用到了上一节所说的PushMatrix和PopMatrix方法。如果不熟悉，请查看上一节的内容。</p>
                  <h2 id="绘制长方体"><a href="#绘制长方体" class="headerlink" title="绘制长方体"></a>绘制长方体</h2>
                  <p>同样地，利用变换平移放缩的方法，再加上类库的绘制正方体的方法，我们也可以轻松地实现绘制长方体的方法。 正方体怎样变成长方体，很简单，拉伸一下就好了。所以，我们用到了glScaled方法。 绘制长方体的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画长方体</span></span><br><span class="line">void draw<span class="constructor">Skewed(<span class="params">double</span> <span class="params">l</span>, <span class="params">double</span> <span class="params">w</span>, <span class="params">double</span> <span class="params">h</span>, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>, <span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Scaled(<span class="params">l</span>, <span class="params">w</span>, <span class="params">h</span>)</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>, <span class="params">y</span>, <span class="params">z</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidCube(1)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE<span class="operator"> == </span>WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireCube(1)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里仍然还是定义了绘图模式，是线条还是实体。</p>
                  <h2 id="定义光照"><a href="#定义光照" class="headerlink" title="定义光照"></a>定义光照</h2>
                  <p>在这里提供一篇博文，讲光照讲得比较细致 <a href="http://www.cnblogs.com/opengl/archive/2012/11/14/2770745.html" target="_blank" rel="noopener">OPENGL光照</a> 那么在这里我就直接贴上光照设置的实现</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">void</span> init() &#123;</span><br><span class="line">   <span class="comment">//定义光源的颜色和位置</span></span><br><span class="line">   GLfloat ambient[] = &#123; <span class="number">0.5</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.1</span> &#125;;  </span><br><span class="line">   GLfloat diffuse[] = &#123; <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   GLfloat position[] = &#123; <span class="number">-80.0</span>, <span class="number">50.0</span>, <span class="number">25.0</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   <span class="comment">//选择光照模型</span></span><br><span class="line">   GLfloat lmodel_ambient[] = &#123; <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   GLfloat local_view[] = &#123; <span class="number">0.0</span> &#125;;  </span><br><span class="line">   glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);   </span><br><span class="line">   glShadeModel(GL_SMOOTH);  </span><br><span class="line">   <span class="comment">//设置环境光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);  </span><br><span class="line">   <span class="comment">//设置漫射光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);  </span><br><span class="line">   <span class="comment">//设置光源位置</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_POSITION, position);  </span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_AMBIENT, lmodel_ambient);  </span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_LOCAL_VIEWER, local_view);  </span><br><span class="line">   <span class="comment">//启动光照</span></span><br><span class="line">   glEnable(GL_LIGHTING);  </span><br><span class="line">   <span class="comment">//启用光源</span></span><br><span class="line">   glEnable(GL_LIGHT0);  </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中设置了光源颜色，位置等参数。</p>
                  <h2 id="图形的移动"><a href="#图形的移动" class="headerlink" title="图形的移动"></a>图形的移动</h2>
                  <p>在这里我们实现了鼠标的监听旋转和键盘的监听旋转，在这里分别描述如下</p>
                  <h3 id="1-鼠标监听"><a href="#1-鼠标监听" class="headerlink" title="1.鼠标监听"></a>1.鼠标监听</h3>
                  <p>对于鼠标监听事件，在前面的文章中已经做了说明，如果大家不熟悉可以看下面这篇文章 <a href="http://cuiqingcai.com/1776.html">鼠标监听</a> 我们要实现的就是在拖动鼠标的时候实现图形的旋转功能。 在点击鼠标时，我们记录下来点击的位置，然后在鼠标移动的时候记录下当前坐标与上一个位置的坐标之差。通过定义一个角度的变量，每次鼠标移动的时候让整个图形旋转角度加上这个差值，然后重新绘制图形，就可以实现整个图形的 旋转了。 鼠标监听的两个方法如下，分别是鼠标点击和鼠标移动。 定义两个变量，旋转角度</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> spinX = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> spinY = <span class="number">0</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后定义两个鼠标事件</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 鼠标移动事件 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseMove</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> dx = x - moveX;</span><br><span class="line">	<span class="keyword">int</span> dy = y - moveY;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"dx;%dx,dy:%dy\n"</span>,dx,dy);</span><br><span class="line">	spinX += dx;</span><br><span class="line">	spinY += dy;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">	moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标点击事件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseClick</span><span class="params">(<span class="keyword">int</span> btn, <span class="keyword">int</span> state, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    moveX = x;</span><br><span class="line">	moveY = y; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过定义上面的方法，然后在main中加入监听。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//鼠标点击事件，鼠标点击或者松开时调用</span></span><br><span class="line">    glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br><span class="line">	<span class="comment">//鼠标移动事件，鼠标按下并移动时调用</span></span><br><span class="line">    glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>display函数中，在绘图前调用该方法即可</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>分别是绕y轴和x轴旋转一定的角度。这样就可以实现鼠标的监听了。</p>
                  <h3 id="2-键盘监听"><a href="#2-键盘监听" class="headerlink" title="2.键盘监听"></a>2.键盘监听</h3>
                  <p>键盘事件也很简单，同样是监听按键的按下。其中w、s键是用来控制机器人的远近的。 定义一个变量叫 dis，代表远近 键盘事件函数如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line"><span class="keyword">void</span> <span class="built_in">keyPressed</span>(unsigned <span class="built_in">char</span> <span class="built_in">key</span>, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="built_in">key</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">        spinX -= <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'d'</span>:</span><br><span class="line">         spinX += <span class="number">2</span>;  </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'w'</span>:</span><br><span class="line">        des += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">        des -= <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main函数中加入监听</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line">	glut<span class="constructor">KeyboardFunc(<span class="params">keyPressed</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>display函数中加入如下的变换</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样通过上述方法，我们便可以实现鼠标和键盘的监听了。</p>
                  <h2 id="裁切物体"><a href="#裁切物体" class="headerlink" title="裁切物体"></a>裁切物体</h2>
                  <p>在这里我们可能要画一个半圆，那么最方便的方法就是裁切了，利用下面的函数，我们可以方便地实现。</p>
                  <h3 id="void-glClipPlane-GLenum-plane-const-GLdouble-equation"><a href="#void-glClipPlane-GLenum-plane-const-GLdouble-equation" class="headerlink" title="void glClipPlane(GLenum plane, const GLdouble *equation);"></a>void glClipPlane(GLenum plane, const GLdouble *equation);</h3>
                  <p>定义一个裁剪平面。equation参数指向平面方程Ax + By + Cz + D = 0的4个系数。 equation=（0，-1，0,0），前三个参数（0，-1,0）可以理解为法线向下，只有向下的，即Y&lt;0的才能显示，最后一个参数0表示从z=0平面开始。这样就是裁剪掉上半平面。 equation=（0,1,0,0）表示裁剪掉下半平面， equation=（1,0,0,0）表示裁剪掉左半平面， equation=（-1,0,0,0）表示裁剪掉右半平面， equation=（0,0,-1,0）表示裁剪掉前半平面， equation=（0,0,1,0）表示裁剪掉后半平面 代码示例如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLdouble eqn<span class="literal">[<span class="number">4</span>]</span>=&#123;<span class="number">0.0</span>,<span class="number">0.0</span>,-<span class="number">1.0</span>,<span class="number">0.0</span>&#125;;</span><br><span class="line">gl<span class="constructor">ClipPlane(GL_CLIP_PLANE0,<span class="params">eqn</span>)</span>;</span><br><span class="line">gl<span class="constructor">Enable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">glut<span class="constructor">SolidSphere(<span class="params">headR</span>,<span class="params">slices</span>,<span class="params">slices</span>)</span>;</span><br><span class="line">gl<span class="constructor">Disable(GL_CLIP_PLANE0)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们必须要定义一个GLdouble数组，然后利用glClipPlane方法来设置，然后开启裁切，最后关闭裁切。 利用类似的方法我们可以写出绘制半球的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画半球</span></span><br><span class="line">void draw<span class="constructor">HalfBall(<span class="params">double</span> R, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>,<span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">	GLdouble eqn<span class="literal">[<span class="number">4</span>]</span>=&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>&#125;;</span><br><span class="line">	gl<span class="constructor">ClipPlane(GL_CLIP_PLANE0,<span class="params">eqn</span>)</span>;</span><br><span class="line">	gl<span class="constructor">Enable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidSphere(R,20,20)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">Disable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过上述方法，我们可以方便地绘制出一个半球体。</p>
                  <h2 id="绘制机器人"><a href="#绘制机器人" class="headerlink" title="绘制机器人"></a>绘制机器人</h2>
                  <p>有了上述的铺垫，我们绘制机器人简直易如反掌，同样还可以实现各式各样的监听。 主要就是位置的确定了。 display函数如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>); </span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();  </span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">-2.0</span>, <span class="number">-1.0</span>, <span class="number">20.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>); </span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br><span class="line">	<span class="comment">//头</span></span><br><span class="line">	drawBall(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//身体</span></span><br><span class="line">	drawSkewed(<span class="number">5</span>, <span class="number">4.4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">-0.75</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//肩膀</span></span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//胳膊</span></span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//手</span></span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//腿</span></span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//脚</span></span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">-0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过调用这个函数我们便可以完成机器人的绘制了。</p>
                  <h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2>
                  <p>在这里提供完整代码示例，仅供参考</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define SOLID <span class="number">1</span></span><br><span class="line">#define WIRE <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> moveX,moveY;</span><br><span class="line"><span class="built_in">int</span> spinX = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> spinY = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> des = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> init() &#123;</span><br><span class="line">   <span class="comment">//定义光源的颜色和位置</span></span><br><span class="line">   GLfloat ambient[] = &#123; <span class="number">0.5</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.1</span> &#125;;  </span><br><span class="line">   GLfloat diffuse[] = &#123; <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   GLfloat position[] = &#123; <span class="number">-80.0</span>, <span class="number">50.0</span>, <span class="number">25.0</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   <span class="comment">//选择光照模型</span></span><br><span class="line">   GLfloat lmodel_ambient[] = &#123; <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span> &#125;;  </span><br><span class="line">   GLfloat local_view[] = &#123; <span class="number">0.0</span> &#125;;  </span><br><span class="line">   glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);   </span><br><span class="line">   glShadeModel(GL_SMOOTH);  </span><br><span class="line">   <span class="comment">//设置环境光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);  </span><br><span class="line">   <span class="comment">//设置漫射光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);  </span><br><span class="line">   <span class="comment">//设置光源位置</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_POSITION, position);  </span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_AMBIENT, lmodel_ambient);  </span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_LOCAL_VIEWER, local_view);  </span><br><span class="line">   <span class="comment">//启动光照</span></span><br><span class="line">   glEnable(GL_LIGHTING);  </span><br><span class="line">   <span class="comment">//启用光源</span></span><br><span class="line">   glEnable(GL_LIGHT0);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画球</span></span><br><span class="line"><span class="built_in">void</span> drawBall(<span class="built_in">double</span> R, <span class="built_in">double</span> x, <span class="built_in">double</span> y,<span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glTranslated(x,y,z);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画半球</span></span><br><span class="line"><span class="built_in">void</span> drawHalfBall(<span class="built_in">double</span> R, <span class="built_in">double</span> x, <span class="built_in">double</span> y,<span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glTranslated(x,y,z);</span><br><span class="line">	GLdouble eqn[<span class="number">4</span>]=&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>&#125;;</span><br><span class="line">	glClipPlane(GL_CLIP_PLANE0,eqn);</span><br><span class="line">	glEnable(GL_CLIP_PLANE0);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glDisable(GL_CLIP_PLANE0);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画长方体</span></span><br><span class="line"><span class="built_in">void</span> drawSkewed(<span class="built_in">double</span> l, <span class="built_in">double</span> w, <span class="built_in">double</span> h, <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glScaled(l, w, h);</span><br><span class="line">	glTranslated(x, y, z);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidCube(<span class="number">1</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireCube(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>); </span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();  </span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">-2.0</span>, <span class="number">-1.0</span>, <span class="number">20.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>); </span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br><span class="line">	<span class="comment">//头</span></span><br><span class="line">	drawBall(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//身体</span></span><br><span class="line">	drawSkewed(<span class="number">5</span>, <span class="number">4.4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">-0.75</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//肩膀</span></span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//胳膊</span></span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//手</span></span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//腿</span></span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//脚</span></span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">-0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标点击事件</span></span><br><span class="line"><span class="built_in">void</span> mouseClick(<span class="built_in">int</span> btn, <span class="built_in">int</span> state, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">	GLfloat ambient[] = &#123; (<span class="built_in">float</span>)rand() / RAND_MAX, (<span class="built_in">float</span>)rand() / RAND_MAX, (<span class="built_in">float</span>)rand() / RAND_MAX, <span class="number">0.1</span> &#125;;  </span><br><span class="line">	 <span class="comment">//设置环境光</span></span><br><span class="line">	glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);  </span><br><span class="line">	<span class="comment">//启用光源</span></span><br><span class="line">	glEnable(GL_LIGHT0);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line"><span class="built_in">void</span> keyPressed(unsigned char key, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">        spinX -= <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'d'</span>:</span><br><span class="line">         spinX += <span class="number">2</span>;  </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'w'</span>:</span><br><span class="line">        des += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">        des -= <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 鼠标移动事件 </span></span><br><span class="line"><span class="built_in">void</span> mouseMove(<span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">	<span class="built_in">int</span> dx = x - moveX;</span><br><span class="line">	<span class="built_in">int</span> dy = y - moveY;</span><br><span class="line">	printf(<span class="string">"dx;%dx,dy:%dy\n"</span>,dx,dy);</span><br><span class="line">	spinX += dx;</span><br><span class="line">	spinY += dy;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">	moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> reshape(<span class="built_in">int</span> w, <span class="built_in">int</span> h) &#123;</span><br><span class="line">	<span class="comment">//定义视口大小</span></span><br><span class="line">	glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h); </span><br><span class="line">	<span class="comment">//投影显示</span></span><br><span class="line">	glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//坐标原点在屏幕中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//操作模型视景</span></span><br><span class="line">	gluPerspective(<span class="number">60.0</span>, (GLfloat) w/(GLfloat) h, <span class="number">1.0</span>, <span class="number">20.0</span>);</span><br><span class="line">	glMatrixMode(GL_MODELVIEW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char** argv) &#123;</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//设置显示模式</span></span><br><span class="line">	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">//初始化窗口大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">500</span>, <span class="number">500</span>); </span><br><span class="line">	<span class="comment">//定义左上角窗口位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	glutCreateWindow(argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	init();</span><br><span class="line">	<span class="comment">//显示函数</span></span><br><span class="line">	glutDisplayFunc(display);</span><br><span class="line">	<span class="comment">//窗口大小改变时的响应</span></span><br><span class="line">	glutReshapeFunc(reshape);</span><br><span class="line">	<span class="comment">//鼠标点击事件，鼠标点击或者松开时调用</span></span><br><span class="line">    glutMouseFunc(mouseClick);</span><br><span class="line">	<span class="comment">//鼠标移动事件，鼠标按下并移动时调用</span></span><br><span class="line">    glutMotionFunc(mouseMove);</span><br><span class="line">	<span class="comment">//键盘事件</span></span><br><span class="line">	glutKeyboardFunc(keyPressed);</span><br><span class="line">	<span class="comment">//循环</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仅供参考，如有问题，敬请指正。 运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150607013139.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150607013139.jpg" alt="QQ截图20150607013139"></a> 恩，大体就是这样。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本次实验做的比较匆忙，只研究了一个晚上的时间，所以有些地方还是不太完善，希望发出来对小伙伴们有所启发，有所帮助。如果有问题，欢迎同我交流。谢大家！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-07 01:35:13" itemprop="dateCreated datePublished" datetime="2015-06-07T01:35:13+08:00">2015-06-07</time>
                </span>
                <span id="/1867.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例十之绘制3D机器人" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1860.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1860.html" class="post-title-link" itemprop="url">OpenGL绘图实例九之3D绘图基础</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在前面我们进行了2D图形的绘制，接下来，我们将步入3D图形的世界，绘制出一个3D机器人，好，废话不多说，让我们一起来迈入3D绘图之旅吧。</p>
                  <h2 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h2>
                  <p>那么在绘图之前呢，我们首先要介绍几个新的函数，弄懂了这几个函数我们才能方便地绘制出我们的3D机器人。 那么我们介绍一下<strong>gluPerspective</strong>、<strong>gluLookAt、glPushMatrix、glPopMatrix()函数</strong></p>
                  <h3 id="1-void-gluPerspective-GLdouble-fovy-GLdouble-aspect-GLdouble-zNear-GLdouble-zFar"><a href="#1-void-gluPerspective-GLdouble-fovy-GLdouble-aspect-GLdouble-zNear-GLdouble-zFar" class="headerlink" title="1.void gluPerspective(GLdouble fovy,GLdouble aspect,GLdouble zNear,GLdouble zFar)"></a>1.void gluPerspective(GLdouble fovy,GLdouble aspect,GLdouble zNear,GLdouble zFar)</h3>
                  <p>参数说明： fovy，视角的大小，如果设置为0,相当闭上眼睛，什么也看不到，如果为180，则可以看到几乎所有的内容。一般设置为60即可。 aspect，就是实际窗口的纵横比,即x/y，一般都是要按照窗口比例来，否则看到的图形和实际图形就会不一样了。 zNear，表示近处的裁面。 zFar，表示远处的裁面。 gluPerspective这个函数指定了观察的视景体在世界坐标系中的具体大小，一般而言，其中的参数aspect应该与窗口的宽高比大小相同。比如说，aspect=2.0表示在观察者的角度中物体的宽度是高度的两倍，在视口中宽度也是高度的两倍，这样显示出的物体才不会被扭曲。 <a href="http://baike.baidu.com/link?url=jzTDJ5fxVoKMTgijgmszkzuPR6116C5DC4GETFIRZvBajy3dWAB539r3oMsoXpTKCxTksLImx1J2VSC5Q-zJja" target="_blank" rel="noopener">详细说明</a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/03087bf40ad162d9f337731d11dfa9ec8b13cdd1.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/03087bf40ad162d9f337731d11dfa9ec8b13cdd1.jpg" alt="03087bf40ad162d9f337731d11dfa9ec8b13cdd1"></a> </p>
                  <h3 id="2-void-gluLookAt-GLdouble-eyex-GLdouble-eyey-GLdouble-eyez-GLdouble-centerx-GLdouble-centery-GLdouble-centerz-GLdouble-upx-GLdouble-upy-GLdouble-upz"><a href="#2-void-gluLookAt-GLdouble-eyex-GLdouble-eyey-GLdouble-eyez-GLdouble-centerx-GLdouble-centery-GLdouble-centerz-GLdouble-upx-GLdouble-upy-GLdouble-upz" class="headerlink" title="2.void gluLookAt(GLdouble eyex,GLdouble eyey,GLdouble eyez,GLdouble centerx,GLdouble centery,GLdouble centerz,GLdouble upx,GLdouble upy,GLdouble upz)"></a><strong>2.void gluLookAt(GLdouble eyex,GLdouble eyey,GLdouble eyez,GLdouble centerx,GLdouble centery,GLdouble centerz,GLdouble upx,GLdouble upy,GLdouble upz)</strong></h3>
                  <p>该函数定义一个视图矩阵，并与当前矩阵相乘。</p>
                  <p>第一组eyex, eyey,eyez 相机在世界坐标的位置</p>
                  <p>第二组centerx,centery,centerz 相机镜头对准的物体在世界坐标的位置</p>
                  <p>第三组upx,upy,upz 相机向上的方向在世界坐标中的方向</p>
                  <p>你把相机想象成为你自己的脑袋：</p>
                  <p>第一组数据就是脑袋的位置</p>
                  <p>第二组数据就是眼睛看的物体的位置</p>
                  <p>第三组就是头顶朝向的方向（因为你可以歪着头看同一个物体）</p>
                  <p>在这里，我们就涉及到一个十分重要的概念，坐标系。 在3D绘图中，坐标系是右手系，如果x轴指向我们的右侧，那么y则指向上侧，z轴指向屏幕外。如下图所示。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/20150606234046.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/20150606234046.jpg" alt="20150606234046"></a> 理解了上述两个函数，下面我们来用一个小例子感受一下 运行如下代码</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>); </span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();  </span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	glutWireTeapot(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//清除缓冲区刷新</span></span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> reshape(<span class="built_in">int</span> w, <span class="built_in">int</span> h) &#123;</span><br><span class="line">	<span class="comment">//定义视口大小</span></span><br><span class="line">	glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h); </span><br><span class="line">	<span class="comment">//投影显示</span></span><br><span class="line">	glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//坐标原点在屏幕中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//操作模型视景</span></span><br><span class="line">	gluPerspective(<span class="number">60.0</span>, (GLfloat) w/(GLfloat) h, <span class="number">1.0</span>, <span class="number">20.0</span>);</span><br><span class="line">	glMatrixMode(GL_MODELVIEW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char** argv) &#123;</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//设置显示模式</span></span><br><span class="line">	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">//初始化窗口大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">500</span>, <span class="number">500</span>); </span><br><span class="line">	<span class="comment">//定义左上角窗口位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	glutCreateWindow(argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">//清除颜色缓冲区</span></span><br><span class="line">	glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>); </span><br><span class="line">	<span class="comment">//显示函数</span></span><br><span class="line">	glutDisplayFunc(display);</span><br><span class="line">	<span class="comment">//窗口大小改变时的响应</span></span><br><span class="line">	glutReshapeFunc(reshape);</span><br><span class="line">	<span class="comment">//循环</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234448.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234448.jpg" alt="QQ截图20150606234448"></a> 在这里，我们定义了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思就是把我们的眼睛放到了（0,0,5）的位置，茶壶放到了原点，脑袋顶朝上，即正视茶壶。 如果我们改变了几个参数的值，例如</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">4.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>眼睛位置不变，茶壶位置变为（4,1,0），脑袋顶的方向朝屏幕外侧，那么看到的效果如下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234708.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234708.jpg" alt="QQ截图20150606234708"></a> 大家可以通过更改这些参数的值来对视图进行变换。</p>
                  <h3 id="3-glPushMatrix-、glPopMatrix"><a href="#3-glPushMatrix-、glPopMatrix" class="headerlink" title="3.glPushMatrix()、glPopMatrix()"></a>3.glPushMatrix()、glPopMatrix()</h3>
                  <p>这个方法在绘制3D图形时依然十分有用，因为我们需要绘制好多个图形，绘制多个不一样的图形必然要经过各种矩阵变换，所以，少不了的利用平移变换放缩的功能，所以为了保证每个图形不受影响，在绘制一个新图形前我们只要调用一下glPushMatrix函数，保存当前的变换矩阵，然后绘制完一个图形之后再调用glPopMatrix函数来恢复之前的变换矩阵就可以了。 比如，绘制球体</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">gl<span class="constructor">PopMatrix()</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在两个函数中间我们可以进行任意的变换放缩等操作，然后绘制想要的图形即可。</p>
                  <h2 id="绘图函数"><a href="#绘图函数" class="headerlink" title="绘图函数"></a>绘图函数</h2>
                  <p>接下来我们说一下一些常用的绘图函数，直接用类库函数来绘制即可。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">void glut<span class="constructor">WireSphere(GLdouble <span class="params">radius</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 线框球</span><br><span class="line">void glut<span class="constructor">SolidSphere(GLdouble <span class="params">radius</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 实心球</span><br><span class="line">void glut<span class="constructor">WireCube(GLdouble <span class="params">size</span>)</span>; 线框立方体</span><br><span class="line">void glut<span class="constructor">SolidCube(GLdouble <span class="params">size</span>)</span>; 实心立方体</span><br><span class="line">void glut<span class="constructor">WireTorus(GLdouble <span class="params">innerRadius</span>, GLdouble <span class="params">outerRadius</span>, GLint <span class="params">nsides</span>, GLint <span class="params">rings</span>)</span>; 线框圆环</span><br><span class="line">void glut<span class="constructor">SolidTorus(GLdouble <span class="params">innerRadius</span>, GLdouble <span class="params">outerRadius</span>, GLint <span class="params">nsides</span>, GLint <span class="params">rings</span>)</span>; 实心圆环</span><br><span class="line">void glut<span class="constructor">WireIcosahedron(<span class="params">void</span>)</span>; 线框<span class="number">20</span>面体</span><br><span class="line">void glut<span class="constructor">SolidIcosahedron(<span class="params">void</span>)</span>; 实心<span class="number">20</span>面体</span><br><span class="line">void glut<span class="constructor">WireOctahedron(<span class="params">void</span>)</span>; 线框<span class="number">8</span>面体 </span><br><span class="line">void glut<span class="constructor">SolidOctahedron(<span class="params">void</span>)</span>; 实心<span class="number">8</span>面体</span><br><span class="line">void glut<span class="constructor">WireTetrahedron(<span class="params">void</span>)</span>; 线框<span class="number">4</span>面体</span><br><span class="line">void glut<span class="constructor">SolidTetrahedron(<span class="params">void</span>)</span>; 实心<span class="number">4</span>面体</span><br><span class="line">void glut<span class="constructor">WireDodecahedron(GLdouble <span class="params">radius</span>)</span>; 线框<span class="number">12</span>面体</span><br><span class="line">void glut<span class="constructor">SolidDodecahedron(GLdouble <span class="params">radius</span>)</span>; 实心<span class="number">12</span>面体</span><br><span class="line">void glut<span class="constructor">WireCone(GLdouble <span class="params">radius</span>, GLdouble <span class="params">height</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 线框圆锥体</span><br><span class="line">void glut<span class="constructor">SolidCone(GLdouble <span class="params">radius</span>, GLdouble <span class="params">height</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 实心圆锥体</span><br><span class="line">void glut<span class="constructor">WireTeapot(GLdouble <span class="params">size</span>)</span>; 线框茶壶</span><br><span class="line">void glut<span class="constructor">SolidTeapot(GLdouble <span class="params">size</span>)</span>; 实心茶壶</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用上面的绘图函数我们便可以方便地实现各种图形的绘制。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>那么本节就先告一段落，本节介绍了相关的绘图函数以及几个重要的函数，为接下来我们绘制机器人做下铺垫，希望小伙伴们可以好好理解。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-07 00:27:30" itemprop="dateCreated datePublished" datetime="2015-06-07T00:27:30+08:00">2015-06-07</time>
                </span>
                <span id="/1860.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例九之3D绘图基础" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1853.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/1853.html" class="post-title-link" itemprop="url">将普通文本替换为正常HTML文本的方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>有时我们在textarea中输入了正常的文本内容，然而如果直接将文本取出来呈现在网页中，原本的换行和回车功能便会失效，完全丢失了原来的样式，这是因为在HTML中的空格和换行分别为&nbsp;和<br>，所以我们需要将其替换才能变成我们想要的样式。 注：本篇内容非常基础，仅作参考，不喜勿喷。</p>
                  <h2 id="替换函数"><a href="#替换函数" class="headerlink" title="替换函数"></a>替换函数</h2>
                  <p>我们可以定义这样的一个函数，将原来的字符串替换为HTML文本。即把空格和换行替换掉即可</p>
                  <figure class="highlight php">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmtocode</span><span class="params">($content)</span> </span>&#123; </span><br><span class="line">		$content = htmlspecialchars($content, ENT_QUOTES);</span><br><span class="line">	    $content = str_replace(<span class="string">" "</span>, <span class="string">"&amp;nbsp;"</span>, $content); </span><br><span class="line">	    $content = str_replace(<span class="string">"\n"</span>, <span class="string">"&lt;br&gt;"</span>,$content);    </span><br><span class="line">	    <span class="keyword">return</span> $content; </span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述方法，我们首先将HTML的特殊标记转化，然后替换掉空格和换行即可。</p>
                  <h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2>
                  <p>写个最简单的小例子，在textarea中输入任意的文本，存储到数据库，然后再取出来，可以实现textarea输入的效果，完全一样。 数据库名称：demo 数据库表：</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">CREATE</span> TABLE <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="symbol">`article`</span> (</span><br><span class="line">  <span class="symbol">`id`</span> int(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="symbol">`text`</span> text <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (<span class="symbol">`id`</span>)</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>插入数据：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"sub"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	$con = mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> (!$con) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"数据库连接失败"</span>);</span></span><br><span class="line"><span class="php">	&#125; </span></span><br><span class="line"><span class="php">	mysql_select_db(<span class="string">"demo"</span>,$con);</span></span><br><span class="line"><span class="php">	mysql_query(<span class="string">"set names utf8"</span>);</span></span><br><span class="line"><span class="php">	$text = @$_POST[<span class="string">'text'</span>];</span></span><br><span class="line"><span class="php">	$sql = <span class="string">"insert into article(text) values ('$text')"</span>;</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $sql;</span></span><br><span class="line"><span class="php">	$result = mysql_query($sql,$con);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入成功"</span>;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入失败"</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查询数据：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"sub"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	$con = mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> (!$con) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"数据库连接失败"</span>);</span></span><br><span class="line"><span class="php">	&#125; </span></span><br><span class="line"><span class="php">	mysql_select_db(<span class="string">"demo"</span>,$con);</span></span><br><span class="line"><span class="php">	mysql_query(<span class="string">"set names utf8"</span>);</span></span><br><span class="line"><span class="php">	$text = @$_POST[<span class="string">'text'</span>];</span></span><br><span class="line"><span class="php">	$sql = <span class="string">"select * from article"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">	$result = mysql_query($sql,$con);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">while</span> ($row = mysql_fetch_array($result)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> htmtocode($row[<span class="string">'text'</span>]);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入失败"</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php">	<span class="function"><span class="keyword">function</span> <span class="title">htmtocode</span><span class="params">($content)</span> </span>&#123; </span></span><br><span class="line"><span class="php">		$content = htmlspecialchars($content, ENT_QUOTES);</span></span><br><span class="line"><span class="php">	    $content = str_replace(<span class="string">" "</span>, <span class="string">"&amp;nbsp;"</span>, $content); </span></span><br><span class="line"><span class="php">	    $content = str_replace(<span class="string">"\n"</span>, <span class="string">"&lt;br&gt;"</span>,$content);    </span></span><br><span class="line"><span class="php">	    <span class="keyword">return</span> $content; </span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，通过上面的方法我们便可以正常地实现输入内容和输出内容的匹配呈现。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-05 22:12:03" itemprop="dateCreated datePublished" datetime="2015-06-05T22:12:03+08:00">2015-06-05</time>
                </span>
                <span id="/1853.html" class="post-meta-item leancloud_visitors" data-flag-title="将普通文本替换为正常HTML文本的方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1835.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1835.html" class="post-title-link" itemprop="url">多说默认头像不显示，那就自己来整一个</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>今天发现博客评论的默认头像不显示了，博客使用的是多说评论，不知道啥情况，之前设置过一个默认头像，然而今天图片都加载不出来了，可对于我这种强迫症来说，这能忍吗？你能忍我也不能忍啊，这必须不能忍啊，看到一个个的红叉号简直刺透了心。于是，我决定，必须要干掉它！</p>
                  <h2 id="初步尝试"><a href="#初步尝试" class="headerlink" title="初步尝试"></a>初步尝试</h2>
                  <p>默认头像不行了，我就重新上传个默认头像对吧，简单粗暴易行。来来来，说试就试！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525114559.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525114559.jpg" alt="20150525114559"></a> 然而上传完毕之后，它是这个样子滴，依然不给我面子！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525114655.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525114655.jpg" alt="20150525114655"></a> 你在逗我吗？是不是多说服务器哪里出毛病了？</p>
                  <h2 id="究其原因"><a href="#究其原因" class="headerlink" title="究其原因"></a>究其原因</h2>
                  <p>然而，美好的事情总是意想不到的发生，当我知道真相的一刻，整个人都惊呆了。 浏览器里审查一下元素，看它到底引用了神马鬼。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525115038.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525115038.jpg" alt="20150525115038"></a> 好，我就打开这个链接，惊呆了。简直棒到无极限！ 域名已过期！域名已过期！域名已过期！重要的话说三遍！简直溜到不行！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525115447.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525115447.jpg" alt="20150525115447"></a> 好吧，这真是太棒了！！我还能说些什么！！！</p>
                  <h2 id="峰回路转"><a href="#峰回路转" class="headerlink" title="峰回路转"></a>峰回路转</h2>
                  <p>行，既然这样，那我自己提供CDN，用我自己的七牛云存储！ 那就用jQuery好了，方便简单，在&lt;/head&gt;标签前面加上这么个代码，来试试。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">'.ds-avatar img[src*="cdncache"]'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112155.jpg'</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思是，在页面加载完成之后，把src里面包含cdncache的多说头像img替换掉。 这句话最好加在所有JS的最后面，要不然可能不会生效。JS执行是有先后顺序的。 这样，我们就会发现，头像已经奇迹般地发生了变化。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525123151.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525123151.jpg" alt="20150525123151"></a> 本身有头像的仍然是那个头像，使用默认头像的已经替换了新头像。</p>
                  <h2 id="更上一层"><a href="#更上一层" class="headerlink" title="更上一层"></a>更上一层</h2>
                  <p>然而这并不能满足我的愿望啊，我想要多变的头像样式，就是这么任性！ 来来来，改代码，我再传上几个头像，让默认头像的孩纸们随机地使用我的头像，一定是炫爆了！</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> imgs = <span class="keyword">new</span> <span class="built_in">Array</span>();</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">0</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525111154.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">1</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525111447.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">2</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112058.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">3</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112112.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">4</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112129.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">5</span>] = <span class="string">'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112155.jpg'</span>;</span></span><br><span class="line"><span class="javascript">	$(<span class="string">'.ds-avatar img[src*="cdncache"]'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> rand = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*imgs.length);</span></span><br><span class="line"><span class="javascript">		$(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,imgs[rand]);</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，把刚才代码优化成这样，我们就可以发现，整个网站的头像就被替换成我们想要的效果了！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525123537.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525123537.jpg" alt="20150525123537"></a> 简直酷炫！小伙伴们可以尝试一下！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-25 12:37:04" itemprop="dateCreated datePublished" datetime="2015-05-25T12:37:04+08:00">2015-05-25</time>
                </span>
                <span id="/1835.html" class="post-meta-item leancloud_visitors" data-flag-title="多说默认头像不显示，那就自己来整一个" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1802.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1802.html" class="post-title-link" itemprop="url">OpenGL绘图实例八之图形的移动删除存盘</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一篇文章中我们已经实现了图形的取点绘制，接下来我们还要实现的功能有图形的删除、移动以及存盘读盘功能。 概述如下</p>
                  <ul>
                    <li>鼠标点击某个绘制的图形，将其删除</li>
                    <li>鼠标拖动某个图形，可以对其随意拖拽改变位置</li>
                    <li>点击存盘，将图形的位置及颜色保存到文件</li>
                    <li>点击读盘，将图形的位置颜色从文件中读取出来并重新绘制</li>
                  </ul>
                  <p>好，接下来我们在上一篇的基础上进行一步步的说明。</p>
                  <h2 id="图形删除"><a href="#图形删除" class="headerlink" title="图形删除"></a>图形删除</h2>
                  <p>首先像之前一样，我们定义一个删除的按钮，指定好颜色。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte delBtn[<span class="number">3</span>] = &#123;<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在display函数中绘制一个删除的按钮</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">220</span>, <span class="number">280</span>, <span class="number">10</span>, delBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>顶部变变成了这个样子，其中最左边的那个按钮便是删除按钮 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511124225.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511124225.jpg" alt="QQ截图20150511124225"></a> 接下来我们想一下删除的实现。 首先我们点击删除按钮之后要设置一下drawStatus，比如设置为2代表删除。 然后鼠标点击下方任意位置时，如果当前drawStatus为2，如果鼠标处在一个多边形内部，我们就把它删除掉。 那么就会出现两个问题了，怎样判断点击的点处在多边形的内部？怎样执行删除操作？ 下面我们分别来研究一下</p>
                  <h3 id="1-判断点在多边形内部"><a href="#1-判断点在多边形内部" class="headerlink" title="1. 判断点在多边形内部"></a>1. 判断点在多边形内部</h3>
                  <p>思路：求解通过该点的水平线与多边形各边的交点 ，如果交点为奇数，那么就判定为在多边形内部，否则在外部。 因此，我的算法实现如下，传入的参数一个是ploygon结构体，结构体中包含了顶点坐标，另外就是这个点的x，y坐标。 思路参考来源： <a href="http://blog.csdn.net/hgl868/article/details/7947272" target="_blank" rel="noopener">判断点在多边形内的多种写法</a> 经过我的改写，变成了如下内容</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/* 判断一个点是否在多边形内部 */</span><br><span class="line">bool pointInPoly(polygon poly,<span class="built_in"> int </span>x,<span class="built_in"> int </span>y)&#123;</span><br><span class="line"><span class="built_in">	int </span>nCross = 0;</span><br><span class="line">	for (int i = 0; i &lt; poly.verNum; i++) &#123;</span><br><span class="line">	<span class="built_in">	int </span>p1x = poly.x[i];</span><br><span class="line">	<span class="built_in">	int </span>p1y = poly.y[i];</span><br><span class="line">	<span class="built_in">	int </span>p2x = poly.x[(i + 1) % poly.verNum];</span><br><span class="line">	<span class="built_in">	int </span>p2y = poly.y[(i + 1) % poly.verNum];</span><br><span class="line">		/* 平行或在延长线上，忽略 */</span><br><span class="line">	<span class="built_in">	if </span>(p1y == p2y || y &lt; min(p1y, p2y) || y &gt; max(p1y, p2y)) &#123;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">		/* 计算交点横坐标 */</span><br><span class="line">	<span class="built_in">	double </span>m = (double)(y - p1y) * (double)(p2x - p1x) / (double)(p2y - p1y) + p1x; </span><br><span class="line">	<span class="built_in">	if </span>( m &gt; x ) nCross++; </span><br><span class="line">	&#125;</span><br><span class="line"><span class="built_in">	return </span>(nCross % 2 == 1); </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是判断在多边形内部的算法。</p>
                  <h3 id="2-删除图形实现"><a href="#2-删除图形实现" class="headerlink" title="2.删除图形实现"></a>2.删除图形实现</h3>
                  <p>好了，有了上面的算法，我们就依次查找我们声明的 polygons 数组，找到第一个符合要求的多边形结构体 polygon 返回它的索引。 这个方法就是传入了点击点的位置x，y坐标，然后判断是在哪个多边形内，然后移除之。如果没有找到，则不执行删除操作。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line">void delete<span class="constructor">Poly(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span> &#123;</span><br><span class="line">	<span class="built_in">int</span> delenum = -<span class="number">1</span>;</span><br><span class="line">	for (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; con; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (point<span class="constructor">InPoly(<span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span>)</span>) &#123;</span><br><span class="line">			delenum = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (delenum != -<span class="number">1</span>) &#123;</span><br><span class="line">		remove<span class="constructor">Poly(<span class="params">delenum</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 removePoly(delenum) 就是通过传入这个结构体的索引，然后将它从polygons里面删除即可，方法实现如下</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="type">void</span> removePoly(<span class="type">int</span> <span class="keyword">index</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">index</span>&gt;con) &#123;</span><br><span class="line">		printf("Out Of Index\n");</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="keyword">index</span>; i &lt; con; i++) &#123;</span><br><span class="line">		polygons[i] = polygons[i+<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	con<span class="comment">--;</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实就是相当于从数组中移除一个元素，然后后面的元素依次前移。 恩好了，准备工作都做好了，我们只需要在点击了删除按钮之后，调用一下deletePoly函数即可。 把原来的mouseClick方法改写如下即可，代码较长，不完全展开，<strong>双击查看完整代码</strong></p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">delBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span> </span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">2</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">			&#125; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过上面的步骤，我们便可以很方便地实现图形的删除了。运行结果如下</p>
                  <p>[embed]<a href="http://qiniu.cuiqingcai.com/robot2.mp4[/embed" target="_blank" rel="noopener">http://qiniu.cuiqingcai.com/robot2.mp4[/embed</a>]</p>
                  <p>嗯，就是这样，现在删除就大功告成了。</p>
                  <h2 id="移动图形"><a href="#移动图形" class="headerlink" title="移动图形"></a>移动图形</h2>
                  <p>像之前一样，定义一个移动图形的按钮。在此不再赘述</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte moveBtn[<span class="number">3</span>] = &#123;<span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">190</span>, <span class="number">280</span>, <span class="number">10</span>, moveBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么图形移动怎么实现？思路如下 首先利用判断点击的点是否在多边形内部的算法，找到需要移动的多边形。然后在监听鼠标移动的事件中设置这个多边形各个顶点的相对移动距离等于鼠标相对移动距离即可。 首先，移动的drawSatus我们设置为3，在mouseClick方法中加入如下部分，在哪加你应该已经知道了。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">moveBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在mouseMove方法中（另一个监听鼠标移动的事件）中首先判断当前的drawStatus如果为3，那么就执行移动操作。 加入如下的方法即可。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line">void mouse<span class="constructor">Move(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(drawStatus<span class="operator"> == </span><span class="number">3</span><span class="operator"> &amp;&amp; </span>moveNum != -<span class="number">1</span>)&#123;</span><br><span class="line">		printf(<span class="string">"move x:%d,y:%dmoveNum:%d\n"</span>, x, y,moveNum);</span><br><span class="line">		move<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里两点需要说明，moveNum就是我们需要移动的图形的索引，定义为了全局变量。在鼠标点击时，首先判定点击点在哪个图形中，然而因为有两个鼠标事件（一个是点击，一个是移动），所以就把这个变量定义为全局变量，来标记该移动哪个图形。moveNum的初始值为-1，如果为-1，那么就代表没有选中任何图形，不移动。如果不是-1，就进行移动。 其次，movePloy方法实现如下</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 移动多边形 */</span></span><br><span class="line">void movePoly(int <span class="symbol">x</span>, int <span class="symbol">y</span>) &#123;</span><br><span class="line">	<span class="comment">/* 取到要移动的图形 */</span></span><br><span class="line">	int verNum = polygons[moveNum].verNum;</span><br><span class="line">	printf(<span class="string">"verNum%d,x%d,y%d,clickX%d,clickY%d\n"</span>,verNum,<span class="symbol">x</span>,<span class="symbol">y</span>,clickX,clickY);</span><br><span class="line">	<span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; verNum; i++) &#123;</span><br><span class="line">		polygons[moveNum].<span class="symbol">x</span>[i] += (<span class="symbol">x</span> - clickX);</span><br><span class="line">		polygons[moveNum].<span class="symbol">y</span>[i] += (<span class="symbol">y</span> - clickY); </span><br><span class="line">		printf(<span class="string">"polyx%d\n"</span>,polygons[moveNum].<span class="symbol">x</span>[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX = <span class="symbol">x</span>;</span><br><span class="line">	clickY = <span class="symbol">y</span>;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法的实现有一部分需要说明，首先是clickX，clickY。 因为在移动时移动的是相对距离。所以，鼠标每移动一个像素，我们就要计算下一步鼠标移动的位置和上一个位置的差值，所以每次移动我们都需要标记一下点击的位置。所以上面的方法中才有了</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX = <span class="symbol">x</span>;</span><br><span class="line">	clickY = <span class="symbol">y</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后，在图形移动时，我们需要移动的是相对位置。所以我们将一个图形的所有顶点进行遍历，加上鼠标移动的相对位置即可。就是如下的实现</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">for (<span class="name">int</span> i = <span class="number">0</span><span class="comment">; i &lt; verNum; i++) &#123;</span></span><br><span class="line">		polygons[moveNum].x[i] += (<span class="name">x</span> - clickX)<span class="comment">;</span></span><br><span class="line">		polygons[moveNum].y[i] += (<span class="name">y</span> - clickY)<span class="comment">; </span></span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，mouseClick方法中我们需要调用一下即可。mouseClick方法现在改写如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">		clickX = x;</span><br><span class="line">		clickY = y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">delBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">moveBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span> </span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">2</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span>(drawStatus<span class="operator"> == </span><span class="number">3</span>) &#123;</span><br><span class="line">				moveNum = -<span class="number">1</span>;</span><br><span class="line">				for (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; con; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (point<span class="constructor">InPoly(<span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span>)</span>) &#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，现在就大功告成了，看一下运行结果吧</p>
                  <p>[embed]<a href="http://qiniu.cuiqingcai.com/robot3.mp4[/embed" target="_blank" rel="noopener">http://qiniu.cuiqingcai.com/robot3.mp4[/embed</a>]</p>
                  <p>现在完整的代码如下，代码过长，不完全显示，<strong>双击查看完整代码</strong></p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX 10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_PLOY 10</span></span><br><span class="line"><span class="comment">/* 窗口长宽的一半 */</span></span><br><span class="line"><span class="keyword">int</span> halfWidth, halfHeight;</span><br><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="keyword">int</span>	drawStatus	= <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span>	moveNum		= <span class="number">-1</span>;</span><br><span class="line"><span class="comment">/* 定义点击点的x,y*/</span></span><br><span class="line"><span class="keyword">int</span> clickX, clickY;</span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">polygon</span> &#123;</span></span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="keyword">int</span>	x[MAX_VERTEX];</span><br><span class="line">	<span class="keyword">int</span>	y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="keyword">int</span>	verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123; <span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span> &#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123; <span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span> &#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123; <span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span> &#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123; <span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span> &#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123; <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span> &#125;;</span><br><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123; <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span> &#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123; <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span> &#125;;</span><br><span class="line">GLubyte delBtn[<span class="number">3</span>] = &#123; <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span> &#125;;</span><br><span class="line">GLubyte moveBtn[<span class="number">3</span>] = &#123; <span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span> &#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="keyword">int</span> con = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glPolygons</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( con &gt;= <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= con; i++ )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly = polygons[i];</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			glBegin( GL_LINE_LOOP );</span><br><span class="line">			<span class="keyword">int</span> num = poly.verNum;</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"num:%d\n"</span>, num );</span><br><span class="line">			<span class="keyword">for</span> ( <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num; j++ )</span><br><span class="line">			&#123;</span><br><span class="line">				glColor3ub( poly.color[<span class="number">0</span>], poly.color[<span class="number">1</span>], poly.color[<span class="number">2</span>] );</span><br><span class="line">				glVertex2d( poly.x[j] - halfWidth, halfHeight - poly.y[j] );</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"polyx:%d,polyy:%d"</span>, poly.x[j], poly.y[j] );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			glEnd();</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			glFlush();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glColorCircle</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> R, GLubyte color[<span class="number">3</span>] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_POLYGON );</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub( color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>] );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * PI; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + R * <span class="built_in">cos</span>( i );</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + R*<span class="built_in">sin</span>( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画矩形，传入的是左下角XY坐标和右上角XY坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glRect</span><span class="params">( <span class="keyword">int</span> leftX, <span class="keyword">int</span> leftY, <span class="keyword">int</span> rightX, <span class="keyword">int</span> rightY )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 左下角 */</span></span><br><span class="line">	glVertex2d( leftX, leftY );</span><br><span class="line">	<span class="comment">/* 右下角 */</span></span><br><span class="line">	glVertex2d( rightX, leftY );</span><br><span class="line">	<span class="comment">/* 右上角 */</span></span><br><span class="line">	glVertex2d( rightX, rightY );</span><br><span class="line">	<span class="comment">/* 左上角 */</span></span><br><span class="line">	glVertex2d( leftX, rightY );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glRoundRec</span><span class="params">( <span class="keyword">int</span> centerX, <span class="keyword">int</span> centerY, <span class="keyword">int</span> <span class="built_in">width</span>, <span class="keyword">int</span> <span class="built_in">height</span>, <span class="keyword">float</span> cirR )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 二分之PI，一个象限的角度 */</span></span><br><span class="line">	<span class="keyword">float</span> PI_HALF = PI / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/* 划分程度,值越大画得越精细 */</span></span><br><span class="line">	<span class="keyword">float</span> divide = <span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">/* 圆角矩形的坐标 */</span></span><br><span class="line">	<span class="keyword">float</span> tx, ty;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 四个象限不同的操作符 */</span></span><br><span class="line">	<span class="keyword">int</span>	opX[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">	<span class="keyword">int</span>	opY[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span> &#125;;</span><br><span class="line">	<span class="comment">/* 用来计数，从第一象限到第四象限 */</span></span><br><span class="line">	<span class="keyword">float</span> x = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* x自增时加的值 */</span></span><br><span class="line">	<span class="keyword">float</span> part = <span class="number">1</span> / divide;</span><br><span class="line">	<span class="comment">/* 计算内矩形宽高一半的数值 */</span></span><br><span class="line">	<span class="keyword">int</span>	w	= <span class="built_in">width</span> / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="keyword">int</span>	h	= <span class="built_in">height</span> / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="comment">/* 循环画线 */</span></span><br><span class="line">	<span class="keyword">for</span> ( x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x += part )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 求出弧度 */</span></span><br><span class="line">		<span class="keyword">float</span> rad = PI_HALF * x;</span><br><span class="line">		<span class="comment">/* 计算坐标值 */</span></span><br><span class="line">		tx	= cirR * <span class="built_in">cos</span>( rad ) + opX[(<span class="keyword">int</span>) x] * w + centerX;</span><br><span class="line">		ty	= cirR * <span class="built_in">sin</span>( rad ) + opY[(<span class="keyword">int</span>) x] * h + centerY;</span><br><span class="line">		<span class="comment">/*传入坐标画线 */</span></span><br><span class="line">		glVertex2f( tx, ty );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glArc</span><span class="params">( <span class="keyword">double</span> x, <span class="keyword">double</span> y, <span class="keyword">double</span> start_angle, <span class="keyword">double</span> end_angle, <span class="keyword">double</span> radius )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">double</span> i = start_angle; i &lt;= end_angle; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + radius * <span class="built_in">cos</span>( i );</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + radius*<span class="built_in">sin</span>( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glCircle</span><span class="params">( <span class="keyword">double</span> x, <span class="keyword">double</span> y, <span class="keyword">double</span> radius )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画全圆 */</span></span><br><span class="line">	glArc( x, y, <span class="number">0</span>, <span class="number">2</span> * PI, radius );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画三角形，传入三个点的坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glTri</span><span class="params">( <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2, <span class="keyword">int</span> x3, <span class="keyword">int</span> y3 )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/*三点 */</span></span><br><span class="line">	glVertex2d( x3, y3 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画线，传入两点坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glLine</span><span class="params">( <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2 )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">( <span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* GL_COLOR_BUFFER_BIT表示清除颜色 */</span></span><br><span class="line">	glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line">	<span class="comment">/* 设置画线颜色 */</span></span><br><span class="line">	glColor3f( <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span> );</span><br><span class="line">	<span class="comment">/* 画点大小 */</span></span><br><span class="line">	glPointSize( <span class="number">2</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大肚子 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">0</span>, <span class="number">146</span>, <span class="number">120</span>, <span class="number">15</span> );</span><br><span class="line">	<span class="comment">/* 画圆，中间小圈 */</span></span><br><span class="line">	glCircle( <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，脖子 */</span></span><br><span class="line">	glRect( <span class="number">-25</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">76</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大脸 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">113</span>, <span class="number">128</span>, <span class="number">74</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两个眼睛 */</span></span><br><span class="line">	glCircle( <span class="number">-30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两条天线 */</span></span><br><span class="line">	glLine( <span class="number">-35</span>, <span class="number">150</span>, <span class="number">-35</span>, <span class="number">173</span> );</span><br><span class="line">	glLine( <span class="number">35</span>, <span class="number">150</span>, <span class="number">35</span>, <span class="number">173</span> );</span><br><span class="line">	<span class="comment">/* 圆角矩形，两个耳朵 */</span></span><br><span class="line">	glRoundRec( <span class="number">81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	glRoundRec( <span class="number">-81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	<span class="comment">/* 圆弧，画嘴 */</span></span><br><span class="line">	glArc( <span class="number">0</span>, <span class="number">133</span>, <span class="number">11</span> * PI / <span class="number">8</span>, <span class="number">13</span> * PI / <span class="number">8</span>, <span class="number">45</span> );</span><br><span class="line">	<span class="comment">/* 画三角，肚子里的三角 */</span></span><br><span class="line">	glTri( <span class="number">-30</span>, <span class="number">-15</span>, <span class="number">30</span>, <span class="number">-15</span>, <span class="number">0</span>, <span class="number">28</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，胳膊连接处 */</span></span><br><span class="line">	glRect( <span class="number">-81</span>, <span class="number">43</span>, <span class="number">-73</span>, <span class="number">25</span> );</span><br><span class="line">	glRect( <span class="number">81</span>, <span class="number">43</span>, <span class="number">73</span>, <span class="number">25</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，上臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">45</span>, <span class="number">-81</span>, <span class="number">0</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">45</span>, <span class="number">81</span>, <span class="number">0</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，中臂 */</span></span><br><span class="line">	glRect( <span class="number">-101</span>, <span class="number">0</span>, <span class="number">-88</span>, <span class="number">-4</span> );</span><br><span class="line">	glRect( <span class="number">101</span>, <span class="number">0</span>, <span class="number">88</span>, <span class="number">-4</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，下臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">-4</span>, <span class="number">-81</span>, <span class="number">-37</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">-4</span>, <span class="number">81</span>, <span class="number">-37</span> );</span><br><span class="line">	<span class="comment">/* 画圆形，手掌 */</span></span><br><span class="line">	glCircle( <span class="number">-95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">	glColorCircle( <span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red );</span><br><span class="line">	glColorCircle( <span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow );</span><br><span class="line">	glColorCircle( <span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey );</span><br><span class="line">	glColorCircle( <span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor );</span><br><span class="line">	glColorCircle( <span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn );</span><br><span class="line">	glColorCircle( <span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn );</span><br><span class="line">	glColorCircle( <span class="number">220</span>, <span class="number">280</span>, <span class="number">10</span>, delBtn );</span><br><span class="line">	glColorCircle( <span class="number">190</span>, <span class="number">280</span>, <span class="number">10</span>, moveBtn );</span><br><span class="line">	<span class="comment">/* 保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待 */</span></span><br><span class="line">	<span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	glPolygons();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 窗口大小变化时调用的函数 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ChangeSize</span><span class="params">( GLsizei w, GLsizei h )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 避免高度为0 */</span></span><br><span class="line">	<span class="keyword">if</span> ( h == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		h = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 定义视口大小，宽高一致 */</span></span><br><span class="line">	glViewport( <span class="number">0</span>, <span class="number">0</span>, w, h );</span><br><span class="line">	<span class="keyword">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 定义宽高的一半 */</span></span><br><span class="line">	halfHeight	= <span class="number">300</span>;</span><br><span class="line">	halfWidth	= <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 重置坐标系统，使投影变换复位 */</span></span><br><span class="line">	glMatrixMode( GL_PROJECTION );</span><br><span class="line">	<span class="comment">/* 将当前的用户坐标系的原点移到了屏幕中心 */</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">/* 定义正交视域体 */</span></span><br><span class="line">	<span class="keyword">if</span> ( w &lt; h )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果高度大于宽度，则将高度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half, half, -half * h / w, half * h / w, -half, half );</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/* 如果宽度大于高度，则将宽度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half * w / h, half * w / h, -half, half, -half, half );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sameColor</span><span class="params">( GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glPoints</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	glBegin( GL_POINTS );</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	glColor3ub( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">	glVertex2d( x - halfWidth, halfHeight - y );</span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断一个点是否在多边形内部 */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">pointInPoly</span><span class="params">( polygon poly, <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nCross = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; poly.verNum; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span>	p1x	= poly.x[i];</span><br><span class="line">		<span class="keyword">int</span>	p1y	= poly.y[i];</span><br><span class="line">		<span class="keyword">int</span>	p2x	= poly.x[(i + <span class="number">1</span>) % poly.verNum];</span><br><span class="line">		<span class="keyword">int</span>	p2y	= poly.y[(i + <span class="number">1</span>) % poly.verNum];</span><br><span class="line">		<span class="comment">/* 平行或在延长线上，忽略 */</span></span><br><span class="line">		<span class="keyword">if</span> ( p1y == p2y || y &lt; <span class="built_in">min</span>( p1y, p2y ) || y &gt; <span class="built_in">max</span>( p1y, p2y ) )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/* 计算交点横坐标 */</span></span><br><span class="line">		<span class="keyword">double</span> m = (<span class="keyword">double</span>) (y - p1y) * (<span class="keyword">double</span>) (p2x - p1x) / (<span class="keyword">double</span>) (p2y - p1y) + p1x;</span><br><span class="line">		<span class="keyword">if</span> ( m &gt; x )</span><br><span class="line">			nCross++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>(nCross % <span class="number">2</span> == <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 移动多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">movePoly</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 取到要移动的图形 */</span></span><br><span class="line">	<span class="keyword">int</span> verNum = polygons[moveNum].verNum;</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"verNum%d,x%d,y%d,clickX%d,clickY%d\n"</span>, verNum, x, y, clickX, clickY );</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verNum; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		polygons[moveNum].x[i]	+= (x - clickX);</span><br><span class="line">		polygons[moveNum].y[i]	+= (y - clickY);</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"polyx%d\n"</span>, polygons[moveNum].x[i] );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removePoly</span><span class="params">( <span class="keyword">int</span> index )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( index &gt; con )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"Out Of Index\n"</span> );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = index; i &lt; con; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		polygons[i] = polygons[i + <span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	con--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deletePoly</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> delenum = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ( pointInPoly( polygons[i], x, y ) )</span><br><span class="line">		&#123;</span><br><span class="line">			delenum = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> ( delenum != <span class="number">-1</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		removePoly( delenum );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseClick</span><span class="params">( <span class="keyword">int</span> btn, <span class="keyword">int</span> state, <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="keyword">int</span>	optionHeight	= <span class="number">40</span>;</span><br><span class="line">	<span class="keyword">int</span>	optionWidth	= <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> ( btn == GLUT_LEFT_BUTTON &amp;&amp; state == GLUT_DOWN )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> ( y &lt; optionHeight &amp;&amp; x &lt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels( x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor );</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>] );</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle( <span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor );</span><br><span class="line">			<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( y &lt; optionHeight &amp;&amp; x &gt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取当前的点 */</span></span><br><span class="line">			GLubyte color[<span class="number">3</span>];</span><br><span class="line">			glReadPixels( x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;color );</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"r:%d,g:%d,b:%d\n"</span>, color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>] );</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> ( sameColor( color, startBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons[con].verNum = <span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">				<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, endBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				glutPostRedisplay();</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, delBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, moveBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> ( drawStatus == <span class="number">0</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints( x, y );</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons[con].color[<span class="number">0</span>]	= nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>]	= nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>]	= nowColor[<span class="number">2</span>];</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>], polygons[con].color[<span class="number">1</span>], polygons[con].color[<span class="number">2</span>] );</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum );</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus == <span class="number">2</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				deletePoly( x, y );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus == <span class="number">3</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				moveNum = <span class="number">-1</span>;</span><br><span class="line">				<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> ( pointInPoly( polygons[i], x, y ) )</span><br><span class="line">					&#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseMove</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( drawStatus == <span class="number">3</span> &amp;&amp; moveNum != <span class="number">-1</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"move x:%d,y:%dmoveNum:%d\n"</span>, x, y, moveNum );</span><br><span class="line">		movePoly( x, y );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*程序入口 */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glutInit( &amp;argc, argv );</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glutInitDisplayMode( GLUT_RGB | GLUT_SINGLE );</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glutInitWindowPosition( <span class="number">100</span>, <span class="number">100</span> );</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glutInitWindowSize( <span class="number">600</span>, <span class="number">600</span> );</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glutCreateWindow( <span class="string">"OpenGL"</span> );</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	glClearColor( <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glutDisplayFunc( &amp;<span class="built_in">display</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，当窗口大小改变时会被调用 */</span></span><br><span class="line">	glutReshapeFunc( ChangeSize );</span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glutMouseFunc( mouseClick );</span><br><span class="line">	<span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">	glutMotionFunc( mouseMove );</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	<span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上，就可以实现图形的移动和删除了。</p>
                  <h2 id="存盘和读盘"><a href="#存盘和读盘" class="headerlink" title="存盘和读盘"></a>存盘和读盘</h2>
                  <p>这个很简单，存盘我们只需要把所有图形的位置以及颜色输出到一个文本中，然后在读盘时，把文本中所有内容读入并存储到多边形结构体数组中，然后重新绘制即可。 代码的讲解直接写在注释中，比较好理解</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 保存所有的图形 */</span></span><br><span class="line">void savePolygons()</span><br><span class="line">&#123;</span><br><span class="line">	FILE *<span class="built_in">fp</span>;</span><br><span class="line">	int i;</span><br><span class="line">	if ((<span class="built_in">fp</span> = fopen(<span class="string">"shapes.txt"</span>, <span class="string">"w"</span>)) == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">"不能打开文件!"</span>);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 保存一共多少个图形 */</span></span><br><span class="line">	fprintf(<span class="built_in">fp</span>, <span class="string">"%d"</span>, con);</span><br><span class="line">	fprintf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	for (i = <span class="number">0</span><span class="comment">; i &lt; con; i++)&#123;</span></span><br><span class="line">		<span class="comment">/* 保存颜色值 */</span></span><br><span class="line">		fprintf(<span class="built_in">fp</span>, <span class="string">"%d %d %d "</span>, polygons[i].color[<span class="number">0</span>], polygons[i].color[<span class="number">1</span>], polygons[i].color[<span class="number">2</span>]);</span><br><span class="line">		<span class="comment">/* 保存顶点数量 */</span></span><br><span class="line">		fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].verNum);</span><br><span class="line">		<span class="comment">/* 保存顶点坐标 */</span></span><br><span class="line">		for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].x[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].y[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	fprintf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(<span class="built_in">fp</span>);</span><br><span class="line">	printf(<span class="string">"保存成功。\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 读取存档 */</span></span><br><span class="line">void readPolygons()</span><br><span class="line">&#123;</span><br><span class="line">	FILE *<span class="built_in">fp</span>;</span><br><span class="line">	int i;</span><br><span class="line">	if ((<span class="built_in">fp</span> = fopen(<span class="string">"shapes.txt"</span>, <span class="string">"r"</span>)) == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">"不能打开文件!"</span>);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	fscanf(<span class="built_in">fp</span>, <span class="string">"%d"</span>, &amp;con);</span><br><span class="line">	printf(<span class="string">"count%d"</span>,con);</span><br><span class="line">	fscanf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	for (i = <span class="number">0</span><span class="comment">; i &lt; con; i++)&#123;</span></span><br><span class="line">		<span class="comment">/* 读取颜色值 */</span></span><br><span class="line">		fscanf(<span class="built_in">fp</span>, <span class="string">"%d %d %d "</span>, &amp;polygons[i].color[<span class="number">0</span>], &amp;polygons[i].color[<span class="number">1</span>], &amp;polygons[i].color[<span class="number">2</span>]);</span><br><span class="line">		<span class="comment">/* 读取顶点数量 */</span></span><br><span class="line">		fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].verNum);</span><br><span class="line">		<span class="comment">/* 读取顶点坐标 */</span></span><br><span class="line">		for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].x[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].y[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	fscanf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(<span class="built_in">fp</span>);</span><br><span class="line">	printf(<span class="string">"读取成功。\n"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们只需要再定义两个按钮，再display中画上这俩按钮</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte storeBtn[<span class="number">3</span>] = &#123;<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>&#125;;</span><br><span class="line">GLubyte loadBtn[<span class="number">3</span>] = &#123;<span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后把mouseClick方法改写一下就好了。最终mouseClick方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click( <span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span> )</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span>	optionHeight	= <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span>	optionWidth	= <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> ( btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> ( y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels( <span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span> )</span>;</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle( -180, 280, 10, <span class="params">nowColor</span> )</span>;</span><br><span class="line">			<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取当前的点 */</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels( <span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span> )</span>;</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">startBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">endBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">delBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">moveBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">storeBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 存盘时设置drawStatus为4 */</span></span><br><span class="line">				drawStatus = <span class="number">4</span>;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				save<span class="constructor">Polygons()</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">loadBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 读盘时设置drawStatus为5 */</span></span><br><span class="line">				drawStatus = <span class="number">5</span>;</span><br><span class="line">				read<span class="constructor">Polygons()</span>;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">0</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points( <span class="params">x</span>, <span class="params">y</span> )</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>	= nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>	= nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>	= nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">2</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly( <span class="params">x</span>, <span class="params">y</span> )</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">3</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				moveNum = -<span class="number">1</span>;</span><br><span class="line">				for ( <span class="built_in">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> ( point<span class="constructor">InPoly( <span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span> )</span> )</span><br><span class="line">					&#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>大功告成！现在只要你存盘成功，不管对图形进行怎样的移动，删除操作。只要再点击读盘，就可以恢复到存盘时的状态，是不是非常酷炫。 大家可以尝试一下！</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本篇文章说明了图形的删除，移动以及存盘读盘的功能。代码实现仅仅是我个人的思路，当然实现方式不止这一种，欢迎大家创新。 部分思路如果大家有更好的解决方法，欢迎同我交流，非常感谢。 总之希望对大家有帮助！小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 13:48:05" itemprop="dateCreated datePublished" datetime="2015-05-11T13:48:05+08:00">2015-05-11</time>
                </span>
                <span id="/1802.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例八之图形的移动删除存盘" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>22k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>20 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1783.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1783.html" class="post-title-link" itemprop="url">OpenGL绘图实例七之鼠标设色取点绘图</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一节我们学习了鼠标监听事件，在这里我们就利用它来做一个实例，对鼠标监听事件进行一个综合的应用。</p>
                  <h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2>
                  <p>1. 绘制如下的机器人，并在此基础上进行创作 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/图片1.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/图片1.png" alt="图片1"></a> 2. 对象创建：支持用户利用鼠标指定各个顶点位置，补充完整机器人的腿部。 3. 对象删除：支持用户选择一个腿部的多边形（与你的多边形保存的数据结构有关）并删除。 4. 对象存储：设计一种数据结构存储每个多边形的顶点与边，支持文件存盘，并支持读盘复原。 5. 支持用户选择多边形的颜色，支持用户移动多边形</p>
                  <h2 id="成果"><a href="#成果" class="headerlink" title="成果"></a>成果</h2>
                  <p>在这里为了动态演示，将我的成果以视频形式演示如下</p>
                  <p>[embed]<a href="http://qiniu.cuiqingcai.com/robot.mp4[/embed" target="_blank" rel="noopener">http://qiniu.cuiqingcai.com/robot.mp4[/embed</a>]</p>
                  <p>好，欣赏完视频之后是不是非常想知道是怎样实现的呢？下面我们来一步一步进行讲解。</p>
                  <h2 id="绘制半机器人"><a href="#绘制半机器人" class="headerlink" title="绘制半机器人"></a>绘制半机器人</h2>
                  <p>在前面的几篇中，已经详细描述了绘制机器人的方法，在这里我们简单贴一下代码来绘制一个半机器人。 直接上代码吧，不多说了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#define PI <span class="number">3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画矩形，传入的是左下角XY坐标和右上角XY坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glRect( <span class="built_in">int</span> leftX, <span class="built_in">int</span> leftY, <span class="built_in">int</span> rightX, <span class="built_in">int</span> rightY )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 左下角 */</span></span><br><span class="line">	glVertex2d( leftX, leftY );</span><br><span class="line">	<span class="comment">/* 右下角 */</span></span><br><span class="line">	glVertex2d( rightX, leftY );</span><br><span class="line">	<span class="comment">/* 右上角 */</span></span><br><span class="line">	glVertex2d( rightX, rightY );</span><br><span class="line">	<span class="comment">/* 左上角 */</span></span><br><span class="line">	glVertex2d( leftX, rightY );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec( <span class="built_in">int</span> centerX, <span class="built_in">int</span> centerY, <span class="built_in">int</span> width, <span class="built_in">int</span> height, <span class="built_in">float</span> cirR )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 二分之PI，一个象限的角度 */</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/* 划分程度,值越大画得越精细 */</span></span><br><span class="line">	<span class="built_in">float</span> divide = <span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">/* 圆角矩形的坐标 */</span></span><br><span class="line">	<span class="built_in">float</span> tx, ty;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 四个象限不同的操作符 */</span></span><br><span class="line">	<span class="built_in">int</span>	opX[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">	<span class="built_in">int</span>	opY[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span> &#125;;</span><br><span class="line">	<span class="comment">/* 用来计数，从第一象限到第四象限 */</span></span><br><span class="line">	<span class="built_in">float</span> x = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* x自增时加的值 */</span></span><br><span class="line">	<span class="built_in">float</span> part = <span class="number">1</span> / divide;</span><br><span class="line">	<span class="comment">/* 计算内矩形宽高一半的数值 */</span></span><br><span class="line">	<span class="built_in">int</span>	w	= width / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="built_in">int</span>	h	= height / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="comment">/* 循环画线 */</span></span><br><span class="line">	<span class="keyword">for</span> ( x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x += part )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 求出弧度 */</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF * x;</span><br><span class="line">		<span class="comment">/* 计算坐标值 */</span></span><br><span class="line">		tx	= cirR * cos( rad ) + opX[(<span class="built_in">int</span>) x] * w + centerX;</span><br><span class="line">		ty	= cirR * sin( rad ) + opY[(<span class="built_in">int</span>) x] * h + centerY;</span><br><span class="line">		<span class="comment">/*传入坐标画线 */</span></span><br><span class="line">		glVertex2f( tx, ty );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径 */</span></span><br><span class="line"><span class="built_in">void</span> glArc( <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> start_angle, <span class="built_in">double</span> end_angle, <span class="built_in">double</span> radius )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="built_in">double</span> i = start_angle; i &lt;= end_angle; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="built_in">double</span>	vx	= x + radius * cos( i );</span><br><span class="line">		<span class="built_in">double</span>	vy	= y + radius*sin( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆 */</span></span><br><span class="line"><span class="built_in">void</span> glCircle( <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画全圆 */</span></span><br><span class="line">	glArc( x, y, <span class="number">0</span>, <span class="number">2</span> * PI, radius );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画三角形，传入三个点的坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glTri( <span class="built_in">int</span> x1, <span class="built_in">int</span> y1, <span class="built_in">int</span> x2, <span class="built_in">int</span> y2, <span class="built_in">int</span> x3, <span class="built_in">int</span> y3 )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/*三点 */</span></span><br><span class="line">	glVertex2d( x3, y3 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画线，传入两点坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glLine( <span class="built_in">int</span> x1, <span class="built_in">int</span> y1, <span class="built_in">int</span> x2, <span class="built_in">int</span> y2 )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line"><span class="built_in">void</span> display( <span class="built_in">void</span> )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* GL_COLOR_BUFFER_BIT表示清除颜色 */</span></span><br><span class="line">	glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line">	<span class="comment">/* 设置画线颜色 */</span></span><br><span class="line">	glColor3f( <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span> );</span><br><span class="line">	<span class="comment">/* 画点大小 */</span></span><br><span class="line">	glPointSize( <span class="number">2</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大肚子 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">0</span>, <span class="number">146</span>, <span class="number">120</span>, <span class="number">15</span> );</span><br><span class="line">	<span class="comment">/* 画圆，中间小圈 */</span></span><br><span class="line">	glCircle( <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，脖子 */</span></span><br><span class="line">	glRect( <span class="number">-25</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">76</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大脸 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">113</span>, <span class="number">128</span>, <span class="number">74</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两个眼睛 */</span></span><br><span class="line">	glCircle( <span class="number">-30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两条天线 */</span></span><br><span class="line">	glLine( <span class="number">-35</span>, <span class="number">150</span>, <span class="number">-35</span>, <span class="number">173</span> );</span><br><span class="line">	glLine( <span class="number">35</span>, <span class="number">150</span>, <span class="number">35</span>, <span class="number">173</span> );</span><br><span class="line">	<span class="comment">/* 圆角矩形，两个耳朵 */</span></span><br><span class="line">	glRoundRec( <span class="number">81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	glRoundRec( <span class="number">-81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	<span class="comment">/* 圆弧，画嘴 */</span></span><br><span class="line">	glArc( <span class="number">0</span>, <span class="number">133</span>, <span class="number">11</span> * PI / <span class="number">8</span>, <span class="number">13</span> * PI / <span class="number">8</span>, <span class="number">45</span> );</span><br><span class="line">	<span class="comment">/* 画三角，肚子里的三角 */</span></span><br><span class="line">	glTri( <span class="number">-30</span>, <span class="number">-15</span>, <span class="number">30</span>, <span class="number">-15</span>, <span class="number">0</span>, <span class="number">28</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，胳膊连接处 */</span></span><br><span class="line">	glRect( <span class="number">-81</span>, <span class="number">43</span>, <span class="number">-73</span>, <span class="number">25</span> );</span><br><span class="line">	glRect( <span class="number">81</span>, <span class="number">43</span>, <span class="number">73</span>, <span class="number">25</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，上臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">45</span>, <span class="number">-81</span>, <span class="number">0</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">45</span>, <span class="number">81</span>, <span class="number">0</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，中臂 */</span></span><br><span class="line">	glRect( <span class="number">-101</span>, <span class="number">0</span>, <span class="number">-88</span>, <span class="number">-4</span> );</span><br><span class="line">	glRect( <span class="number">101</span>, <span class="number">0</span>, <span class="number">88</span>, <span class="number">-4</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，下臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">-4</span>, <span class="number">-81</span>, <span class="number">-37</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">-4</span>, <span class="number">81</span>, <span class="number">-37</span> );</span><br><span class="line">	<span class="comment">/* 画圆形，手掌 */</span></span><br><span class="line">	glCircle( <span class="number">-95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待 */</span></span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 窗口大小变化时调用的函数 */</span></span><br><span class="line"><span class="built_in">void</span> ChangeSize( GLsizei w, GLsizei h )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 避免高度为0 */</span></span><br><span class="line">	<span class="keyword">if</span> ( h == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		h = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 定义视口大小，宽高一致 */</span></span><br><span class="line">	glViewport( <span class="number">0</span>, <span class="number">0</span>, w, h );</span><br><span class="line">	<span class="built_in">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 重置坐标系统，使投影变换复位 */</span></span><br><span class="line">	glMatrixMode( GL_PROJECTION );</span><br><span class="line">	<span class="comment">/* 将当前的用户坐标系的原点移到了屏幕中心 */</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">/* 定义正交视域体 */</span></span><br><span class="line">	<span class="keyword">if</span> ( w &lt; h )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果高度大于宽度，则将高度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half, half, -half * h / w, half * h / w, -half, half );</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/* 如果宽度大于高度，则将宽度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half * w / h, half * w / h, -half, half, -half, half );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*程序入口 */</span></span><br><span class="line"><span class="built_in">int</span> main( <span class="built_in">int</span> argc, char *argv[] )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glutInit( &amp;argc, argv );</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glutInitDisplayMode( GLUT_RGB | GLUT_SINGLE );</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glutInitWindowPosition( <span class="number">100</span>, <span class="number">100</span> );</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glutInitWindowSize( <span class="number">600</span>, <span class="number">600</span> );</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glutCreateWindow( <span class="string">"OpenGL"</span> );</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	glClearColor( <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glutDisplayFunc( &amp;display );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，当窗口大小改变时会被调用 */</span></span><br><span class="line">	glutReshapeFunc( ChangeSize );</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	<span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150511002257.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150511002257.jpg" alt="20150511002257"></a> 这一步非常非常简单，如果有不懂的小伙伴请参见 <a href="http://cuiqingcai.com/1597.html">此文章</a>。</p>
                  <h2 id="对象创建"><a href="#对象创建" class="headerlink" title="对象创建"></a>对象创建</h2>
                  <p>通过上面的一步，我们已经可以轻松地绘制出一个半身机器人，接下来我们就要通过监听鼠标事件来实现动态多边形的绘制了。 因为实验要求中要求了多边形的颜色绘制，所以颜色怎么选取呢？我是这么想的，在面板的左上角绘制几个色块，通过鼠标点击这几个色块，读取出RGB值，然后相应地设置当前绘图的颜色即可。 所以首先我在左上角定义了几个颜色色块，同时监听鼠标事件。 首先定义几个颜色的RGB值</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123;<span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span>&#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123;<span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span>&#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123;<span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span>&#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后定义一个绘制填充色的圆形的方法</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="keyword">void</span> glColorCircle(<span class="built_in">int</span> x, <span class="built_in">int</span> y, <span class="built_in">int</span> R, GLubyte <span class="built_in">color</span>[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin(GL_POLYGON);</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub(<span class="built_in">color</span>[<span class="number">0</span>], <span class="built_in">color</span>[<span class="number">1</span>], <span class="built_in">color</span>[<span class="number">2</span>]);</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = <span class="literal">PI</span> / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * <span class="literal">PI</span>; i += delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + R * <span class="built_in">cos</span>(i);</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + R*<span class="built_in">sin</span>(i);</span><br><span class="line">		glVertex2d(vx, vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么在display函数中，我们就可以调用下面的方法来绘制三个取色盘拾取颜色，其中最后一个取色盘保存了当前的颜色。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">glColorCircle(<span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red);</span><br><span class="line">glColorCircle(<span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow);</span><br><span class="line">glColorCircle(<span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey);</span><br><span class="line">glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样光有了取色盘可不行，需要有鼠标点击事动态地改变取色的色值。现在我们可以加入鼠标监听方法如下 通过上一节的说明，我们定义一个mouseClick事件</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line"></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外加入监听方法</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line"> glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里有几个地方需要说明一下。</p>
                  <h3 id="1-选项卡的分界范围是什么？"><a href="#1-选项卡的分界范围是什么？" class="headerlink" title="1.选项卡的分界范围是什么？"></a>1.选项卡的分界范围是什么？</h3>
                  <p>其实我是把整个画面分割成了三部分，其中最上面40像素的一个长条就是选项卡，选项卡又分为了两部分。左边是取色板，右边是绘制的选项，比如取点，绘制，删除等等的操作。所以，optionHeight 就指的是上面的40像素的分割线，optionWidth是中间的分割线，即上方调色板和绘制选项点的分割线。 通过鼠标点击判断是在哪个范围内从而响应不同的事件。 从而鼠标监听事件就是下面的结构了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &gt; optionWidth) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中第四个色板就是显示了当前的颜色，在-180,280的位置绘制了当前的颜色色盘。并同时颜色值保存在了nowColor中。</p>
                  <h3 id="2-halfHeight-和-halfWidth"><a href="#2-halfHeight-和-halfWidth" class="headerlink" title="2. halfHeight 和 halfWidth"></a>2. halfHeight 和 halfWidth</h3>
                  <p>这里定义了halfHeight和halfWdith，在后面的绘图中会用到，同时在取色时也会用到，实际就是整个窗口宽高的一半，定义为全局变量即可。如当前的窗口是600x600，所以现在二者就都是300,300. 到现在，如果你按照流程走下来，代码是可以正常运行的，现在可以通过点击左上角的色盘进行取色，同时第四个色盘显示了当前的颜色。运行结果截图如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150511005807.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150511005807.jpg" alt="20150511005807"></a> 好，接下来我们就进行多边形的定义了，多边形的定义我们利用结构体的形式，假设我们绘制的边数最大是10，可以定义如下的多边形结构体，结构体中包含了顶点坐标（数组形式），顶点数量，颜色（RGB）。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX 10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_PLOY 10</span></span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">polygon</span> &#123;</span></span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="keyword">int</span> x[MAX_VERTEX];</span><br><span class="line">	<span class="keyword">int</span> y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="keyword">int</span> verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为了便于记录，我们定义一个con变量来记录当前绘制到了哪个多边形</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="built_in">int</span> con = <span class="number">0</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，定义好结构体之后，我们就可以先选取点，然后绘制多边形了。所以在这里我们定义两个按钮，取点和绘制。 定义两个颜色</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用颜色来区分不同的按钮，现在原来的display函数中画上这俩按钮。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn);</span><br><span class="line">glColorCircle(<span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如图所示，当我们要取点的时候就可以点击一下左边的按钮，取完点后就可以点击右边的按钮完成绘制。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511010802.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511010802.jpg" alt="QQ截图20150511010802"></a> 在鼠标监听事件中，当点击了左边的按钮，便开始拾取几个顶点，然后点击右边的按钮之后，会将图形绘制出来。所以为了区分当前是在拾取点还是完成绘制，我们定义一个状态变量叫drawStatus</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="built_in">int</span> drawStatus = <span class="number">-1</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在原来的mouseClick函数中，对于判断点击右上方选项卡的响应就可以改写如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中sameColor方法就是来判断当前点击的位置是否和按钮颜色相等，在这里为了避免误差，我们像往常一样设置一个容差。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="built_in">bool</span> sameColor(GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span> (color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span>)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，当点击了第一个黑色按钮（取点的按钮）时，我们便可以在下方拾取点来保存到数组中了。 在最后的else代码块中加入如下的方法，用来取点。 这里的取点是取到了点击的坐标值，当前的RGB值，每取一个点，响应的verNum（顶点数目）就加一。 而且当前保存到的多边形是polygons[con]，con初始值为0，也就是保存到第一个多边形结构体中。 当我们点击了开始绘制按钮时，con会加1，并且将保存的多边形绘制出来。</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			if (drawStatus == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints(x, y);</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span> </span><br><span class="line">				polygons[con].color[<span class="number">0</span>] = nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>] = nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>] = nowColor[<span class="number">2</span>];</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>],polygons[con].color[<span class="number">1</span>],polygons[con].color[<span class="number">2</span>]);</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在上面的mouseClick方法就变成了</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span> </span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里有几点说明如下</p>
                  <h3 id="1-glPoints方法"><a href="#1-glPoints方法" class="headerlink" title="1.glPoints方法"></a>1.glPoints方法</h3>
                  <p>即画点方法，为了直观地显示用户选取了哪个点，我们设置了这个画点的方法，每点一个点，就在屏幕上显示出来。 方法定义如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line">void gl<span class="constructor">Points(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span> &#123;</span><br><span class="line">	gl<span class="constructor">Begin(GL_POINTS)</span>;</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	gl<span class="constructor">Color3ub(0, 0, 0)</span>;</span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x</span> - <span class="params">halfWidth</span>, <span class="params">halfHeight</span> - <span class="params">y</span>)</span>;</span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">	gl<span class="constructor">Flush()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里，glVertex2d方法的参数为什么不是x，y呢？很简单，因为我们绘画时的坐标原点是窗口的中心点，而鼠标点击的坐标原点是左上角，为了做一个映射变换，x需要减去halfWidth，y需要取反并加halfWidth。总之定义这两个half变量还是用处多多的。</p>
                  <h3 id="2-glutPostRedisplay"><a href="#2-glutPostRedisplay" class="headerlink" title="2.glutPostRedisplay"></a><strong>2.glutPostRedisplay</strong></h3>
                  <p>这个方法就是重新绘制的方法，我们看到在结束绘制的地方调用了这个方法，其实就是重新调用了display方法，所以为了让我们绘制的图形正常显示，我们需要在display方法中来绘制我们已经存储好的多边形。我们可以把绘制多边形定义为一个方法，然后在display中调用即可。 绘制多边形的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line">void gl<span class="constructor">Polygons()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (con&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">		for (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= con; i++) &#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly	= polygons<span class="literal">[<span class="identifier">i</span>]</span>;</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			gl<span class="constructor">Begin(GL_LINE_LOOP)</span>;</span><br><span class="line">			<span class="built_in">int</span> num = poly.verNum;</span><br><span class="line">			printf(<span class="string">"num:%d\n"</span>,num);</span><br><span class="line">			for (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; num; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				gl<span class="constructor">Color3ub(<span class="params">poly</span>.<span class="params">color</span>[0], <span class="params">poly</span>.<span class="params">color</span>[1], <span class="params">poly</span>.<span class="params">color</span>[2])</span>;</span><br><span class="line">				gl<span class="constructor">Vertex2d(<span class="params">poly</span>.<span class="params">x</span>[<span class="params">j</span>] - <span class="params">halfWidth</span>, <span class="params">halfHeight</span> - <span class="params">poly</span>.<span class="params">y</span>[<span class="params">j</span>])</span>;</span><br><span class="line">				printf(<span class="string">"polyx:%d,polyy:%d"</span>,poly.x<span class="literal">[<span class="identifier">j</span>]</span>,poly.y<span class="literal">[<span class="identifier">j</span>]</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			gl<span class="constructor">End()</span>;</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			gl<span class="constructor">Flush()</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在display函数中调用一下即可，方法的最后面调用一下。</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	<span class="selector-tag">glPolygons</span>();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，现在我们点击第一个黑色圆点，然后在屏幕上取点，取完点之后，然后点击右上角的黑色圆点，即可完成绘制 运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511013259.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511013259.jpg" alt="QQ截图20150511013259"></a> 在此先告一段落，下一篇我们接着这里来实现图形的删除，移动以及存盘，读盘等操作。</p>
                  <h2 id="本节代码"><a href="#本节代码" class="headerlink" title="本节代码"></a>本节代码</h2>
                  <p>到这里，提供如下代码，代码运行结果即为上图所示，由于代码太长，不完全展开显示，<strong>双击查看全部代码</strong>。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;math.h&gt; </span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define PI <span class="number">3.1415926</span></span><br><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line">#define MAX_VERTEX <span class="number">10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line">#define MAX_PLOY <span class="number">10</span></span><br><span class="line"><span class="comment">/* 窗口长宽的一半 */</span></span><br><span class="line"><span class="built_in">int</span> halfWidth, halfHeight;</span><br><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="built_in">int</span> drawStatus = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line">struct polygon &#123;</span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="built_in">int</span> x[MAX_VERTEX];</span><br><span class="line">	<span class="built_in">int</span> y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="built_in">int</span> verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123;<span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span>&#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123;<span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span>&#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123;<span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span>&#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="built_in">int</span> con = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line"><span class="built_in">void</span> glPolygons()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (con&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= con; i++) &#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly	= polygons[i];</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			glBegin(GL_LINE_LOOP);</span><br><span class="line">			<span class="built_in">int</span> num = poly.verNum;</span><br><span class="line">			printf(<span class="string">"num:%d\n"</span>,num);</span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; num; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				glColor3ub(poly.color[<span class="number">0</span>], poly.color[<span class="number">1</span>], poly.color[<span class="number">2</span>]);</span><br><span class="line">				glVertex2d(poly.x[j] - halfWidth, halfHeight - poly.y[j]);</span><br><span class="line">				printf(<span class="string">"polyx:%d,polyy:%d"</span>,poly.x[j],poly.y[j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			glEnd();</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			glFlush();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="built_in">void</span> glColorCircle(<span class="built_in">int</span> x, <span class="built_in">int</span> y, <span class="built_in">int</span> R, GLubyte color[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin(GL_POLYGON);</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub(color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * PI; i += delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="built_in">double</span>	vx	= x + R * cos(i);</span><br><span class="line">		<span class="built_in">double</span>	vy	= y + R*sin(i);</span><br><span class="line">		glVertex2d(vx, vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画矩形，传入的是左下角XY坐标和右上角XY坐标</span></span><br><span class="line"><span class="built_in">void</span> glRect(<span class="built_in">int</span> leftX,<span class="built_in">int</span> leftY,<span class="built_in">int</span> rightX,<span class="built_in">int</span> rightY)&#123;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//左下角</span></span><br><span class="line">	glVertex2d(leftX,leftY);</span><br><span class="line">	<span class="comment">//右下角</span></span><br><span class="line">	glVertex2d(rightX,leftY);</span><br><span class="line">	<span class="comment">//右上角</span></span><br><span class="line">	glVertex2d(rightX,rightY);</span><br><span class="line">	<span class="comment">//左上角</span></span><br><span class="line">	glVertex2d(leftX,rightY);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec(<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> width,<span class="built_in">int</span> height,<span class="built_in">float</span> cirR)&#123;</span><br><span class="line">	<span class="comment">//二分之PI，一个象限的角度</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//划分程度,值越大画得越精细</span></span><br><span class="line">	<span class="built_in">float</span> divide=<span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">//圆角矩形的坐标</span></span><br><span class="line">    <span class="built_in">float</span> tx,ty; </span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//四个象限不同的操作符</span></span><br><span class="line">    <span class="built_in">int</span> opX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> opY[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="comment">//用来计数，从第一象限到第四象限</span></span><br><span class="line">    <span class="built_in">float</span> x=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//x自增时加的值</span></span><br><span class="line">	<span class="built_in">float</span> part=<span class="number">1</span>/divide;</span><br><span class="line">	<span class="comment">//计算内矩形宽高一半的数值</span></span><br><span class="line">	<span class="built_in">int</span> w=width/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="built_in">int</span> h=height/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="comment">//循环画线</span></span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;<span class="number">4</span>;x+=part)&#123;</span><br><span class="line">		<span class="comment">//求出弧度</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF*x;</span><br><span class="line">		<span class="comment">//计算坐标值</span></span><br><span class="line">	    tx=cirR*cos(rad)+opX[(<span class="built_in">int</span>)x]*w+centerX;</span><br><span class="line">	    ty=cirR*sin(rad)+opY[(<span class="built_in">int</span>)x]*h+centerY;</span><br><span class="line">		<span class="comment">//传入坐标画线</span></span><br><span class="line">	    glVertex2f(tx,ty);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">   glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径</span></span><br><span class="line"><span class="built_in">void</span> glArc(<span class="built_in">double</span> x,<span class="built_in">double</span> y,<span class="built_in">double</span> start_angle,<span class="built_in">double</span> end_angle,<span class="built_in">double</span> radius)</span><br><span class="line">&#123;   </span><br><span class="line">	<span class="comment">//开始绘制曲线</span></span><br><span class="line">	glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//每次画增加的弧度</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle=PI/<span class="number">180</span>;</span><br><span class="line">	<span class="comment">//画圆弧</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i=start_angle;i&lt;=end_angle;i+=delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//绝对定位加三角函数值</span></span><br><span class="line">		<span class="built_in">double</span> vx=x+radius * cos(i);</span><br><span class="line">		<span class="built_in">double</span> vy=y+radius*sin(i);</span><br><span class="line">		glVertex2d(vx,vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束绘画</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆</span></span><br><span class="line"><span class="built_in">void</span> glCircle(<span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius)  </span><br><span class="line">&#123;  </span><br><span class="line">	<span class="comment">//画全圆</span></span><br><span class="line">    glArc(x,y,<span class="number">0</span>,<span class="number">2</span>*PI,radius);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line"><span class="built_in">void</span> glTri(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2,<span class="built_in">int</span> x3,<span class="built_in">int</span> y3)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	glVertex2d(x3,y3);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画线，传入两点坐标</span></span><br><span class="line"><span class="built_in">void</span> glLine(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数用来画图</span></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//GL_COLOR_BUFFER_BIT表示清除颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//设置画线颜色</span></span><br><span class="line">    glColor3f(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">//画点大小</span></span><br><span class="line">	glPointSize(<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大肚子</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">0</span>,<span class="number">146</span>,<span class="number">120</span>,<span class="number">15</span>);</span><br><span class="line">	<span class="comment">//画圆，中间小圈</span></span><br><span class="line">	glCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//画矩形，脖子</span></span><br><span class="line">	glRect(<span class="number">-25</span>,<span class="number">60</span>,<span class="number">25</span>,<span class="number">76</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大脸</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">113</span>,<span class="number">128</span>,<span class="number">74</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两个眼睛</span></span><br><span class="line">	glCircle(<span class="number">-30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两条天线</span></span><br><span class="line">	glLine(<span class="number">-35</span>,<span class="number">150</span>,<span class="number">-35</span>,<span class="number">173</span>);</span><br><span class="line">	glLine(<span class="number">35</span>,<span class="number">150</span>,<span class="number">35</span>,<span class="number">173</span>);</span><br><span class="line">	<span class="comment">//圆角矩形，两个耳朵</span></span><br><span class="line">	glRoundRec(<span class="number">81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	glRoundRec(<span class="number">-81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//圆弧，画嘴</span></span><br><span class="line">	glArc(<span class="number">0</span>,<span class="number">133</span>,<span class="number">11</span>*PI/<span class="number">8</span>,<span class="number">13</span>*PI/<span class="number">8</span>,<span class="number">45</span>);</span><br><span class="line">	<span class="comment">//画三角，肚子里的三角</span></span><br><span class="line">	glTri(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">30</span>,<span class="number">-15</span>,<span class="number">0</span>,<span class="number">28</span>);</span><br><span class="line">	<span class="comment">//画矩形，胳膊连接处</span></span><br><span class="line">	glRect(<span class="number">-81</span>,<span class="number">43</span>,<span class="number">-73</span>,<span class="number">25</span>);</span><br><span class="line">	glRect(<span class="number">81</span>,<span class="number">43</span>,<span class="number">73</span>,<span class="number">25</span>);</span><br><span class="line">	<span class="comment">//画矩形，上臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">45</span>,<span class="number">81</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//画矩形，中臂</span></span><br><span class="line">	glRect(<span class="number">-101</span>,<span class="number">0</span>,<span class="number">-88</span>,<span class="number">-4</span>);</span><br><span class="line">	glRect(<span class="number">101</span>,<span class="number">0</span>,<span class="number">88</span>,<span class="number">-4</span>);</span><br><span class="line">	<span class="comment">//画矩形，下臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-37</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">-4</span>,<span class="number">81</span>,<span class="number">-37</span>);</span><br><span class="line">	<span class="comment">//画圆形，手掌</span></span><br><span class="line">	glCircle(<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">	glColorCircle(<span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red);</span><br><span class="line">	glColorCircle(<span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow);</span><br><span class="line">	glColorCircle(<span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey);</span><br><span class="line">	glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">	glColorCircle(<span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn);</span><br><span class="line">	glColorCircle(<span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn);</span><br><span class="line">	<span class="comment">//保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待 </span></span><br><span class="line">	<span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	glPolygons();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口大小变化时调用的函数</span></span><br><span class="line"><span class="built_in">void</span> ChangeSize(GLsizei w,GLsizei h)  </span><br><span class="line">&#123;  </span><br><span class="line">	<span class="comment">//避免高度为0</span></span><br><span class="line">    <span class="keyword">if</span>(h==<span class="number">0</span>) &#123;  </span><br><span class="line">        h=<span class="number">1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//定义视口大小，宽高一致  </span></span><br><span class="line">    glViewport(<span class="number">0</span>,<span class="number">0</span>,w,h);</span><br><span class="line">	<span class="built_in">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 定义宽高的一半 */</span></span><br><span class="line">	halfHeight	= <span class="number">300</span>;</span><br><span class="line">	halfWidth	= <span class="number">300</span>;</span><br><span class="line">	<span class="comment">//重置坐标系统，使投影变换复位</span></span><br><span class="line">    glMatrixMode(GL_PROJECTION); </span><br><span class="line">	<span class="comment">//将当前的用户坐标系的原点移到了屏幕中心</span></span><br><span class="line">    glLoadIdentity();  </span><br><span class="line">   <span class="comment">//定义正交视域体  </span></span><br><span class="line">    <span class="keyword">if</span>(w&lt;h) &#123;</span><br><span class="line">		<span class="comment">//如果高度大于宽度，则将高度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half,half,-half*h/w,half*h/w,-half,half);  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//如果宽度大于高度，则将宽度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half*w/h,half*w/h,-half,half,-half,half);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="built_in">bool</span> sameColor(GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line"><span class="built_in">void</span> glPoints(<span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">	glBegin(GL_POINTS);</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	glColor3ub(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glVertex2d(x - halfWidth, halfHeight - y);</span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line"><span class="built_in">void</span> mouseClick(<span class="built_in">int</span> btn, <span class="built_in">int</span> state, <span class="built_in">int</span> x, <span class="built_in">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn == GLUT_LEFT_BUTTON &amp;&amp; state == GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color[<span class="number">3</span>];</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;color);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (sameColor(color, startBtn)) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons[con].verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameColor(color, endBtn)) &#123;</span><br><span class="line">				glutPostRedisplay();</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints(x, y);</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span> </span><br><span class="line">				polygons[con].color[<span class="number">0</span>] = nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>] = nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>] = nowColor[<span class="number">2</span>];</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>],polygons[con].color[<span class="number">1</span>],polygons[con].color[<span class="number">2</span>]);</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//程序入口</span></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char *argv[])&#123;</span><br><span class="line">	<span class="comment">//对GLUT进行初始化，并处理所有的命令行参数</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//指定RGB颜色模式和单缓冲窗口</span></span><br><span class="line">	glutInitDisplayMode(GLUT_RGB | GLUT_SINGLE);</span><br><span class="line">	<span class="comment">//定义窗口的位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//定义窗口的大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">600</span>, <span class="number">600</span>);</span><br><span class="line">	<span class="comment">//创建窗口，同时为之命名</span></span><br><span class="line">	glutCreateWindow(<span class="string">"OpenGL"</span>);</span><br><span class="line">	<span class="comment">//设置窗口清除颜色为白色</span></span><br><span class="line">	glClearColor(<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>);</span><br><span class="line">	<span class="comment">//参数为一个函数，绘图时这个函数就会被调用</span></span><br><span class="line">	glutDisplayFunc(&amp;display);</span><br><span class="line">	<span class="comment">//参数为一个函数，当窗口大小改变时会被调用</span></span><br><span class="line">	glutReshapeFunc(ChangeSize); </span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glutMouseFunc(mouseClick);</span><br><span class="line">	<span class="comment">//该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">//程序返回</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>小伙伴们可以运行试试看。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>本节我们主要利用了鼠标时间来实现了取色，设置颜色，并成功通过取点绘制出了各种形状的多边形。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 01:38:19" itemprop="dateCreated datePublished" datetime="2015-05-11T01:38:19+08:00">2015-05-11</time>
                </span>
                <span id="/1783.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例七之鼠标设色取点绘图" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>21k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>19 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1776.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1776.html" class="post-title-link" itemprop="url">OpenGL绘图实例六之鼠标监听事件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在前面的例子中我们绘制了2D机器人以及颜色的填充，另外还有平移放缩变换等等。不过这些绘图方式都有一个特点，那就是无法动态地响应事件，如果我们在例子中加入鼠标点击的响应时间，让图形根据鼠标点击的变化而变化，那将会是非常友好的。 那么这一篇我们就来看一下鼠标响应的实现。</p>
                  <h2 id="鼠标点击"><a href="#鼠标点击" class="headerlink" title="鼠标点击"></a>鼠标点击</h2>
                  <p>对于鼠标点击，无非是左右键，滚轮的点击以及区分按下还是按上。 监听方法如下： <strong>void mouseClick(int btn, int state, int x, int y)</strong> 方法名是任意的，参数有四个，分别是左右键，点击状态（按下还是松开），点击的x，y坐标。 那么我们在main函数中怎么调用，代码如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们利用了类库中提供的方法 <strong>glutMouseFunc()</strong> 这个方法用来监听鼠标事件，我们传入刚才定义的mouseClick函数，即可完成调用，同时mouseClick函数的参数都会被赋值。 通过上面的代码，在鼠标点击窗口内部时，会自动调用mouseClick方法，而且四个参数都会有赋值。可以直接使用这些值来操作。</p>
                  <h2 id="鼠标移动"><a href="#鼠标移动" class="headerlink" title="鼠标移动"></a>鼠标移动</h2>
                  <p><strong>void mouseMove(int x, int y)</strong> 方法名我们也可以任意指定，参数有2个，分别是x，y 在main函数中可以这样调用</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们利用了类库中提供的方法 <strong>glutMotionFunc()</strong> 同上面的原理，传入了mouseMove方法，在鼠标移动时，就可以对mouseMove方法的参数进行赋值。</p>
                  <h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2>
                  <p>好了，上面我们说了两个鼠标事件的方法，下面我们用一个例子来感受一下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#<span class="keyword">include</span> &lt;glut.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;math.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line">void display(void)</span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	printf(<span class="string">"点击了鼠标，btn:%d,state:%d,x:%d,y:%d\n"</span>, btn, state, x, y);</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)&#123;</span><br><span class="line">		printf(<span class="string">"按下了左边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_UP)&#123;</span><br><span class="line">		printf(<span class="string">"松开了左边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_RIGHT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)&#123;</span><br><span class="line">		printf(<span class="string">"按下了右边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_RIGHT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_UP)&#123;</span><br><span class="line">		printf(<span class="string">"松开了右边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line">void mouse<span class="constructor">Move(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	printf(<span class="string">"移动鼠标中，x:%d,y%d\n"</span>, x, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 程序入口 */</span></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, <span class="built_in">char</span> *argv<span class="literal">[]</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glut<span class="constructor">Init(&amp;<span class="params">argc</span>, <span class="params">argv</span>)</span>;</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glut<span class="constructor">InitDisplayMode(GLUT_RGB | GLUT_SINGLE)</span>;</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glut<span class="constructor">InitWindowPosition(100, 100)</span>;</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glut<span class="constructor">InitWindowSize(400, 400)</span>;</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glut<span class="constructor">CreateWindow(<span class="string">"OpenGL"</span>)</span>;</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	gl<span class="constructor">ClearColor(1.0f, 1.0f, 1.0f, 1.0f)</span>;</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glut<span class="constructor">DisplayFunc(&amp;<span class="params">display</span>)</span>;</span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br><span class="line">	<span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">	glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glut<span class="constructor">MainLoop()</span>;</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	return(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在上面的代码中，我们监听了鼠标点击和鼠标移动事件，并打印输出了鼠标点击事件的响应。 比如我先点击了鼠标左键，然后点击了鼠标右键。然后移动了鼠标左键，然后移动了鼠标右键。运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/0150511000009.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/0150511000009.jpg" alt="0150511000009"></a> 可以发现它打印输出了鼠标的按钮代号，点击状态，点击的位置。 另外我们发现鼠标点击的坐标原点是左上角，这跟我们之前读取色值的坐标原点（左下角）不一样，也跟我们绘图的坐标原点（中心点）不一样。编程时一定要注意。 获取到了点击点的位置，我们就可以利用这些值来进行相应的作图处理了。 小伙伴们可以尝试一下。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>本节说的不多，主要是说明了鼠标监听事件的用法。glutMouseFunc以及glutMotionFunc，另外通过一个实例来演示了鼠标监听事件的用法，下一篇我们就利用这个知识来进行一个实例演示。大家加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 00:04:11" itemprop="dateCreated datePublished" datetime="2015-05-11T00:04:11+08:00">2015-05-11</time>
                </span>
                <span id="/1776.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例六之鼠标监听事件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1760.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/1760.html" class="post-title-link" itemprop="url">LESS学习记录</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>LESS 包含一套自定义的语法及一个解析器，用户根据这些语法定义自己的样式规则，这些规则最终会通过解析器，编译生成对应的 CSS 文件。LESS 并没有裁剪 CSS 原有的特性，更不是用来取代 CSS 的，而是在现有 CSS 语法的基础上，为 CSS 加入程序式语言的特性。 本文部分内容参考 <a href="http://www.ibm.com/developerworks/cn/web/1207_zhaoch_lesscss/" target="_blank" rel="noopener">官方文档</a></p>
                  <h2 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h2>
                  <p>建议使用Koala编译器 <a href="http://koala-app.com/index-zh.html" target="_blank" rel="noopener">下载地址</a></p>
                  <h2 id="LESS-原理及使用方式"><a href="#LESS-原理及使用方式" class="headerlink" title="LESS 原理及使用方式"></a>LESS 原理及使用方式</h2>
                  <p>本质上，LESS 包含一套自定义的语法及一个解析器，用户根据这些语法定义自己的样式规则，这些规则最终会通过解析器，编译生成对应的 CSS 文件。LESS 并没有裁剪 CSS 原有的特性，更不是用来取代 CSS 的，而是在现有 CSS 语法的基础上，为 CSS 加入程序式语言的特性。下面是一个简单的例子：</p>
                  <h5 id="清单-1-LESS-文件"><a href="#清单-1-LESS-文件" class="headerlink" title="清单 1. LESS 文件"></a>清单 1. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@color:</span> <span class="number">#4D926F</span>; </span><br><span class="line"></span><br><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="variable">@color</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">h2</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="variable">@color</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-2-CSS-文件"><a href="#清单-2-CSS-文件" class="headerlink" title="清单 2. CSS 文件"></a>清单 2. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#4D926F</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">h2</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#4D926F</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的例子可以看出，学习 LESS 非常容易，只要你了解 CSS 基础就可以很容易上手。 LESS 可以直接在客户端使用，也可以在服务器端使用。在实际项目开发中，我们更推荐使用第三种方式，将 LESS 文件编译生成静态 CSS 文件，并在 HTML 文档中应用。</p>
                  <h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3>
                  <p>我们可以直接在客户端使用 .less（LESS 源文件），只需要从 <a href="http://lesscss.org/" target="_blank" rel="noopener">LESSCSS</a> 下载 less.js 文件，然后在我们需要引入 LESS 源文件的 HTML 中加入如下代码：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;link <span class="attribute">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attribute">type</span>=<span class="string">"text/css"</span> <span class="attribute">href</span>=<span class="string">"styles.less"</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>LESS 源文件的引入方式与标准 CSS 文件引入方式一样：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;link <span class="attribute">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attribute">type</span>=<span class="string">"text/css"</span> <span class="attribute">href</span>=<span class="string">"styles.less"</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>需要注意的是：在引入 .less 文件时，rel 属性要设置为“stylesheet/less”。还有更重要的一点需要注意的是：LESS 源文件一定要在 less.js 引入之前引入，这样才能保证 LESS 源文件正确编译解析。</p>
                  <h3 id="使用编译生成的静态-CSS-文件"><a href="#使用编译生成的静态-CSS-文件" class="headerlink" title="使用编译生成的静态 CSS 文件"></a>使用编译生成的静态 CSS 文件</h3>
                  <p>我们可以通过 LESS 的编译器，将 LESS 文件编译成为 CSS 文件，在 HTML 文章中引入使用。这里要强调的一点，LESS 是完全兼容 CSS 语法的，也就是说，我们可以将标准的 CSS 文件直接改成 .less 格式，LESS 编译器可以完全识别。</p>
                  <h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2>
                  <h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3>
                  <p>LESS 允许开发者自定义变量，变量可以在全局样式中使用，变量使得样式修改起来更加简单。 我们可以从下面的代码了解变量的使用及作用：</p>
                  <h5 id="清单-3-LESS-文件"><a href="#清单-3-LESS-文件" class="headerlink" title="清单 3. LESS 文件"></a>清单 3. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@border-color :</span> <span class="number">#b5bcc7</span>; </span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mythemes</span> <span class="selector-tag">tableBorder</span>&#123; </span><br><span class="line">  <span class="attribute">border </span>: <span class="number">1px</span> solid <span class="variable">@border-color</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-4-CSS-文件"><a href="#清单-4-CSS-文件" class="headerlink" title="清单 4. CSS 文件"></a>清单 4. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.mythemes</span> <span class="selector-tag">tableBorder</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#b5bcc7</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码中我们可以看出，变量是 VALUE（值）级别的复用，可以将相同的值定义成变量统一管理起来。 该特性适用于定义主题，我们可以将背景颜色、字体颜色、边框属性等常规样式进行统一定义，这样不同的主题只需要定义不同的变量文件就可以了。当然该特性也同样适用于 CSS RESET（重置样式表），在 Web 开发中，我们往往需要屏蔽浏览器默认的样式行为而需要重新定义样式表来覆盖浏览器的默认行为，这里可以使用 LESS 的变量特性，这样就可以在不同的项目间重用样式表，我们仅需要在不同的项目样式表中，根据需求重新给变量赋值即可。 LESS 中的变量和其他编程语言一样，可以实现值的复用，同样它也有生命周期，也就是 Scope（变量范围，开发人员惯称之为作用域），简单的讲就是局部变量还是全局变量的概念，查找变量的顺序是先在局部定义中找，如果找不到，则查找上级定义，直至全局。下面我们通过一个简单的例子来解释 Scope。</p>
                  <h5 id="清单-5-LESS-文件"><a href="#清单-5-LESS-文件" class="headerlink" title="清单 5. LESS 文件"></a>清单 5. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@width :</span> <span class="number">20px</span>; </span><br><span class="line"><span class="selector-id">#homeDiv</span> &#123; </span><br><span class="line">  <span class="variable">@width :</span> <span class="number">30px</span>; </span><br><span class="line">  <span class="selector-id">#centerDiv</span>&#123; </span><br><span class="line">      <span class="attribute">width </span>: <span class="variable">@width</span>;<span class="comment">// 此处应该取最近定义的变量 width 的值 30px </span></span><br><span class="line">             &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#leftDiv</span> &#123; </span><br><span class="line">    <span class="attribute">width </span>: <span class="variable">@width</span>; <span class="comment">// 此处应该取最上面定义的变量 width 的值 20px </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-6-CSS-文件"><a href="#清单-6-CSS-文件" class="headerlink" title="清单 6. CSS 文件"></a>清单 6. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#homeDiv</span> <span class="selector-id">#centerDiv</span> &#123; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">30px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#leftDiv</span> &#123; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">20px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Mixins（混入）"><a href="#Mixins（混入）" class="headerlink" title="Mixins（混入）"></a>Mixins（混入）</h3>
                  <p>Mixins（混入）功能对用开发者来说并不陌生，很多动态语言都支持 Mixins（混入）特性，它是多重继承的一种实现，在 LESS 中，混入是指在一个 CLASS 中引入另外一个已经定义的 CLASS，就像在当前 CLASS 中增加一个属性一样。 我们先简单看一下 Mixins 在 LESS 中的使用：</p>
                  <h5 id="清单-7-LESS-文件"><a href="#清单-7-LESS-文件" class="headerlink" title="清单 7. LESS 文件"></a>清单 7. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 定义一个样式选择器</span></span><br><span class="line"> <span class="selector-class">.roundedCorners</span>(<span class="variable">@radius</span>:<span class="number">5px</span>) &#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="comment">// 在另外的样式选择器中使用</span></span><br><span class="line"> <span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="selector-class">.roundedCorners</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-id">#footer</span> &#123; </span><br><span class="line"> <span class="selector-class">.roundedCorners</span>(<span class="number">10px</span>); </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-8-CSS-文件"><a href="#清单-8-CSS-文件" class="headerlink" title="清单 8. CSS 文件"></a>清单 8. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>:<span class="number">5px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>:<span class="number">5px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>:<span class="number">5px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#footer</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>:<span class="number">10px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>:<span class="number">10px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>:<span class="number">10px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码我们可以看出：Mixins 其实是一种嵌套，它允许将一个类嵌入到另外一个类中使用，被嵌入的类也可以称作变量，简单的讲，Mixins 其实是规则级别的复用。 Mixins 还有一种形式叫做 Parametric Mixins（混入参数），LESS 也支持这一特性：</p>
                  <h5 id="清单-9-LESS-文件"><a href="#清单-9-LESS-文件" class="headerlink" title="清单 9. LESS 文件"></a>清单 9. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 定义一个样式选择器</span></span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="variable">@radius</span>)&#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="comment">// 使用已定义的样式选择器</span></span><br><span class="line"> <span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="number">10px</span>); <span class="comment">// 把 10px 作为参数传递给样式选择器</span></span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.btn</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="number">3px</span>);<span class="comment">// // 把 3px 作为参数传递给样式选择器</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-10-CSS-文件"><a href="#清单-10-CSS-文件" class="headerlink" title="清单 10. CSS 文件"></a>清单 10. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">10px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">10px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">10px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.btn</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">3px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">3px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">3px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们还可以给 Mixins 的参数定义一人默认值，如</p>
                  <h5 id="清单-11-LESS-文件"><a href="#清单-11-LESS-文件" class="headerlink" title="清单 11. LESS 文件"></a>清单 11. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.borderRadius</span>(<span class="variable">@radius</span>:<span class="number">5px</span>)&#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.btn</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>; </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-12-CSS-文件"><a href="#清单-12-CSS-文件" class="headerlink" title="清单 12. CSS 文件"></a>清单 12. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.btn</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">5px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">5px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">5px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>像 JavaScript 中 <strong>arguments</strong>一样，Mixins 也有这样一个变量：<strong>@arguments</strong>。@arguments 在 Mixins 中具是一个很特别的参数，当 Mixins 引用这个参数时，该参数表示所有的变量，很多情况下，这个参数可以省去你很多代码。</p>
                  <h5 id="清单-13-LESS-文件"><a href="#清单-13-LESS-文件" class="headerlink" title="清单 13. LESS 文件"></a>清单 13. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.boxShadow</span>(<span class="variable">@x</span>:<span class="number">0</span>,<span class="variable">@y</span>:<span class="number">0</span>,<span class="variable">@blur</span>:<span class="number">1px</span>,<span class="variable">@color</span>:<span class="number">#000</span>)&#123; </span><br><span class="line"><span class="attribute">-moz-box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line"><span class="attribute">-webkit-box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line"><span class="attribute">box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="selector-class">.boxShadow</span>(<span class="number">2px</span>,<span class="number">2px</span>,<span class="number">3px</span>,<span class="number">#f36</span>); </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-14-CSS-文件"><a href="#清单-14-CSS-文件" class="headerlink" title="清单 14. CSS 文件"></a>清单 14. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line"><span class="attribute">-webkit-box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line"><span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Mixins 是 LESS 中很重要的特性之一，我们这里也写了很多例子，看到这些例子你是否会有这样的疑问：当我们拥有了大量选择器的时候，特别是团队协同开发时，如何保证选择器之间重名问题？如果你是 java 程序员或 C++ 程序员，我猜你肯定会想到命名空间 Namespaces，LESS 也采用了命名空间的方法来避免重名问题，于是乎 LESS 在 mixins 的基础上扩展了一下，看下面这样一段代码：</p>
                  <h5 id="清单-15-LESS-文件"><a href="#清单-15-LESS-文件" class="headerlink" title="清单 15. LESS 文件"></a>清单 15. LESS 文件</h5>
                  <figure class="highlight nimrod">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#mynamespace &#123; </span></span><br><span class="line">.home <span class="meta">&#123;...&#125;</span> </span><br><span class="line">.user <span class="meta">&#123;...&#125;</span> </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就定义了一个名为 mynamespace 的命名空间，如果我们要复用 user 这个选择器的时候，我们只需要在需要混入这个选择器的地方这样使用就可以了。#mynamespace &gt; .user。</p>
                  <h3 id="嵌套的规则"><a href="#嵌套的规则" class="headerlink" title="嵌套的规则"></a>嵌套的规则</h3>
                  <p>在我们书写标准 CSS 的时候，遇到多层的元素嵌套这种情况时，我们要么采用从外到内的选择器嵌套定义，要么采用给特定元素加 CLASS 或 ID 的方式。在 LESS 中我们可以这样写：</p>
                  <h5 id="清单-16-HTML-片段"><a href="#清单-16-HTML-片段" class="headerlink" title="清单 16. HTML 片段"></a>清单 16. HTML 片段</h5>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"home"</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"top"</span>&gt;top&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"center"</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"left"</span>&gt;left&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"right"</span>&gt;right&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单-17-LESS-文件"><a href="#清单-17-LESS-文件" class="headerlink" title="清单 17. LESS 文件"></a>清单 17. LESS 文件</h5>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#home</span>&#123; </span><br><span class="line">  <span class="attribute">color</span> : blue; </span><br><span class="line">  <span class="attribute">width</span> : <span class="number">600px</span>; </span><br><span class="line">  <span class="attribute">height</span> : <span class="number">500px</span>; </span><br><span class="line">  <span class="attribute">border</span>:outset; </span><br><span class="line">  <span class="selector-id">#top</span>&#123; </span><br><span class="line">       <span class="attribute">border</span>:outset; </span><br><span class="line">       <span class="attribute">width</span> : <span class="number">90%</span>; </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="selector-id">#center</span>&#123; </span><br><span class="line">       <span class="attribute">border</span>:outset; </span><br><span class="line">       <span class="attribute">height</span> : <span class="number">300px</span>; </span><br><span class="line">       <span class="attribute">width</span> : <span class="number">90%</span>; </span><br><span class="line">       <span class="selector-id">#left</span>&#123; </span><br><span class="line">         <span class="attribute">border</span>:outset; </span><br><span class="line">         <span class="attribute">float</span> : left; </span><br><span class="line"> <span class="attribute">width</span> : <span class="number">40%</span>; </span><br><span class="line">       &#125; </span><br><span class="line">       <span class="selector-id">#right</span>&#123; </span><br><span class="line">         <span class="attribute">border</span>:outset; </span><br><span class="line">         <span class="attribute">float</span> : left; </span><br><span class="line"> <span class="attribute">width</span> : <span class="number">40%</span>; </span><br><span class="line">       &#125; </span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-18-CSS-文件"><a href="#清单-18-CSS-文件" class="headerlink" title="清单 18. CSS 文件"></a>清单 18. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#home</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: blue; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">600px</span>; </span><br><span class="line"> <span class="attribute">height</span>: <span class="number">500px</span>; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#top</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">90%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">height</span>: <span class="number">300px</span>; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">90%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> <span class="selector-id">#left</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">float</span>: left; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">40%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> <span class="selector-id">#right</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">float</span>: left; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">40%</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码中我们可以看出，LESS 的嵌套规则的写法是 HTML 中的 DOM 结构相对应的，这样使我们的样式表书写更加简洁和更好的可读性。同时，嵌套规则使得对伪元素的操作更为方便。</p>
                  <h5 id="清单-19-LESS-文件"><a href="#清单-19-LESS-文件" class="headerlink" title="清单 19. LESS 文件"></a>清单 19. LESS 文件</h5>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: red; </span><br><span class="line"> <span class="attribute">text-decoration</span>: none; </span><br><span class="line"> &amp;<span class="selector-pseudo">:hover</span> &#123;<span class="comment">// 有 &amp; 时解析的是同一个元素或此元素的伪类，没有 &amp; 解析是后代元素</span></span><br><span class="line">  <span class="attribute">color</span>: black; </span><br><span class="line">  <span class="attribute">text-decoration</span>: underline; </span><br><span class="line"> &#125; </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-20-CSS-文件"><a href="#清单-20-CSS-文件" class="headerlink" title="清单 20. CSS 文件"></a>清单 20. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: red; </span><br><span class="line"><span class="attribute">text-decoration</span>: none; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: black; </span><br><span class="line"><span class="attribute">text-decoration</span>: underline; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="运算及函数"><a href="#运算及函数" class="headerlink" title="运算及函数"></a>运算及函数</h3>
                  <p>在我们的 CSS 中充斥着大量的数值型的 value，比如 color、padding、margin 等，这些数值之间在某些情况下是有着一定关系的，那么我们怎样利用 LESS 来组织我们这些数值之间的关系呢？我们来看这段代码：</p>
                  <h5 id="清单-21-LESS-文件"><a href="#清单-21-LESS-文件" class="headerlink" title="清单 21 . LESS 文件"></a>清单 21 . LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@init:</span> <span class="number">#111111</span>; </span><br><span class="line"><span class="variable">@transition:</span> <span class="variable">@init</span>*<span class="number">2</span>; </span><br><span class="line"><span class="selector-class">.switchColor</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: <span class="variable">@transition</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-22-CSS-文件"><a href="#清单-22-CSS-文件" class="headerlink" title="清单 22. CSS 文件"></a>清单 22. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.switchColor</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#222222</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的例子中使用 LESS 的 operation 是 特性，其实简单的讲，就是对数值型的 value（数字、颜色、变量等）进行加减乘除四则运算。同时 LESS 还有一个专门针对 color 的操作提供一组函数。下面是 LESS 提供的针对颜色操作的函数列表：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">lighten</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color which is 10% *lighter* than @color </span></span><br><span class="line"><span class="selector-tag">darken</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color which is 10% *darker* than @color </span></span><br><span class="line"><span class="selector-tag">saturate</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *more* saturated than @color </span></span><br><span class="line"><span class="selector-tag">desaturate</span>(<span class="variable">@color</span>, <span class="number">10%</span>);<span class="comment">// return a color 10% *less* saturated than @color </span></span><br><span class="line"><span class="selector-tag">fadein</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *less* transparent than @color </span></span><br><span class="line"><span class="selector-tag">fadeout</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *more* transparent than @color </span></span><br><span class="line"><span class="selector-tag">spin</span>(<span class="variable">@color</span>, <span class="number">10</span>); <span class="comment">// return a color with a 10 degree larger in hue than @color </span></span><br><span class="line"><span class="selector-tag">spin</span>(<span class="variable">@color</span>, -<span class="number">10</span>); <span class="comment">// return a color with a 10 degree smaller hue than @color</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>PS: 上述代码引自 LESS CSS 官方网站，详情请见 <a href="http://lesscss.org/#-color-functions" target="_blank" rel="noopener">http://lesscss.org/#-color-functions</a> 使用这些函数和 JavaScript 中使用函数一样。</p>
                  <h5 id="清单-23-LESS-文件"><a href="#清单-23-LESS-文件" class="headerlink" title="清单 23. LESS 文件"></a>清单 23. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">init</span>: <span class="number">#f04615</span>; </span><br><span class="line"> <span class="selector-id">#body</span> &#123; </span><br><span class="line">  <span class="attribute">background-color</span>: fadein(<span class="variable">@init</span>, <span class="number">10%</span>); </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-24-CSS-文件"><a href="#清单-24-CSS-文件" class="headerlink" title="清单 24. CSS 文件"></a>清单 24. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#body</span> &#123; </span><br><span class="line"> <span class="attribute">background-color</span>: <span class="number">#f04615</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的例子我们可以发现，这组函数像极了 JavaScript 中的函数，它可以被调用和传递参数。这些函数的主要作用是提供颜色变换的功能，先把颜色转换成 HSL 色，然后在此基础上进行操作，LESS 还提供了获取颜色值的方法，在这里就不举例说明了。 LESS 提供的运算及函数特性适用于实现页面组件特性，比如组件切换时的渐入渐出。</p>
                  <h3 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h3>
                  <h5 id="清单-25-LESS文件"><a href="#清单-25-LESS文件" class="headerlink" title="清单 25. LESS文件"></a>清单 25. LESS文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.tri</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">overflow</span>: hidden;</span><br><span class="line">	<span class="selector-class">.triangle</span>(bottom);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(top,<span class="variable">@w</span>:<span class="number">5px</span>,<span class="variable">@c</span>:<span class="number">#CCC</span>)&#123;</span><br><span class="line">	<span class="attribute">border-width</span>: <span class="variable">@w</span>;</span><br><span class="line">	<span class="attribute">border-color</span>: transparent transparent red transparent;</span><br><span class="line">	<span class="attribute">border-style</span>: dashed dashed solid dashed;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.triangle</span>(bottom,<span class="variable">@w</span>:<span class="number">5px</span>,<span class="variable">@c</span>:<span class="number">#CCC</span>)&#123;</span><br><span class="line">	<span class="attribute">border-width</span>: <span class="variable">@w</span>;</span><br><span class="line">	<span class="attribute">border-color</span>: red transparent transparent  transparent;</span><br><span class="line">	<span class="attribute">border-style</span>: solid dashed dashed  dashed;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单-26-CSS文件"><a href="#清单-26-CSS文件" class="headerlink" title="清单 26. CSS文件"></a>清单 26. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.tri</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: red transparent transparent  transparent;</span><br><span class="line">  <span class="attribute">border-style</span>: solid dashed dashed  dashed;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上可以看出，我们可以在LESS中定义相同名字的样式，第一个参数不同，在调用时可以通过传入第一个参数进行匹配，得到不同的样式即可。</p>
                  <h3 id="避免编译"><a href="#避免编译" class="headerlink" title="避免编译"></a>避免编译</h3>
                  <h5 id="清单27-LESS文件"><a href="#清单27-LESS文件" class="headerlink" title="清单27. LESS文件"></a>清单27. LESS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:<span class="built_in">calc</span>(<span class="number">300px</span>-<span class="number">30px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单28-CSS文件"><a href="#清单28-CSS文件" class="headerlink" title="清单28. CSS文件"></a>清单28. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">270px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有时候一些样式如果编译了之后就会产生不必要的麻烦，如果我们不想要编译，可以改写如下</p>
                  <h5 id="清单29-LESS文件"><a href="#清单29-LESS文件" class="headerlink" title="清单29. LESS文件"></a>清单29. LESS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:~<span class="string">'calc(300px-30px)'</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单30-CSS文件"><a href="#清单30-CSS文件" class="headerlink" title="清单30. CSS文件"></a>清单30. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">300px</span>-<span class="number">30px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过在前面加上一个 ~然后将内容用引号引起来，就可以避免编译了。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本文提到的只是 LESS 的基本功能，更高级的功能如：字符串插值，服务器端使用配置，JavaScript 表达式，避免编译等可以参看 LESS 的官方网站。 LESS 以 CSS 语法为基础，又借用了很多我们熟知编程式语言的特性，这对于我们开发人员来讲学习成本几乎可以忽略，它在保留 CSS 语法的基础上扩展了更多实用的功能，LESS 为我们提供了一种新的编写样式表的方法，我们可以根据我们的项目特性选择使用 LESS 的部分特性，我们只需用很少的成本就可以换了很大的回报，一句话，Less is more，借助 LESS 可以更便捷的进行 Web 开发。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-08 14:16:19" itemprop="dateCreated datePublished" datetime="2015-05-08T14:16:19+08:00">2015-05-08</time>
                </span>
                <span id="/1760.html" class="post-meta-item leancloud_visitors" data-flag-title="LESS学习记录" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1722.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/1722.html" class="post-title-link" itemprop="url">记一次泰安方特之旅</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>等啊等，终于等到五一放假，这次必须要出去好好玩一番，解脱一下，释放一下。经过一系列思想斗争，最终决定去泰安方特了！昨天方特之旅结束之后，甚是爽快，在此记流水账一篇，不喜勿喷哈！ 话说回来还是要先说五月二号啊，简直了，本来打算是在五月二号去的，带上室友小周周和隔壁的花花学长。一号那天我定了第二天的火车，早上7点半的火车，室友小周周也提前约好了出租车，准备早上六点出发去火车站。万事俱备只欠东风了，当天晚上早早滚去睡觉，定好五点半的闹钟，准备静静等待闹钟的响起。可是，可是，一切都是来得那么突然，第二天一大早起来竟然下雨了！泰安那边下雨了！天哪，睡之前我还特意看了看二号是多云啊！这不是坑爹吗？下雨就下雨吧，可是你不知道下雨方特室外项目是不开放的好嘛！顿时心都凉了。╮(╯▽╰)╭ 哎，改签吧，小周周给那位出租司机打电话，我去重新改签票。嗯，又一个坑爹的事情发生了，7点之前网上购票是不开放的好嘛？发车前两小时是不能在网上改签和退票的好嘛？哎，算了，还好票便宜，才十二块五，索性我不要了！不要了！默默去买了三号的车票，特么的还是无座啊，无座。哎，多么痛的领悟，╮(╯▽╰)╭。 然后，然后，就默默等到了三号，还是五点半的闹钟，这次终于不下雨了！苍天啊！带上手机，耳机，money，学僧证，充电宝，六点出门坐上TAXI，朝火车站奔去，这次是真快啊这速度，路上都没车的，一路狂奔，竟然六点半多点就到了火车站了，可是我们七点半的火车啊，这不是坑爹吗？于是乎，我们决定改签一下提前一点，有个七点稍多的一趟车，于是乎我们兴冲冲地跑向了改签大厅，惊呆了！怎么它就那么长的队伍，哦你，那么长，么长，长。试着排了排，二十分钟往前走了不到十步，也是醉了。哎，默默走掉，去候车室等着吧，七点半就七点半！ 呼呼呼，检票咯，K771，我们走上站台，看到一条漫长的绿皮车，不是说好的无座吗？怎么这么多空座，我们三个找到一个就坐下来，不得不再次吐槽一下这种座位真难受。早上好困，睡觉睡觉，带上耳机听着歌，像打坐一样睡着了，就那么睡着了，我好佩服我自己。睡了一个小时，一睁眼，泰山站到了，不错不错，下车，出发。 出站了，果然不出我所料，好多人都拿着牌子，问去方特吗？免费接送，立即出发，同时卖门票，220一位，其实方特门票就是220的，学生票可能就便宜10块钱。哎，这样就这样吧，他们是打着免费接送的名义，实质钱都包含在门票里面了。我们也担心方特人特别多，到时候买票排个时候，就直接跟着他走吧，反正也贵不了多少。 车是一个公交车，等人来齐了一起发车出发，我们几个竟然赶到了第一波，进去的时候车是空的，要等到其他人来才发车，这不是坑爹吗？坑爹吗？说好的立马出发的呢？算了，不计较这些了，其实等了也没多久就走了。在车上交了钱买了门票，那个收钱的人（姑且叫导游吧）跟我们讲了方特的各个注意事项，还是挺贴心的嘛！在这里透露给大家一点，记不住的我就记不住了。 包包最好要寄存起来，最好寄存在方特外面，比较便宜，当然也可以背着如果你不嫌沉的话。 贵重物品一定要看管好，方特里面丢的最多的就是数码相机，然后是手机，保管好了就行咯。 如果你不想一开始就玩惊险刺激的，建议从右边开始玩，如果你一开始就想玩刺激的，建议还是从右边开始玩哈哈哈。 项链啊首饰啊最好要收起来，要不然你想体验在空中翻滚的时候项链打到牙的感受吗？ 哦，其他的忘了，我也不知道他说了多少了，可能比较健忘，记不起来还有啥了。后面的我就根据我的亲身体验来说了，哈哈。 走了半个多小时，终于到了！我们去存上包，买好雨衣以防神秘河谷的时候淋湿。正式进门！进门！冲冲冲！方特之旅正式开始！差不多九点半！ 放个地图先 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150504150649.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150504150649.jpg" alt="20150504150649"></a> 恩，进去看过去就是一个方特城堡，好有艺术气息的，旁边还放着欢乐的音乐，走在小路上，还有阳光照射着，哈哈不错。而且关键是路上人好少啊，哈哈，是不是五月三号外地的都回家了呢？是吗？后面你就知道了。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/4d6577b5ga2451346b0fc690690.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/4d6577b5ga2451346b0fc690690.jpg" alt="4d6577b5ga2451346b0fc&amp;690&amp;690"></a> 恩，我们没有进城堡玩，直接奔向右边的飞跃极限。噢丫，谁说的人少的？谁说的人少的？人都跑进来了，排队啊，一层、两层、三层…不数了，心好累。也就十来层吧。排个毛线，我们直接冲向了下一站，神秘河谷。PO个图先 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/255405771681257058.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/255405771681257058.jpg" alt="25540577,1681257058&amp;"></a> 简直是人品好，我们进去的时候竟然排到了前面，是不是刚开放就被我们赶上了呢？而且，我们赶上了第一波。这次在外面买的雨衣派上用场了，穿上我们的半透明红色雨衣，带上蓝色高筒鞋套，上船。船一排四个人，一共好像是五排吧，我们很果断地选择了第一排，雨衣全部裹起来。准备冲，看到图了吗？这是一个小船从河谷里面二十米高空俯冲下来的样子，看那浪花。这次我们真正地感受到了它的魅力。河谷里面其实是有两个小下坡的，第一次比较小，杀杀你的锐气，第二次就是图中这个超大的下坡，从楼顶的那个位置冲下来，自己想象！第一次下坡还好，等到第二次下坡的时候，啊啊啊啊，二三十米高空俯冲，那种朝下的重力加速度深深牵引着我们，俯冲的时候我们叫喊着，咆哮着，嘶吼着，身心全部都感受着重力加速，咣！超大的浪花被我们激起来了，溅起十多米，丫的坑爹的是浪花不只是超前喷的啊，特么的它在空中划了一道优美的弧线直接想瓢泼一样泼到了我们身上啊，尤其是第一排啊第一排，最惨烈啊，尼玛我当初怎么就选了第一排啊，这不是坑爹吗？我真的是穿了雨衣，但是我屁股底下的雨衣不够长啊，水落到了座位上，然后水就浸到我的裤子里面去了啊，一阵凉意袭来，嗖嗖嗖，我屁股湿了，湿了。坑爹啊，这雨衣抵了个毛用啊。随后船缓缓划回去，出来的时候我走出来，屁股底下湿了一片，像尿了裤子一样，怎么能这样啊？我才玩了一个就湿了，湿了啊，╭(╯^╰)╮ 怎么这样。 还好太阳好，我就叉开腿走着，自己想象！赶紧的太阳把我的裤子晒干吧。接下来我们去了维苏威火山，听说这个还不错。果然，走到旁边就听到了火山里面一群人的嘶吼，开始排队吧，人也不大多啊，应该还是人品好的缘故吧，嗖嗖就排上了。PO个图先 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/3e4c18d1g778440eee0a9690.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/3e4c18d1g778440eee0a9690.jpg" alt="3e4c18d1g778440eee0a9&amp;690"></a> 对，就是这么酷炫，这就是传说中的过山车，一个个小匣子接起来，我和花花坐在了一个匣子里，抓紧扶手，小车就开动了，呼呼呼，伴随着轮子的摩擦，伴随着我们的尖叫，在急转弯的地方，车呼啸而过，整个人有种呼之欲出的感觉，巨大的离心力简直爽到爆。一个又一个急转，一次又一次的钻洞，一声又一声的呐喊，一下又一下的心跳。自行想象！ 出来之后旁边有个火流星，可是排队的人太多了，机智的我们就继续绕，看到有一个影视特技演出室刚开放，就跑进去了。尼玛一进去就是一个人在表演剁手，当然那刀是假的，duang，duang，duang，加了特效而已，后来欣赏了一点电影特效制作的过程，整体不算经验刺激，还说得过去吧。 后来继续绕，到了未来警察和生命之光那里，可惜的是都没有到开放的点，就去了星际航班，这下排队的人真多，到底什么鬼，干嘛的。我先PO个图 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/500_6935_7e6f4c36_7e6f4c36-e1430727030482.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/500_6935_7e6f4c36_7e6f4c36-e1430727030482.jpg" alt=""></a> 别看这个外面有个火箭什么的，这么酷炫，其实进去啊，我总算见识到了，排了半个小时队，最后二十个人坐在一个舱里，这个舱是可以动的，上下左右倾斜，可以模拟一下加速度什么的，然后整个前面就是一个超大的圆形幕布，像放电影一样，来给你模拟一个飞行的过程。随着画面的切换，舱左右摆动，也算是逼真。出来之后看到外面这个火箭，我本来还真以为要飞天呢，结果给我整这么一出，我也是醉醉的。 接下来就是恐龙危机了，一走过去吓我一跳啊，这是什么玩意翻了啊，上面的字怎么还是倒着的？好吧，经过缓过神来，不得不佩服这建筑真是溜啊，真是设计师逼死建筑师的典范啊，来来来，看图你就知道我为啥这么说了，尼玛这整个建筑都被恐龙掀翻了好嘛？ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/XocG88iM553THvvg.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/XocG88iM553THvvg.jpg" alt="XocG88iM553THvvg"></a> 虽然外面看着是倒着的，不过进去之后是正着的。呸，我这不废话么，倒着谁能走啊？进去也是想刚才那样，几个人坐在一个小车里，有个跑道，小车会在跑道上走，有时候转来转去。而四周当然就是恐龙咯，带上4D眼镜，能够看到周围银幕上一只只恐龙扑过来，小车上还有各种音效。小车有时候没油了，有时候加速了，有时候甩尾了，有时候弹飞了，模拟得非常逼真。特么的走到一个地方上面突然出现一个霸王龙头啊，这次不是屏幕出来的啊，是实物啊，一动一动的，它的牙像魔鬼的爪牙，还迈着魔鬼的步伐，在我不经意间粗线了啊，不能忍，特么的还长着嘴朝着我吼啊，吓尿了有木有。晃来晃去，这破小车终于抵达了传说中的安全地带，我也解脱出来了，╭(╯^╰)╮。臭霸王龙。 哎呦终于出来了，这也不能光玩室内的啊，来点室外的体验一把。于是乎，我们走到了一个叫波浪翻滚的东西那里，我了个去，这不就是济南泉城公园里面的遨游太空加强版吗？ 遨游太空是这样子的 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150504202138.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150504202138.jpg" alt="20150504202138"></a> 这里的波浪翻滚是这样子的，这何止是一样啊，这简直就是一样啊！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/1278644413015_1_o.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/1278644413015_1_o.jpg" alt="1278644413015_1_o"></a> 坐在那上面，就尽情地摇摆摇摆吧，飞上来，飞上去，有时候这玩意还是倾斜的啊，哦飞天的感觉真爽哈哈哈！ 接下来就是传说中的大摆锤了，据说好多人都在这一关不行不行的了，上吐下泻的统统地都有。我记得还有人说买了一张票一开始就坐了个大摆锤，直接不行了，后面的项目都玩不了了，合着220块钱就坐了个这个，真值！我还是准备挑战一下，会会它，看看这玩意到底多么厉害。先PO图一张。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20131119GAig3-e1430744520488.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20131119GAig3-e1430744520488.jpg" alt="20131119GAig3"></a> 嗯，就是这个样子滴，它一边摆，一边转啊，最开始摆的角度是很小的，后来最高的时候都有90度了吧，我一边承受着离心力，一边又在半空中飘荡，简直有一种超凡脱俗的感觉。啊，当到达最高点的时候，我整个人横在了半空中同时围绕着中间的转轴在转啊，转啊。神马姿态，多么优美啊！我当时脑子里在想神马？我还活着吗？神呐。 最终，我还是活着下来了，然后又来了一个刺激的，体验蹦极的感觉。PO图一张，先提前感受一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/624188preview4.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/624188preview4.jpg" alt="624188preview4"></a> 对，就是它！太空飞梭，哈哈哈哈，体验一下从100米高空坠落的感觉吧！上去坐在座位上绑好了，深呼吸一下，就在那一瞬间，就是那一瞬间，座位以一个超快的速度飞到架子的顶端啊！注意它不是缓缓上去的啊，是突然地一下，升到最上面，只需要短短几秒，那一瞬间啊，我的天，周围的人的呐喊，小周周的咆哮，花花的哭喊混成一团，就像火箭升空的感觉一样。然后，座位在空中停住了，尼玛这时候我们已经升到了最高的地方了啊。还不够形象，再来一张图！<img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211315.png" alt="QQ截图20150504211315"> 将近一百米的高空，我们坐在座位上，腿是悬空的，朝下一瞅你可能就会昏死过去。然后，然后！这座位突然不受力了，直接自由落体！我们也跟随着座位飞下来，呐喊声，咆哮声混作一团，而我也在撕吼，啊啊啊啊。真正的自由落体，感受到了吗？而且它接下来还没完啊，又升上去，然后又来一次降下来。呼呼呼呼呼，简直了！！嗯，最后我还是活着下来了。 其实，这个还真的不够刺激，然后我们又来了一个刺激的，空中飞舞，哈哈哈，堪称一绝了。先PO个图感受一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211949-e1430750658538.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211949-e1430750658538.png" alt=""></a> 简直了，这个巨大的翅上都坐着人，翅子这玩意不仅是自己在转，而且这个长臂在左右上下摇摆，尼玛可想而知我们的人在天上是波浪翻滚啊，朝上甩，朝下甩，朝左甩，朝右甩，有时倒这甩，有时正着甩。有没有玩过小时候的波浪鼓，我们这些人就想波浪鼓上面的两个圆球，各种甩，各种浪，在上面想不喊都不行，在上面我们的撕吼声简直是无与伦比，有时真的感觉自己就要被甩出去的样子，自己感受一下吧。这个简直是爽哭我了，花花直接吓得没敢坐，我和小周周真是感受到了这玩意的魅力，太浪了，也是浪到不行不行的。 接下来坐了坐勇敢者转盘，就是它！就是它！罪该万死的家伙！直接把我转晕了！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/68a8f2b5-02d5-4fda-87cb-ae5fca294f04.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/68a8f2b5-02d5-4fda-87cb-ae5fca294f04.jpg" alt="68a8f2b5-02d5-4fda-87cb-ae5fca294f04"></a> 别看他只是个转盘拉着一个个小车在那里转，其实它离心力特别大，我的腿在小车里简直都抬不起来。看到这个转盘下面的支撑臂了没？一开始它是平的啊，也就是说我们最开始是在水平面上转的，随着时间推移，这个臂慢慢往上升，升到将近90度的样子，尼玛我就简直被离心力牵引着在转啊，你可以想想我在最高处就是脚朝上头朝下在转啊转啊转啊转。而且离心力没那么大的话我还是斜着的好嘛？我的脖子也在不由自主地斜着，出来的时候真是转得我晕死了，脖子差点没正过来啊尼玛。 就是因为这个破玩意，我走路都开始晕了，趴桌子上一会，碎一觉，就没事了，起来接着浪！ 恩，然后接下来就是飞越极限了，这个效果简直赞啊。排队的人虽然多，但是一次性进去50多个人一起飞。坐在椅子上，脚是悬空的，在眼前会有一个超大超大的银幕，先PO图一张。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/W020140505433553648700.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/W020140505433553648700.jpg" alt="W020140505433553648700"></a> 应该就是这种感觉吧，一排排人坐着，座位可以模拟飞行时的感受，比如模拟加速，左右转等等的动作，相当逼真，而且还吹着风，模拟一下风中飞行的感觉。当然最享受的还是眼前的超大的幕布，一幅幅3D效果的画面，有艾菲尔铁塔，金字塔，故宫，长城，布达拉宫，大峡谷，珠穆朗玛峰，东方明珠等等，风景特别多。在飞行的过程中带你穿越世界各地，游遍千山万水。实在是太棒，不得不赞一个。像的看了一个超大的电影偶也！ 恩，最最最重头戏来了，火流星！号称是最惊险刺激的一个项目，如果你一开始坐了这个，其他的真的一点意思都没有，所以我们把这个放在了最后。来张图先感受一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20131216191455574-e1430747766704.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20131216191455574-e1430747766704.jpg" alt="20131216191455574"></a> 哈哈哈，害怕了吧，整个人都是坐在座位上脚是完全悬空的，图上的人在以一个超快的速度在做空中大反转，我估计他们差点就要被甩出去了。来张全图感受一下。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504215457.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504215457.png" alt="QQ截图20150504215457"></a> 恩，这跑道有正的有倒的，最高处差不多有三十四米。花花没有一起坐这个，我和小周周去尝试了。绑好之后，我们在那条长直道上慢慢地往上升，尼玛在升的过程中其实是比较慢的，十米，二十米，三十米，升的过程中我的脚下是悬空的，没有任何踩踏的地方，朝下一看，整个就是一大悬崖啊，啊啊啊。我想，一声我爱过这个世界足以表达我当时的感受。接着升到最高地方，就立即向下俯冲了，尼玛啊，简直就是自由落体一般的速度啊，而且这轨道它还不是一个平稳的正圆啊，跑道就像麻花一样向前延伸着，而我们就一边在自转一边向下俯冲，我的妈啊，全车的人都在喊叫，整个在穿梭的过程中肩膀被死死压着，一个巨大的扭转力扭动着我的身体，身体向前前进的同时在做大回环运动。这还不算完，降落到最低点之后接着又是一个上升，一个弧形的360度大回环跑道，那时我们的脚完全是在上方，头在下方，死死地卡在座位上，巨大的离心力给我的身体难以承受之重。图中那么长的跑道，跑完需要多久？2分钟？1分钟？不，只需要30秒！30秒啊！那速度简直太快了，一个劲的酸爽，真能到达极限了。下来之后，感觉整个人都接受了全身的按摩，浑身的酥麻感觉，也是爽到不行不行的！ 火流星，真是名副其实，就像太空穿梭一遍回来了一样，无法比拟的刺激。嗯，坐完这个心里就踏实了。哈哈。 后来就是几个比较放松的项目了，海螺湾，生命之光，转转杯，放松体验一下，最后爬了一下方特城堡，也算是圆满了。 晚上在方特门口拍了拍照，买了个西部牛仔帽子，留作纪念。方特之旅正式圆满结束！偶也！ 最后PO图几张，留作纪念！真是开心！愉快！ 再见！方特！再见！泰安！么么哒！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221857-e1430749176983.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221857-e1430749176983.png" alt="QQ截图20150504221857"></a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222004.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222004.png" alt="QQ截图20150504222004"></a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222028.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222028.png" alt="QQ截图20150504222028"></a><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221741-e1430749091293.png" alt="QQ截图20150504221741"></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-04 13:43:58" itemprop="dateCreated datePublished" datetime="2015-05-04T13:43:58+08:00">2015-05-04</time>
                </span>
                <span id="/1722.html" class="post-meta-item leancloud_visitors" data-flag-title="记一次泰安方特之旅" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1707.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1707.html" class="post-title-link" itemprop="url">Python中ValueError: invalid literal for int() with base 10 的实用解决办法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>今天在写爬虫程序的时候由于要翻页，做除法分页的时候出现了</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">totalCount</span> = <span class="string">'100'</span></span><br><span class="line"><span class="attr">totalPage</span> = int(totalCount)/<span class="number">20</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>ValueError: invalid literal for int() with base 10的错误 网上同样的错误有人建议用round(float(“1.0”))，但是解决不了我这个问题，round(float(“1.0”))是用于解决浮点数转换为整形数的， 而我这个则是因为原字符串转换为整形后做除法，虽然一段时间内可能不报错，但时间久了就会提示（其实就是一个warning，但是会强制终止你的程序），正确解决方法如下： 去除掉字符串中的非数字字符即可。亲测可用</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">totalCount</span> = re.sub(<span class="string">"\D"</span>, <span class="string">""</span>, totalCount)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/qianhaoq" class="author" itemprop="url" rel="index">qianhaoq</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-04 12:39:03" itemprop="dateCreated datePublished" datetime="2015-05-04T12:39:03+08:00">2015-05-04</time>
                </span>
                <span id="/1707.html" class="post-meta-item leancloud_visitors" data-flag-title="Python中ValueError: invalid literal for int() with base 10 的实用解决办法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>338</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1711.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/1711.html" class="post-title-link" itemprop="url">良好的代码风格养成记</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>优秀的代码风格如同一身得体的打扮，能够给人以良好的印象。初学程序设计，首先必须建立良好的编程习惯，这其中就包括代码风格。本文就代码风格中的几个重点问题进行了讨论，并在文后给出了一份优秀的代码作为风格模板。代码风格不必花费太多专门的时间研究，在使用中不断模仿模板代码，轻轻松松就能写出“专业的代码”。</p>
                  <h2 id="80字符，代码行极限"><a href="#80字符，代码行极限" class="headerlink" title="80字符，代码行极限"></a>80字符，代码行极限</h2>
                  <p>无论时空怎么转变，世界怎样改变，一行80字符应始终铭记心间。古老的Unix终端以80列的格式显示文本，为了让源代码与手册具有最佳的可读性， Unix系统始终坚持着80列的传统。80列不多不少，足够写出一行有意义的代码，同时也足够显示在终端屏幕，足够打印在A4纸上。虽然时至今日，我们的屏幕分辨率早已足够高，一行能够显示的内容远超超过80字符，但我们的优秀传统已经形成──几乎所有的Unix/Linux内核源代码以及联机用户手册都严格地遵守着80列极限。如果你正好在使用Windows平台下的Dev C++，你是否有注意到代码编辑框里那条细细的灰色竖线？不错，那正是代码行极限。除了HTML、XML等冗长繁复的标记式语言，几乎所有的语言都需要严格遵守代码行极限，这包括C、C++、Java、C#、Python、PHP等等。不过有时，比如当PHP跟HTML打交道的时候，这个限制是可以暂时放松的。过长的代码行总是不好的，好的代码要始终保持苗条的身材。</p>
                  <h2 id="Tab还是Space，众说纷纭的缩进方式"><a href="#Tab还是Space，众说纷纭的缩进方式" class="headerlink" title="Tab还是Space，众说纷纭的缩进方式"></a>Tab还是Space，众说纷纭的缩进方式</h2>
                  <p>代码离不开缩进，关于缩进主要有两个争论，一个是该用空格（Space）还是用制表符（Tab），另外一个是该用4格缩进还是8格缩进甚至都不是。 先来谈谈Space与Tab的问题。坚持用Space的程序员会告诉你，如果你从来都不用Tab，那么你的代码放到所有的地方看都是一样的。没错，这是用Space缩进的优点，可惜的是，这是它唯一的优点。代码层次越多，内层代码最前面的缩进便越多，这意味着你需要敲很多很多次空格。即使你能忍受不厌其烦地按空格键直到它坏掉，你也一定会被IDE总是自作聪明地插入一些Tab字符的行为烦恼不已。建议总是使用Tab缩进，因为几乎所有的代码（不仅仅是C 代码）都在使用Tab缩进。 Tab到底是4格还是8格？这是Tab缩进会被某些人诟病的根源。当你写程序时使用的Tab大小与别人读程序时使用的Tab大小不同时，再漂亮的排版也会变得杂乱无章。标准的Tab是8格的，而不幸的是，几乎所有的Windows平台下的IDE，包括 Visual Studio、Dev C++，甚至跨平台的Eclipse等，都默认使用4格Tab。我使用的FreeBSD系统的所有的内核源代码都采用8格缩进，所以我一直坚持使用8格缩进。也许你不习惯太大的间距，如果不是在Unix平台下，或者不是C语言，那就采用4格Tab吧。如果你在Unix下编写C代码，使用8格的标准Tab是更好的习惯。</p>
                  <h2 id="折行原则，容易被忽略的角落"><a href="#折行原则，容易被忽略的角落" class="headerlink" title="折行原则，容易被忽略的角落"></a>折行原则，容易被忽略的角落</h2>
                  <p>既然有代码行极限，很多情况下我们不得不断开一个完整的代码行，这就带来了一个问题：折行后应该如何缩进？好的做法是，第一次折行后，在原来缩进的基础上增加1/2的Tab大小的空格，之后的折行全部对齐第二行。可能这样的文字描述过于晦涩了，还是举个例子罢（以8格缩进为例）：</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (<span class="keyword">value</span> &gt; a &amp;&amp; <span class="keyword">value</span> &gt; b &amp;&amp; <span class="keyword">value</span> &gt; c &amp;&amp; <span class="keyword">value</span> &lt; d &amp;&amp; <span class="keyword">value</span> &lt; e &amp;&amp; <span class="keyword">value</span> &lt; f</span><br><span class="line">    <span class="keyword">value</span> &lt; h &amp;&amp; <span class="keyword">value</span> &lt; h) &#123; <span class="comment">/* 注意折行后的缩进 */</span></span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span></span><br><span class="line">            * <span class="keyword">value</span> * <span class="keyword">value</span> + <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span></span><br><span class="line">            * <span class="keyword">value</span> * <span class="keyword">value</span>; <span class="comment">/* 注意再次折行后的缩进 */</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>显然这个段代码没有任何实际用处，只是为了说明折行缩进而编造的。</p>
                  <h2 id="无处不在的空格，无处不在的空行"><a href="#无处不在的空格，无处不在的空行" class="headerlink" title="无处不在的空格，无处不在的空行"></a>无处不在的空格，无处不在的空行</h2>
                  <p>需要空格的位置有：</p>
                  <ul>
                    <li>if、while、switch等关键字与之后的左括号(之间。</li>
                    <li>左花括号{之前。</li>
                    <li>双目运算符两侧，例如p == NULL。</li>
                    <li>逗号,与分号;之后，例如for (i = 0; i &lt; 10; i++)。</li>
                  </ul>
                  <p>不要空格的位置有：</p>
                  <ul>
                    <li>函数名与之后的左括号(，包括带参数的宏与之后的左括号(，例如max(a, b)。</li>
                    <li>分号;与冒号:之前。</li>
                    <li>左括号(右边，右括号)左边，例如if (p == NULL)。</li>
                  </ul>
                  <p>需要空行的位置有：</p>
                  <ul>
                    <li>函数的定义之前、函数的定义之后</li>
                    <li>一组联系紧密的代码段之前和之后</li>
                  </ul>
                  <p>这些规则并不完全，当你碰到上面没有列举出来的情况时，请参考本文提供的模板代码。</p>
                  <h2 id="左花括号的争议──换行乎？不换乎？"><a href="#左花括号的争议──换行乎？不换乎？" class="headerlink" title="左花括号的争议──换行乎？不换乎？"></a>左花括号的争议──换行乎？不换乎？</h2>
                  <p>这又是一个仁者见仁智者见智的问题了。从使代码更清晰的角度看，作为代码段开头标识的左花括号{应该另起一行：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (p == NULL)</span><br><span class="line">&#123;</span><br><span class="line">        printf(<span class="string">"error!\n"</span>);</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可是，这看起来实在不够紧凑，所以大部分的C代码（至少Unix上如此）都采用了这样的方式：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (p == NULL) &#123;</span><br><span class="line">        printf(<span class="string">"error!\n"</span>);</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我的建议是采用后者，这会使你的代码显得更加紧凑，也更加专业。需要说明一个特例，在定义函数时，我们总是要给左花括号 { 换行：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">maxint</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>额，不过我还是不太习惯额</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本文介绍了编程的代码风格，希望对大家有帮助 本文内容为转载，<a href="http://blog.csdn.net/tolys/article/details/1807360" target="_blank" rel="noopener">原文出处</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-30 23:47:18" itemprop="dateCreated datePublished" datetime="2015-04-30T23:47:18+08:00">2015-04-30</time>
                </span>
                <span id="/1711.html" class="post-meta-item leancloud_visitors" data-flag-title="良好的代码风格养成记" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1691.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/1691.html" class="post-title-link" itemprop="url">几款优秀的前端UI框架</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>目前响应式布局和扁平化越来越风靡，前端UI框架也是风生水起，在这里分享几款优秀的前端UI框架</p>
                  <h2 id="BootStrap"><a href="#BootStrap" class="headerlink" title="BootStrap"></a>BootStrap</h2>
                  <p>相比这个大家都听说过吧，Bootstrap，来自 Twitter，是目前最受欢迎的前端框架。Bootstrap 是基于 HTML、CSS、JAVASCRIPT 的，它简洁灵活，使得 Web 开发更加快捷。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427144535.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427144535.jpg" alt="20150427144535"></a> <a href="http://getbootstrap.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.bootcss.com/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Foundation"><a href="#Foundation" class="headerlink" title="Foundation"></a><strong>Foundation</strong></h2>
                  <p>与Bootstrap相比，Foundation屈居第二，不过这并不能说明它不受欢迎。 ZURB在后面强有力的支持，使得 Foundation 更加强大！Foundation被各大网站使用，如Facebook、Mozilla、Ebay、 Yahoo、美国国家地理网站等等。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427154906.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427154906.jpg" alt="20150427154906"></a> <a href="http://foundation.zurb.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.foundcss.com/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Semantic-Ui"><a href="#Semantic-Ui" class="headerlink" title="Semantic Ui"></a>Semantic Ui</h2>
                  <p>语义化设计的前端框架，为攻城师而制作的可复用的开源前端框架。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427155432.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427155432.jpg" alt="20150427155432"></a> <a href="http://semantic-ui.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.semantic-ui.com.cn/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Amaze-UI"><a href="#Amaze-UI" class="headerlink" title="Amaze UI"></a>Amaze UI</h2>
                  <p>Amaze UI 是一个移动优先的跨屏前端框架。… Amaze UI 以移动优先(Mobile first)为理念,从小屏逐步扩展到大屏,最终实现所有屏幕适配,适应移动互联潮流。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427155625.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427155625.jpg" alt="20150427155625"></a> <a href="http://amazeui.org/" target="_blank" rel="noopener">官网链接</a></p>
                  <h2 id="Purecss"><a href="#Purecss" class="headerlink" title="Purecss"></a>Purecss</h2>
                  <p>免费响应式CSS前端框架是有Yahoo发布的一个可以应用到所有web项目的小巧的、响应式的CSS模块集，Pure是建立在Normalize.css的基础上的，对HTML元素提供了布局和样式，增加了一些公共的并且是你需要的UI组件。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427160204.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/20150427160204.jpg" alt="20150427160204"></a> <a href="http://purecss.io/" target="_blank" rel="noopener">官网链接</a> <a href="http://pure-site.ap01.aws.af.cm/" target="_blank" rel="noopener">中文链接</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-27 15:44:21" itemprop="dateCreated datePublished" datetime="2015-04-27T15:44:21+08:00">2015-04-27</time>
                </span>
                <span id="/1691.html" class="post-meta-item leancloud_visitors" data-flag-title="几款优秀的前端UI框架" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>580</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1687.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1687.html" class="post-title-link" itemprop="url">JS对于Android和IOS平台的点击响应的适配</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>最近做项目的时候发现了一个非常奇怪的问题，就是对于click事件的响应。经过测试发现，对于IOS平台，直接监听click事件可能是没有响应的，而在Android和PC上则完全没有问题。所以通过获取设备信息实现了不同平台的不同监听。</p>
                  <h2 id="IOS监听"><a href="#IOS监听" class="headerlink" title="IOS监听"></a>IOS监听</h2>
                  <p>对于IOS设备，只监听click方法可能是没有响应的。解决方法就是监听 “touchend click”事件。 而对于Android和PC，则只监听click事件即可。</p>
                  <h2 id="平台检测"><a href="#平台检测" class="headerlink" title="平台检测"></a>平台检测</h2>
                  <p>我们利用userAgent来检测平台</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">if</span> (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) &#123;</span><br><span class="line">    <span class="comment">//alert(navigator.userAgent);  </span></span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"iOS"</span>);</span><br><span class="line">&#125; <span class="selector-tag">else</span> <span class="selector-tag">if</span> (/(Android)/i.test(navigator.userAgent)) &#123;</span><br><span class="line">    <span class="comment">//alert(navigator.userAgent); </span></span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"Android"</span>);</span><br><span class="line">&#125; <span class="selector-tag">else</span> &#123;</span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"PC"</span>);</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的JS代码可以检测三个平台。</p>
                  <h2 id="实现监听"><a href="#实现监听" class="headerlink" title="实现监听"></a>实现监听</h2>
                  <p>我们可以把方法自定义名字，比如</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">back_click</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="string">".group-names"</span>).show();</span><br><span class="line">		$(<span class="string">".groups:visible"</span>).hide();</span><br><span class="line">		$(<span class="keyword">this</span>).hide();</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后跨平台实现监听</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* bind the event */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="regexp">/(iPhone|iPad|iPod|iOS)/i</span>.test(navigator.userAgent)) &#123;</span><br><span class="line">		$(<span class="string">".back"</span>).bind(&#123;<span class="string">"touchend click"</span>:back_click&#125;);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$(<span class="string">".back"</span>).bind(&#123;<span class="string">"click"</span>:back_click&#125;);</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上监听便没有问题了。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>通过以上方法便可以实现不同平台的监听。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-26 13:02:48" itemprop="dateCreated datePublished" datetime="2015-04-26T13:02:48+08:00">2015-04-26</time>
                </span>
                <span id="/1687.html" class="post-meta-item leancloud_visitors" data-flag-title="JS对于Android和IOS平台的点击响应的适配" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>868</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1680.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1680.html" class="post-title-link" itemprop="url">jQuery应用五之瀑布流效果的实现</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>这里我们来利用jQuery实现瀑布流效果。</p>
                  <h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2>
                  <p>我们首先来在线演示一下效果，然后我们说一下是怎样的实现，点开链接进行预览吧 <a href="http://res.cuiqingcai.com/waterfall/" target="_blank" rel="noopener">在线预览</a></p>
                  <h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2>
                  <p>首先我们在页面中加入了一些图片元素，都加到id为container的元素中，每一张图片都在一个class为box的容器里，然后里面是一张图片。</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"box"</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"content"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/1.jpg"</span>&gt;</span><br><span class="line">            &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">        &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在JS中，我们遍历了每一个box，实现box的位置为上一行高度最小的box的位置。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> imgLocation()&#123;</span><br><span class="line">    var <span class="type">box</span> = $(".box");</span><br><span class="line">    var boxWidth = <span class="type">box</span>.eq(<span class="number">0</span>).width();</span><br><span class="line">    var num = Math.floor($(<span class="keyword">window</span>).width()/boxWidth);</span><br><span class="line">    var boxArr=[];</span><br><span class="line">    <span class="type">box</span>.<span class="keyword">each</span>(<span class="keyword">function</span>(<span class="keyword">index</span>,<span class="keyword">value</span>)&#123;</span><br><span class="line">        var boxHeight = <span class="type">box</span>.eq(<span class="keyword">index</span>).height();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">index</span>&lt;num)&#123;</span><br><span class="line">            boxArr[<span class="keyword">index</span>]= boxHeight;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            var minboxHeight = Math.min.apply(<span class="keyword">null</span>,boxArr);</span><br><span class="line">            var minboxIndex = $.inArray(minboxHeight,boxArr);</span><br><span class="line">            $(<span class="keyword">value</span>).css(&#123;</span><br><span class="line">                "position":"absolute",</span><br><span class="line">                "top":minboxHeight,</span><br><span class="line">                "left":<span class="type">box</span>.eq(minboxIndex).position().left</span><br><span class="line">            &#125;);</span><br><span class="line">            boxArr[minboxIndex]+=<span class="type">box</span>.eq(<span class="keyword">index</span>).height();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后实现了滚动条滑动时的动态加载</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrollside</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> box = $(<span class="string">".box"</span>);</span><br><span class="line">    <span class="keyword">var</span> lastboxHeight = box.last().get(<span class="number">0</span>).offsetTop+<span class="built_in">Math</span>.floor(box.last().height()/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> documentHeight = $(<span class="built_in">document</span>).width();</span><br><span class="line">    <span class="keyword">var</span> scrollHeight = $(<span class="built_in">window</span>).scrollTop();</span><br><span class="line">    <span class="keyword">return</span> (lastboxHeight&lt;scrollHeight+documentHeight)?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>调用如下</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">window</span>.onscroll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(scrollside())&#123;</span><br><span class="line">                $.each(dataImg.data,<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> box = $(<span class="string">"&lt;div&gt;"</span>).addClass(<span class="string">"box"</span>).appendTo($(<span class="string">"#container"</span>));</span><br><span class="line">                    <span class="keyword">var</span> content = $(<span class="string">"&lt;div&gt;"</span>).addClass(<span class="string">"content"</span>).appendTo(box);</span><br><span class="line">                    $(<span class="string">"&lt;img&gt;"</span>).attr(<span class="string">"src"</span>,<span class="string">"./img/"</span>+$(value).attr(<span class="string">"src"</span>)).appendTo(content);</span><br><span class="line">                &#125;);</span><br><span class="line">                imgLocation();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述简单的设置我们就实现了瀑布流的效果。</p>
                  <h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2>
                  <p><a href="https://github.com/cqcre/waterfall" target="_blank" rel="noopener">源码下载</a></p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>以上便是瀑布流效果的实现，希望对大家有一定帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-24 15:44:34" itemprop="dateCreated datePublished" datetime="2015-04-24T15:44:34+08:00">2015-04-24</time>
                </span>
                <span id="/1680.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用五之瀑布流效果的实现" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">崔庆才的个人站点，记录生活的瞬间，分享学习的心得。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">518</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">21</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">121</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.abuyun.com/http-proxy/introduce.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/88au8.jpg" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ikkq9.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/599/" style="font-size: 10px;">599</a> <a href="/tags/Bootstrap/" style="font-size: 11.25px;">Bootstrap</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11.25px;">Eclipse</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/GitHub/" style="font-size: 11.25px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 11.25px;">PHP</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/PySpider/" style="font-size: 10px;">PySpider</a> <a href="/tags/Python/" style="font-size: 16.25px;">Python</a> <a href="/tags/Python3/" style="font-size: 12.5px;">Python3</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 10px;">Selenium</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/Ubuntu/" style="font-size: 11.25px;">Ubuntu</a> <a href="/tags/Vue/" style="font-size: 11.25px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13.75px;">WordPress</a> <a href="/tags/object-Object/" style="font-size: 10px;">[object Object]</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11.25px;">matlab</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/style/" style="font-size: 10px;">style</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/uwsgi/" style="font-size: 10px;">uwsgi</a> <a href="/tags/validate-cert/" style="font-size: 10px;">validate_cert</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/wamp/" style="font-size: 10px;">wamp</a> <a href="/tags/wineQQ/" style="font-size: 10px;">wineQQ</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 11.25px;">七牛</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 10px;">上海</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/" style="font-size: 10px;">个人网站</a> <a href="/tags/%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">主题</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 10px;">云存储</a> <a href="/tags/%E4%BA%AC%E4%B8%9C%E4%BA%91/" style="font-size: 10px;">京东云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 10px;">人工智能</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">代码</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size: 10px;">位运算</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 10px;">分享</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 10px;">创业</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 11.25px;">前端</a> <a href="/tags/%E5%8E%9F%E7%94%9FAPP/" style="font-size: 10px;">原生APP</a> <a href="/tags/%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 12.5px;">反爬虫</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80/" style="font-size: 10px;">响应式布局</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A/" style="font-size: 10px;">域名绑定</a> <a href="/tags/%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84/" style="font-size: 10px;">大众点评</a> <a href="/tags/%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">字体反爬虫</a> <a href="/tags/%E5%AE%9E%E7%94%A8/" style="font-size: 10px;">实用</a> <a href="/tags/%E5%B4%94%E5%BA%86%E6%89%8D/" style="font-size: 18.75px;">崔庆才</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE/" style="font-size: 10px;">手机访问</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">旅游</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9D%9C%E5%85%B0%E7%89%B9/" style="font-size: 10px;">杜兰特</a> <a href="/tags/%E6%A1%8C%E9%9D%A2/" style="font-size: 10px;">桌面</a> <a href="/tags/%E6%B1%9F%E5%8D%97/" style="font-size: 10px;">江南</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 10px;">环境变量</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">生活笔记</a> <a href="/tags/%E7%99%BB%E5%BD%95/" style="font-size: 10px;">登录</a> <a href="/tags/%E7%9F%A5%E4%B9%8E/" style="font-size: 10px;">知乎</a> <a href="/tags/%E7%9F%AD%E4%BF%A1/" style="font-size: 10px;">短信</a> <a href="/tags/%E7%BA%B8%E5%BC%A0/" style="font-size: 10px;">纸张</a> <a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 10px;">网站</a> <a href="/tags/%E8%82%89%E5%A4%B9%E9%A6%8D/" style="font-size: 10px;">肉夹馍</a> <a href="/tags/%E8%A5%BF%E5%B0%91%E7%88%B7/" style="font-size: 10px;">西少爷</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">远程</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">配置</a> <a href="/tags/%E9%87%8D%E8%A3%85/" style="font-size: 10px;">重装</a> <a href="/tags/%E9%9D%99%E8%A7%85/" style="font-size: 17.5px;">静觅</a> <a href="/tags/%E9%A2%A0%E8%A6%86/" style="font-size: 10px;">颠覆</a> <a href="/tags/%E9%A3%9E%E4%BF%A1/" style="font-size: 10px;">飞信</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">13</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">38</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">256</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">10</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">74</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ou6mm.jpg">
                  </span>
                  <span class="link">
                    <a href="https://diygod.me/" target="_blank" rel="noopener">DIYgod</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.jankl.com/img/titleshu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.jankl.com/" target="_blank" rel="noopener">liberalist</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/4i7yf.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lizenghai.com/" target="_blank" rel="noopener">Python量化投资</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/22uv1.png">
                  </span>
                  <span class="link">
                    <a href="http://www.cenchong.com/" target="_blank" rel="noopener">岑冲博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ev9kl.png">
                  </span>
                  <span class="link">
                    <a href="http://www.zxiaoji.com/" target="_blank" rel="noopener">张小鸡</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.chrafz.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.chrafz.com/" target="_blank" rel="noopener">张弦先生</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://seofangfa.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://seofangfa.com/" target="_blank" rel="noopener">方法SEO</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lfmj3.png">
                  </span>
                  <span class="link">
                    <a href="http://frankchen.xyz/" target="_blank" rel="noopener">不正经数据科学家</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/129d8.png">
                  </span>
                  <span class="link">
                    <a href="https://www.bysocket.com/" target="_blank" rel="noopener">泥瓦匠BYSocket</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/262r1.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.ysir308.com/" target="_blank" rel="noopener">程序员虾说</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">2.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">37:31</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": null,
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
