<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": true,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://qiniu.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "天验",
            "enable": true,
            "url": "https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850",
            "src": "https://qiniu.cuiqingcai.com/bco2a.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "华为云",
            "enable": false,
            "url": "https://activity.huaweicloud.com/2020_618_promotion/index.html?bpName=5f9f98a29e2c40b780c1793086f29fe2&bindType=1&salesID=wangyubei",
            "src": "https://qiniu.cuiqingcai.com/y42ik.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "张小鸡",
            "enable": false,
            "url": "http://www.zxiaoji.com/",
            "src": "https://qiniu.cuiqingcai.com/fm72f.png",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "Luminati",
            "src": "https://qiniu.cuiqingcai.com/ikkq9.jpg",
            "url": "https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095",
            "width": "100%",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/24/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="崔庆才">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="PHP">
  <meta property="article:tag" content="Java">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Spider">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Web">
  <meta property="article:tag" content="Kubernetes">
  <meta property="article:tag" content="深度学习">
  <meta property="article:tag" content="机器学习">
  <meta property="article:tag" content="数据分析">
  <meta property="article:tag" content="网络">
  <meta property="article:tag" content="IT">
  <meta property="article:tag" content="技术">
  <meta property="article:tag" content="博客">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/24/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://cuiqingcai.com/5052.html"><img title="Python3网络爬虫开发实战教程" src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/1052.html"><img title="Python2爬虫学习系列教程" src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/ipy96.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/uyl5v.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://qiniu.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 20 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1076.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1076.html" class="post-title-link" itemprop="url">Python爬虫实战五之模拟登录淘宝并获取所有订单</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>经过多次尝试，模拟登录淘宝终于成功了，实在是不容易，淘宝的登录加密和验证太复杂了，煞费苦心，在此写出来和大家一起分享，希望大家支持。</p>
                  <h2 id="温馨提示"><a href="#温馨提示" class="headerlink" title="温馨提示"></a>温馨提示</h2>
                  <p>更新时间，2016-02-01，现在淘宝换成了滑块验证了，比较难解决这个问题，以下的代码没法用了，仅作学习参考研究之用吧。</p>
                  <h2 id="本篇内容"><a href="#本篇内容" class="headerlink" title="本篇内容"></a>本篇内容</h2>
                  <p>1. python模拟登录淘宝网页 2. 获取登录用户的所有订单详情 3. 学会应对出现验证码的情况 4. 体会一下复杂的模拟登录机制</p>
                  <h2 id="探索部分成果"><a href="#探索部分成果" class="headerlink" title="探索部分成果"></a>探索部分成果</h2>
                  <p>1. 淘宝的密码用了AES加密算法，最终将密码转化为256位，在POST时，传输的是256位长度的密码。 2. 淘宝在登录时必须要输入验证码，在经过几次尝试失败后最终获取了验证码图片让用户手动输入来验证。 3. 淘宝另外有复杂且每天在变的 ua 加密算法，在程序中我们需要提前获取某一 ua 码才可进行模拟登录。 4. 在获取最后的登录 st 码时，历经了多次请求和正则表达式提取，且 st 码只可使用一次。</p>
                  <h2 id="整体思路梳理"><a href="#整体思路梳理" class="headerlink" title="整体思路梳理"></a>整体思路梳理</h2>
                  <p>1. 手动到浏览器获取 ua 码以及 加密后的密码，只获取一次即可，一劳永逸。 2. 向登录界面发送登录请求，POST 一系列参数，包括 ua 码以及密码等等，获得响应，提取验证码图像。 3. 用户输入手动验证码，重新加入验证码数据再次用 POST 方式发出请求，获得响应，提取 J_Htoken。 4. 利用 J_Htoken 向 alipay 发出请求，获得响应，提取 st 码。 5. 利用 st 码和用户名，重新发出登录请求，获得响应，提取重定向网址，存储 cookie。 6. 利用 cookie 向其他个人页面如订单页面发出请求，获得响应，提取订单详情。 是不是没看懂？没事，下面我将一点点说明自己模拟登录的过程，希望大家可以理解。</p>
                  <h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2>
                  <p>由于淘宝的 ua 算法和 aes 密码加密算法太复杂了，ua 算法在淘宝每天都是在变化的，不过，这个内容你获取之后一直用即可，经过测试之后没有问题，一劳永逸。 那么 ua 和 aes 密码怎样获取呢？ 我们就从浏览器里面直接获取吧，打开浏览器，找到淘宝的登录界面，按 F12 或者浏览器右键审查元素。 在这里我用的是火狐浏览器，首先记得在浏览器中设置一下显示持续日志，要不然页面跳转了你就看不到之前抓取的信息了。在这里截图如下： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150225013600.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150225013600.jpg" alt="20150225013600"></a> 好，那么接下来我们就从浏览器中获取 ua 和 aes 密码 点击网络选项卡，这时都是空的，什么数据也没有截取。这时你就在网页上登录一下试试吧，输入用户名啊，密码啊，有必要时需要输入验证码，点击登录。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225014124.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225014124.jpg" alt="QQ截图20150225014124"></a> 等跳转成功后，你就可以看到好多日志记录了，点击图中的那一行 login.taobo.com，然后查看参数，你就会发现表单数据了，其中就包括 ua 还有下面的 password2，把这俩复制下来，我们之后要用到的。这就是我们需要的 ua 还有 aes 加密后的密码。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225014019.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225014019.jpg" alt="QQ截图20150225014019"></a> 恩，读到这里，你应该获取到了属于自己的 ua 和 password2 两个内容。</p>
                  <h2 id="输入验证码并获取J-HToken"><a href="#输入验证码并获取J-HToken" class="headerlink" title="输入验证码并获取J_HToken"></a>输入验证码并获取J_HToken</h2>
                  <p>经过博主本人亲自验证，有时候，在模拟登录时你并不需要输入验证码，它直接返回的结果就是前面所说的下一步用到的 J_Token，而有时候你则会需要输入验证码，等你手动输入验证码之后，重新请求登录一次。 博主是边写程序边更新文章的，现在写完了是否有必要输入验证码的检验以及在浏览器中呈现验证码。 代码如下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> cookielib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟登录淘宝类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taobao</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#登录的URL</span></span><br><span class="line">        self.loginURL = <span class="string">"https://login.taobao.com/member/login.jhtml"</span></span><br><span class="line">        <span class="comment">#代理IP地址，防止自己的IP被封禁</span></span><br><span class="line">        self.proxyURL = <span class="string">'http://120.193.146.97:843'</span></span><br><span class="line">        <span class="comment">#登录POST数据时发送的头部信息</span></span><br><span class="line">        self.loginHeaders =  &#123;</span><br><span class="line">            <span class="string">'Host'</span>:<span class="string">'login.taobao.com'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0'</span>,</span><br><span class="line">            <span class="string">'Referer'</span> : <span class="string">'https://login.taobao.com/member/login.jhtml'</span>,</span><br><span class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">            <span class="string">'Connection'</span> : <span class="string">'Keep-Alive'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#用户名</span></span><br><span class="line">        self.username = <span class="string">'cqcre'</span></span><br><span class="line">        <span class="comment">#ua字符串，经过淘宝ua算法计算得出，包含了时间戳,浏览器,屏幕分辨率,随机数,鼠标移动,鼠标点击,其实还有键盘输入记录,鼠标移动的记录、点击的记录等等的信息</span></span><br><span class="line">        self.ua = <span class="string">'191UW5TcyMNYQwiAiwTR3tCf0J/QnhEcUpkMmQ=|Um5Ockt0TXdPc011TXVKdyE=|U2xMHDJ+H2QJZwBxX39Rb1d5WXcrSixAJ1kjDVsN|VGhXd1llXGNaYFhkWmJaYl1gV2pIdUtyTXRKfkN4Qn1FeEF6R31TBQ==|VWldfS0TMw8xDjYWKhAwHiUdOA9wCDEVaxgkATdcNU8iDFoM|VmNDbUMV|V2NDbUMV|WGRYeCgGZhtmH2VScVI2UT5fORtmD2gCawwuRSJHZAFsCWMOdVYyVTpbPR99HWAFYVMpUDUFORshHiQdJR0jAT0JPQc/BDoFPgooFDZtVBR5Fn9VOwt2EWhCOVQ4WSJPJFkHXhgoSDVIMRgnHyFqQ3xEezceIRkmahRqFDZLIkUvRiEDaA9qQ3xEezcZORc5bzk=|WWdHFy0TMw8vEy0UIQE0ADgYJBohGjoAOw4uEiwXLAw2DThu9a==|WmBAED5+KnIbdRh1GXgFQSZbGFdrUm1UblZqVGxQa1ZiTGxQcEp1I3U=|W2NDEz19KXENZwJjHkY7Ui9OJQsre09zSWlXY1oMLBExHzERLxsuE0UT|XGZGFjh4LHQdcx5zH34DRyBdHlFtVGtSaFBsUmpWbVBkSmpXd05zTnMlcw==|XWdHFzl5LXUJYwZnGkI/VitKIQ8vEzMKNws3YTc=|XmdaZ0d6WmVFeUB8XGJaYEB4TGxWbk5yTndXa0tyT29Ta0t1QGBeZDI='</span></span><br><span class="line">        <span class="comment">#密码，在这里不能输入真实密码，淘宝对此密码进行了加密处理，256位，此处为加密后的密码</span></span><br><span class="line">        self.password2 = <span class="string">'7511aa68sx629e45de220d29174f1066537a73420ef6dbb5b46f202396703a2d56b0312df8769d886e6ca63d587fdbb99ee73927e8c07d9c88cd02182e1a21edc13fb8e140a4a2a4b5c253bf38484bd0e08199e03eb9bf7b365a5c673c03407d812b91394f0d3c7564042e3f2b11d156aeea37ad6460118914125ab8f8ac466f'</span></span><br><span class="line">        self.post = post = &#123;</span><br><span class="line">            <span class="string">'ua'</span>:self.ua,</span><br><span class="line">            <span class="string">'TPL_checkcode'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'CtrlVersion'</span>: <span class="string">'1,0,0,7'</span>,</span><br><span class="line">            <span class="string">'TPL_password'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_redirect_url'</span>:<span class="string">'http://i.taobao.com/my_taobao.htm?nekot=udm8087E1424147022443'</span>,</span><br><span class="line">            <span class="string">'TPL_username'</span>:self.username,</span><br><span class="line">            <span class="string">'loginsite'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'newlogin'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'from'</span>:<span class="string">'tb'</span>,</span><br><span class="line">            <span class="string">'fc'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'style'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'css_style'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'tid'</span>:<span class="string">'XOR_1_000000000000000000000000000000_625C4720470A0A050976770A'</span>,</span><br><span class="line">            <span class="string">'support'</span>:<span class="string">'000001'</span>,</span><br><span class="line">            <span class="string">'loginType'</span>:<span class="string">'4'</span>,</span><br><span class="line">            <span class="string">'minititle'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'minipara'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'umto'</span>:<span class="string">'NaN'</span>,</span><br><span class="line">            <span class="string">'pstrong'</span>:<span class="string">'3'</span>,</span><br><span class="line">            <span class="string">'llnick'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'isIgnore'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'full_redirect'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'popid'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'callback'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'guf'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'not_duplite_str'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_user_id'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'poy'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'gvfdcname'</span>:<span class="string">'10'</span>,</span><br><span class="line">            <span class="string">'gvfdcre'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'from_encoding '</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sub'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_password_2'</span>:self.password2,</span><br><span class="line">            <span class="string">'loginASR'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'loginASRSuc'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'allp'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'oslanguage'</span>:<span class="string">'zh-CN'</span>,</span><br><span class="line">            <span class="string">'sr'</span>:<span class="string">'1366*768'</span>,</span><br><span class="line">            <span class="string">'osVer'</span>:<span class="string">'windows|6.1'</span>,</span><br><span class="line">            <span class="string">'naviVer'</span>:<span class="string">'firefox|35'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#将POST的数据进行编码转换</span></span><br><span class="line">        self.postData = urllib.urlencode(self.post)</span><br><span class="line">        <span class="comment">#设置代理</span></span><br><span class="line">        self.proxy = urllib2.ProxyHandler(&#123;<span class="string">'http'</span>:self.proxyURL&#125;)</span><br><span class="line">        <span class="comment">#设置cookie</span></span><br><span class="line">        self.cookie = cookielib.LWPCookieJar()</span><br><span class="line">        <span class="comment">#设置cookie处理器</span></span><br><span class="line">        self.cookieHandler = urllib2.HTTPCookieProcessor(self.cookie)</span><br><span class="line">        <span class="comment">#设置登录时用到的opener，它的open方法相当于urllib2.urlopen</span></span><br><span class="line">        self.opener = urllib2.build_opener(self.cookieHandler,self.proxy,urllib2.HTTPHandler)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到是否需要输入验证码，这次请求的相应有时会不同，有时需要验证有时不需要</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">needIdenCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#第一次登录获取验证码尝试，构建request</span></span><br><span class="line">        request = urllib2.Request(self.loginURL,self.postData,self.loginHeaders)</span><br><span class="line">        <span class="comment">#得到第一次登录尝试的相应</span></span><br><span class="line">        response = self.opener.open(request)</span><br><span class="line">        <span class="comment">#获取其中的内容</span></span><br><span class="line">        content = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        <span class="comment">#获取状态吗</span></span><br><span class="line">        status = response.getcode()</span><br><span class="line">        <span class="comment">#状态码为200，获取成功</span></span><br><span class="line">        <span class="keyword">if</span> status == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求成功"</span></span><br><span class="line">            <span class="comment">#\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801这六个字是请输入验证码的utf-8编码</span></span><br><span class="line">            pattern = re.compile(<span class="string">u'\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801'</span>,re.S)</span><br><span class="line">            result = re.search(pattern,content)</span><br><span class="line">            <span class="comment">#如果找到该字符，代表需要输入验证码</span></span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"此次安全验证异常，您需要输入验证码"</span></span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="comment">#否则不需要</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"此次安全验证通过，您这次不需要输入验证码"</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求失败"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到验证码图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIdenCode</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#得到验证码的图片</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;img id="J_StandardCode_m.*?data-src="(.*?)"'</span>,re.S)</span><br><span class="line">        <span class="comment">#匹配的结果</span></span><br><span class="line">        matchResult = re.search(pattern,page)</span><br><span class="line">        <span class="comment">#已经匹配得到内容，并且验证码图片链接不为空</span></span><br><span class="line">        <span class="keyword">if</span> matchResult <span class="keyword">and</span> matchResult.group(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">print</span> matchResult.group(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> matchResult.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"没有找到验证码内容"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#程序运行主干</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#是否需要验证码，是则得到页面内容，不是则返回False</span></span><br><span class="line">        needResult = self.needIdenCode()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> needResult == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"您需要手动输入验证码"</span></span><br><span class="line">            idenCode = self.getIdenCode(needResult)</span><br><span class="line">            <span class="comment">#得到了验证码的链接</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> idenCode == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"验证码获取成功"</span></span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"请在浏览器中输入您看到的验证码"</span></span><br><span class="line">                webbrowser.open_new_tab(idenCode)</span><br><span class="line">            <span class="comment">#验证码链接为空，无效验证码</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"验证码获取失败，请重试"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"不需要输入验证码"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">taobao = Taobao()</span><br><span class="line">taobao.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，请把里面的 ua 和 password2 还有用户名换成自己的进行尝试，用我的可能会产生错误的。 运行结果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225015508.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225015508.jpg" alt="QQ截图20150225015508"></a> 然后会蹦出浏览器，显示了验证码的内容，这个需要你来手动输入。 在这里有小伙伴向我反映有这么个错误 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ图片20150227181617.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ图片20150227181617.png" alt="QQ图片20150227181617"></a> 经过查证，竟然是版本问题，博主本人用的是 2.7.7，而小伙伴用的是 2.7.9。后来换成 2.7.7 就好了…，我也是醉了，希望有相同错误的小伙伴，可以尝试换一下版本… 好啦，运行时会弹出浏览器，如图 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225015717.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225015717.jpg" alt="QQ截图20150225015717"></a> 那么，我们现在需要手动输入验证码，重新向登录界面发出登录请求，之前的post数据内容加入验证码这一项，重新请求一次，如果请求成功，则会返回下一步我们需要的 J_HToken，如果验证码输入错误，则会返回验证码输入错误的选项。好，下面，我已经写到了获取J_HToken的进度，代码如下，现在运行程序，会蹦出浏览器，然后提示你输入验证码，用户手动输入之后，则会返回一个页面，我们提取出 J_Htoken即可。 注意，到现在为止，你还没有登录成功，只是获取到了J_HToken的值。 目前写到的代码如下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> cookielib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟登录淘宝类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taobao</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#登录的URL</span></span><br><span class="line">        self.loginURL = <span class="string">"https://login.taobao.com/member/login.jhtml"</span></span><br><span class="line">        <span class="comment">#代理IP地址，防止自己的IP被封禁</span></span><br><span class="line">        self.proxyURL = <span class="string">'http://120.193.146.97:843'</span></span><br><span class="line">        <span class="comment">#登录POST数据时发送的头部信息</span></span><br><span class="line">        self.loginHeaders =  &#123;</span><br><span class="line">            <span class="string">'Host'</span>:<span class="string">'login.taobao.com'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0'</span>,</span><br><span class="line">            <span class="string">'Referer'</span> : <span class="string">'https://login.taobao.com/member/login.jhtml'</span>,</span><br><span class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">            <span class="string">'Connection'</span> : <span class="string">'Keep-Alive'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#用户名</span></span><br><span class="line">        self.username = <span class="string">'cqcre'</span></span><br><span class="line">        <span class="comment">#ua字符串，经过淘宝ua算法计算得出，包含了时间戳,浏览器,屏幕分辨率,随机数,鼠标移动,鼠标点击,其实还有键盘输入记录,鼠标移动的记录、点击的记录等等的信息</span></span><br><span class="line">        self.ua = <span class="string">'191UW5TcyMNYQwiAiwTR3tCf0J/QnhEcUpkMmQ=|Um5Ockt0TXdPc011TXVKdyE=|U2xMHDJ+H2QJZwBxX39Rb1d5WXcrSixAJ1kjDVsN|VGhXd1llXGNaYFhkWmJaYl1gV2pIdUtyTXRKfkN4Qn1FeEF6R31TBQ==|VWldfS0TMw8xDjYWKhAwHiUdOA9wCDEVaxgkATdcNU8iDFoM|VmNDbUMV|V2NDbUMV|WGRYeCgGZhtmH2VScVI2UT5fORtmD2gCawwuRSJHZAFsCWMOdVYyVTpbPR99HWAFYVMpUDUFORshHiQdJR0jAT0JPQc/BDoFPgooFDZtVBR5Fn9VOwt2EWhCOVQ4WSJPJFkHXhgoSDVIMRgnHyFqQ3xEezceIRkmahRqFDZLIkUvRiEDaA9qQ3xEezcZORc5bzk=|WWdHFy0TMw8vEy0UIQE0ADgYJBohGjoAOw4uEiwXLAw2DThuOA==|WmBAED5+KnIbdRh1GXgFQSZbGFdrUm1UblZqVGxQa1ZiTGxQcEp1I3U=|W2NDEz19KXENZwJjHkY7Ui9OJQsre09zSWlXY1oMLBExHzERLxsuE0UT|XGZGFjh4LHQdcx5zH34DRyBdHlFtVGtSaFBsUmpWbVBkSmpXd05zTnMlcw==|XWdHFzl5LXUJYwZnGkI/VitKIQ8vEzMKNws3YTc=|XmdaZ0d6WmVFeUB8XGJaYEB4TGxWbk5yTndXa0tyT29Ta0t1QGBeZDI='</span></span><br><span class="line">        <span class="comment">#密码，在这里不能输入真实密码，淘宝对此密码进行了加密处理，256位，此处为加密后的密码</span></span><br><span class="line">        self.password2 = <span class="string">'7511aa6854629e45de220d29174f1066537a73420ef6dbb5b46f202396703a2d56b0312df8769d886e6ca63d587fdbb99ee73927e8c07d9c88cd02182e1a21edc13fb8e0a4a2a4b5c253bf38484bd0e08199e03eb9bf7b365a5c673c03407d812b91394f0d3c7564042e3f2b11d156aeea37ad6460118914125ab8f8ac466f'</span></span><br><span class="line">        self.post = post = &#123;</span><br><span class="line">            <span class="string">'ua'</span>:self.ua,</span><br><span class="line">            <span class="string">'TPL_checkcode'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'CtrlVersion'</span>: <span class="string">'1,0,0,7'</span>,</span><br><span class="line">            <span class="string">'TPL_password'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_redirect_url'</span>:<span class="string">'http://i.taobao.com/my_taobao.htm?nekot=udm8087E1424147022443'</span>,</span><br><span class="line">            <span class="string">'TPL_username'</span>:self.username,</span><br><span class="line">            <span class="string">'loginsite'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'newlogin'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'from'</span>:<span class="string">'tb'</span>,</span><br><span class="line">            <span class="string">'fc'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'style'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'css_style'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'tid'</span>:<span class="string">'XOR_1_000000000000000000000000000000_625C4720470A0A050976770A'</span>,</span><br><span class="line">            <span class="string">'support'</span>:<span class="string">'000001'</span>,</span><br><span class="line">            <span class="string">'loginType'</span>:<span class="string">'4'</span>,</span><br><span class="line">            <span class="string">'minititle'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'minipara'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'umto'</span>:<span class="string">'NaN'</span>,</span><br><span class="line">            <span class="string">'pstrong'</span>:<span class="string">'3'</span>,</span><br><span class="line">            <span class="string">'llnick'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'isIgnore'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'full_redirect'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'popid'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'callback'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'guf'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'not_duplite_str'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_user_id'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'poy'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'gvfdcname'</span>:<span class="string">'10'</span>,</span><br><span class="line">            <span class="string">'gvfdcre'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'from_encoding '</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sub'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_password_2'</span>:self.password2,</span><br><span class="line">            <span class="string">'loginASR'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'loginASRSuc'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'allp'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'oslanguage'</span>:<span class="string">'zh-CN'</span>,</span><br><span class="line">            <span class="string">'sr'</span>:<span class="string">'1366*768'</span>,</span><br><span class="line">            <span class="string">'osVer'</span>:<span class="string">'windows|6.1'</span>,</span><br><span class="line">            <span class="string">'naviVer'</span>:<span class="string">'firefox|35'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#将POST的数据进行编码转换</span></span><br><span class="line">        self.postData = urllib.urlencode(self.post)</span><br><span class="line">        <span class="comment">#设置代理</span></span><br><span class="line">        self.proxy = urllib2.ProxyHandler(&#123;<span class="string">'http'</span>:self.proxyURL&#125;)</span><br><span class="line">        <span class="comment">#设置cookie</span></span><br><span class="line">        self.cookie = cookielib.LWPCookieJar()</span><br><span class="line">        <span class="comment">#设置cookie处理器</span></span><br><span class="line">        self.cookieHandler = urllib2.HTTPCookieProcessor(self.cookie)</span><br><span class="line">        <span class="comment">#设置登录时用到的opener，它的open方法相当于urllib2.urlopen</span></span><br><span class="line">        self.opener = urllib2.build_opener(self.cookieHandler,self.proxy,urllib2.HTTPHandler)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到是否需要输入验证码，这次请求的相应有时会不同，有时需要验证有时不需要</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">needCheckCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#第一次登录获取验证码尝试，构建request</span></span><br><span class="line">        request = urllib2.Request(self.loginURL,self.postData,self.loginHeaders)</span><br><span class="line">        <span class="comment">#得到第一次登录尝试的相应</span></span><br><span class="line">        response = self.opener.open(request)</span><br><span class="line">        <span class="comment">#获取其中的内容</span></span><br><span class="line">        content = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        <span class="comment">#获取状态吗</span></span><br><span class="line">        status = response.getcode()</span><br><span class="line">        <span class="comment">#状态码为200，获取成功</span></span><br><span class="line">        <span class="keyword">if</span> status == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求成功"</span></span><br><span class="line">            <span class="comment">#\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801这六个字是请输入验证码的utf-8编码</span></span><br><span class="line">            pattern = re.compile(<span class="string">u'\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801'</span>,re.S)</span><br><span class="line">            result = re.search(pattern,content)</span><br><span class="line">            <span class="keyword">print</span> content</span><br><span class="line">            <span class="comment">#如果找到该字符，代表需要输入验证码</span></span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"此次安全验证异常，您需要输入验证码"</span></span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="comment">#否则不需要</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#返回结果直接带有J_HToken字样，表明直接验证通过</span></span><br><span class="line">                tokenPattern = re.compile(<span class="string">'id="J_HToken"'</span>)</span><br><span class="line">                tokenMatch = re.search(tokenPattern,content)</span><br><span class="line">                <span class="keyword">if</span> tokenMatch:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"此次安全验证通过，您这次不需要输入验证码"</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求失败"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到验证码图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCheckCode</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#得到验证码的图片</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;img id="J_StandardCode_m.*?data-src="(.*?)"'</span>,re.S)</span><br><span class="line">        <span class="comment">#匹配的结果</span></span><br><span class="line">        matchResult = re.search(pattern,page)</span><br><span class="line">        <span class="comment">#已经匹配得到内容，并且验证码图片链接不为空</span></span><br><span class="line">        <span class="keyword">if</span> matchResult <span class="keyword">and</span> matchResult.group(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">print</span> matchResult.group(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> matchResult.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"没有找到验证码内容"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#输入验证码，重新请求，如果验证成功，则返回J_HToken</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loginWithCheckCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#提示用户输入验证码</span></span><br><span class="line">        checkcode = raw_input(<span class="string">'请输入验证码:'</span>)</span><br><span class="line">        <span class="comment">#将验证码重新添加到post的数据中</span></span><br><span class="line">        self.post[<span class="string">'TPL_checkcode'</span>] = checkcode</span><br><span class="line">        <span class="comment">#对post数据重新进行编码</span></span><br><span class="line">        self.postData = urllib.urlencode(self.post)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#再次构建请求，加入验证码之后的第二次登录尝试</span></span><br><span class="line">            request = urllib2.Request(self.loginURL,self.postData,self.loginHeaders)</span><br><span class="line">            <span class="comment">#得到第一次登录尝试的相应</span></span><br><span class="line">            response = self.opener.open(request)</span><br><span class="line">            <span class="comment">#获取其中的内容</span></span><br><span class="line">            content = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">            <span class="comment">#检测验证码错误的正则表达式，\u9a8c\u8bc1\u7801\u9519\u8bef 是验证码错误五个字的编码</span></span><br><span class="line">            pattern = re.compile(<span class="string">u'\u9a8c\u8bc1\u7801\u9519\u8bef'</span>,re.S)</span><br><span class="line">            result = re.search(pattern,content)</span><br><span class="line">            <span class="comment">#如果返回页面包括了，验证码错误五个字</span></span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"验证码输入错误"</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#返回结果直接带有J_HToken字样，说明验证码输入成功，成功跳转到了获取HToken的界面</span></span><br><span class="line">                tokenPattern = re.compile(<span class="string">'id="J_HToken" value="(.*?)"'</span>)</span><br><span class="line">                tokenMatch = re.search(tokenPattern,content)</span><br><span class="line">                <span class="comment">#如果匹配成功，找到了J_HToken</span></span><br><span class="line">                <span class="keyword">if</span> tokenMatch:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码输入正确"</span></span><br><span class="line">                    <span class="keyword">print</span> tokenMatch.group(<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> tokenMatch.group(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment">#匹配失败，J_Token获取失败</span></span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"J_Token获取失败"</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> urllib2.HTTPError, e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"连接服务器出错，错误原因"</span>,e.reason</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#程序运行主干</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#是否需要验证码，是则得到页面内容，不是则返回False</span></span><br><span class="line">        needResult = self.needCheckCode()</span><br><span class="line">        <span class="comment">#请求获取失败，得到的结果是None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> needResult ==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> needResult == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"您需要手动输入验证码"</span></span><br><span class="line">                idenCode = self.getCheckCode(needResult)</span><br><span class="line">                <span class="comment">#得到了验证码的链接</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> idenCode == <span class="literal">False</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码获取成功"</span></span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"请在浏览器中输入您看到的验证码"</span></span><br><span class="line">                    webbrowser.open_new_tab(idenCode)</span><br><span class="line">                    J_HToken = self.loginWithCheckCode()</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">"J_HToken"</span>,J_HToken</span><br><span class="line">                <span class="comment">#验证码链接为空，无效验证码</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码获取失败，请重试"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"不需要输入验证码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"请求登录页面失败，无法确认是否需要验证码"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">taobao = Taobao()</span><br><span class="line">taobao.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在的运行结果是这样的，我们已经可以得到 J_HToken 了，离成功又迈进了一步。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225200329.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225200329.jpg" alt="QQ截图20150225200329"></a> 好，到现在为止，我们应该可以获取到J_HToken的值啦。</p>
                  <h2 id="利用J-HToken获取st"><a href="#利用J-HToken获取st" class="headerlink" title="利用J_HToken获取st"></a>利用J_HToken获取st</h2>
                  <p>st也是一个经计算得到的code，可以这么理解，st是淘宝后台利用J_HToken以及其他数据经过计算之后得到的，可以利用st和用户名直接用get方式登录，所以st可以理解为一个秘钥。这个st值只会使用一次，如果第二次用get方式登录则会失效。所以它是一次性使用的。 下面J_HToken计算st的方法如下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#通过token获得st</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSTbyToken</span><span class="params">(self,token)</span>:</span></span><br><span class="line">    tokenURL = <span class="string">'https://passport.alipay.com/mini_apply_st.js?site=0&amp;token=%s&amp;callback=stCallback6'</span> % token</span><br><span class="line">    request = urllib2.Request(tokenURL)</span><br><span class="line">    response = urllib2.urlopen(request)</span><br><span class="line">    <span class="comment">#处理st，获得用户淘宝主页的登录地址</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&#123;"st":"(.*?)"&#125;'</span>,re.S)</span><br><span class="line">    result = re.search(pattern,response.read())</span><br><span class="line">    <span class="comment">#如果成功匹配</span></span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"成功获取st码"</span></span><br><span class="line">        <span class="comment">#获取st的值</span></span><br><span class="line">        st = result.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> st</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"未匹配到st"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="直接利用st登录"><a href="#直接利用st登录" class="headerlink" title="直接利用st登录"></a>直接利用st登录</h2>
                  <p>得到st之后，基本上就大功告成啦，一段辛苦终于没有白费，你可以直接构建get方式请求的URL，直接访问这个URL便可以实现登录。</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">stURL = <span class="string">'https://login.taobao.com/member/vst.htm?st=%s&amp;TPL_username=%s'</span> <span class="meta">%</span> <span class="comment">(st,username)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"> http<span class="variable">s:</span>//login.taobao.<span class="keyword">com</span>/member/vst.htm?<span class="keyword">st</span>=<span class="number">1</span>uynJELa4hKfsfWU3OjPJCw&amp;TPL_username=cqcre</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>直接访问该链接即可实现登录，不过我这个应该已经失效了吧~ 代码在这先不贴了，剩下的一起贴了~</p>
                  <h2 id="获取已买到的宝贝页面"><a href="#获取已买到的宝贝页面" class="headerlink" title="获取已买到的宝贝页面"></a>获取已买到的宝贝页面</h2>
                  <p>已买到的宝贝的页面地址是</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http:<span class="regexp">//</span>buyer.trade.taobao.com<span class="regexp">/trade/i</span>temlist<span class="regexp">/list_bought_items.htm</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有页码的参数。 重新构建一个带有cookie的opener，将上面的带有st的URL打开，保存它的cookie，然后再利用这个opener打开已买到的宝贝的页面，你就会得到已买到的宝贝页面详情了。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#获得已买到的宝贝页面</span></span><br><span class="line">def getGoodsPage(self,pageIndex):</span><br><span class="line">    goodsURL = <span class="string">'http://buyer.trade.taobao.com/trade/itemlist/listBoughtItems.htm?action=itemlist/QueryAction&amp;event_submit_do_query=1&amp;pageNum='</span> + str(pageIndex)</span><br><span class="line">    response = self.newOpener.open(goodsURL)</span><br><span class="line">   <span class="built_in"> page </span>=  response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">    return page</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>正则表达式提取信息 这是我的已买到的宝贝界面，审查元素可以看到，每一个宝贝都是tbody标签包围着。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225223302.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225223302.jpg" alt="QQ截图20150225223302"></a>我们现在想获取订单时间，订单号，卖家店铺名称，宝贝名称，原价，购买数量，最后付款多少，交易状态这几个量，具体就不再分析啦，正则表达式还不熟悉的同学请参考前面所说的正则表达式的用法，在这里，正则表达式匹配的代码是</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#u'\u8ba2\u5355\u53f7'是订单号的编码</span></span><br><span class="line">pattern = re.compile(<span class="string">u'dealtime.*?&gt;(.*?)&lt;/span&gt;.*?\u8ba2\u5355\u53f7.*?&lt;em&gt;(.*?)&lt;/em&gt;.*?shopname.*?title="(.*?)".*?baobei-name"&gt;.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?'</span></span><br><span class="line">                     <span class="string">u'price.*?title="(.*?)".*?quantity.*?title="(.*?)".*?amount.*?em.*?&gt;(.*?)&lt;/em&gt;.*?trade-status.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;'</span>,re.S)</span><br><span class="line">result = re.findall(pattern,page)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> result:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'------------------------------------------------------------'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"购买日期:"</span>,item[<span class="number">0</span>].strip(), <span class="string">'订单号:'</span>,item[<span class="number">1</span>].strip(),<span class="string">'卖家店铺:'</span>,item[<span class="number">2</span>].strip()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'宝贝名称:'</span>,item[<span class="number">3</span>].strip()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'原价:'</span>,item[<span class="number">4</span>].strip(),<span class="string">'购买数量:'</span>,item[<span class="number">5</span>].strip(),<span class="string">'实际支付:'</span>,item[<span class="number">6</span>].strip(),<span class="string">'交易状态'</span>,item[<span class="number">7</span>].strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="最终代码整理"><a href="#最终代码整理" class="headerlink" title="最终代码整理"></a>最终代码整理</h2>
                  <p>恩，你懂得，最重要的东西来了，经过博主2天多的奋战，代码基本就构建完成。写了两个类，其中提取页面信息的方法我单独放到了一个类中，叫 tool.py，类名为 Tool。 先看一下运行结果吧~ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225234414.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150225234414.jpg" alt="QQ截图20150225234414"></a> 最终代码如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">tool</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理获得的宝贝页面</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tool</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获得页码数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageNum</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;div class="total"&gt;.*?\u5171(.*?)\u9875'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"找到了共多少页"</span></span><br><span class="line">            pageNum = result.group(<span class="number">1</span>).strip()</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'共'</span>,pageNum,<span class="string">'页'</span></span><br><span class="line">            <span class="keyword">return</span> pageNum</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getGoodsInfo</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#u'\u8ba2\u5355\u53f7'是订单号的编码</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'dealtime.*?&gt;(.*?)&lt;/span&gt;.*?\u8ba2\u5355\u53f7.*?&lt;em&gt;(.*?)&lt;/em&gt;.*?shopname.*?title="(.*?)".*?baobei-name"&gt;.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?'</span></span><br><span class="line">                             <span class="string">u'price.*?title="(.*?)".*?quantity.*?title="(.*?)".*?amount.*?em.*?&gt;(.*?)&lt;/em&gt;.*?trade-status.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;'</span>,re.S)</span><br><span class="line">        result = re.findall(pattern,page)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'------------------------------------------------------------'</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"购买日期:"</span>,item[<span class="number">0</span>].strip(), <span class="string">'订单号:'</span>,item[<span class="number">1</span>].strip(),<span class="string">'卖家店铺:'</span>,item[<span class="number">2</span>].strip()</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'宝贝名称:'</span>,item[<span class="number">3</span>].strip()</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'原价:'</span>,item[<span class="number">4</span>].strip(),<span class="string">'购买数量:'</span>,item[<span class="number">5</span>].strip(),<span class="string">'实际支付:'</span>,item[<span class="number">6</span>].strip(),<span class="string">'交易状态'</span>,item[<span class="number">7</span>].strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">taobao</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> cookielib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> webbrowser</span><br><span class="line"><span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟登录淘宝类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taobao</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#登录的URL</span></span><br><span class="line">        self.loginURL = <span class="string">"https://login.taobao.com/member/login.jhtml"</span></span><br><span class="line">        <span class="comment">#代理IP地址，防止自己的IP被封禁</span></span><br><span class="line">        self.proxyURL = <span class="string">'http://120.193.146.97:843'</span></span><br><span class="line">        <span class="comment">#登录POST数据时发送的头部信息</span></span><br><span class="line">        self.loginHeaders =  &#123;</span><br><span class="line">            <span class="string">'Host'</span>:<span class="string">'login.taobao.com'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0'</span>,</span><br><span class="line">            <span class="string">'Referer'</span> : <span class="string">'https://login.taobao.com/member/login.jhtml'</span>,</span><br><span class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">            <span class="string">'Connection'</span> : <span class="string">'Keep-Alive'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#用户名</span></span><br><span class="line">        self.username = <span class="string">'cqcre'</span></span><br><span class="line">        <span class="comment">#ua字符串，经过淘宝ua算法计算得出，包含了时间戳,浏览器,屏幕分辨率,随机数,鼠标移动,鼠标点击,其实还有键盘输入记录,鼠标移动的记录、点击的记录等等的信息</span></span><br><span class="line">        self.ua = <span class="string">'191UW5TcyMNYQwiAiwTR3tCf0J/QnhEcUpkMmQ=|Um5Ockt0TXdPc011TXVKdyE=|U2xMHDJ+H2QJZwBxX39Rb1d5WXcrSixAJ1kjDVsN|VGhXd1llXGNaYFhkWmJaYl1gV2pIdUtyTXRKfkN4Qn1FeEF6R31TBQ==|VWldfS0TMw8xDjYWKhAwHiUdOA9wCDEVaxgkATdcNU8iDFoM|VmNDbUMV|V2NDbUMV|WGRYeCgGZhtmH2VScVI2UT5fORtmD2gCawwuRSJHZAFsCWMOdVYyVTpbPR99HWAFYVMpUDUFORshHiQdJR0jAT0JPQc/BDoFPgooFDZtVBR5Fn9VOwt2EWhCOVQ4WSJPJFkHXhgoSDVIMRgnHyFqQ3xEezceIRkmahRqFDZLIkUvRiEDaA9qQ3xEezcZORc5bzk=|WWdHFy0TMw8vEy0UIQE0ADgYJBohGjoAOw4uEiwXLAw2DThuOA==|WmBAED5+KnIbdRh1GXgFQSZbGFdrUm1UblZqVGxQa1ZiTGxQcEp1I3U=|W2NDEz19KXENZwJjHkY7Ui9OJQsre09zSWlXY1oMLBExHzERLxsuE0UT|XGZGFjh4LHQdcx5zH34DRyBdHlFtVGtSaFBsUmpWbVBkSmpXd05zTnMlcw==|XWdHFzl5LXUJYwZnGkI/VitKIQ8vEzMKNws3YTc=|XmdaZ0d6WmVFeUB8XGJaYEB4TGxWbk5yTndXa0tyT29Ta0t1QGBeZDI='</span></span><br><span class="line">        <span class="comment">#密码，在这里不能输入真实密码，淘宝对此密码进行了加密处理，256位，此处为加密后的密码</span></span><br><span class="line">        self.password2 = <span class="string">'7511aa6854629e45de220d29174f1066537a73420ef6dbb5b46f202396703a2d56b0312df8769d886e6ca63d587fdbb99ee73927e8c07d9c88cd02182e1a21edc13fb8e140a4a2a4b53bf38484bd0e08199e03eb9bf7b365a5c673c03407d812b91394f0d3c7564042e3f2b11d156aeea37ad6460118914125ab8f8ac466f'</span></span><br><span class="line">        self.post = post = &#123;</span><br><span class="line">            <span class="string">'ua'</span>:self.ua,</span><br><span class="line">            <span class="string">'TPL_checkcode'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'CtrlVersion'</span>: <span class="string">'1,0,0,7'</span>,</span><br><span class="line">            <span class="string">'TPL_password'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_redirect_url'</span>:<span class="string">'http://i.taobao.com/my_taobao.htm?nekot=udm8087E1424147022443'</span>,</span><br><span class="line">            <span class="string">'TPL_username'</span>:self.username,</span><br><span class="line">            <span class="string">'loginsite'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'newlogin'</span>:<span class="string">'0'</span>,</span><br><span class="line">            <span class="string">'from'</span>:<span class="string">'tb'</span>,</span><br><span class="line">            <span class="string">'fc'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'style'</span>:<span class="string">'default'</span>,</span><br><span class="line">            <span class="string">'css_style'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'tid'</span>:<span class="string">'XOR_1_000000000000000000000000000000_625C4720470A0A050976770A'</span>,</span><br><span class="line">            <span class="string">'support'</span>:<span class="string">'000001'</span>,</span><br><span class="line">            <span class="string">'loginType'</span>:<span class="string">'4'</span>,</span><br><span class="line">            <span class="string">'minititle'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'minipara'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'umto'</span>:<span class="string">'NaN'</span>,</span><br><span class="line">            <span class="string">'pstrong'</span>:<span class="string">'3'</span>,</span><br><span class="line">            <span class="string">'llnick'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_sign'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'isIgnore'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'full_redirect'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'popid'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'callback'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'guf'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'not_duplite_str'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'need_user_id'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'poy'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'gvfdcname'</span>:<span class="string">'10'</span>,</span><br><span class="line">            <span class="string">'gvfdcre'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'from_encoding '</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'sub'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'TPL_password_2'</span>:self.password2,</span><br><span class="line">            <span class="string">'loginASR'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'loginASRSuc'</span>:<span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'allp'</span>:<span class="string">''</span>,</span><br><span class="line">            <span class="string">'oslanguage'</span>:<span class="string">'zh-CN'</span>,</span><br><span class="line">            <span class="string">'sr'</span>:<span class="string">'1366*768'</span>,</span><br><span class="line">            <span class="string">'osVer'</span>:<span class="string">'windows|6.1'</span>,</span><br><span class="line">            <span class="string">'naviVer'</span>:<span class="string">'firefox|35'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#将POST的数据进行编码转换</span></span><br><span class="line">        self.postData = urllib.urlencode(self.post)</span><br><span class="line">        <span class="comment">#设置代理</span></span><br><span class="line">        self.proxy = urllib2.ProxyHandler(&#123;<span class="string">'http'</span>:self.proxyURL&#125;)</span><br><span class="line">        <span class="comment">#设置cookie</span></span><br><span class="line">        self.cookie = cookielib.LWPCookieJar()</span><br><span class="line">        <span class="comment">#设置cookie处理器</span></span><br><span class="line">        self.cookieHandler = urllib2.HTTPCookieProcessor(self.cookie)</span><br><span class="line">        <span class="comment">#设置登录时用到的opener，它的open方法相当于urllib2.urlopen</span></span><br><span class="line">        self.opener = urllib2.build_opener(self.cookieHandler,self.proxy,urllib2.HTTPHandler)</span><br><span class="line">        <span class="comment">#赋值J_HToken</span></span><br><span class="line">        self.J_HToken = <span class="string">''</span></span><br><span class="line">        <span class="comment">#登录成功时，需要的Cookie</span></span><br><span class="line">        self.newCookie = cookielib.CookieJar()</span><br><span class="line">        <span class="comment">#登陆成功时，需要的一个新的opener</span></span><br><span class="line">        self.newOpener = urllib2.build_opener(urllib2.HTTPCookieProcessor(self.newCookie))</span><br><span class="line">        <span class="comment">#引入工具类</span></span><br><span class="line">        self.tool = tool.Tool()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到是否需要输入验证码，这次请求的相应有时会不同，有时需要验证有时不需要</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">needCheckCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#第一次登录获取验证码尝试，构建request</span></span><br><span class="line">        request = urllib2.Request(self.loginURL,self.postData,self.loginHeaders)</span><br><span class="line">        <span class="comment">#得到第一次登录尝试的相应</span></span><br><span class="line">        response = self.opener.open(request)</span><br><span class="line">        <span class="comment">#获取其中的内容</span></span><br><span class="line">        content = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        <span class="comment">#获取状态吗</span></span><br><span class="line">        status = response.getcode()</span><br><span class="line">        <span class="comment">#状态码为200，获取成功</span></span><br><span class="line">        <span class="keyword">if</span> status == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求成功"</span></span><br><span class="line">            <span class="comment">#\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801这六个字是请输入验证码的utf-8编码</span></span><br><span class="line">            pattern = re.compile(<span class="string">u'\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801'</span>,re.S)</span><br><span class="line">            result = re.search(pattern,content)</span><br><span class="line">            <span class="comment">#如果找到该字符，代表需要输入验证码</span></span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"此次安全验证异常，您需要输入验证码"</span></span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="comment">#否则不需要</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#返回结果直接带有J_HToken字样，表明直接验证通过</span></span><br><span class="line">                tokenPattern = re.compile(<span class="string">'id="J_HToken" value="(.*?)"'</span>)</span><br><span class="line">                tokenMatch = re.search(tokenPattern,content)</span><br><span class="line">                <span class="keyword">if</span> tokenMatch:</span><br><span class="line">                    self.J_HToken = tokenMatch.group(<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"此次安全验证通过，您这次不需要输入验证码"</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"获取请求失败"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#得到验证码图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCheckCode</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#得到验证码的图片</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;img id="J_StandardCode_m.*?data-src="(.*?)"'</span>,re.S)</span><br><span class="line">        <span class="comment">#匹配的结果</span></span><br><span class="line">        matchResult = re.search(pattern,page)</span><br><span class="line">        <span class="comment">#已经匹配得到内容，并且验证码图片链接不为空</span></span><br><span class="line">        <span class="keyword">if</span> matchResult <span class="keyword">and</span> matchResult.group(<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> matchResult.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"没有找到验证码内容"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#输入验证码，重新请求，如果验证成功，则返回J_HToken</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loginWithCheckCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#提示用户输入验证码</span></span><br><span class="line">        checkcode = raw_input(<span class="string">'请输入验证码:'</span>)</span><br><span class="line">        <span class="comment">#将验证码重新添加到post的数据中</span></span><br><span class="line">        self.post[<span class="string">'TPL_checkcode'</span>] = checkcode</span><br><span class="line">        <span class="comment">#对post数据重新进行编码</span></span><br><span class="line">        self.postData = urllib.urlencode(self.post)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#再次构建请求，加入验证码之后的第二次登录尝试</span></span><br><span class="line">            request = urllib2.Request(self.loginURL,self.postData,self.loginHeaders)</span><br><span class="line">            <span class="comment">#得到第一次登录尝试的相应</span></span><br><span class="line">            response = self.opener.open(request)</span><br><span class="line">            <span class="comment">#获取其中的内容</span></span><br><span class="line">            content = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">            <span class="comment">#检测验证码错误的正则表达式，\u9a8c\u8bc1\u7801\u9519\u8bef 是验证码错误五个字的编码</span></span><br><span class="line">            pattern = re.compile(<span class="string">u'\u9a8c\u8bc1\u7801\u9519\u8bef'</span>,re.S)</span><br><span class="line">            result = re.search(pattern,content)</span><br><span class="line">            <span class="comment">#如果返回页面包括了，验证码错误五个字</span></span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"验证码输入错误"</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment">#返回结果直接带有J_HToken字样，说明验证码输入成功，成功跳转到了获取HToken的界面</span></span><br><span class="line">                tokenPattern = re.compile(<span class="string">'id="J_HToken" value="(.*?)"'</span>)</span><br><span class="line">                tokenMatch = re.search(tokenPattern,content)</span><br><span class="line">                <span class="comment">#如果匹配成功，找到了J_HToken</span></span><br><span class="line">                <span class="keyword">if</span> tokenMatch:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码输入正确"</span></span><br><span class="line">                    self.J_HToken = tokenMatch.group(<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> tokenMatch.group(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment">#匹配失败，J_Token获取失败</span></span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"J_Token获取失败"</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> urllib2.HTTPError, e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"连接服务器出错，错误原因"</span>,e.reason</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#通过token获得st</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getSTbyToken</span><span class="params">(self,token)</span>:</span></span><br><span class="line">        tokenURL = <span class="string">'https://passport.alipay.com/mini_apply_st.js?site=0&amp;token=%s&amp;callback=stCallback6'</span> % token</span><br><span class="line">        request = urllib2.Request(tokenURL)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        <span class="comment">#处理st，获得用户淘宝主页的登录地址</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&#123;"st":"(.*?)"&#125;'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,response.read())</span><br><span class="line">        <span class="comment">#如果成功匹配</span></span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"成功获取st码"</span></span><br><span class="line">            <span class="comment">#获取st的值</span></span><br><span class="line">            st = result.group(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> st</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"未匹配到st"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#利用st码进行登录,获取重定向网址</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loginByST</span><span class="params">(self,st,username)</span>:</span></span><br><span class="line">        stURL = <span class="string">'https://login.taobao.com/member/vst.htm?st=%s&amp;TPL_username=%s'</span> % (st,username)</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0'</span>,</span><br><span class="line">            <span class="string">'Host'</span>:<span class="string">'login.taobao.com'</span>,</span><br><span class="line">            <span class="string">'Connection'</span> : <span class="string">'Keep-Alive'</span></span><br><span class="line">        &#125;</span><br><span class="line">        request = urllib2.Request(stURL,headers = headers)</span><br><span class="line">        response = self.newOpener.open(request)</span><br><span class="line">        content =  response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        <span class="comment">#检测结果，看是否登录成功</span></span><br><span class="line">        pattern = re.compile(<span class="string">'top.location = "(.*?)"'</span>,re.S)</span><br><span class="line">        match = re.search(pattern,content)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"登录网址成功"</span></span><br><span class="line">            location = match.group(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"登录失败"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获得已买到的宝贝页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getGoodsPage</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        goodsURL = <span class="string">'http://buyer.trade.taobao.com/trade/itemlist/listBoughtItems.htm?action=itemlist/QueryAction&amp;event_submit_do_query=1'</span> + <span class="string">'&amp;pageNum='</span> + str(pageIndex)</span><br><span class="line">        response = self.newOpener.open(goodsURL)</span><br><span class="line">        page =  response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        <span class="keyword">return</span> page</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取所有已买到的宝贝信息</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAllGoods</span><span class="params">(self,pageNum)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"获取到的商品列表如下"</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>,int(pageNum)+<span class="number">1</span>):</span><br><span class="line">            page = self.getGoodsPage(x)</span><br><span class="line">            self.tool.getGoodsInfo(page)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#程序运行主干</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#是否需要验证码，是则得到页面内容，不是则返回False</span></span><br><span class="line">        needResult = self.needCheckCode()</span><br><span class="line">        <span class="comment">#请求获取失败，得到的结果是None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> needResult ==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> needResult == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"您需要手动输入验证码"</span></span><br><span class="line">                checkCode = self.getCheckCode(needResult)</span><br><span class="line">                <span class="comment">#得到了验证码的链接</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> checkCode == <span class="literal">False</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码获取成功"</span></span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"请在浏览器中输入您看到的验证码"</span></span><br><span class="line">                    webbrowser.open_new_tab(checkCode)</span><br><span class="line">                    self.loginWithCheckCode()</span><br><span class="line">                <span class="comment">#验证码链接为空，无效验证码</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">u"验证码获取失败，请重试"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"不需要输入验证码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"请求登录页面失败，无法确认是否需要验证码"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">#判断token是否正常获取到</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.J_HToken:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"获取Token失败，请重试"</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment">#获取st码</span></span><br><span class="line">        st = self.getSTbyToken(self.J_HToken)</span><br><span class="line">        <span class="comment">#利用st进行登录</span></span><br><span class="line">        result = self.loginByST(st,self.username)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="comment">#获得所有宝贝的页面</span></span><br><span class="line">            page = self.getGoodsPage(<span class="number">1</span>)</span><br><span class="line">            pageNum = self.tool.getPageNum(page)</span><br><span class="line">            self.getAllGoods(pageNum)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"登录失败"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">taobao = Taobao()</span><br><span class="line">taobao.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好啦，运行结果就是上面贴的图片，可以成功获取到自己的商品列表，前提是把你们的 用户名，ua，password2这三个设置好。 以上均为博主亲身所敲，代码写的不好，谨在此贴出和大家一起分享经验~ 小伙伴们试一下吧，希望对大家有帮助~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-24 00:20:33" itemprop="dateCreated datePublished" datetime="2015-02-24T00:20:33+08:00">2015-02-24</time>
                </span>
                <span id="/1076.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战五之模拟登录淘宝并获取所有订单" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>24k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>22 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1070.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/1070.html" class="post-title-link" itemprop="url">WordPress解决修改style.css不生效问题三步走！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近发现WordPress博客在修改style.css样式不能立即生效的问题，根本原因在于服务器开启了.htaccess缓存，不过你总不能直接把这个关掉吧。开启.htaccess缓存还是有很多好处的。</p>
                  <h2 id="我们为什么要设置-htaccess缓存？"><a href="#我们为什么要设置-htaccess缓存？" class="headerlink" title="我们为什么要设置.htaccess缓存？"></a>我们为什么要设置.htaccess缓存？</h2>
                  <p>网站一般不容易变化的都是一些图片，CSS，JS脚本这些可以缓存到本地，设置一个缓存时间，比如30天，这样访客打开你的网站就不会在从网站服务器直接下载这些数据了，而是直接从本地缓存读取这些数据，这样就大大提高了网站加载速度，减少了加载时间。</p>
                  <h2 id="在不修改-htaccess缓存情况下怎样实现修改style-css并且即时生效？"><a href="#在不修改-htaccess缓存情况下怎样实现修改style-css并且即时生效？" class="headerlink" title="在不修改.htaccess缓存情况下怎样实现修改style.css并且即时生效？"></a>在不修改.htaccess缓存情况下怎样实现修改style.css并且即时生效？</h2>
                  <p>经过博主这么多天的探索，总结出了一个”三步走”战略。</p>
                  <h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3>
                  <p>当然是修改主题下的 style.css 文件，去定制你想要的样式。</p>
                  <h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3>
                  <p>找到 functions.php 文件，找到类似</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wp_register_style( 'style', get_template_directory_uri().'/style.css',false,<span class="number">25</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的代码，这就是加载 style.css 文件的代码，在这里注意最后一个参数，这是一个版本号，在有了这个之后，浏览器中审查元素，你会发现 引入的样式文件带有一个参数，比如，现在我的引入的css文件就是这样子的。因为带有版本号，所以它缓存了这个文件，如果版本号不变更，那么它永远在加载这个版本的 CSS 文件。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150223140857-e1424671815196.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150223140857-e1424671815196.jpg" alt=""></a> 所以，我们的解决方法就是改变后面的这个数字，也就是上述代码的最后一个参数。 修改完style.css 文件之后，将这个数字加一即可。 P.S 如果你修改为之前的数字，那么它可能会加载回曾经的版本，在这里，最好修改一次递增一下这个数字。</p>
                  <h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3>
                  <p>现在，你刷新网页可能还不会即时生效样式，就找到 WP Super Cache 插件，点击删除缓存，清一下缓存即可。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150223141547.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150223141547.jpg" alt="20150223141547"></a> 如果没有安装这个插件的童鞋，请安装一个吧，很有用的缓存加速插件。 好，以上就是三步走战略来解决修改style.css不生效问题！ 另外，如果你没有修改 style.css 文件，而是单纯在后台设置了一些选项而发现没有生效，只执行第三部即可生效，亲测可用！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-23 14:16:21" itemprop="dateCreated datePublished" datetime="2015-02-23T14:16:21+08:00">2015-02-23</time>
                </span>
                <span id="/1070.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress解决修改style.css不生效问题三步走！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>885</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1052.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1052.html" class="post-title-link" itemprop="url">Python2爬虫学习系列教程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><strong>年度重磅大放送！！！博主录制的《Python3网络爬虫实战案例》视频教程及《Python3网络爬虫开发实战》书籍出炉啦！！！欢迎大家支持！！！</strong> 视频教程介绍：<a href="//cuiqingcai.com/4320.html">Python3爬虫视频学习教程</a> 视频教程链接：<a href="//edu.hellobi.com/course/157" target="_blank" rel="noopener">自己动手，丰衣足食！Python3网络爬虫实战案例</a> 书籍内容查看：<a href="//cuiqingcai.com/5052.html">Python3网络爬虫开发实战教程</a> 以下为Python2爬虫系列教程： 大家好哈，我呢最近在学习Python爬虫，感觉非常有意思，真的让生活可以方便很多。学习过程中我把一些学习的笔记总结下来，还记录了一些自己实际写的一些小爬虫，在这里跟大家一同分享，希望对Python爬虫感兴趣的童鞋有帮助，如果有机会期待与大家的交流。</p>
                  <h2 id="一、爬虫入门"><a href="#一、爬虫入门" class="headerlink" title="一、爬虫入门"></a>一、爬虫入门</h2>
                  <ol>
                    <li><a href="//cuiqingcai.com/927.html" title="Python爬虫入门一之综述">Python爬虫入门一之综述</a> 2. <a href="//cuiqingcai.com/942.html" title="Python爬虫入门二之爬虫基础了解">Python爬虫入门二之爬虫基础了解</a> 3. <a href="//cuiqingcai.com/947.html" title="Python爬虫入门三之Urllib库的基本使用">Python爬虫入门三之Urllib库的基本使用</a> 4. <a href="//cuiqingcai.com/954.html" title="Python爬虫入门四之Urllib库的高级用法">Python爬虫入门四之Urllib库的高级用法</a> 5. <a href="//cuiqingcai.com/961.html" title="Python爬虫入门五之URLError异常处理">Python爬虫入门五之URLError异常处理</a> 6. <a href="//cuiqingcai.com/968.html" title="Python爬虫入门六之Cookie的使用">Python爬虫入门六之Cookie的使用</a> 7. <a href="//cuiqingcai.com/977.html" title="Python爬虫入门七之正则表达式">Python爬虫入门七之正则表达式</a></li>
                  </ol>
                  <h2 id="二、爬虫实战"><a href="#二、爬虫实战" class="headerlink" title="二、爬虫实战"></a>二、爬虫实战</h2>
                  <ol>
                    <li><a href="//cuiqingcai.com/990.html" title="Python爬虫实战一之爬取糗事百科段子">Python爬虫实战一之爬取糗事百科段子</a> 2. <a href="//cuiqingcai.com/993.html" title="Python爬虫实战二之爬取百度贴吧帖子">Python爬虫实战二之爬取百度贴吧帖子</a> 3. <a href="//cuiqingcai.com/2083.html">Python爬虫实战三之实现山东大学无线网络掉线自动重连</a> 4. <a href="//cuiqingcai.com/1001.html" title="Python爬虫实战四之抓取淘宝MM照片">Python爬虫实战四之抓取淘宝MM照片</a> 5. <a href="//cuiqingcai.com/1076.html" title="Python爬虫实战五之模拟登录淘宝并获取所有订单">Python爬虫实战五之模拟登录淘宝并获取所有订单</a> 6. <a href="//cuiqingcai.com/1972.html" title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a> 7. <a href="//cuiqingcai.com/997.html" title="Python爬虫实战七之计算大学本学期绩点">Python爬虫实战七之计算大学本学期绩点</a> 8. <a href="//cuiqingcai.com/2852.html">Python爬虫实战八之利用Selenium抓取淘宝匿名旺旺</a></li>
                  </ol>
                  <h2 id="三、爬虫利器"><a href="#三、爬虫利器" class="headerlink" title="三、爬虫利器"></a>三、爬虫利器</h2>
                  <ol>
                    <li><a href="//cuiqingcai.com/2556.html" title="Python爬虫利器一之Requests库的用法">Python爬虫利器一之Requests库的用法</a> 2. <a href="//cuiqingcai.com/1319.html" title="Python爬虫利器二之Beautiful Soup的用法">Python爬虫利器二之Beautiful Soup的用法</a> 3. <a href="//cuiqingcai.com/2621.html" title="Python爬虫利器三之Xpath语法与lxml库的用法">Python爬虫利器三之Xpath语法与lxml库的用法</a> 4. <a href="//cuiqingcai.com/2577.html" title="Python爬虫利器四之PhantomJS的用法">Python爬虫利器四之PhantomJS的用法</a> 5. <a href="//cuiqingcai.com/2599.html" title="Python爬虫利器五之Selenium的用法">Python爬虫利器五之Selenium的用法</a> 6. <a href="//cuiqingcai.com/2636.html" title="Python爬虫利器六之PyQuery的用法">Python爬虫利器六之PyQuery的用法</a></li>
                  </ol>
                  <h2 id="四、爬虫进阶"><a href="#四、爬虫进阶" class="headerlink" title="四、爬虫进阶"></a>四、爬虫进阶</h2>
                  <ol>
                    <li><a href="//cuiqingcai.com/2433.html" title="Python爬虫进阶一之爬虫框架概述">Python爬虫进阶一之爬虫框架概述</a> 2. <a href="//cuiqingcai.com/2443.html" title="Python爬虫进阶二之PySpider框架安装配置">Python爬虫进阶二之PySpider框架安装配置</a> 3. <a href="//cuiqingcai.com/912.html" title="Python爬虫进阶三之爬虫框架Scrapy安装配置">Python爬虫进阶三之爬虫框架Scrapy安装配置</a> 4. <a href="//cuiqingcai.com/2652.html" title="Python爬虫进阶四之PySpider的用法">Python爬虫进阶四之PySpider的用法</a> 5. <a href="//cuiqingcai.com/3325.html" title="Python爬虫进阶五之多线程的用法">Python爬虫进阶五之多线程的用法</a> 6. <a href="//cuiqingcai.com/3335.html" title="Python爬虫进阶六之多进程的用法">Python爬虫进阶六之多进程的用法</a> 7. <a href="//cuiqingcai.com/3443.html" title="Python爬虫进阶七之设置ADSL拨号服务器代理">Python爬虫进阶七之设置ADSL拨号服务器代理</a> 目前暂时是这些文章，随着学习的进行，会不断更新哒，敬请期待~ 希望对大家有所帮助，谢谢！</li>
                  </ol>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-21 14:14:48" itemprop="dateCreated datePublished" datetime="2015-02-21T14:14:48+08:00">2015-02-21</time>
                </span>
                <span id="/1052.html" class="post-meta-item leancloud_visitors" data-flag-title="Python2爬虫学习系列教程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1001.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1001.html" class="post-title-link" itemprop="url">Python爬虫实战四之抓取淘宝MM照片</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>福利啊福利，本次为大家带来的项目是抓取淘宝MM照片并保存起来，大家有没有很激动呢？</p>
                  <h2 id="最新动态"><a href="#最新动态" class="headerlink" title="最新动态"></a>最新动态</h2>
                  <blockquote>
                    <p>更新时间：2015/8/2 最近好多读者反映代码已经不能用了，原因是淘宝索引页的MM链接改了。网站改版了，URL的索引已经和之前的不一样了，之前可以直接跳转到每个MM的个性域名，现在中间加了一个跳转页，本以为可以通过这个页面然后跳转到原来的个性域名，而经过一番折腾发现，这个跳转页中的内容是JS动态生成的，所以不能用Urllib库来直接抓取了，本篇就只提供学习思路，代码不能继续用了。 之后博主会利用其它方法来尝试解决，如果解决，第一时间更新！谢谢大家！</p>
                    <p>更新时间：2016/3/26 如上问题已解决，利用 PhantomJS的动态解析即可完成。因为 PySpider 同样支持 PhantomJS，所以我直接利用了 PySpider 来完成，解决方案如下 <a href="http://cuiqingcai.com/2652.html">解决方案</a> 另外如果不想使用框架，可以直接利用 Selenium + PhantomJS 来解析，同样方便，解决方案可以参考 <a href="http://cuiqingcai.com/2599.html">动态解析解决方案</a></p>
                  </blockquote>
                  <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
                  <p>1.抓取淘宝MM的姓名，头像，年龄 2.抓取每一个MM的资料简介以及写真图片 3.把每一个MM的写真图片按照文件夹保存到本地 4.熟悉文件保存的过程</p>
                  <h2 id="1-URL的格式"><a href="#1-URL的格式" class="headerlink" title="1.URL的格式"></a>1.URL的格式</h2>
                  <p>在这里我们用到的URL是 <a href="http://mm.taobao.com/json/request_top_list.htm?page=1" target="_blank" rel="noopener">http://mm.taobao.com/json/request_top_list.htm?page=1</a>，问号前面是基地址，后面的参数page是代表第几页，可以随意更换地址。点击开之后，会发现有一些淘宝MM的简介，并附有超链接链接到个人详情页面。 我们需要抓取本页面的头像地址，MM姓名，MM年龄，MM居住地，以及MM的个人详情页面地址。</p>
                  <h2 id="2-抓取简要信息"><a href="#2-抓取简要信息" class="headerlink" title="2.抓取简要信息"></a>2.抓取简要信息</h2>
                  <p>相信大家经过上几次的实战，对抓取和提取页面的地址已经非常熟悉了，这里没有什么难度了，我们首先抓取本页面的MM详情页面地址，姓名，年龄等等的信息打印出来，直接贴代码如下</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author_<span class="number">_</span> = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.siteURL = <span class="string">'http://mm.taobao.com/json/request_top_list.htm'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(<span class="keyword">self</span>,pageIndex)</span></span><span class="symbol">:</span></span><br><span class="line">        url = <span class="keyword">self</span>.siteURL + <span class="string">"?page="</span> + str(pageIndex)</span><br><span class="line">        print url</span><br><span class="line">        request = urllib2.Request(url)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        <span class="keyword">return</span> response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getContents</span><span class="params">(<span class="keyword">self</span>,pageIndex)</span></span><span class="symbol">:</span></span><br><span class="line">        page = <span class="keyword">self</span>.getPage(pageIndex)</span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div class="list-item".*?pic-word.*?&lt;a href="(.*?)".*?&lt;img src="(.*?)".*?&lt;a class="lady-name.*?&gt;(.*?)&lt;/a&gt;.*?&lt;strong&gt;(.*?)&lt;/strong&gt;.*?&lt;span&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">        items = re.findall(pattern,page)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> <span class="symbol">items:</span></span><br><span class="line">            print item[<span class="number">0</span>],item[<span class="number">1</span>],item[<span class="number">2</span>],item[<span class="number">3</span>],item[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">spider = Spider()</span><br><span class="line">spider.getContents(<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220234132.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220234132.jpg" alt="QQ截图20150220234132"></a></p>
                  <h2 id="2-文件写入简介"><a href="#2-文件写入简介" class="headerlink" title="2.文件写入简介"></a>2.文件写入简介</h2>
                  <p>在这里，我们有写入图片和写入文本两种方式</p>
                  <h3 id="1）写入图片"><a href="#1）写入图片" class="headerlink" title="1）写入图片"></a>1）写入图片</h3>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#传入图片地址，文件名，保存单张图片</span><br><span class="line">def saveImg(self,imageURL,<span class="meta">fileName</span>):</span><br><span class="line">     u = urllib.ur<span class="meta">lopen(</span>imageURL)</span><br><span class="line"><span class="keyword">     data </span>= u.read()</span><br><span class="line">     f =<span class="meta"> open(</span><span class="meta">fileName</span>, <span class="string">'wb'</span>)</span><br><span class="line">     f.write(data)</span><br><span class="line">     f<span class="meta">.close(</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2）写入文本"><a href="#2）写入文本" class="headerlink" title="2）写入文本"></a>2）写入文本</h3>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveBrief</span><span class="params">(self,content,name)</span>:</span></span><br><span class="line">    fileName = name + <span class="string">"/"</span> + name + <span class="string">".txt"</span></span><br><span class="line">    f = open(fileName,<span class="string">"w+"</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">u"正在偷偷保存她的个人信息为"</span>,fileName</span><br><span class="line">    f.write(content.encode(<span class="string">'utf-8'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3）创建新目录"><a href="#3）创建新目录" class="headerlink" title="3）创建新目录"></a>3）创建新目录</h3>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#创建新目录</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mkdir</span><span class="params">(self,path)</span>:</span></span><br><span class="line">    path = path.strip()</span><br><span class="line">    <span class="comment"># 判断路径是否存在</span></span><br><span class="line">    <span class="comment"># 存在     True</span></span><br><span class="line">    <span class="comment"># 不存在   False</span></span><br><span class="line">    isExists=os.path.exists(path)</span><br><span class="line">    <span class="comment"># 判断结果</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isExists:</span><br><span class="line">        <span class="comment"># 如果不存在则创建目录</span></span><br><span class="line">        <span class="comment"># 创建目录操作函数</span></span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果目录存在则不创建，并提示目录已存在</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-代码完善"><a href="#3-代码完善" class="headerlink" title="3.代码完善"></a>3.代码完善</h2>
                  <p>主要的知识点已经在前面都涉及到了，如果大家前面的章节都已经看了，完成这个爬虫不在话下，具体的详情在此不再赘述，直接帖代码啦。</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">spider</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取MM</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#页面初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.siteURL = <span class="string">'http://mm.taobao.com/json/request_top_list.htm'</span></span><br><span class="line">        self.tool = tool.Tool()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取索引页面的内容</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        url = self.siteURL + <span class="string">"?page="</span> + str(pageIndex)</span><br><span class="line">        request = urllib2.Request(url)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        <span class="keyword">return</span> response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取索引界面所有MM的信息，list格式</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getContents</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        page = self.getPage(pageIndex)</span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div class="list-item".*?pic-word.*?&lt;a href="(.*?)".*?&lt;img src="(.*?)".*?&lt;a class="lady-name.*?&gt;(.*?)&lt;/a&gt;.*?&lt;strong&gt;(.*?)&lt;/strong&gt;.*?&lt;span&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">        items = re.findall(pattern,page)</span><br><span class="line">        contents = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            contents.append([item[<span class="number">0</span>],item[<span class="number">1</span>],item[<span class="number">2</span>],item[<span class="number">3</span>],item[<span class="number">4</span>]])</span><br><span class="line">        <span class="keyword">return</span> contents</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取MM个人详情页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getDetailPage</span><span class="params">(self,infoURL)</span>:</span></span><br><span class="line">        response = urllib2.urlopen(infoURL)</span><br><span class="line">        <span class="keyword">return</span> response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取个人文字简介</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getBrief</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div class="mm-aixiu-content".*?&gt;(.*?)&lt;!--'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">return</span> self.tool.replace(result.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取页面所有图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAllImg</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div class="mm-aixiu-content".*?&gt;(.*?)&lt;!--'</span>,re.S)</span><br><span class="line">        <span class="comment">#个人信息页面所有代码</span></span><br><span class="line">        content = re.search(pattern,page)</span><br><span class="line">        <span class="comment">#从代码中提取图片</span></span><br><span class="line">        patternImg = re.compile(<span class="string">'&lt;img.*?src="(.*?)"'</span>,re.S)</span><br><span class="line">        images = re.findall(patternImg,content.group(<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> images</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#保存多张写真图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveImgs</span><span class="params">(self,images,name)</span>:</span></span><br><span class="line">        number = <span class="number">1</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"发现"</span>,name,<span class="string">u"共有"</span>,len(images),<span class="string">u"张照片"</span></span><br><span class="line">        <span class="keyword">for</span> imageURL <span class="keyword">in</span> images:</span><br><span class="line">            splitPath = imageURL.split(<span class="string">'.'</span>)</span><br><span class="line">            fTail = splitPath.pop()</span><br><span class="line">            <span class="keyword">if</span> len(fTail) &gt; <span class="number">3</span>:</span><br><span class="line">                fTail = <span class="string">"jpg"</span></span><br><span class="line">            fileName = name + <span class="string">"/"</span> + str(number) + <span class="string">"."</span> + fTail</span><br><span class="line">            self.saveImg(imageURL,fileName)</span><br><span class="line">            number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存头像</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveIcon</span><span class="params">(self,iconURL,name)</span>:</span></span><br><span class="line">        splitPath = iconURL.split(<span class="string">'.'</span>)</span><br><span class="line">        fTail = splitPath.pop()</span><br><span class="line">        fileName = name + <span class="string">"/icon."</span> + fTail</span><br><span class="line">        self.saveImg(iconURL,fileName)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#保存个人简介</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveBrief</span><span class="params">(self,content,name)</span>:</span></span><br><span class="line">        fileName = name + <span class="string">"/"</span> + name + <span class="string">".txt"</span></span><br><span class="line">        f = open(fileName,<span class="string">"w+"</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"正在偷偷保存她的个人信息为"</span>,fileName</span><br><span class="line">        f.write(content.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#传入图片地址，文件名，保存单张图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">saveImg</span><span class="params">(self,imageURL,fileName)</span>:</span></span><br><span class="line">         u = urllib.urlopen(imageURL)</span><br><span class="line">         data = u.read()</span><br><span class="line">         f = open(fileName, <span class="string">'wb'</span>)</span><br><span class="line">         f.write(data)</span><br><span class="line">         <span class="keyword">print</span> <span class="string">u"正在悄悄保存她的一张图片为"</span>,fileName</span><br><span class="line">         f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建新目录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mkdir</span><span class="params">(self,path)</span>:</span></span><br><span class="line">        path = path.strip()</span><br><span class="line">        <span class="comment"># 判断路径是否存在</span></span><br><span class="line">        <span class="comment"># 存在     True</span></span><br><span class="line">        <span class="comment"># 不存在   False</span></span><br><span class="line">        isExists=os.path.exists(path)</span><br><span class="line">        <span class="comment"># 判断结果</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isExists:</span><br><span class="line">            <span class="comment"># 如果不存在则创建目录</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"偷偷新建了名字叫做"</span>,path,<span class="string">u'的文件夹'</span></span><br><span class="line">            <span class="comment"># 创建目录操作函数</span></span><br><span class="line">            os.makedirs(path)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果目录存在则不创建，并提示目录已存在</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"名为"</span>,path,<span class="string">'的文件夹已经创建成功'</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#将一页淘宝MM的信息保存起来</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">savePageInfo</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        <span class="comment">#获取第一页淘宝MM列表</span></span><br><span class="line">        contents = self.getContents(pageIndex)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> contents:</span><br><span class="line">            <span class="comment">#item[0]个人详情URL,item[1]头像URL,item[2]姓名,item[3]年龄,item[4]居住地</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"发现一位模特,名字叫"</span>,item[<span class="number">2</span>],<span class="string">u"芳龄"</span>,item[<span class="number">3</span>],<span class="string">u",她在"</span>,item[<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"正在偷偷地保存"</span>,item[<span class="number">2</span>],<span class="string">"的信息"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"又意外地发现她的个人地址是"</span>,item[<span class="number">0</span>]</span><br><span class="line">            <span class="comment">#个人详情页面的URL</span></span><br><span class="line">            detailURL = item[<span class="number">0</span>]</span><br><span class="line">            <span class="comment">#得到个人详情页面代码</span></span><br><span class="line">            detailPage = self.getDetailPage(detailURL)</span><br><span class="line">            <span class="comment">#获取个人简介</span></span><br><span class="line">            brief = self.getBrief(detailPage)</span><br><span class="line">            <span class="comment">#获取所有图片列表</span></span><br><span class="line">            images = self.getAllImg(detailPage)</span><br><span class="line">            self.mkdir(item[<span class="number">2</span>])</span><br><span class="line">            <span class="comment">#保存个人简介</span></span><br><span class="line">            self.saveBrief(brief,item[<span class="number">2</span>])</span><br><span class="line">            <span class="comment">#保存头像</span></span><br><span class="line">            self.saveIcon(item[<span class="number">1</span>],item[<span class="number">2</span>])</span><br><span class="line">            <span class="comment">#保存图片</span></span><br><span class="line">            self.saveImgs(images,item[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传入起止页码，获取MM图片</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">savePagesInfo</span><span class="params">(self,start,end)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(start,end+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"正在偷偷寻找第"</span>,i,<span class="string">u"个地方，看看MM们在不在"</span></span><br><span class="line">            self.savePageInfo(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#传入起止页码即可，在此传入了2,10,表示抓取第2到10页的MM</span></span><br><span class="line">spider = Spider()</span><br><span class="line">spider.savePagesInfo(<span class="number">2</span>,<span class="number">10</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">tool</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="comment">'CQC'</span></span><br><span class="line"><span class="meta">#-*- coding:utf-8 -*-</span></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上两个文件就是所有的代码内容，运行一下试试看，那叫一个酸爽啊 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221020543.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221020543.jpg" alt="QQ截图20150221020543"></a> 看看文件夹里面有什么变化 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221020709.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221020709.jpg" alt="QQ截图20150221020709"></a> <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221021032.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150221021032.jpg" alt="QQ截图20150221021032"></a> 不知不觉，海量的MM图片已经进入了你的电脑，还不快快去试试看！！ 代码均为本人所敲，写的不好，大神勿喷，写来方便自己，同时分享给大家参考！希望大家支持！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-20 22:48:11" itemprop="dateCreated datePublished" datetime="2015-02-20T22:48:11+08:00">2015-02-20</time>
                </span>
                <span id="/1001.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战四之抓取淘宝MM照片" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/997.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/997.html" class="post-title-link" itemprop="url">Python爬虫实战七之计算大学本学期绩点</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，本次为大家带来的项目是计算大学本学期绩点。首先说明的是，博主来自山东大学，有属于个人的学生成绩管理系统，需要学号密码才可以登录，不过可能广大读者没有这个学号密码，不能实际进行操作，所以最主要的还是获取它的原理。最主要的是了解cookie的相关操作。</p>
                  <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
                  <p>1.模拟登录学生成绩管理系统 2.抓取本学期成绩界面 3.计算打印本学期成绩</p>
                  <h2 id="1-URL的获取"><a href="#1-URL的获取" class="headerlink" title="1.URL的获取"></a>1.URL的获取</h2>
                  <p>恩，博主来自山东大学~ 先贴一个URL，让大家知道我们学校学生信息系统的网站构架，主页是 <a href="http://jwxt.sdu.edu.cn:7890/zhxt_bks/zhxt_bks.html" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/zhxt_bks/zhxt_bks.html</a>，山东大学学生个人信息系统，进去之后，Oh不，他竟然用了frame，一个多么古老的而又任性的写法，真是惊出一身冷汗~ 算了，就算他是frame又能拿我怎么样？我们点到登录界面，审查一下元素，先看看登录界面的URL是怎样的？ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220211218.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220211218.jpg" alt="QQ截图20150220211218"></a> 恩，看到了右侧的frame名称，src=”xk_login.html”，可以分析出完整的登录界面的网址为 <a href="http://jwxt.sdu.edu.cn:7890/zhxt_bks/xk_login.html" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/zhxt_bks/xk_login.html</a>，点进去看看，真是棒棒哒，他喵的竟然是清华大学选课系统，醉了，你说你抄袭就抄袭吧，改改名字也不错啊~ 算了，就不和他计较了。现在，我们登录一下，用浏览器监听网络。 我用的是猎豹浏览器，审查元素时会有一个网络的选项，如果大家用的Chrome，也有相对应的功能，Firefox需要装插件HttpFox，同样可以实现。 这个网络监听功能可以监听表单的传送以及请求头，响应头等等的信息。截个图看一下，恩，我偷偷把密码隐藏了，你看不到~ 大家看到的是登录之后出现的信息以及NetWork监听，显示了hearders的详细信息。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220212025.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220212025.jpg" alt="QQ截图20150220212025"></a> 最主要的内容，我们可以发现有一个表单提交的过程，提交方式为POST，两个参数分别为stuid和pwd。 请求的URL为 <a href="http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login</a>，没错，找到表单数据和目标地址就是这么简单。 在这里注意，刚才的 <a href="http://jwxt.sdu.edu.cn:7890/zhxt_bks/xk_login.html" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/zhxt_bks/xk_login.html</a> 只是登录界面的地址，刚刚得到的这个地址才是登录索要提交到的真正的URL。希望大家这里不要混淆。 不知道山大这个系统有没有做headers的检查，我们先不管这么多，先尝试一下模拟登录并保存Cookie。</p>
                  <h2 id="2-模拟登录"><a href="#2-模拟登录" class="headerlink" title="2.模拟登录"></a>2.模拟登录</h2>
                  <p>好，通过以上信息，我们已经找到了登录的目标地址为 <a href="http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login</a> 有一个表单提交到这个URL，表单的两个内容分别为stuid和pwd，学号和密码，没有其他的隐藏信息，提交方式为POST。 好，现在我们首先构造以下代码来完成登录。看看会不会获取到登录之后的提示页面。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author_<span class="number">_</span> = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="comment">#山东大学绩点运算</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SDU</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.loginUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login'</span></span><br><span class="line">        <span class="keyword">self</span>.cookies = cookielib.CookieJar()</span><br><span class="line">        <span class="keyword">self</span>.postdata = urllib.urlencode(&#123;</span><br><span class="line">            <span class="string">'stuid'</span><span class="symbol">:<span class="string">'201200131012'</span></span>,</span><br><span class="line">            <span class="string">'pwd'</span><span class="symbol">:<span class="string">'xxxxxx'</span></span></span><br><span class="line">         &#125;)</span><br><span class="line">        <span class="keyword">self</span>.opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(<span class="keyword">self</span>.cookies))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        request  = urllib2.Request(</span><br><span class="line">            url = <span class="keyword">self</span>.loginUrl,</span><br><span class="line">            data = <span class="keyword">self</span>.postdata)</span><br><span class="line">        result = <span class="keyword">self</span>.opener.open(request)</span><br><span class="line">        <span class="comment">#打印登录内容</span></span><br><span class="line">        print result.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sdu = SDU()</span><br><span class="line">sdu.getPage()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试一下，竟然成功了，山大这网竟然没有做headers检查，很顺利就登录进去了。 说明一下，在这里我们利用了前面所说的cookie，用到了CookieJar这个对象来保存cookies，另外通过构建opener，利用open方法实现了登录。如果大家觉得这里有疑惑，请看 <a href="http://cuiqingcai.com/968.html">Python爬虫入门六之Cookie的使用</a>，这篇文章说得比较详细。 好，我们看一下运行结果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220214238.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220214238.jpg" alt="QQ截图20150220214238"></a> 酸爽啊，接下来我们只要再获取到本学期成绩界面然后把成绩抓取出来就好了。</p>
                  <h2 id="3-抓取本学期成绩"><a href="#3-抓取本学期成绩" class="headerlink" title="3.抓取本学期成绩"></a>3.抓取本学期成绩</h2>
                  <p>让我们先在浏览器中找到本学期成绩界面，点击左边的本学期成绩。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220220000.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220220000.jpg" alt="QQ截图20150220220000"></a> 重新审查元素，你会发现这个frame的src还是没有变，仍然是xk_login.html，引起这个页面变化的原因是在左边的本学期成绩这个超链接设置了一个目标frame，所以，那个页面就显示在右侧了。 所以，让我们再审查一下本学期成绩这个超链接的内容是什么~ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220220338.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220220338.jpg" alt="QQ截图20150220220338"></a> 恩，找到它了，<a href="/pls/wwwbks/bkscjcx.curscopre" target="w_right">本学期成绩</a> 那么，完整的URL就是 <a href="http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre" target="_blank" rel="noopener">http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre</a>，好，URL已经找到了，我们继续完善一下代码，获取这个页面。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author_<span class="number">_</span> = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="comment">#山东大学绩点运算</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SDU</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="comment">#登录URL</span></span><br><span class="line">        <span class="keyword">self</span>.loginUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login'</span></span><br><span class="line">        <span class="comment">#本学期成绩URL</span></span><br><span class="line">        <span class="keyword">self</span>.gradeUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre'</span></span><br><span class="line">        <span class="keyword">self</span>.cookies = cookielib.CookieJar()</span><br><span class="line">        <span class="keyword">self</span>.postdata = urllib.urlencode(&#123;</span><br><span class="line">            <span class="string">'stuid'</span><span class="symbol">:<span class="string">'201200131012'</span></span>,</span><br><span class="line">            <span class="string">'pwd'</span><span class="symbol">:<span class="string">'xxxxxx'</span></span></span><br><span class="line">         &#125;)</span><br><span class="line">        <span class="comment">#构建opener</span></span><br><span class="line">        <span class="keyword">self</span>.opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(<span class="keyword">self</span>.cookies))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取本学期成绩页面</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        request  = urllib2.Request(</span><br><span class="line">            url = <span class="keyword">self</span>.loginUrl,</span><br><span class="line">            data = <span class="keyword">self</span>.postdata)</span><br><span class="line">        result = <span class="keyword">self</span>.opener.open(request)</span><br><span class="line">        result = <span class="keyword">self</span>.opener.open(<span class="keyword">self</span>.gradeUrl)</span><br><span class="line">        <span class="comment">#打印登录内容</span></span><br><span class="line">        print result.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sdu = SDU()</span><br><span class="line">sdu.getPage()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的代码，我们最主要的是增加了</p>
                  <figure class="highlight oxygene">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">result</span> = <span class="keyword">self</span>.opener.open(<span class="keyword">self</span>.gradeUrl)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这句代码，用原来的opener 访问一个本学期成绩的URL即可。运行结果如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220221909.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150220221909.jpg" alt="QQ截图20150220221909"></a> 恩，本学期成绩的页面已经被我们抓取下来了，接下来用正则表达式提取一下，然后计算学分即可</p>
                  <h2 id="4-抓取有效信息"><a href="#4-抓取有效信息" class="headerlink" title="4.抓取有效信息"></a>4.抓取有效信息</h2>
                  <p>接下来我们就把页面内容提取一下，最主要的便是学分以及分数了。 平均绩点 = ∑（每科学分*每科分数）/总学分 所以我们把每科的学分以及分数抓取下来就好了，对于有些课打了良好或者优秀等级的，我们不进行抓取。 我们可以发现每一科都是TR标签，然后是一系列的td标签</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">TR</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span><span class="tag">&lt;<span class="name">INPUT</span> <span class="attr">TYPE</span>=<span class="string">"checkbox"</span> <span class="attr">NAME</span>=<span class="string">"p_pm"</span> <span class="attr">VALUE</span>=<span class="string">"013320131012015011294 面向对象技术"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>0133201310<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>面向对象技术<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>20150112<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>94<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">"#EAE2F3"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>必修<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TR</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们用下面的正则表达式进行提取即可，部分代码如下</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">page = self.getPage()</span><br><span class="line">myItems = re.findall(<span class="comment">'<span class="doctag">&lt;TR&gt;</span>.*?<span class="doctag">&lt;p.*?&lt;p.*?&lt;p.*?&lt;p.*?&lt;p.*?&gt;</span>(.*?)<span class="doctag">&lt;/p&gt;</span>.*?<span class="doctag">&lt;p.*?&lt;p.*?&gt;</span>(.*?)<span class="doctag">&lt;/p&gt;</span>.*?<span class="doctag">&lt;/TR&gt;</span>',page,re.S) </span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> myItems:</span><br><span class="line">   self.credit.append(item[<span class="number">0</span>].encode(<span class="comment">'gbk'))</span></span><br><span class="line">   self.grades.append(item[<span class="number">1</span>].encode(<span class="comment">'gbk'))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>主要利用了findall方法，这个方法在此就不多介绍了，前面我们已经用过多次了。 得到的学分和分数我们都用列表list进行存储，所以用了 append 方法，每获取到一个信息就把它加进去。</p>
                  <h2 id="5-整理计算最后绩点"><a href="#5-整理计算最后绩点" class="headerlink" title="5.整理计算最后绩点"></a>5.整理计算最后绩点</h2>
                  <p>恩，像上面那样把学分绩点都保存到列表list中了，所以我们最后用一个公式来计算学分绩点就好了，最后整理后的代码如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line">import re</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"><span class="comment">#绩点运算</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SDU</span>:</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">#类的初始化</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="comment">#登录URL</span></span><br><span class="line">      <span class="keyword">self</span>.loginUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login'</span></span><br><span class="line">      <span class="comment">#成绩URL</span></span><br><span class="line">      <span class="keyword">self</span>.gradeUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre'</span></span><br><span class="line">      <span class="comment">#CookieJar对象</span></span><br><span class="line">      <span class="keyword">self</span>.cookies = cookielib.CookieJar()</span><br><span class="line">      <span class="comment">#表单数据</span></span><br><span class="line">      <span class="keyword">self</span>.postdata = urllib.urlencode(&#123;</span><br><span class="line">            <span class="string">'stuid'</span><span class="symbol">:<span class="string">'201200131012'</span></span>,</span><br><span class="line">            <span class="string">'pwd'</span><span class="symbol">:<span class="string">'xxxxx'</span></span></span><br><span class="line">         &#125;)</span><br><span class="line">      <span class="comment">#构建opener</span></span><br><span class="line">      <span class="keyword">self</span>.opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(<span class="keyword">self</span>.cookies))</span><br><span class="line">      <span class="comment">#学分list</span></span><br><span class="line">      <span class="keyword">self</span>.credit = []</span><br><span class="line">      <span class="comment">#成绩list</span></span><br><span class="line">      <span class="keyword">self</span>.grades = []</span><br><span class="line">      </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      req  = urllib2.Request(</span><br><span class="line">            url = <span class="keyword">self</span>.loginUrl,</span><br><span class="line">            data = <span class="keyword">self</span>.postdata)</span><br><span class="line">      result = <span class="keyword">self</span>.opener.open(req)</span><br><span class="line">      result = <span class="keyword">self</span>.opener.open(<span class="keyword">self</span>.gradeUrl)</span><br><span class="line">      <span class="comment">#返回本学期成绩页面</span></span><br><span class="line">      <span class="keyword">return</span> result.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">getGrades</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="comment">#获得本学期成绩页面</span></span><br><span class="line">      page = <span class="keyword">self</span>.getPage()</span><br><span class="line">      <span class="comment">#正则匹配</span></span><br><span class="line">      myItems = re.findall(<span class="string">'&lt;TR&gt;.*?&lt;p.*?&lt;p.*?&lt;p.*?&lt;p.*?&lt;p.*?&gt;(.*?)&lt;/p&gt;.*?&lt;p.*?&lt;p.*?&gt;(.*?)&lt;/p&gt;.*?&lt;/TR&gt;'</span>,page,re.S) </span><br><span class="line">      <span class="keyword">for</span> item <span class="keyword">in</span> <span class="symbol">myItems:</span></span><br><span class="line">         <span class="keyword">self</span>.credit.append(item[<span class="number">0</span>].encode(<span class="string">'gbk'</span>))</span><br><span class="line">         <span class="keyword">self</span>.grades.append(item[<span class="number">1</span>].encode(<span class="string">'gbk'</span>))</span><br><span class="line">      <span class="keyword">self</span>.getGrade()</span><br><span class="line">      </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">getGrade</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">      <span class="comment">#计算总绩点</span></span><br><span class="line">      sum = <span class="number">0</span>.<span class="number">0</span></span><br><span class="line">      weight = <span class="number">0</span>.<span class="number">0</span></span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> range(len(<span class="keyword">self</span>.credit))<span class="symbol">:</span></span><br><span class="line">         <span class="keyword">if</span>(<span class="keyword">self</span>.grades[i].isdigit())<span class="symbol">:</span></span><br><span class="line">            sum += string.atof(<span class="keyword">self</span>.credit[i])*string.atof(<span class="keyword">self</span>.grades[i])</span><br><span class="line">            weight += string.atof(<span class="keyword">self</span>.credit[i])</span><br><span class="line">      </span><br><span class="line">      print u<span class="string">"本学期绩点为:"</span>,sum/weight</span><br><span class="line">      </span><br><span class="line">sdu = SDU()</span><br><span class="line">sdu.getGrades()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，最后就会打印输出本学期绩点是多少，小伙伴们最主要的了解上面的编程思路就好。 最主要的内容就是Cookie的使用，模拟登录的功能。 本文思路参考来源：<a href="http://blog.csdn.net/pleasecallmewhy/article/details/9305229" target="_blank" rel="noopener">汪海的爬虫</a> 希望小伙伴们加油，加深一下理解。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-20 22:44:33" itemprop="dateCreated datePublished" datetime="2015-02-20T22:44:33+08:00">2015-02-20</time>
                </span>
                <span id="/997.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战七之计算大学本学期绩点" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/993.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/993.html" class="post-title-link" itemprop="url">Python爬虫实战二之爬取百度贴吧帖子</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，上次我们实验了爬取了糗事百科的段子，那么这次我们来尝试一下爬取百度贴吧的帖子。与上一篇不同的是，这次我们需要用到文件的相关操作。</p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>亲爱的们，教程比较旧了，百度贴吧页面可能改版，可能代码不好使，八成是正则表达式那儿匹配不到了，请更改一下正则，当然最主要的还是帮助大家理解思路。</p>
                  <p>2016/12/2</p>
                  <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
                  <p>1.对百度贴吧的任意帖子进行抓取 2.指定是否只抓取楼主发帖内容 3.将抓取到的内容分析并保存到文件</p>
                  <h2 id="1-URL格式的确定"><a href="#1-URL格式的确定" class="headerlink" title="1.URL格式的确定"></a>1.URL格式的确定</h2>
                  <p>首先，我们先观察一下百度贴吧的任意一个帖子。 比如：<a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1" target="_blank" rel="noopener">http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1</a>，这是一个关于NBA50大的盘点，分析一下这个地址。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http:<span class="comment">//  代表资源传输使用http协议</span></span><br><span class="line">tieba.baidu.com 是百度的二级域名，指向百度贴吧的服务器。</span><br><span class="line">/p/<span class="number">3138733512</span> 是服务器某个资源，即这个帖子的地址定位符</span><br><span class="line">see_lz和pn是该URL的两个参数，分别代表了只看楼主和帖子页码，等于<span class="number">1</span>表示该条件为真</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以我们可以把URL分为两部分，一部分为基础部分，一部分为参数部分。 例如，上面的URL我们划分基础部分是 <a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1" target="_blank" rel="noopener">http://tieba.baidu.com/p/3138733512</a>，参数部分是 <a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1" target="_blank" rel="noopener">?see_lz=1&amp;pn=1</a></p>
                  <h2 id="2-页面的抓取"><a href="#2-页面的抓取" class="headerlink" title="2.页面的抓取"></a>2.页面的抓取</h2>
                  <p>熟悉了URL的格式，那就让我们用urllib2库来试着抓取页面内容吧。上一篇糗事百科我们最后改成了面向对象的编码方式，这次我们直接尝试一下，定义一个类名叫BDTB(百度贴吧)，一个初始化方法，一个获取页面的方法。 其中，有些帖子我们想指定给程序是否要只看楼主，所以我们把只看楼主的参数初始化放在类的初始化上，即init方法。另外，获取页面的方法我们需要知道一个参数就是帖子页码，所以这个参数的指定我们放在该方法中。 综上，我们初步构建出基础代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#百度贴吧爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BDTB</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化，传入基地址，是否只看楼主的参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,baseUrl,seeLZ)</span>:</span></span><br><span class="line">        self.baseURL = baseUrl</span><br><span class="line">        self.seeLZ = <span class="string">'?see_lz='</span>+str(seeLZ)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传入页码，获取该页帖子的代码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(self,pageNum)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = self.baseURL+ self.seeLZ + <span class="string">'&amp;pn='</span> + str(pageNum)</span><br><span class="line">            request = urllib2.Request(url)</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">            <span class="keyword">print</span> response.read()</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"连接百度贴吧失败,错误原因"</span>,e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">baseURL = <span class="string">'http://tieba.baidu.com/p/3138733512'</span></span><br><span class="line">bdtb = BDTB(baseURL,<span class="number">1</span>)</span><br><span class="line">bdtb.getPage(<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行代码，我们可以看到屏幕上打印出了这个帖子第一页楼主发言的所有内容，形式为HTML代码。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219162232.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219162232.jpg" alt="20150219162232"></a></p>
                  <h2 id="3-提取相关信息"><a href="#3-提取相关信息" class="headerlink" title="3.提取相关信息"></a>3.提取相关信息</h2>
                  <h3 id="1）提取帖子标题"><a href="#1）提取帖子标题" class="headerlink" title="1）提取帖子标题"></a>1）提取帖子标题</h3>
                  <p>首先，让我们提取帖子的标题。 在浏览器中审查元素，或者按F12，查看页面源代码，我们找到标题所在的代码段，可以发现这个标题的HTML代码是</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;h1 <span class="attribute">class</span>=<span class="string">"core_title_txt  "</span> <span class="attribute">title</span>=<span class="string">"纯原创我心中的NBA2014-2015赛季现役50大"</span> <span class="attribute">style</span>=<span class="string">"width: 396px"</span>&gt;纯原创我心中的NBA2014-2015赛季现役50大&lt;/h1&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以我们想提取
                  <h1>标签中的内容，同时还要指定这个class确定唯一，因为h1标签实在太多啦。 正则表达式如下</p>
                    <figure class="highlight cpp">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">&lt;h1 <span class="class"><span class="keyword">class</span>="<span class="title">core_title_txt</span>.*?&gt;(.*?)&lt;/h1&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>所以，我们增加一个获取页面标题的方法</p>
                    <figure class="highlight routeros">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">#获取帖子标题</span></span><br><span class="line">def getTitle(self):</span><br><span class="line">   <span class="built_in"> page </span>= self.getPage(1)</span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span>,re.S)</span><br><span class="line">    result = re.search(pattern,page)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        #<span class="builtin-name">print</span> result.group(1)  #测试输出</span><br><span class="line">        return result.group(1).strip()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        return None</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <h3 id="2）提取帖子页数"><a href="#2）提取帖子页数" class="headerlink" title="2）提取帖子页数"></a>2）提取帖子页数</h3>
                    <p>同样地，帖子总页数我们也可以通过分析页面中的共?页来获取。所以我们的获取总页数的方法如下</p>
                    <figure class="highlight routeros">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">#获取帖子一共有多少页</span></span><br><span class="line">def getPageNum(self):</span><br><span class="line">   <span class="built_in"> page </span>= self.getPage(1)</span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">    result = re.search(pattern,page)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        #<span class="builtin-name">print</span> result.group(1)  #测试输出</span><br><span class="line">        return result.group(1).strip()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        return None</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <h3 id="3）提取正文内容"><a href="#3）提取正文内容" class="headerlink" title="3）提取正文内容"></a>3）提取正文内容</h3>
                    <p>审查元素，我们可以看到百度贴吧每一层楼的主要内容都在
                    <div id="post_content_xxxx"></div>标签里面，所以我们可以写如下的正则表达式</p>
                    <figure class="highlight applescript">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"post_content_.*?&gt;(.*?)&lt;/div&gt;</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>相应地，获取页面所有楼层数据的方法可以写成如下方法</p>
                    <figure class="highlight ruby">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">#获取每一层楼的内容,传入页面内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getContent</span><span class="params">(<span class="keyword">self</span>,page)</span></span><span class="symbol">:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,page)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="symbol">items:</span></span><br><span class="line">        print item</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>好，我们运行一下结果看一下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219235120.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219235120-e1424361136128.jpg" alt="20150219235120"></a> 真是醉了，还有一大片换行符和图片符，好口怕！既然这样，我们就要对这些文本进行处理，把各种各样复杂的标签给它剔除掉，还原精华内容，把文本处理写成一个方法也可以，不过为了实现更好的代码架构和代码重用，我们可以考虑把标签等的处理写作一个类。 那我们就叫它Tool（工具类吧），里面定义了一个方法，叫replace，是替换各种标签的。在类中定义了几个正则表达式，主要利用了re.sub方法对文本进行匹配后然后替换。具体的思路已经写到注释中，大家可以看一下这个类</p>
                    <figure class="highlight vbnet">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line">    <span class="meta">#去除img标签,7位长空格</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;7&#125;|')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把段落开头换为\n加空两格</span></span><br><span class="line">    replacePara = re.compile(<span class="comment">'<span class="doctag">&lt;p.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replacePara,<span class="string">"\n    "</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>在使用时，我们只需要初始化一下这个类，然后调用replace方法即可。 现在整体代码是如下这样子的，现在我的代码是写到这样子的</p>
                    <figure class="highlight ruby">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">__author_<span class="number">_</span> = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面标签类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tool</span>:</span></span><br><span class="line">    <span class="comment">#去除img标签,7位长空格</span></span><br><span class="line">    removeImg = re.compile(<span class="string">'&lt;img.*?&gt;| &#123;7&#125;|'</span>)</span><br><span class="line">    <span class="comment">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="string">'&lt;a.*?&gt;|&lt;/a&gt;'</span>)</span><br><span class="line">    <span class="comment">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="string">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span>)</span><br><span class="line">    <span class="comment">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="string">'&lt;td&gt;'</span>)</span><br><span class="line">    <span class="comment">#把段落开头换为\n加空两格</span></span><br><span class="line">    replacePara = re.compile(<span class="string">'&lt;p.*?&gt;'</span>)</span><br><span class="line">    <span class="comment">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="string">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span>)</span><br><span class="line">    <span class="comment">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="string">'&lt;.*?&gt;'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replace</span><span class="params">(<span class="keyword">self</span>,x)</span></span><span class="symbol">:</span></span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.replacePara,<span class="string">"\n    "</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.sub(<span class="keyword">self</span>.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        <span class="comment">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#百度贴吧爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BDTB</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化，传入基地址，是否只看楼主的参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>,baseUrl,seeLZ)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.baseURL = baseUrl</span><br><span class="line">        <span class="keyword">self</span>.seeLZ = <span class="string">'?see_lz='</span>+str(seeLZ)</span><br><span class="line">        <span class="keyword">self</span>.tool = Tool()</span><br><span class="line">    <span class="comment">#传入页码，获取该页帖子的代码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(<span class="keyword">self</span>,pageNum)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            url = <span class="keyword">self</span>.baseURL+ <span class="keyword">self</span>.seeLZ + <span class="string">'&amp;pn='</span> + str(pageNum)</span><br><span class="line">            request = urllib2.Request(url)</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">            <span class="keyword">return</span> response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        except urllib2.URLError, <span class="symbol">e:</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>)<span class="symbol">:</span></span><br><span class="line">                print u<span class="string">"连接百度贴吧失败,错误原因"</span>,e.reason</span><br><span class="line">                <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取帖子标题</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTitle</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        page = <span class="keyword">self</span>.getPage(<span class="number">1</span>)</span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">result:</span></span><br><span class="line">            <span class="comment">#print result.group(1)  #测试输出</span></span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">1</span>).strip()</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取帖子一共有多少页</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageNum</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        page = <span class="keyword">self</span>.getPage(<span class="number">1</span>)</span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">if</span> <span class="symbol">result:</span></span><br><span class="line">            <span class="comment">#print result.group(1)  #测试输出</span></span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">1</span>).strip()</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取每一层楼的内容,传入页面内容</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getContent</span><span class="params">(<span class="keyword">self</span>,page)</span></span><span class="symbol">:</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span>,re.S)</span><br><span class="line">        items = re.findall(pattern,page)</span><br><span class="line">        <span class="comment">#for item in items:</span></span><br><span class="line">        <span class="comment">#  print item</span></span><br><span class="line">        print <span class="keyword">self</span>.tool.replace(items[<span class="number">1</span>])</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">baseURL = <span class="string">'http://tieba.baidu.com/p/3138733512'</span></span><br><span class="line">bdtb = BDTB(baseURL,<span class="number">1</span>)</span><br><span class="line">bdtb.getContent(bdtb.getPage(<span class="number">1</span>))</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>我们尝试一下，重新再看一下效果，这下经过处理之后应该就没问题了，是不是感觉好酸爽！ <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000103.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000103.jpg" alt="20150220000103"></a></p>
                    <h3 id="4）替换楼层"><a href="#4）替换楼层" class="headerlink" title="4）替换楼层"></a>4）替换楼层</h3>
                    <p>至于这个问题，我感觉直接提取楼层没什么必要呀，因为只看楼主的话，有些楼层的编号是间隔的，所以我们得到的楼层序号是不连续的，这样我们保存下来也没什么用。 所以可以尝试下面的方法：</p>
                    <blockquote>
                      <p>1.每打印输出一段楼层，写入一行横线来间隔，或者换行符也好。 2.试着重新编一个楼层，按照顺序，设置一个变量，每打印出一个结果变量加一，打印出这个变量当做楼层。</p>
                    </blockquote>
                    <p>这里我们尝试一下吧，看看效果怎样 把getContent方法修改如下</p>
                    <figure class="highlight python">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line"><span class="comment">#获取每一层楼的内容,传入页面内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getContent</span><span class="params">(self,page)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,page)</span><br><span class="line">    floor = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">print</span> floor,<span class="string">u"楼------------------------------------------------------------------------------------------------------------------------------------\n"</span></span><br><span class="line">        <span class="keyword">print</span> self.tool.replace(item)</span><br><span class="line">        floor += <span class="number">1</span></span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>运行一下看看效果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000947.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000947.jpg" alt="20150220000947"></a> 嘿嘿，效果还不错吧，感觉真酸爽！接下来我们完善一下，然后写入文件</p>
                    <h2 id="4-写入文件"><a href="#4-写入文件" class="headerlink" title="4.写入文件"></a>4.写入文件</h2>
                    <p>最后便是写入文件的过程，过程很简单，就几句话的代码而已，主要是利用了以下两句</p>
                    <blockquote>
                      <p>file = open(“tb.txt”,”w”) file.writelines(obj)</p>
                    </blockquote>
                    <p>这里不再赘述，稍后直接贴上完善之后的代码。</p>
                    <h2 id="5-完善代码"><a href="#5-完善代码" class="headerlink" title="5.完善代码"></a>5.完善代码</h2>
                    <p>现在我们对代码进行优化，重构，在一些地方添加必要的打印信息，整理如下</p>
                    <figure class="highlight python">
                      <table>
                        <tr>
                          <td class="gutter">
                            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre>
                          </td>
                          <td class="code">
                            <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面标签类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tool</span>:</span></span><br><span class="line">    <span class="comment">#去除img标签,7位长空格</span></span><br><span class="line">    removeImg = re.compile(<span class="string">'&lt;img.*?&gt;| &#123;7&#125;|'</span>)</span><br><span class="line">    <span class="comment">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="string">'&lt;a.*?&gt;|&lt;/a&gt;'</span>)</span><br><span class="line">    <span class="comment">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="string">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span>)</span><br><span class="line">    <span class="comment">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="string">'&lt;td&gt;'</span>)</span><br><span class="line">    <span class="comment">#把段落开头换为\n加空两格</span></span><br><span class="line">    replacePara = re.compile(<span class="string">'&lt;p.*?&gt;'</span>)</span><br><span class="line">    <span class="comment">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="string">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span>)</span><br><span class="line">    <span class="comment">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="string">'&lt;.*?&gt;'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replace</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x = re.sub(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.sub(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.sub(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.sub(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.sub(self.replacePara,<span class="string">"\n    "</span>,x)</span><br><span class="line">        x = re.sub(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.sub(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        <span class="comment">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#百度贴吧爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BDTB</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化，传入基地址，是否只看楼主的参数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,baseUrl,seeLZ,floorTag)</span>:</span></span><br><span class="line">        <span class="comment">#base链接地址</span></span><br><span class="line">        self.baseURL = baseUrl</span><br><span class="line">        <span class="comment">#是否只看楼主</span></span><br><span class="line">        self.seeLZ = <span class="string">'?see_lz='</span>+str(seeLZ)</span><br><span class="line">        <span class="comment">#HTML标签剔除工具类对象</span></span><br><span class="line">        self.tool = Tool()</span><br><span class="line">        <span class="comment">#全局file变量，文件写入操作对象</span></span><br><span class="line">        self.file = <span class="literal">None</span></span><br><span class="line">        <span class="comment">#楼层标号，初始为1</span></span><br><span class="line">        self.floor = <span class="number">1</span></span><br><span class="line">        <span class="comment">#默认的标题，如果没有成功获取到标题的话则会用这个标题</span></span><br><span class="line">        self.defaultTitle = <span class="string">u"百度贴吧"</span></span><br><span class="line">        <span class="comment">#是否写入楼分隔符的标记</span></span><br><span class="line">        self.floorTag = floorTag</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传入页码，获取该页帖子的代码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(self,pageNum)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#构建URL</span></span><br><span class="line">            url = self.baseURL+ self.seeLZ + <span class="string">'&amp;pn='</span> + str(pageNum)</span><br><span class="line">            request = urllib2.Request(url)</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">            <span class="comment">#返回UTF-8格式编码内容</span></span><br><span class="line">            <span class="keyword">return</span> response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="comment">#无法连接，报错</span></span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"连接百度贴吧失败,错误原因"</span>,e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取帖子标题</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTitle</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#得到标题的正则表达式</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="comment">#如果存在，则返回标题</span></span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">1</span>).strip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取帖子一共有多少页</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageNum</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#获取帖子页数的正则表达式</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">        result = re.search(pattern,page)</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">1</span>).strip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取每一层楼的内容,传入页面内容</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getContent</span><span class="params">(self,page)</span>:</span></span><br><span class="line">        <span class="comment">#匹配所有楼层的内容</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span>,re.S)</span><br><span class="line">        items = re.findall(pattern,page)</span><br><span class="line">        contents = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            <span class="comment">#将文本进行去除标签处理，同时在前后加入换行符</span></span><br><span class="line">            content = <span class="string">"\n"</span>+self.tool.replace(item)+<span class="string">"\n"</span></span><br><span class="line">            contents.append(content.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">        <span class="keyword">return</span> contents</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setFileTitle</span><span class="params">(self,title)</span>:</span></span><br><span class="line">        <span class="comment">#如果标题不是为None，即成功获取到标题</span></span><br><span class="line">        <span class="keyword">if</span> title <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.file = open(title + <span class="string">".txt"</span>,<span class="string">"w+"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.file = open(self.defaultTitle + <span class="string">".txt"</span>,<span class="string">"w+"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writeData</span><span class="params">(self,contents)</span>:</span></span><br><span class="line">        <span class="comment">#向文件写入每一楼的信息</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> contents:</span><br><span class="line">            <span class="keyword">if</span> self.floorTag == <span class="string">'1'</span>:</span><br><span class="line">                <span class="comment">#楼之间的分隔符</span></span><br><span class="line">                floorLine = <span class="string">"\n"</span> + str(self.floor) + <span class="string">u"-----------------------------------------------------------------------------------------\n"</span></span><br><span class="line">                self.file.write(floorLine)</span><br><span class="line">            self.file.write(item)</span><br><span class="line">            self.floor += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        indexPage = self.getPage(<span class="number">1</span>)</span><br><span class="line">        pageNum = self.getPageNum(indexPage)</span><br><span class="line">        title = self.getTitle(indexPage)</span><br><span class="line">        self.setFileTitle(title)</span><br><span class="line">        <span class="keyword">if</span> pageNum == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"URL已失效，请重试"</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"该帖子共有"</span> + str(pageNum) + <span class="string">"页"</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,int(pageNum)+<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"正在写入第"</span> + str(i) + <span class="string">"页数据"</span></span><br><span class="line">                page = self.getPage(i)</span><br><span class="line">                contents = self.getContent(page)</span><br><span class="line">                self.writeData(contents)</span><br><span class="line">        <span class="comment">#出现写入异常</span></span><br><span class="line">        <span class="keyword">except</span> IOError,e:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"写入异常，原因"</span> + e.message</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"写入任务完成"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">u"请输入帖子代号"</span></span><br><span class="line">baseURL = <span class="string">'http://tieba.baidu.com/p/'</span> + str(raw_input(<span class="string">u'http://tieba.baidu.com/p/'</span>))</span><br><span class="line">seeLZ = raw_input(<span class="string">"是否只获取楼主发言，是输入1，否输入0\n"</span>)</span><br><span class="line">floorTag = raw_input(<span class="string">"是否写入楼层信息，是输入1，否输入0\n"</span>)</span><br><span class="line">bdtb = BDTB(baseURL,seeLZ,floorTag)</span><br><span class="line">bdtb.start()</span><br></pre>
                          </td>
                        </tr>
                      </table>
                    </figure>
                    <p>现在程序演示如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220012351.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220012351.jpg" alt="20150220012351"></a> 完成之后，可以查看一下当前目录下多了一个以该帖子命名的txt文件，内容便是帖子的所有数据。 抓贴吧，就是这么简单和任性！</p>
                    </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-17 01:09:52" itemprop="dateCreated datePublished" datetime="2015-02-17T01:09:52+08:00">2015-02-17</time>
                </span>
                <span id="/993.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战二之爬取百度贴吧帖子" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/990.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/990.html" class="post-title-link" itemprop="url">Python爬虫实战一之爬取糗事百科段子</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，前面入门已经说了那么多基础知识了，下面我们做几个实战项目来挑战一下吧。那么这次为大家带来，Python爬取糗事百科的小段子的例子。 首先，糗事百科大家都听说过吧？糗友们发的搞笑的段子一抓一大把，这次我们尝试一下用爬虫把他们抓取下来。</p>
                  <h2 id="友情提示"><a href="#友情提示" class="headerlink" title="友情提示"></a>友情提示</h2>
                  <blockquote>
                    <p>糗事百科在前一段时间进行了改版，导致之前的代码没法用了，会导致无法输出和CPU占用过高的情况，是因为正则表达式没有匹配到的缘故。 现在，博主已经对程序进行了重新修改，代码亲测可用，包括截图和说明，之前一直在忙所以没有及时更新，望大家海涵！ 更新时间：2015/8/2</p>
                    <p>糗事百科又又又又改版了，博主已经没心再去一次次匹配它了，如果大家遇到长时间运行不出结果也不报错的情况，请大家参考最新的评论，热心小伙伴提供的正则来修改下吧～ 更新时间：2016/3/27</p>
                  </blockquote>
                  <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
                  <blockquote>
                    <p>1.抓取糗事百科热门段子 2.过滤带有图片的段子 3.实现每按一次回车显示一个段子的发布时间，发布人，段子内容，点赞数。</p>
                  </blockquote>
                  <p>糗事百科是不需要登录的，所以也没必要用到Cookie，另外糗事百科有的段子是附图的，我们把图抓下来图片不便于显示，那么我们就尝试过滤掉有图的段子吧。 好，现在我们尝试抓取一下糗事百科的热门段子吧，每按下一次回车我们显示一个段子。</p>
                  <h2 id="1-确定URL并抓取页面代码"><a href="#1-确定URL并抓取页面代码" class="headerlink" title="1.确定URL并抓取页面代码"></a>1.确定URL并抓取页面代码</h2>
                  <p>首先我们确定好页面的URL是 <a href="http://www.qiushibaike.com/hot/page/1，其中最后一个数字1代表页数，我们可以传入不同的值来获得某一页的段子内容。" target="_blank" rel="noopener">http://www.qiushibaike.com/hot/page/1，其中最后一个数字1代表页数，我们可以传入不同的值来获得某一页的段子内容。</a> 我们初步构建如下的代码来打印页面代码内容试试看，先构造最基本的页面抓取方式，看看会不会成功</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">page = 1</span><br><span class="line">url = <span class="string">'http://www.qiushibaike.com/hot/page/'</span> + str(page)</span><br><span class="line">try:</span><br><span class="line">    request = urllib2.Request(url)</span><br><span class="line">    response = urllib2.urlopen(request)</span><br><span class="line">    <span class="builtin-name">print</span> response.read()</span><br><span class="line">except urllib2.URLError, e:</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"code"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.code</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.reason</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行程序，哦不，它竟然报错了，真是时运不济，命途多舛啊</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">line</span> <span class="number">373</span>, <span class="keyword">in</span> _read_status</span><br><span class="line"> <span class="keyword">raise</span> BadStatusLine(<span class="type">line</span>)</span><br><span class="line">httplib.BadStatusLine: <span class="string">''</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好吧，应该是headers验证的问题，我们加上一个headers验证试试看吧，将代码修改如下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">page = 1</span><br><span class="line">url = <span class="string">'http://www.qiushibaike.com/hot/page/'</span> + str(page)</span><br><span class="line">user_agent = <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span></span><br><span class="line">headers = &#123; <span class="string">'User-Agent'</span> : user_agent &#125;</span><br><span class="line">try:</span><br><span class="line">    request = urllib2.Request(url,headers = headers)</span><br><span class="line">    response = urllib2.urlopen(request)</span><br><span class="line">    <span class="builtin-name">print</span> response.read()</span><br><span class="line">except urllib2.URLError, e:</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"code"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.code</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.reason</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嘿嘿，这次运行终于正常了，打印出了第一页的HTML代码，大家可以运行下代码试试看。在这里运行结果太长就不贴了。</p>
                  <h2 id="2-提取某一页的所有段子"><a href="#2-提取某一页的所有段子" class="headerlink" title="2.提取某一页的所有段子"></a>2.提取某一页的所有段子</h2>
                  <p>好，获取了HTML代码之后，我们开始分析怎样获取某一页的所有段子。 首先我们审查元素看一下，按浏览器的F12，截图如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150802154147.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150802154147.jpg" alt="20150802154147"></a> 我们可以看到，每一个段子都是
                  <div class="article block untagged mb15" id="...">...</div>包裹的内容。 现在我们想获取发布人，发布日期，段子内容，以及点赞的个数。不过另外注意的是，段子有些是带图片的，如果我们想在控制台显示图片是不现实的，所以我们直接把带有图片的段子给它剔除掉，只保存仅含文本的段子。 所以我们加入如下正则表达式来匹配一下，用到的方法是 re.findall 是找寻所有匹配的内容。方法的用法详情可以看前面说的正则表达式的介绍。 好，我们的正则表达式匹配语句书写如下，在原来的基础上追加如下代码</p>
                  <figure class="highlight django">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="xml">content = response.read().decode('utf-8')</span></span><br><span class="line"><span class="xml">pattern = re.compile('<span class="tag">&lt;<span class="name">div.*?author"</span>&gt;</span>.*?<span class="tag">&lt;<span class="name">a.*?</span>&lt;<span class="attr">img.</span>*?&gt;</span>(.*?)<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.*?<span class="tag">&lt;<span class="name">div.*?'+</span></span></span></span><br><span class="line"><span class="xml">                         'content"&gt;(.*?)<span class="comment">&lt;!--(.*?)--&gt;</span>.*?<span class="tag">&lt;/<span class="name">div</span>&gt;</span>(.*?)<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"stats.*?class="</span><span class="attr">number</span>"&gt;</span>(.*?)<span class="tag">&lt;/<span class="name">i</span>&gt;</span>',re.S)</span></span><br><span class="line"><span class="xml">items = re.findall(pattern,content)</span></span><br><span class="line"><span class="xml">for item in items:</span></span><br><span class="line"><span class="xml">    print item[0],item[1],item[2],item[3],item[4]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在正则表达式在这里稍作说明 1）.<em>? 是一个固定的搭配，.和</em>代表可以匹配任意无限多个字符，加上？表示使用非贪婪模式进行匹配，也就是我们会尽可能短地做匹配，以后我们还会大量用到 .<em>? 的搭配。 2）(.</em>?)代表一个分组，在这个正则表达式中我们匹配了五个分组，在后面的遍历item中，item[0]就代表第一个(.<em>?)所指代的内容，item[1]就代表第二个(.</em>?)所指代的内容，以此类推。 3）re.S 标志代表在匹配时为点任意匹配模式，点 . 也可以代表换行符。 这样我们就获取了发布人，发布时间，发布内容，附加图片以及点赞数。 在这里注意一下，我们要获取的内容如果是带有图片，直接输出出来比较繁琐，所以这里我们只获取不带图片的段子就好了。 所以，在这里我们就需要对带图片的段子进行过滤。 我们可以发现，带有图片的段子会带有类似下面的代码，而不带图片的则没有，所以，我们的正则表达式的item[3]就是获取了下面的内容，如果不带图片，item[3]获取的内容便是空。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"thumb"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;a href=<span class="string">"/article/112061287?list=hot&amp;amp;s=4794990"</span> target=<span class="string">"_blank"</span>&gt;</span><br><span class="line">&lt;img src=<span class="string">"http://pic.qiushibaike.com/system/pictures/11206/112061287/medium/app112061287.jpg"</span> alt=<span class="string">"但他们依然乐观"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以我们只需要判断item[3]中是否含有img标签就可以了。 好，我们再把上述代码中的for循环改为下面的样子</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">for</span> <span class="keyword">item</span> <span class="keyword">in</span> <span class="keyword">items</span>:</span><br><span class="line">        haveImg = re.search(<span class="string">"img"</span>,<span class="keyword">item</span>[<span class="number">3</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> haveImg:</span><br><span class="line">            print <span class="keyword">item</span>[<span class="number">0</span>],<span class="keyword">item</span>[<span class="number">1</span>],<span class="keyword">item</span>[<span class="number">2</span>],<span class="keyword">item</span>[<span class="number">4</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在，整体的代码如下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">page = 1</span><br><span class="line">url = <span class="string">'http://www.qiushibaike.com/hot/page/'</span> + str(page)</span><br><span class="line">user_agent = <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span></span><br><span class="line">headers = &#123; <span class="string">'User-Agent'</span> : user_agent &#125;</span><br><span class="line">try:</span><br><span class="line">    request = urllib2.Request(url,headers = headers)</span><br><span class="line">    response = urllib2.urlopen(request)</span><br><span class="line">    content = response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;div.*?author"&gt;.*?&lt;a.*?&lt;img.*?&gt;(.*?)&lt;/a&gt;.*?&lt;div.*?'</span>+</span><br><span class="line">                         <span class="string">'content"&gt;(.*?)&lt;!--(.*?)--&gt;.*?&lt;/div&gt;(.*?)&lt;div class="stats.*?class="number"&gt;(.*?)&lt;/i&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,content)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        haveImg = re.search(<span class="string">"img"</span>,item[3])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> haveImg:</span><br><span class="line">            <span class="builtin-name">print</span> item[0],item[1],item[2],item[4]</span><br><span class="line">except urllib2.URLError, e:</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"code"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.code</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">        <span class="builtin-name">print</span> e.reason</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行一下看下效果 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150802154832.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150802154832.jpg" alt="20150802154832"></a> 恩，带有图片的段子已经被剔除啦。是不是很开森？</p>
                  <h2 id="3-完善交互，设计面向对象模式"><a href="#3-完善交互，设计面向对象模式" class="headerlink" title="3.完善交互，设计面向对象模式"></a>3.完善交互，设计面向对象模式</h2>
                  <p>好啦，现在最核心的部分我们已经完成啦，剩下的就是修一下边边角角的东西，我们想达到的目的是： 按下回车，读取一个段子，显示出段子的发布人，发布日期，内容以及点赞个数。 另外我们需要设计面向对象模式，引入类和方法，将代码做一下优化和封装，最后，我们的代码如下所示</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">#糗事百科爬虫类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QSBK</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化方法，定义一些变量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.pageIndex = <span class="number">1</span></span><br><span class="line">        self.user_agent = <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span></span><br><span class="line">        <span class="comment">#初始化headers</span></span><br><span class="line">        self.headers = &#123; <span class="string">'User-Agent'</span> : self.user_agent &#125;</span><br><span class="line">        <span class="comment">#存放段子的变量，每一个元素是每一页的段子们</span></span><br><span class="line">        self.stories = []</span><br><span class="line">        <span class="comment">#存放程序是否继续运行的变量</span></span><br><span class="line">        self.enable = <span class="literal">False</span></span><br><span class="line">    <span class="comment">#传入某一页的索引获得页面代码</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPage</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url = <span class="string">'http://www.qiushibaike.com/hot/page/'</span> + str(pageIndex)</span><br><span class="line">            <span class="comment">#构建请求的request</span></span><br><span class="line">            request = urllib2.Request(url,headers = self.headers)</span><br><span class="line">            <span class="comment">#利用urlopen获取页面代码</span></span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">            <span class="comment">#将页面转化为UTF-8编码</span></span><br><span class="line">            pageCode = response.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">return</span> pageCode</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> <span class="string">u"连接糗事百科失败,错误原因"</span>,e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#传入某一页代码，返回本页不带图片的段子列表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageItems</span><span class="params">(self,pageIndex)</span>:</span></span><br><span class="line">        pageCode = self.getPage(pageIndex)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pageCode:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"页面加载失败...."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        pattern = re.compile(<span class="string">'&lt;div.*?author"&gt;.*?&lt;a.*?&lt;img.*?&gt;(.*?)&lt;/a&gt;.*?&lt;div.*?'</span>+</span><br><span class="line">                         <span class="string">'content"&gt;(.*?)&lt;!--(.*?)--&gt;.*?&lt;/div&gt;(.*?)&lt;div class="stats.*?class="number"&gt;(.*?)&lt;/i&gt;'</span>,re.S)</span><br><span class="line">        items = re.findall(pattern,pageCode)</span><br><span class="line">        <span class="comment">#用来存储每页的段子们</span></span><br><span class="line">        pageStories = []</span><br><span class="line">        <span class="comment">#遍历正则表达式匹配的信息</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            <span class="comment">#是否含有图片</span></span><br><span class="line">            haveImg = re.search(<span class="string">"img"</span>,item[<span class="number">3</span>])</span><br><span class="line">            <span class="comment">#如果不含有图片，把它加入list中</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> haveImg:</span><br><span class="line">                replaceBR = re.compile(<span class="string">'&lt;br/&gt;'</span>)</span><br><span class="line">                text = re.sub(replaceBR,<span class="string">"\n"</span>,item[<span class="number">1</span>])</span><br><span class="line">                <span class="comment">#item[0]是一个段子的发布者，item[1]是内容，item[2]是发布时间,item[4]是点赞数</span></span><br><span class="line">                pageStories.append([item[<span class="number">0</span>].strip(),text.strip(),item[<span class="number">2</span>].strip(),item[<span class="number">4</span>].strip()])</span><br><span class="line">        <span class="keyword">return</span> pageStories</span><br><span class="line"></span><br><span class="line">    <span class="comment">#加载并提取页面的内容，加入到列表中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadPage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#如果当前未看的页数少于2页，则加载新一页</span></span><br><span class="line">        <span class="keyword">if</span> self.enable == <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> len(self.stories) &lt; <span class="number">2</span>:</span><br><span class="line">                <span class="comment">#获取新一页</span></span><br><span class="line">                pageStories = self.getPageItems(self.pageIndex)</span><br><span class="line">                <span class="comment">#将该页的段子存放到全局list中</span></span><br><span class="line">                <span class="keyword">if</span> pageStories:</span><br><span class="line">                    self.stories.append(pageStories)</span><br><span class="line">                    <span class="comment">#获取完之后页码索引加一，表示下次读取下一页</span></span><br><span class="line">                    self.pageIndex += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#调用该方法，每次敲回车打印输出一个段子</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getOneStory</span><span class="params">(self,pageStories,page)</span>:</span></span><br><span class="line">        <span class="comment">#遍历一页的段子</span></span><br><span class="line">        <span class="keyword">for</span> story <span class="keyword">in</span> pageStories:</span><br><span class="line">            <span class="comment">#等待用户输入</span></span><br><span class="line">            input = raw_input()</span><br><span class="line">            <span class="comment">#每当输入回车一次，判断一下是否要加载新页面</span></span><br><span class="line">            self.loadPage()</span><br><span class="line">            <span class="comment">#如果输入Q则程序结束</span></span><br><span class="line">            <span class="keyword">if</span> input == <span class="string">"Q"</span>:</span><br><span class="line">                self.enable = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">u"第%d页\t发布人:%s\t发布时间:%s\t赞:%s\n%s"</span> %(page,story[<span class="number">0</span>],story[<span class="number">2</span>],story[<span class="number">3</span>],story[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#开始方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">u"正在读取糗事百科,按回车查看新段子，Q退出"</span></span><br><span class="line">        <span class="comment">#使变量为True，程序可以正常运行</span></span><br><span class="line">        self.enable = <span class="literal">True</span></span><br><span class="line">        <span class="comment">#先加载一页内容</span></span><br><span class="line">        self.loadPage()</span><br><span class="line">        <span class="comment">#局部变量，控制当前读到了第几页</span></span><br><span class="line">        nowPage = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> self.enable:</span><br><span class="line">            <span class="keyword">if</span> len(self.stories)&gt;<span class="number">0</span>:</span><br><span class="line">                <span class="comment">#从全局list中获取一页的段子</span></span><br><span class="line">                pageStories = self.stories[<span class="number">0</span>]</span><br><span class="line">                <span class="comment">#当前读到的页数加一</span></span><br><span class="line">                nowPage += <span class="number">1</span></span><br><span class="line">                <span class="comment">#将全局list中第一个元素删除，因为已经取出</span></span><br><span class="line">                <span class="keyword">del</span> self.stories[<span class="number">0</span>]</span><br><span class="line">                <span class="comment">#输出该页的段子</span></span><br><span class="line">                self.getOneStory(pageStories,nowPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">spider = QSBK()</span><br><span class="line">spider.start()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好啦，大家来测试一下吧，点一下回车会输出一个段子，包括发布人，发布时间，段子内容以及点赞数，是不是感觉爽爆了！ 我们第一个爬虫实战项目介绍到这里，欢迎大家继续关注，小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-17 01:07:54" itemprop="dateCreated datePublished" datetime="2015-02-17T01:07:54+08:00">2015-02-17</time>
                </span>
                <span id="/990.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战一之爬取糗事百科段子" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/912.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/912.html" class="post-title-link" itemprop="url">Python爬虫进阶三之Scrapy框架安装配置</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>初级的爬虫我们利用urllib和urllib2库以及正则表达式就可以完成了，不过还有更加强大的工具，爬虫框架Scrapy，这安装过程也是煞费苦心哪，在此整理如下。</p>
                  <h2 id="Windows-平台："><a href="#Windows-平台：" class="headerlink" title="Windows 平台："></a>Windows 平台：</h2>
                  <p>我的系统是 Win7，首先，你要有Python，我用的是2.7.7版本，Python3相仿，只是一些源文件不同。 官网文档：<a href="http://doc.scrapy.org/en/latest/intro/install.html" target="_blank" rel="noopener">http://doc.scrapy.org/en/latest/intro/install.html</a>，最权威哒，下面是我的亲身体验过程。 1.安装Python 安装过程我就不多说啦，我的电脑中已经安装了 Python 2.7.7 版本啦，安装完之后记得配置环境变量，比如我的安装在D盘，D:\python2.7.7，就把以下两个路径添加到Path变量中</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">D:\python2<span class="number">.7</span><span class="number">.7</span>;D:\python2<span class="number">.7</span><span class="number">.7</span>\Scripts</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置好了之后，在命令行中输入 python —version，如果没有提示错误，则安装成功 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171953.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171953.jpg" alt="QQ截图20150211171953"></a> 2.安装pywin32 在windows下，必须安装pywin32，安装地址：<a href="http://sourceforge.net/projects/pywin32/" target="_blank" rel="noopener">http://sourceforge.net/projects/pywin32/</a> 下载对应版本的pywin32，直接双击安装即可，安装完毕之后验证： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171713.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171713.jpg" alt="QQ截图20150211171713"></a> 在python命令行下输入 import win32com 如果没有提示错误，则证明安装成功 3.安装pip pip是用来安装其他必要包的工具，首先下载 <a href="https://bootstrap.pypa.io/get-pip.py" target="_blank" rel="noopener">get-pip.py</a> 下载好之后，选中该文件所在路径，执行下面的命令</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> <span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行命令后便会安装好pip，并且同时，它帮你安装了<a href="https://pypi.python.org/pypi/setuptools" target="_blank" rel="noopener">setuptools</a> 安装完了之后在命令行中执行</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="comment">--version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果提示如下，说明就安装成功了，如果提示不是内部或外部命令，那么就检查一下环境变量有没有配置好吧，有两个路径。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171001.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211171001.jpg" alt="QQ截图20150211171001"></a> 4.安装pyOPENSSL 在Windows下，是没有预装pyOPENSSL的，而在Linux下是已经安装好的。 安装地址：<a href="https://launchpad.net/pyopenssl" target="_blank" rel="noopener">https://launchpad.net/pyopenssl</a> 5.安装 lxml lxml的详细介绍 <a href="http://lxml.de/" target="_blank" rel="noopener">点我</a> ，是一种使用 Python 编写的库，可以迅速、灵活地处理 XML 直接执行如下命令</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就可完成安装，如果提示 Microsoft Visual C++库没安装，则 <a href="http://www.microsoft.com/en-us/download/details.aspx?id=44266" target="_blank" rel="noopener">点我</a> 下载支持的库。 6.安装Scrapy 最后就是激动人心的时刻啦，上面的铺垫做好了，我们终于可以享受到胜利的果实啦！ 执行如下命令</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> Scrapy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211172637.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211172637.jpg" alt="QQ截图20150211172637"></a> pip 会另外下载其他依赖的包，这些就不要我们手动安装啦，等待一会，大功告成！ 7.验证安装 输入 Scrapy 如果提示如下命令，就证明安装成功啦，如果失败了，请检查上述步骤有何疏漏。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211172456.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150211172456-e1423673746697.jpg" alt="QQ截图20150211172456"></a></p>
                  <h2 id="Linux-Ubuntu-平台："><a href="#Linux-Ubuntu-平台：" class="headerlink" title="Linux Ubuntu 平台："></a>Linux Ubuntu 平台：</h2>
                  <p>Linux 下安装非常简单，只需要执行几条命令几个 1.安装Python</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> install python2<span class="number">.7</span> python2<span class="number">.7</span>-dev</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>2.安装 pip 首先下载 <a href="https://bootstrap.pypa.io/get-pip.py" target="_blank" rel="noopener">get-pip.py</a> 下载好之后，选中该文件所在路径，执行下面的命令</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">python</span> <span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>3.直接安装 Scrapy 由于 Linux下已经预装了 lxml 和 OPENSSL 如果想验证 lxml ，可以分别输入</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo pip <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>出现下面的提示这证明已经安装成功</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Requirement already satisfied (use --upgrade to upgrade): lxml in /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">python2</span>.7/<span class="title">dist</span>-<span class="title">packages</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想验证 openssl，则直接输入openssl 即可，如果跳转到 OPENSSL 命令行，则安装成功。 接下来直接安装 Scrapy 即可</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo pip <span class="keyword">install</span> Scrapy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完毕之后，输入 scrapy 注意，这里linux下不要输入Scrapy，linux依然严格区分大小写的，感谢kamen童鞋提醒。 如果出现如下提示，这证明安装成功</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Usage:</span><br><span class="line"> scrapy &lt;command&gt; [options] [args]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line"> bench <span class="builtin-name">Run</span> quick benchmark test</span><br><span class="line"> fetch Fetch a URL using the Scrapy downloader</span><br><span class="line"> runspider <span class="builtin-name">Run</span> a self-contained spider (without creating a project)</span><br><span class="line"><span class="built_in"> settings </span><span class="builtin-name">Get</span><span class="built_in"> settings </span>values</span><br><span class="line"> shell Interactive scraping console</span><br><span class="line"> startproject Create new project</span><br><span class="line"> version <span class="builtin-name">Print</span> Scrapy version</span><br><span class="line"> view Open URL <span class="keyword">in</span> browser, as seen by Scrapy</span><br><span class="line"></span><br><span class="line"> [ more ] More commands available when <span class="builtin-name">run</span> <span class="keyword">from</span> project directory</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>截图如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-12-010022-的屏幕截图.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-12-010022-的屏幕截图.png" alt="2015-02-12 01:00:22 的屏幕截图"></a> 如有问题，欢迎留言！祝各位小伙伴顺利安装！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-17 01:02:41" itemprop="dateCreated datePublished" datetime="2015-02-17T01:02:41+08:00">2015-02-17</time>
                </span>
                <span id="/912.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫进阶三之Scrapy框架安装配置" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/977.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/977.html" class="post-title-link" itemprop="url">Python爬虫入门七之正则表达式</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在前面我们已经搞定了怎样获取页面的内容，不过还差一步，这么多杂乱的代码夹杂文字我们怎样把它提取出来整理呢？下面就开始介绍一个十分强大的工具，正则表达式！</p>
                  <h2 id="1-了解正则表达式"><a href="#1-了解正则表达式" class="headerlink" title="1.了解正则表达式"></a>1.了解正则表达式</h2>
                  <blockquote>
                    <p>正则表达式是对字符串操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。</p>
                  </blockquote>
                  <p>正则表达式是用来匹配字符串非常强大的工具，在其他编程语言中同样有正则表达式的概念，Python同样不例外，利用了正则表达式，我们想要从返回的页面内容提取出我们想要的内容就易如反掌了。</p>
                  <blockquote>
                    <p>正则表达式的大致匹配过程是： 1.依次拿出表达式和文本中的字符比较， 2.如果每一个字符都能匹配，则匹配成功；一旦有匹配不成功的字符则匹配失败。 3.如果表达式中有量词或边界，这个过程会稍微有一些不同。</p>
                  </blockquote>
                  <h2 id="2-正则表达式的语法规则"><a href="#2-正则表达式的语法规则" class="headerlink" title="2.正则表达式的语法规则"></a>2.正则表达式的语法规则</h2>
                  <p>下面是Python中正则表达式的一些匹配规则，图片资料来自CSDN <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20130515113723855.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20130515113723855-e1424095177180.png" alt="20130515113723855"></a></p>
                  <h2 id="3-正则表达式相关注解"><a href="#3-正则表达式相关注解" class="headerlink" title="3.正则表达式相关注解"></a>3.正则表达式相关注解</h2>
                  <h3 id="（1）数量词的贪婪模式与非贪婪模式"><a href="#（1）数量词的贪婪模式与非贪婪模式" class="headerlink" title="（1）数量词的贪婪模式与非贪婪模式"></a>（1）数量词的贪婪模式与非贪婪模式</h3>
                  <p>正则表达式通常用于在文本中查找匹配的字符串。Python里数量词默认是贪婪的（在少数语言里也可能是默认非贪婪），总是尝试匹配尽可能多的字符；非贪婪的则相反，总是尝试匹配尽可能少的字符。例如：正则表达式”ab<em>“如果用于查找”abbbc”，将找到”abbb”。而如果使用非贪婪的数量词”ab</em>?”，将找到”a”。 注：我们一般使用非贪婪模式来提取。</p>
                  <h3 id="（2）反斜杠问题"><a href="#（2）反斜杠问题" class="headerlink" title="（2）反斜杠问题"></a>（2）反斜杠问题</h3>
                  <p>与大多数编程语言相同，正则表达式里使用”\“作为转义字符，这就可能造成反斜杠困扰。假如你需要匹配文本中的字符”\“，那么使用编程语言表示的正则表达式里将需要4个反斜杠”\\\\“：前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。 Python里的原生字符串很好地解决了这个问题，这个例子中的正则表达式可以使用r”\\“表示。同样，匹配一个数字的”\\d”可以写成r”\d”。有了原生字符串，妈妈也不用担心是不是漏写了反斜杠，写出来的表达式也更直观勒。</p>
                  <h2 id="4-Python-Re模块"><a href="#4-Python-Re模块" class="headerlink" title="4.Python Re模块"></a>4.Python Re模块</h2>
                  <p>Python 自带了re模块，它提供了对正则表达式的支持。主要用到的方法列举如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#返回<span class="selector-tag">pattern</span>对象</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.compile</span>(<span class="selector-tag">string</span><span class="selector-attr">[,flag]</span>)  </span><br><span class="line">#以下为匹配所用函数</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.match</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">string</span><span class="selector-attr">[, flags]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.search</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">string</span><span class="selector-attr">[, flags]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.split</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">string</span><span class="selector-attr">[, maxsplit]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.findall</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">string</span><span class="selector-attr">[, flags]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.finditer</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">string</span><span class="selector-attr">[, flags]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.sub</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">repl</span>, <span class="selector-tag">string</span><span class="selector-attr">[, count]</span>)</span><br><span class="line"><span class="selector-tag">re</span><span class="selector-class">.subn</span>(<span class="selector-tag">pattern</span>, <span class="selector-tag">repl</span>, <span class="selector-tag">string</span><span class="selector-attr">[, count]</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在介绍这几个方法之前，我们先来介绍一下pattern的概念，pattern可以理解为一个匹配模式，那么我们怎么获得这个匹配模式呢？很简单，我们需要利用re.compile方法就可以。例如</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pattern = re.compile(<span class="string">r'hello'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在参数中我们传入了原生字符串对象，通过compile方法编译生成一个pattern对象，然后我们利用这个对象来进行进一步的匹配。 另外大家可能注意到了另一个参数 flags，在这里解释一下这个参数的含义： 参数flag是匹配模式，取值可以使用按位或运算符’|’表示同时生效，比如re.I | re.M。 可选值有：</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">• re.I(全拼：IGNORECASE): 忽略大小写（括号内是完整写法，下同）</span><br><span class="line">• re.M(全拼：MULTILINE): 多行模式，改变<span class="string">'^'</span>和<span class="string">'$'</span>的行为（参见上图）</span><br><span class="line">• re.S(全拼：DOTALL): 点任意匹配模式，改变<span class="string">'.'</span>的行为</span><br><span class="line">• re.L(全拼：LOCALE): 使预定字符类 <span class="string">\w</span> <span class="string">\W</span> <span class="string">\b</span> <span class="string">\B</span> <span class="string">\s</span> <span class="string">\S</span> 取决于当前区域设定</span><br><span class="line">• re.U(全拼：UNICODE): 使预定字符类 <span class="string">\w</span> <span class="string">\W</span> <span class="string">\b</span> <span class="string">\B</span> <span class="string">\s</span> <span class="string">\S</span> <span class="string">\d</span> <span class="string">\D</span> 取决于unicode定义的字符属性</span><br><span class="line">• re.X(全拼：VERBOSE): 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在刚才所说的另外几个方法例如 re.match 里我们就需要用到这个pattern了，下面我们一一介绍。</p>
                  <blockquote>
                    <p>注：以下七个方法中的flags同样是代表匹配模式的意思，如果在pattern生成时已经指明了flags，那么在下面的方法中就不需要传入这个参数了。</p>
                  </blockquote>
                  <h3 id="（1）re-match-pattern-string-flags"><a href="#（1）re-match-pattern-string-flags" class="headerlink" title="（1）re.match(pattern, string[, flags])"></a>（1）re.match(pattern, string[, flags])</h3>
                  <p>这个方法将会从string（我们要匹配的字符串）的开头开始，尝试匹配pattern，一直向后匹配，如果遇到无法匹配的字符，立即返回None，如果匹配未结束已经到达string的末尾，也会返回None。两个结果均表示匹配失败，否则匹配pattern成功，同时匹配终止，不再对string向后匹配。下面我们通过一个例子理解一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入re模块</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将正则表达式编译成Pattern对象，注意hello前面的r的意思是“原生字符串”</span></span><br><span class="line">pattern = re.compile(<span class="string">r'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用re.match匹配文本，获得匹配结果，无法匹配时将返回None</span></span><br><span class="line">result1 = re.match(pattern,<span class="string">'hello'</span>)</span><br><span class="line">result2 = re.match(pattern,<span class="string">'helloo CQC!'</span>)</span><br><span class="line">result3 = re.match(pattern,<span class="string">'helo CQC!'</span>)</span><br><span class="line">result4 = re.match(pattern,<span class="string">'hello CQC!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果1匹配成功</span></span><br><span class="line"><span class="keyword">if</span> result1:</span><br><span class="line">    <span class="comment"># 使用Match获得分组信息</span></span><br><span class="line">    <span class="keyword">print</span> result1.group()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'1匹配失败！'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果2匹配成功</span></span><br><span class="line"><span class="keyword">if</span> result2:</span><br><span class="line">    <span class="comment"># 使用Match获得分组信息</span></span><br><span class="line">    <span class="keyword">print</span> result2.group()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'2匹配失败！'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果3匹配成功</span></span><br><span class="line"><span class="keyword">if</span> result3:</span><br><span class="line">    <span class="comment"># 使用Match获得分组信息</span></span><br><span class="line">    <span class="keyword">print</span> result3.group()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'3匹配失败！'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果4匹配成功</span></span><br><span class="line"><span class="keyword">if</span> result4:</span><br><span class="line">    <span class="comment"># 使用Match获得分组信息</span></span><br><span class="line">    <span class="keyword">print</span> result4.group()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'4匹配失败！'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hello</span><br><span class="line">hello</span><br><span class="line"><span class="number">3</span>匹配失败！</span><br><span class="line">hello</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>匹配分析 1.第一个匹配，pattern正则表达式为’hello’，我们匹配的目标字符串string也为hello，从头至尾完全匹配，匹配成功。 2.第二个匹配，string为helloo CQC，从string头开始匹配pattern完全可以匹配，pattern匹配结束，同时匹配终止，后面的o CQC不再匹配，返回匹配成功的信息。 3.第三个匹配，string为helo CQC，从string头开始匹配pattern，发现到 ‘o’ 时无法完成匹配，匹配终止，返回None 4.第四个匹配，同第二个匹配原理，即使遇到了空格符也不会受影响。 我们还看到最后打印出了result.group()，这个是什么意思呢？下面我们说一下关于match对象的的属性和方法 Match对象是一次匹配的结果，包含了很多关于此次匹配的信息，可以使用Match提供的可读属性或方法来获取这些信息。</p>
                  <blockquote>
                    <p>属性： 1.string: 匹配时使用的文本。 2.re: 匹配时使用的Pattern对象。 3.pos: 文本中正则表达式开始搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。 4.endpos: 文本中正则表达式结束搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。 5.lastindex: 最后一个被捕获的分组在文本中的索引。如果没有被捕获的分组，将为None。 6.lastgroup: 最后一个被捕获的分组的别名。如果这个分组没有别名或者没有被捕获的分组，将为None。 方法： 1.group([group1, …]): 获得一个或多个分组截获的字符串；指定多个参数时将以元组形式返回。group1可以使用编号也可以使用别名；编号0代表整个匹配的子串；不填写参数时，返回group(0)；没有截获字符串的组返回None；截获了多次的组返回最后一次截获的子串。 2.groups([default]): 以元组形式返回全部分组截获的字符串。相当于调用group(1,2,…last)。default表示没有截获字符串的组以这个值替代，默认为None。 3.groupdict([default]): 返回以有别名的组的别名为键、以该组截获的子串为值的字典，没有别名的组不包含在内。default含义同上。 4.start([group]): 返回指定的组截获的子串在string中的起始索引（子串第一个字符的索引）。group默认值为0。 5.end([group]): 返回指定的组截获的子串在string中的结束索引（子串最后一个字符的索引+1）。group默认值为0。 6.span([group]): 返回(start(group), end(group))。 7.expand(template): 将匹配到的分组代入template中然后返回。template中可以使用\id或\g、\g引用分组，但不能使用编号0。\id与\g是等价的；但\10将被认为是第10个分组，如果你想表达\1之后是字符’0’，只能使用\g0。</p>
                  </blockquote>
                  <p>下面我们用一个例子来体会一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#一个简单的match实例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># 匹配如下内容：单词+空格+单词+任意字符</span></span><br><span class="line">m = re.match(<span class="string">r'(\w+) (\w+)(?P&lt;sign&gt;.*)'</span>, <span class="string">'hello world!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.string:"</span>, m.string</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.re:"</span>, m.re</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.pos:"</span>, m.pos</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.endpos:"</span>, m.endpos</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.lastindex:"</span>, m.lastindex</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.lastgroup:"</span>, m.lastgroup</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.group():"</span>, m.group()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.group(1,2):"</span>, m.group(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.groups():"</span>, m.groups()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.groupdict():"</span>, m.groupdict()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.start(2):"</span>, m.start(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.end(2):"</span>, m.end(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m.span(2):"</span>, m.span(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">r"m.expand(r'\g \g\g'):"</span>, m.expand(<span class="string">r'\2 \1\3'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">### output ###</span></span><br><span class="line"><span class="comment"># m.string: hello world!</span></span><br><span class="line"><span class="comment"># m.re: </span></span><br><span class="line"><span class="comment"># m.pos: 0</span></span><br><span class="line"><span class="comment"># m.endpos: 12</span></span><br><span class="line"><span class="comment"># m.lastindex: 3</span></span><br><span class="line"><span class="comment"># m.lastgroup: sign</span></span><br><span class="line"><span class="comment"># m.group(1,2): ('hello', 'world')</span></span><br><span class="line"><span class="comment"># m.groups(): ('hello', 'world', '!')</span></span><br><span class="line"><span class="comment"># m.groupdict(): &#123;'sign': '!'&#125;</span></span><br><span class="line"><span class="comment"># m.start(2): 6</span></span><br><span class="line"><span class="comment"># m.end(2): 11</span></span><br><span class="line"><span class="comment"># m.span(2): (6, 11)</span></span><br><span class="line"><span class="comment"># m.expand(r'\2 \1\3'): world hello!</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（2）re-search-pattern-string-flags"><a href="#（2）re-search-pattern-string-flags" class="headerlink" title="（2）re.search(pattern, string[, flags])"></a>（2）re.search(pattern, string[, flags])</h3>
                  <p>search方法与match方法极其类似，区别在于match()函数只检测re是不是在string的开始位置匹配，search()会扫描整个string查找匹配，match（）只有在0位置匹配成功的话才有返回，如果不是开始位置匹配成功的话，match()就返回None。同样，search方法的返回对象同样match()返回对象的方法和属性。我们用一个例子感受一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#导入re模块</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将正则表达式编译成Pattern对象</span></span><br><span class="line">pattern = re.compile(<span class="string">r'world'</span>)</span><br><span class="line"><span class="comment"># 使用search()查找匹配的子串，不存在能匹配的子串时将返回None</span></span><br><span class="line"><span class="comment"># 这个例子中使用match()无法成功匹配</span></span><br><span class="line">match = re.search(pattern,<span class="string">'hello world!'</span>)</span><br><span class="line"><span class="keyword">if</span> match:</span><br><span class="line">    <span class="comment"># 使用Match获得分组信息</span></span><br><span class="line">    <span class="keyword">print</span> match.group()</span><br><span class="line"><span class="comment">### 输出 ###</span></span><br><span class="line"><span class="comment"># world</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（3）re-split-pattern-string-maxsplit"><a href="#（3）re-split-pattern-string-maxsplit" class="headerlink" title="（3）re.split(pattern, string[, maxsplit])"></a>（3）re.split(pattern, string[, maxsplit])</h3>
                  <p>按照能够匹配的子串将string分割后返回列表。maxsplit用于指定最大分割次数，不指定将全部分割。我们通过下面的例子感受一下。</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(r<span class="string">'\d+'</span>)</span><br><span class="line">print re.split(pattern,<span class="string">'one1two2three3four4'</span>)</span><br><span class="line"></span><br><span class="line">### 输出 ###</span><br><span class="line"># [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">''</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（4）re-findall-pattern-string-flags"><a href="#（4）re-findall-pattern-string-flags" class="headerlink" title="（4）re.findall(pattern, string[, flags])"></a>（4）re.findall(pattern, string[, flags])</h3>
                  <p>搜索string，以列表形式返回全部能匹配的子串。我们通过这个例子来感受一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">r'\d+'</span>)</span><br><span class="line"><span class="keyword">print</span> re.findall(pattern,<span class="string">'one1two2three3four4'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 输出 ###</span></span><br><span class="line"><span class="comment"># ['1', '2', '3', '4']</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（5）re-finditer-pattern-string-flags"><a href="#（5）re-finditer-pattern-string-flags" class="headerlink" title="（5）re.finditer(pattern, string[, flags])"></a>（5）re.finditer(pattern, string[, flags])</h3>
                  <p>搜索string，返回一个顺序访问每一个匹配结果（Match对象）的迭代器。我们通过下面的例子来感受一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">r'\d+'</span>)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern,<span class="string">'one1two2three3four4'</span>):</span><br><span class="line">    <span class="keyword">print</span> m.group(),</span><br><span class="line"></span><br><span class="line"><span class="comment">### 输出 ###</span></span><br><span class="line"><span class="comment"># 1 2 3 4</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（6）re-sub-pattern-repl-string-count"><a href="#（6）re-sub-pattern-repl-string-count" class="headerlink" title="（6）re.sub(pattern, repl, string[, count])"></a>（6）re.sub(pattern, repl, string[, count])</h3>
                  <p>使用repl替换string中每一个匹配的子串后返回替换后的字符串。 当repl是一个字符串时，可以使用\id或\g、\g引用分组，但不能使用编号0。 当repl是一个方法时，这个方法应当只接受一个参数（Match对象），并返回一个字符串用于替换（返回的字符串中不能再引用分组）。 count用于指定最多替换次数，不指定时全部替换。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">r'(\w+) (\w+)'</span>)</span><br><span class="line">s = <span class="string">'i say, hello world!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> re.sub(pattern,<span class="string">r'\2 \1'</span>, s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(m)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> m.group(<span class="number">1</span>).title() + <span class="string">' '</span> + m.group(<span class="number">2</span>).title()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> re.sub(pattern,func, s)</span><br><span class="line"></span><br><span class="line"><span class="comment">### output ###</span></span><br><span class="line"><span class="comment"># say i, world hello!</span></span><br><span class="line"><span class="comment"># I Say, Hello World!</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="（7）re-subn-pattern-repl-string-count"><a href="#（7）re-subn-pattern-repl-string-count" class="headerlink" title="（7）re.subn(pattern, repl, string[, count])"></a>（7）re.subn(pattern, repl, string[, count])</h3>
                  <p>返回 (sub(repl, string[, count]), 替换次数)。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"> </span><br><span class="line">pattern = re.compile(<span class="string">r'(\w+) (\w+)'</span>)</span><br><span class="line">s = <span class="string">'i say, hello world!'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> re.subn(pattern,<span class="string">r'\2 \1'</span>, s)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(m)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> m.group(<span class="number">1</span>).title() + <span class="string">' '</span> + m.group(<span class="number">2</span>).title()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> re.subn(pattern,func, s)</span><br><span class="line"> </span><br><span class="line"><span class="comment">### output ###</span></span><br><span class="line"><span class="comment"># ('say i, world hello!', 2)</span></span><br><span class="line"><span class="comment"># ('I Say, Hello World!', 2)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-Python-Re模块的另一种使用方式"><a href="#5-Python-Re模块的另一种使用方式" class="headerlink" title="5.Python Re模块的另一种使用方式"></a>5.Python Re模块的另一种使用方式</h2>
                  <p>在上面我们介绍了7个工具方法，例如match，search等等，不过调用方式都是 re.match，re.search的方式，其实还有另外一种调用方式，可以通过pattern.match，pattern.search调用，这样调用便不用将pattern作为第一个参数传入了，大家想怎样调用皆可。 函数API列表</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">match</span>(<span class="built_in">string</span>[, pos[, endpos]]) | re.<span class="keyword">match</span>(pattern, <span class="built_in">string</span>[, flags])</span><br><span class="line"><span class="built_in">search</span>(<span class="built_in">string</span>[, pos[, endpos]]) | re.<span class="built_in">search</span>(pattern, <span class="built_in">string</span>[, flags])</span><br><span class="line"><span class="keyword">split</span>(<span class="built_in">string</span>[, maxsplit]) | re.<span class="keyword">split</span>(pattern, <span class="built_in">string</span>[, maxsplit])</span><br><span class="line">findall(<span class="built_in">string</span>[, pos[, endpos]]) | re.findall(pattern, <span class="built_in">string</span>[, flags])</span><br><span class="line">finditer(<span class="built_in">string</span>[, pos[, endpos]]) | re.finditer(pattern, <span class="built_in">string</span>[, flags])</span><br><span class="line">sub(repl, <span class="built_in">string</span>[, <span class="built_in">count</span>]) | re.sub(pattern, repl, <span class="built_in">string</span>[, <span class="built_in">count</span>])</span><br><span class="line">subn(repl, <span class="built_in">string</span>[, <span class="built_in">count</span>]) |re.sub(pattern, repl, <span class="built_in">string</span>[, <span class="built_in">count</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>具体的调用方法不必详说了，原理都类似，只是参数的变化不同。小伙伴们尝试一下吧~ 小伙伴们加油，即使这一节看得云里雾里的也没关系，接下来我们会通过一些实战例子来帮助大家熟练掌握正则表达式的。 参考文章：此文章部分内容出自 <a href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html" target="_blank" rel="noopener">CNBlogs</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-15 23:30:22" itemprop="dateCreated datePublished" datetime="2015-02-15T23:30:22+08:00">2015-02-15</time>
                </span>
                <span id="/977.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门七之正则表达式" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/968.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/968.html" class="post-title-link" itemprop="url">Python爬虫入门六之Cookie的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好哈，上一节我们研究了一下爬虫的异常处理问题，那么接下来我们一起来看一下Cookie的使用。 为什么要使用Cookie呢？ Cookie，指某些网站为了辨别用户身份、进行session跟踪而储存在用户本地终端上的数据（通常经过加密） 比如说有些网站需要登录后才能访问某个页面，在登录之前，你想抓取某个页面内容是不允许的。那么我们可以利用Urllib2库保存我们登录的Cookie，然后再抓取其他页面就达到目的了。 在此之前呢，我们必须先介绍一个opener的概念。</p>
                  <h2 id="1-Opener"><a href="#1-Opener" class="headerlink" title="1.Opener"></a>1.Opener</h2>
                  <p>当你获取一个URL你使用一个opener(一个urllib2.OpenerDirector的实例)。在前面，我们都是使用的默认的opener，也就是urlopen。它是一个特殊的opener，可以理解成opener的一个特殊实例，传入的参数仅仅是url，data，timeout。 如果我们需要用到Cookie，只用这个opener是不能达到目的的，所以我们需要创建更一般的opener来实现对Cookie的设置。</p>
                  <h2 id="2-Cookielib"><a href="#2-Cookielib" class="headerlink" title="2.Cookielib"></a>2.Cookielib</h2>
                  <p>cookielib模块的主要作用是提供可存储cookie的对象，以便于与urllib2模块配合使用来访问Internet资源。Cookielib模块非常强大，我们可以利用本模块的CookieJar类的对象来捕获cookie并在后续连接请求时重新发送，比如可以实现模拟登录功能。该模块主要的对象有CookieJar、FileCookieJar、MozillaCookieJar、LWPCookieJar。 它们的关系：CookieJar ——派生——&gt;FileCookieJar ——派生——-&gt;MozillaCookieJar和LWPCookieJar</p>
                  <h3 id="1）获取Cookie保存到变量"><a href="#1）获取Cookie保存到变量" class="headerlink" title="1）获取Cookie保存到变量"></a>1）获取Cookie保存到变量</h3>
                  <p>首先，我们先利用CookieJar对象实现获取cookie的功能，存储到变量中，先来感受一下</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">import</span> <span class="string">urllib2</span></span><br><span class="line"><span class="attr">import</span> <span class="string">cookielib</span></span><br><span class="line"><span class="comment">#声明一个CookieJar对象实例来保存cookie</span></span><br><span class="line"><span class="attr">cookie</span> = <span class="string">cookielib.CookieJar()</span></span><br><span class="line"><span class="comment">#利用urllib2库的HTTPCookieProcessor对象来创建cookie处理器</span></span><br><span class="line"><span class="attr">handler</span>=<span class="string">urllib2.HTTPCookieProcessor(cookie)</span></span><br><span class="line"><span class="comment">#通过handler来构建opener</span></span><br><span class="line"><span class="attr">opener</span> = <span class="string">urllib2.build_opener(handler)</span></span><br><span class="line"><span class="comment">#此处的open方法同urllib2的urlopen方法，也可以传入request</span></span><br><span class="line"><span class="attr">response</span> = <span class="string">opener.open('http://www.baidu.com')</span></span><br><span class="line"><span class="attr">for</span> <span class="string">item in cookie:</span></span><br><span class="line">    <span class="attr">print</span> <span class="string">'Name = '+item.name</span></span><br><span class="line">    <span class="attr">print</span> <span class="string">'Value = '+item.value</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们使用以上方法将cookie保存到变量中，然后打印出了cookie中的值，运行结果如下</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Name</span> = BAIDUID</span><br><span class="line"><span class="attr">Value</span> = B07B663B645729F11F659C02AAE65B4C:FG=<span class="number">1</span></span><br><span class="line"><span class="attr">Name</span> = BAIDUPSID</span><br><span class="line"><span class="attr">Value</span> = B07B663B645729F11F659C02AAE65B4C</span><br><span class="line"><span class="attr">Name</span> = H_PS_PSSID</span><br><span class="line"><span class="attr">Value</span> = <span class="number">12527_11076_1438_10633</span></span><br><span class="line"><span class="attr">Name</span> = BDSVRTM</span><br><span class="line"><span class="attr">Value</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">Name</span> = BD_HOME</span><br><span class="line"><span class="attr">Value</span> = <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2）保存Cookie到文件"><a href="#2）保存Cookie到文件" class="headerlink" title="2）保存Cookie到文件"></a>2）保存Cookie到文件</h3>
                  <p>在上面的方法中，我们将cookie保存到了cookie这个变量中，如果我们想将cookie保存到文件中该怎么做呢？这时，我们就要用到 FileCookieJar这个对象了，在这里我们使用它的子类MozillaCookieJar来实现Cookie的保存</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> cookielib</span><br><span class="line"><span class="built_in">import</span> urllib2</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置保存cookie的文件，同级目录下的cookie.txt</span></span><br><span class="line"><span class="attr">filename</span> = 'cookie.txt'</span><br><span class="line"><span class="comment">#声明一个MozillaCookieJar对象实例来保存cookie，之后写入文件</span></span><br><span class="line"><span class="attr">cookie</span> = cookielib.MozillaCookieJar(filename)</span><br><span class="line"><span class="comment">#利用urllib2库的HTTPCookieProcessor对象来创建cookie处理器</span></span><br><span class="line"><span class="attr">handler</span> = urllib2.HTTPCookieProcessor(cookie)</span><br><span class="line"><span class="comment">#通过handler来构建opener</span></span><br><span class="line"><span class="attr">opener</span> = urllib2.build_opener(handler)</span><br><span class="line"><span class="comment">#创建一个请求，原理同urllib2的urlopen</span></span><br><span class="line"><span class="attr">response</span> = opener.open(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="comment">#保存cookie到文件</span></span><br><span class="line">cookie.save(<span class="attr">ignore_discard=True,</span> <span class="attr">ignore_expires=True)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于最后save方法的两个参数在此说明一下： 官方解释如下：</p>
                  <blockquote>
                    <p><em>ignore_discard: save even cookies set to be discarded. </em> <em>ignore_expires: save even cookies that have expiredThe file is overwritten if it already exists</em></p>
                  </blockquote>
                  <p>由此可见，ignore_discard的意思是即使cookies将被丢弃也将它保存下来，ignore_expires的意思是如果在该文件中cookies已经存在，则覆盖原文件写入，在这里，我们将这两个全部设置为True。运行之后，cookies将被保存到cookie.txt文件中，我们查看一下内容，附图如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150215215136.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150215215136.jpg" alt="QQ截图20150215215136"></a></p>
                  <h3 id="3）从文件中获取Cookie并访问"><a href="#3）从文件中获取Cookie并访问" class="headerlink" title="3）从文件中获取Cookie并访问"></a>3）从文件中获取Cookie并访问</h3>
                  <p>那么我们已经做到把Cookie保存到文件中了，如果以后想使用，可以利用下面的方法来读取cookie并访问网站，感受一下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import cookielib</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建MozillaCookieJar实例对象</span></span><br><span class="line">cookie = cookielib.MozillaCookieJar()</span><br><span class="line"><span class="comment">#从文件中读取cookie内容到变量</span></span><br><span class="line">cookie.load(<span class="string">'cookie.txt'</span>, <span class="attribute">ignore_discard</span>=<span class="literal">True</span>, <span class="attribute">ignore_expires</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#创建请求的request</span></span><br><span class="line">req = urllib2.Request(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="comment">#利用urllib2的build_opener方法创建一个opener</span></span><br><span class="line">opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))</span><br><span class="line">response = opener.open(req)</span><br><span class="line"><span class="builtin-name">print</span> response.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>设想，如果我们的 cookie.txt 文件中保存的是某个人登录百度的cookie，那么我们提取出这个cookie文件内容，就可以用以上方法模拟这个人的账号登录百度。</p>
                  <h3 id="4）利用cookie模拟网站登录"><a href="#4）利用cookie模拟网站登录" class="headerlink" title="4）利用cookie模拟网站登录"></a>4）利用cookie模拟网站登录</h3>
                  <p>下面我们以我们学校的教育系统为例，利用cookie实现模拟登录，并将cookie信息保存到文本文件中，来感受一下cookie大法吧！ 注意：密码我改了啊，别偷偷登录本宫的选课系统 o(╯□╰)o</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'cookie.txt'</span></span><br><span class="line"><span class="comment">#声明一个MozillaCookieJar对象实例来保存cookie，之后写入文件</span></span><br><span class="line">cookie = cookielib.MozillaCookieJar(filename)</span><br><span class="line">opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cookie))</span><br><span class="line">postdata = urllib.urlencode(&#123;</span><br><span class="line">			<span class="string">'stuid'</span>:<span class="string">'201200131012'</span>,</span><br><span class="line">			<span class="string">'pwd'</span>:<span class="string">'23342321'</span></span><br><span class="line">		&#125;)</span><br><span class="line"><span class="comment">#登录教务系统的URL</span></span><br><span class="line">loginUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login'</span></span><br><span class="line"><span class="comment">#模拟登录，并把cookie保存到变量</span></span><br><span class="line">result = opener.open(loginUrl,postdata)</span><br><span class="line"><span class="comment">#保存cookie到cookie.txt中</span></span><br><span class="line">cookie.save(<span class="attribute">ignore_discard</span>=<span class="literal">True</span>, <span class="attribute">ignore_expires</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#利用cookie请求访问另一个网址，此网址是成绩查询网址</span></span><br><span class="line">gradeUrl = <span class="string">'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bkscjcx.curscopre'</span></span><br><span class="line"><span class="comment">#请求访问成绩查询网址</span></span><br><span class="line">result = opener.open(gradeUrl)</span><br><span class="line"><span class="builtin-name">print</span> result.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上程序的原理如下 创建一个带有cookie的opener，在访问登录的URL时，将登录后的cookie保存下来，然后利用这个cookie来访问其他网址。 如登录之后才能查看的成绩查询呀，本学期课表呀等等网址，模拟登录就这么实现啦，是不是很酷炫？ 好，小伙伴们要加油哦！我们现在可以顺利获取网站信息了，接下来就是把网站里面有效内容提取出来，下一节我们去会会正则表达式！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-15 01:01:35" itemprop="dateCreated datePublished" datetime="2015-02-15T01:01:35+08:00">2015-02-15</time>
                </span>
                <span id="/968.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门六之Cookie的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/961.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/961.html" class="post-title-link" itemprop="url">Python爬虫入门五之URLError异常处理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，本节在这里主要说的是URLError还有HTTPError，以及对它们的一些处理。</p>
                  <h2 id="1-URLError"><a href="#1-URLError" class="headerlink" title="1.URLError"></a>1.URLError</h2>
                  <p>首先解释下URLError可能产生的原因：</p>
                  <ul>
                    <li>网络无连接，即本机无法上网</li>
                    <li>连接不到特定的服务器</li>
                    <li>服务器不存在</li>
                  </ul>
                  <p>在代码中，我们需要用try-except语句来包围并捕获相应的异常。下面是一个例子，先感受下它的风骚</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">requset = urllib2.<span class="constructor">Request('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">www</span>.<span class="params">xxxxx</span>.<span class="params">com</span>')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    urllib2.urlopen(request)</span><br><span class="line">except urllib2.URLError, e:</span><br><span class="line">    print e.reason</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们利用了 urlopen方法访问了一个不存在的网址，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[Errno <span class="number">11004</span>] getaddrinfo failed</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它说明了错误代号是11004，错误原因是 getaddrinfo failed 2.HTTPError HTTPError是URLError的子类，在你利用urlopen方法发出一个请求时，服务器上都会对应一个应答对象response，其中它包含一个数字”状态码”。举个例子，假如response是一个”重定向”，需定位到别的地址获取文档，urllib2将对此进行处理。 其他不能处理的，urlopen会产生一个HTTPError，对应相应的状态吗，HTTP状态码表示HTTP协议所返回的响应的状态。下面将状态码归结如下：</p>
                  <blockquote>
                    <p>100：继续 客户端应当继续发送请求。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。 101： 转换协议 在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。只有在切换新的协议更有好处的时候才应该采取类似措施。 102：继续处理 由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。 200：请求成功 处理方式：获得响应的内容，进行处理 201：请求完成，结果是创建了新资源。新创建资源的URI可在响应的实体中得到 处理方式：爬虫中不会遇到 202：请求被接受，但处理尚未完成 处理方式：阻塞等待 204：服务器端已经实现了请求，但是没有返回新的信 息。如果客户是用户代理，则无须为此更新自身的文档视图。 处理方式：丢弃 300：该状态码不被HTTP/1.0的应用程序直接使用， 只是作为3XX类型回应的默认解释。存在多个可用的被请求资源。 处理方式：若程序中能够处理，则进行进一步处理，如果程序中不能处理，则丢弃 301：请求到的资源都会分配一个永久的URL，这样就可以在将来通过该URL来访问此资源 处理方式：重定向到分配的URL 302：请求到的资源在一个不同的URL处临时保存 处理方式：重定向到临时的URL 304：请求的资源未更新 处理方式：丢弃 400：非法请求 处理方式：丢弃 401：未授权 处理方式：丢弃 403：禁止 处理方式：丢弃 404：没有找到 处理方式：丢弃 500：服务器内部错误 服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。 501：服务器无法识别 服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。 502：错误网关 作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。 503：服务出错 由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。</p>
                  </blockquote>
                  <p>HTTPError实例产生后会有一个code属性，这就是是服务器发送的相关错误号。 因为urllib2可以为你处理重定向，也就是3开头的代号可以被处理，并且100-299范围的号码指示成功，所以你只能看到400-599的错误号码。 下面我们写一个例子来感受一下，捕获的异常是HTTPError，它会带有一个code属性，就是错误代号，另外我们又打印了reason属性，这是它的父类URLError的属性。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">req = urllib2.<span class="constructor">Request('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">blog</span>.<span class="params">csdn</span>.<span class="params">net</span><span class="operator">/</span><span class="params">cqcre</span>')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    urllib2.urlopen(req)</span><br><span class="line">except urllib2.HTTPError, e:</span><br><span class="line">    print e.code</span><br><span class="line">    print e.reason</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">403</span></span><br><span class="line">Forbidden</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>错误代号是403，错误原因是Forbidden，说明服务器禁止访问。 我们知道，HTTPError的父类是URLError，根据编程经验，父类的异常应当写到子类异常的后面，如果子类捕获不到，那么可以捕获父类的异常，所以上述的代码可以这么改写</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line">req = urllib2.Request(<span class="string">'http://blog.csdn.net/cqcre'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    urllib2.urlopen(req)</span><br><span class="line"><span class="keyword">except</span> urllib2.HTTPError, e:</span><br><span class="line">    <span class="keyword">print</span> e.code</span><br><span class="line"><span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">    <span class="keyword">print</span> e.reason</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"OK"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果捕获到了HTTPError，则输出code，不会再处理URLError异常。如果发生的不是HTTPError，则会去捕获URLError异常，输出错误原因。 另外还可以加入 hasattr属性提前对属性进行判断，代码改写如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line">req = urllib2.<span class="constructor">Request('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">blog</span>.<span class="params">csdn</span>.<span class="params">net</span><span class="operator">/</span><span class="params">cqcre</span>')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    urllib2.urlopen(req)</span><br><span class="line">except urllib2.URLError, e:</span><br><span class="line">    <span class="keyword">if</span> hasattr(e,<span class="string">"reason"</span>):</span><br><span class="line">        print e.reason</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print <span class="string">"OK"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先对异常的属性进行判断，以免出现属性输出报错的现象。 以上，就是对URLError和HTTPError的相关介绍，以及相应的错误处理办法，小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-14 01:02:04" itemprop="dateCreated datePublished" datetime="2015-02-14T01:02:04+08:00">2015-02-14</time>
                </span>
                <span id="/961.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门五之URLError异常处理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/954.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/954.html" class="post-title-link" itemprop="url">Python爬虫入门四之Urllib库的高级用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-设置Headers"><a href="#1-设置Headers" class="headerlink" title="1.设置Headers"></a>1.设置Headers</h2>
                  <p>有些网站不会同意程序直接用上面的方式进行访问，如果识别有问题，那么站点根本不会响应，所以为了完全模拟浏览器的工作，我们需要设置一些Headers 的属性。 首先，打开我们的浏览器，调试浏览器F12，我用的是Chrome，打开网络监听，示意如下，比如知乎，点登录之后，我们会发现登陆之后界面都变化了，出现一个新的界面，实质上这个页面包含了许许多多的内容，这些内容也不是一次性就加载完成的，实质上是执行了好多次请求，一般是首先请求HTML文件，然后加载JS，CSS 等等，经过多次请求之后，网页的骨架和肌肉全了，整个网页的效果也就出来了。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-13-013155-的屏幕截图-e1423762350360.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-13-013155-的屏幕截图-e1423762350360-1024x424.png" alt="2015-02-13 01:31:55 的屏幕截图"></a> 拆分这些请求，我们只看一第一个请求，你可以看到，有个Request URL，还有headers，下面便是response，图片显示得不全，小伙伴们可以亲身实验一下。那么这个头中包含了许许多多是信息，有文件编码啦，压缩方式啦，请求的agent啦等等。 其中，agent就是请求的身份，如果没有写入请求身份，那么服务器不一定会响应，所以可以在headers中设置agent,例如下面的例子，这个例子只是说明了怎样设置的headers，小伙伴们看一下设置格式就好。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib  </span><br><span class="line">import urllib2  </span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://www.server.com/login'</span></span><br><span class="line">user_agent = <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span>  </span><br><span class="line">values = &#123;<span class="string">'username'</span> : <span class="string">'cqc'</span>,  <span class="string">'password'</span> : <span class="string">'XXXX'</span> &#125;  </span><br><span class="line">headers = &#123; <span class="string">'User-Agent'</span> : user_agent &#125;  </span><br><span class="line">data = urllib.urlencode(values)  </span><br><span class="line">request = urllib2.Request(url, data, headers)  </span><br><span class="line">response = urllib2.urlopen(request)  </span><br><span class="line">page = response.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，我们设置了一个headers，在构建request时传入，在请求时，就加入了headers传送，服务器若识别了是浏览器发来的请求，就会得到响应。 另外，我们还有<strong>对付”反盗链”</strong>的方式，对付防盗链，服务器会识别headers中的referer是不是它自己，如果不是，有的服务器不会响应，所以我们还可以在headers中加入referer 例如我们可以构建下面的headers</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">headers</span> = &#123; <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span>  ,</span><br><span class="line">                        <span class="string">'Referer'</span>:<span class="string">'http://www.zhihu.com/articles'</span> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同上面的方法，在传送请求时把headers传入Request参数里，这样就能应付防盗链了。 另外headers的一些属性，下面的需要特别注意一下：</p>
                  <blockquote>
                    <p>User-Agent : 有些服务器或 Proxy 会通过该值来判断是否是浏览器发出的请求 Content-Type : 在使用 REST 接口时，服务器会检查该值，用来确定 HTTP Body 中的内容该怎样解析。 application/xml ： 在 XML RPC，如 RESTful/SOAP 调用时使用 application/json ： 在 JSON RPC 调用时使用 application/x-www-form-urlencoded ： 浏览器提交 Web 表单时使用 在使用服务器提供的 RESTful 或 SOAP 服务时， Content-Type 设置错误会导致服务器拒绝服务</p>
                  </blockquote>
                  <p>其他的有必要的可以审查浏览器的headers内容，在构建时写入同样的数据即可。</p>
                  <h2 id="2-Proxy（代理）的设置"><a href="#2-Proxy（代理）的设置" class="headerlink" title="2. Proxy（代理）的设置"></a><strong>2. Proxy（代理）的设置</strong></h2>
                  <p>urllib2 默认会使用环境变量 http_proxy 来设置 HTTP Proxy。假如一个网站它会检测某一段时间某个IP 的访问次数，如果访问次数过多，它会禁止你的访问。所以你可以设置一些代理服务器来帮助你做工作，每隔一段时间换一个代理，网站君都不知道是谁在捣鬼了，这酸爽！ 下面一段代码说明了代理的设置用法</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line">enable_proxy = True</span><br><span class="line">proxy_handler = urllib2.<span class="constructor">ProxyHandler(&#123;<span class="string">"http"</span> : '<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">some</span>-<span class="params">proxy</span>.<span class="params">com</span>:8080'&#125;)</span></span><br><span class="line">null_proxy_handler = urllib2.<span class="constructor">ProxyHandler(&#123;&#125;)</span></span><br><span class="line"><span class="keyword">if</span> enable_proxy:</span><br><span class="line">    opener = urllib2.build<span class="constructor">_opener(<span class="params">proxy_handler</span>)</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    opener = urllib2.build<span class="constructor">_opener(<span class="params">null_proxy_handler</span>)</span></span><br><span class="line">urllib2.install<span class="constructor">_opener(<span class="params">opener</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-Timeout-设置"><a href="#3-Timeout-设置" class="headerlink" title="3.Timeout 设置"></a>3.<strong>Timeout 设置</strong></h2>
                  <p>上一节已经说过urlopen方法了，第三个参数就是timeout的设置，可以设置等待多久超时，为了解决一些网站实在响应过慢而造成的影响。 例如下面的代码,如果第二个参数data为空那么要特别指定是timeout是多少，写明形参，如果data已经传入，则不必声明。</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> urllib2</span><br><span class="line"><span class="attr">response</span> = urllib2.urlopen('http://www.baidu.com', <span class="attr">timeout=10)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="title">response</span> = urllib2.urlopen('http://www.baidu.com',<span class="class"><span class="keyword">data</span>, 10)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-使用-HTTP-的-PUT-和-DELETE-方法"><a href="#4-使用-HTTP-的-PUT-和-DELETE-方法" class="headerlink" title="4.使用 HTTP 的 PUT 和 DELETE 方法"></a><strong>4.使用 HTTP 的 PUT 和 DELETE 方法</strong></h2>
                  <p>http协议有六种请求方法，get,head,put,delete,post,options，我们有时候需要用到PUT方式或者DELETE方式请求。</p>
                  <blockquote>
                    <p>PUT：这个方法比较少见。HTML表单也不支持这个。本质上来讲， PUT和POST极为相似，都是向服务器发送数据，但它们之间有一个重要区别，PUT通常指定了资源的存放位置，而POST则没有，POST的数据存放位置由服务器自己决定。 DELETE：删除某一个资源。基本上这个也很少见，不过还是有一些地方比如amazon的S3云服务里面就用的这个方法来删除资源。</p>
                  </blockquote>
                  <p>如果要使用 HTTP PUT 和 DELETE ，只能使用比较低层的 httplib 库。虽然如此，我们还是能通过下面的方式，使 urllib2 能够发出 PUT 或DELETE 的请求，不过用的次数的确是少，在这里提一下。</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> urllib2</span><br><span class="line"><span class="attr">request</span> = urllib2.Request(uri, <span class="attr">data=data)</span></span><br><span class="line">request.<span class="attr">get_method</span> = lambda: 'PUT' <span class="comment"># or 'DELETE'</span></span><br><span class="line"><span class="attr">response</span> = urllib2.urlopen(request)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-使用DebugLog"><a href="#5-使用DebugLog" class="headerlink" title="5.使用DebugLog"></a>5.使用DebugLog</h2>
                  <p>可以通过下面的方法把 Debug Log 打开，这样收发包的内容就会在屏幕上打印出来，方便调试，这个也不太常用，仅提一下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line">httpHandler = urllib2.<span class="constructor">HTTPHandler(<span class="params">debuglevel</span>=1)</span></span><br><span class="line">httpsHandler = urllib2.<span class="constructor">HTTPSHandler(<span class="params">debuglevel</span>=1)</span></span><br><span class="line">opener = urllib2.build<span class="constructor">_opener(<span class="params">httpHandler</span>, <span class="params">httpsHandler</span>)</span></span><br><span class="line">urllib2.install<span class="constructor">_opener(<span class="params">opener</span>)</span></span><br><span class="line">response = urllib2.urlopen('http:<span class="comment">//www.baidu.com')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是一部分高级特性，前三个是重要内容，在后面，还有cookies的设置还有异常的处理，小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-13 02:12:57" itemprop="dateCreated datePublished" datetime="2015-02-13T02:12:57+08:00">2015-02-13</time>
                </span>
                <span id="/954.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门四之Urllib库的高级用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/947.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/947.html" class="post-title-link" itemprop="url">Python爬虫入门三之Urllib库的基本使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>那么接下来，小伙伴们就一起和我真正迈向我们的爬虫之路吧。</p>
                  <h2 id="1-分分钟扒一个网页下来"><a href="#1-分分钟扒一个网页下来" class="headerlink" title="1.分分钟扒一个网页下来"></a>1.分分钟扒一个网页下来</h2>
                  <p>怎样扒网页呢？其实就是根据URL来获取它的网页信息，虽然我们在浏览器中看到的是一幅幅优美的画面，但是其实是由浏览器解释才呈现出来的，实质它是一段HTML代码，加 JS、CSS，如果把网页比作一个人，那么HTML便是他的骨架，JS便是他的肌肉，CSS便是它的衣服。所以最重要的部分是存在于HTML中的，下面我们就写个例子来扒一个网页下来。</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line">response = urllib2.urlopen(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="built_in">print</span> response.<span class="built_in">read</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是的你没看错，真正的程序就两行，把它保存成 demo.py，进入该文件的目录，执行如下命令查看运行结果，感受一下。</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> demo.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-13-000909-的屏幕截图.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/2015-02-13-000909-的屏幕截图.png" alt="2015-02-13 00:09:09 的屏幕截图"></a> 看，这个网页的源码已经被我们扒下来了，是不是很酸爽？</p>
                  <h2 id="2-分析扒网页的方法"><a href="#2-分析扒网页的方法" class="headerlink" title="2.分析扒网页的方法"></a>2.分析扒网页的方法</h2>
                  <p>那么我们来分析这两行代码，第一行</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">response</span> = urllib2.urlopen(<span class="string">"http://www.baidu.com"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们调用的是urllib2库里面的urlopen方法，传入一个URL，这个网址是百度首页，协议是HTTP协议，当然你也可以把HTTP换做FTP,FILE,HTTPS 等等，只是代表了一种访问控制协议，urlopen一般接受三个参数，它的参数如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">urlopen</span><span class="params">(url, data, timeout)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第一个参数url即为URL，第二个参数data是访问URL时要传送的数据，第三个timeout是设置超时时间。 第二三个参数是可以不传送的，data默认为空None，timeout默认为 socket._GLOBAL_DEFAULT_TIMEOUT 第一个参数URL是必须要传送的，在这个例子里面我们传送了百度的URL，执行urlopen方法之后，返回一个response对象，返回信息便保存在这里面。</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">print</span> response.<span class="built_in">read</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>response对象有一个read方法，可以返回获取到的网页内容。</p>
                  <p>如果不加read直接打印会是什么？答案如下：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">addinfourl </span><span class="built_in">at</span> <span class="number">139728495260376</span> whose <span class="built_in">fp</span> = &lt;socket._fileobject object <span class="built_in">at</span> <span class="number">0x7f1513fb3ad0</span>&gt;&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>直接打印出了该对象的描述，所以记得一定要加read方法，否则它不出来内容可就不怪我咯！</p>
                  <h2 id="3-构造Request"><a href="#3-构造Request" class="headerlink" title="3.构造Request"></a>3.构造Request</h2>
                  <p>其实上面的urlopen参数可以传入一个request请求,它其实就是一个Request类的实例，构造时需要传入Url,Data等等的内容。比如上面的两行代码，我们可以这么改写</p>
                  <figure class="highlight vbscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line"><span class="built_in">request</span> = urllib2.<span class="built_in">Request</span>(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="built_in">response</span> = urllib2.urlopen(<span class="built_in">request</span>)</span><br><span class="line">print <span class="built_in">response</span>.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是完全一样的，只不过中间多了一个request对象，推荐大家这么写，因为在构建请求时还需要加入好多内容，通过构建一个request，服务器响应请求得到应答，这样显得逻辑上清晰明确。</p>
                  <h2 id="4-POST和GET数据传送"><a href="#4-POST和GET数据传送" class="headerlink" title="4.POST和GET数据传送"></a>4.POST和GET数据传送</h2>
                  <p>上面的程序演示了最基本的网页抓取，不过，现在大多数网站都是动态网页，需要你动态地传递参数给它，它做出对应的响应。所以，在访问时，我们需要传递数据给它。最常见的情况是什么？对了，就是登录注册的时候呀。 把数据用户名和密码传送到一个URL，然后你得到服务器处理之后的响应，这个该怎么办？下面让我来为小伙伴们揭晓吧！ 数据传送分为POST和GET两种方式，两种方式有什么区别呢？ 最重要的区别是GET方式是直接以链接形式访问，链接中包含了所有的参数，当然如果包含了密码的话是一种不安全的选择，不过你可以直观地看到自己提交了什么内容。POST则不会在网址上显示所有的参数，不过如果你想直接查看提交了什么就不太方便了，大家可以酌情选择。</p>
                  <h3 id="POST方式："><a href="#POST方式：" class="headerlink" title="POST方式："></a>POST方式：</h3>
                  <p>上面我们说了data参数是干嘛的？对了，它就是用在这里的，我们传送的数据就是这个参数data，下面演示一下POST方式。</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line"><span class="title">values</span> = &#123;<span class="string">"username"</span>:<span class="string">"1016903103@qq.com"</span>,<span class="string">"password"</span>:<span class="string">"XXXX"</span>&#125;</span><br><span class="line"><span class="class"><span class="keyword">data</span> = urllib.urlencode(<span class="title">values</span>) </span></span><br><span class="line"><span class="title">url</span> = <span class="string">"https://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn"</span></span><br><span class="line"><span class="title">request</span> = urllib2.<span class="type">Request</span>(url,<span class="class"><span class="keyword">data</span>)</span></span><br><span class="line"><span class="title">response</span> = urllib2.urlopen(request)</span><br><span class="line"><span class="title">print</span> response.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们引入了urllib库，现在我们模拟登陆CSDN，当然上述代码可能登陆不进去，因为CSDN还有个流水号的字段，没有设置全，比较复杂在这里就不写上去了，在此只是说明登录的原理。一般的登录网站一般是这种写法。 我们需要定义一个字典，名字为values，参数我设置了username和password，下面利用urllib的urlencode方法将字典编码，命名为data，构建request时传入两个参数，url和data，运行程序，返回的便是POST后呈现的页面内容。 注意上面字典的定义方式还有一种，下面的写法是等价的</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line"><span class="keyword">values</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">values</span>[<span class="string">'username'</span>] = <span class="string">"1016903103@qq.com"</span></span><br><span class="line"><span class="keyword">values</span>[<span class="string">'password'</span>] = <span class="string">"XXXX"</span></span><br><span class="line"><span class="keyword">data</span> = urllib.urlencode(<span class="keyword">values</span>) </span><br><span class="line"><span class="keyword">url</span> = <span class="string">"http://passport.csdn.net/account/login?from=http://my.csdn.net/my/mycsdn"</span></span><br><span class="line">request = urllib2.Request(<span class="keyword">url</span>,<span class="keyword">data</span>)</span><br><span class="line">response = urllib2.urlopen(request)</span><br><span class="line">print response.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上方法便实现了POST方式的传送</p>
                  <h3 id="GET方式："><a href="#GET方式：" class="headerlink" title="GET方式："></a>GET方式：</h3>
                  <p>至于GET方式我们可以直接把参数写到网址上面，直接构建一个带参数的URL出来即可。</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import urllib</span><br><span class="line">import urllib2</span><br><span class="line"></span><br><span class="line"><span class="keyword">values</span>=&#123;&#125;</span><br><span class="line"><span class="keyword">values</span>[<span class="string">'username'</span>] = <span class="string">"1016903103@qq.com"</span></span><br><span class="line"><span class="keyword">values</span>[<span class="string">'password'</span>]=<span class="string">"XXXX"</span></span><br><span class="line"><span class="keyword">data</span> = urllib.urlencode(<span class="keyword">values</span>) </span><br><span class="line"><span class="keyword">url</span> = <span class="string">"http://passport.csdn.net/account/login"</span></span><br><span class="line">geturl = <span class="keyword">url</span> + <span class="string">"?"</span>+<span class="keyword">data</span></span><br><span class="line">request = urllib2.Request(geturl)</span><br><span class="line">response = urllib2.urlopen(request)</span><br><span class="line">print response.read()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你可以print geturl，打印输出一下url，发现其实就是原来的url加？然后加编码后的参数</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http:<span class="regexp">//</span>passport.csdn.net<span class="regexp">/account/</span>login?username=<span class="number">1016903103</span>%<span class="number">40</span>qq.com&amp;password=XXXX</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和我们平常GET访问方式一模一样，这样就实现了数据的GET方式传送。 本节讲解了一些基本使用，可以抓取到一些基本的网页信息，小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-13 01:48:23" itemprop="dateCreated datePublished" datetime="2015-02-13T01:48:23+08:00">2015-02-13</time>
                </span>
                <span id="/947.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门三之Urllib库的基本使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/942.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/942.html" class="post-title-link" itemprop="url">Python爬虫入门二之爬虫基础了解</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-什么是爬虫"><a href="#1-什么是爬虫" class="headerlink" title="1.什么是爬虫"></a>1.什么是爬虫</h2>
                  <p>爬虫，即网络爬虫，大家可以理解为在网络上爬行的一直蜘蛛，互联网就比作一张大网，而爬虫便是在这张网上爬来爬去的蜘蛛咯，如果它遇到资源，那么它就会抓取下来。想抓取什么？这个由你来控制它咯。 比如它在抓取一个网页，在这个网中他发现了一条道路，其实就是指向网页的超链接，那么它就可以爬到另一张网上来获取数据。这样，整个连在一起的大网对这之蜘蛛来说触手可及，分分钟爬下来不是事儿。</p>
                  <h2 id="2-浏览网页的过程"><a href="#2-浏览网页的过程" class="headerlink" title="2.浏览网页的过程"></a>2.浏览网页的过程</h2>
                  <p>在用户浏览网页的过程中，我们可能会看到许多好看的图片，比如 <a href="http://image.baidu.com/" target="_blank" rel="noopener">http://image.baidu.com/</a> ，我们会看到几张的图片以及百度搜索框，这个过程其实就是用户输入网址之后，经过DNS服务器，找到服务器主机，向服务器发出一个请求，服务器经过解析之后，发送给用户的浏览器 HTML、JS、CSS 等文件，浏览器解析出来，用户便可以看到形形色色的图片了。 因此，用户看到的网页实质是由 HTML 代码构成的，爬虫爬来的便是这些内容，通过分析和过滤这些 HTML 代码，实现对图片、文字等资源的获取。</p>
                  <h2 id="3-URL的含义"><a href="#3-URL的含义" class="headerlink" title="3.URL的含义"></a>3.URL的含义</h2>
                  <p>URL，即统一资源定位符，也就是我们说的网址，统一资源定位符是对可以从互联网上得到的资源的位置和访问方法的一种简洁的表示，是互联网上标准资源的地址。互联网上的每个文件都有一个唯一的URL，它包含的信息指出文件的位置以及浏览器应该怎么处理它。</p>
                  <blockquote>
                    <p>URL的格式由三部分组成： ①第一部分是协议(或称为服务方式)。 ②第二部分是存有该资源的主机IP地址(有时也包括端口号)。 ③第三部分是主机资源的具体地址，如目录和文件名等。</p>
                  </blockquote>
                  <p>爬虫爬取数据时必须要有一个目标的URL才可以获取数据，因此，它是爬虫获取数据的基本依据，准确理解它的含义对爬虫学习有很大帮助。</p>
                  <h2 id="4-环境的配置"><a href="#4-环境的配置" class="headerlink" title="4. 环境的配置"></a>4. 环境的配置</h2>
                  <p>学习Python，当然少不了环境的配置，最初我用的是Notepad++，不过发现它的提示功能实在是太弱了，于是，在Windows下我用了PyCharm，在Linux下我用了Eclipse for Python，另外还有几款比较优秀的IDE，大家可以参考这篇文章 <a href="http://www.oschina.net/news/57468/best-python-ide-for-developers" target="_blank" rel="noopener">学习Python推荐的IDE</a> 。好的开发工具是前进的推进器，希望大家可以找到适合自己的IDE 下一节，我们就正式步入 Python 爬虫学习的殿堂了，小伙伴准备好了嘛？</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-12 23:45:29" itemprop="dateCreated datePublished" datetime="2015-02-12T23:45:29+08:00">2015-02-12</time>
                </span>
                <span id="/942.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门二之爬虫基础了解" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>932</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/927.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/927.html" class="post-title-link" itemprop="url">Python爬虫入门一之综述</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好哈，最近博主在学习Python，学习期间也遇到一些问题，获得了一些经验，在此将自己的学习系统地整理下来，如果大家有兴趣学习爬虫的话，可以将这些文章作为参考，也欢迎大家一共分享学习经验。 Python版本:2.7，Python 3请另寻其他博文。 首先爬虫是什么？</p>
                  <blockquote>
                    <p>网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动的抓取万维网信息的程序或者脚本。</p>
                  </blockquote>
                  <p>根据我的经验，要学习Python爬虫，我们要学习的共有以下几点：</p>
                  <ul>
                    <li>Python基础知识</li>
                    <li>Python中urllib和urllib2库的用法</li>
                    <li>Python正则表达式</li>
                    <li>Python爬虫框架Scrapy</li>
                    <li>Python爬虫更高级的功能</li>
                  </ul>
                  <h2 id="1-Python基础学习"><a href="#1-Python基础学习" class="headerlink" title="1.Python基础学习"></a>1.Python基础学习</h2>
                  <p>首先，我们要用Python写爬虫，肯定要了解Python的基础吧，万丈高楼平地起，不能忘啦那地基，哈哈，那么我就分享一下自己曾经看过的一些Python教程，小伙伴们可以作为参考。</p>
                  <h3 id="1-慕课网Python教程"><a href="#1-慕课网Python教程" class="headerlink" title="1) 慕课网Python教程"></a>1) 慕课网Python教程</h3>
                  <p>曾经有一些基础的语法是在慕课网上看的，上面附有一些练习，学习完之后可以作为练习，感觉效果还是蛮不错的，不过稍微遗憾的是内容基本上都是最基础的，入门开始的话，就这个吧 学习网址：<a href="http://www.imooc.com/view/177" target="_blank" rel="noopener">慕课网Python教程</a></p>
                  <h3 id="2-廖雪峰Python教程"><a href="#2-廖雪峰Python教程" class="headerlink" title="2) 廖雪峰Python教程"></a>2) 廖雪峰Python教程</h3>
                  <p>后来，我发现了廖老师的Python教程，讲的那是非常通俗易懂哪，感觉也是非常不错，大家如果想进一步了解Python就看一下这个吧。 学习网址：<a href="http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000" target="_blank" rel="noopener">廖雪峰Python教程</a></p>
                  <h3 id="3-简明Python教程"><a href="#3-简明Python教程" class="headerlink" title="3) 简明Python教程"></a>3) 简明Python教程</h3>
                  <p>还有一个我看过的，简明Python教程，感觉讲的也不错 学习网址：<a href="http://woodpecker.org.cn/abyteofpython_cn/chinese/pr01.html#s01" target="_blank" rel="noopener">简明Python教程</a></p>
                  <h3 id="4-汪海的实验室"><a href="#4-汪海的实验室" class="headerlink" title="4) 汪海的实验室"></a>4) 汪海的实验室</h3>
                  <p>这是我的本科实验室学长，入门的时候参考的他的文章，自己重新做了总结，后来这些系列文章又在他的基础上增加了一些内容。 学习网址：<a href="http://blog.csdn.net/wxg694175346/article/category/1418998/1" target="_blank" rel="noopener">汪海的实验室</a></p>
                  <h2 id="2-Python-urllib和urllib2-库的用法"><a href="#2-Python-urllib和urllib2-库的用法" class="headerlink" title="2.Python urllib和urllib2 库的用法"></a>2.Python urllib和urllib2 库的用法</h2>
                  <p>urllib和urllib2库是学习Python爬虫最基本的库，利用这个库我们可以得到网页的内容，并对内容用正则表达式提取分析，得到我们想要的结果。这个在学习过程中我会和大家分享的。</p>
                  <h2 id="3-Python-正则表达式"><a href="#3-Python-正则表达式" class="headerlink" title="3.Python 正则表达式"></a>3.Python 正则表达式</h2>
                  <p>Python正则表达式是一种用来匹配字符串的强有力的武器。它的设计思想是用一种描述性的语言来给字符串定义一个规则，凡是符合规则的字符串，我们就认为它“匹配”了，否则，该字符串就是不合法的。这个在后面的博文会分享的。</p>
                  <h2 id="4-爬虫框架Scrapy"><a href="#4-爬虫框架Scrapy" class="headerlink" title="4.爬虫框架Scrapy"></a>4.爬虫框架Scrapy</h2>
                  <p>如果你是一个Python高手，基本的爬虫知识都已经掌握了，那么就寻觅一下Python框架吧，我选择的框架是Scrapy框架。这个框架有什么强大的功能呢？下面是它的官方介绍：</p>
                  <blockquote>
                    <p>HTML, XML源数据 选择及提取 的内置支持 提供了一系列在spider之间共享的可复用的过滤器(即 Item Loaders)，对智能处理爬取数据提供了内置支持。 通过 feed导出 提供了多格式(JSON、CSV、XML)，多存储后端(FTP、S3、本地文件系统)的内置支持 提供了media pipeline，可以 自动下载 爬取到的数据中的图片(或者其他资源)。 高扩展性。您可以通过使用 signals ，设计好的API(中间件, extensions, pipelines)来定制实现您的功能。 内置的中间件及扩展为下列功能提供了支持: cookies and session 处理 HTTP 压缩 HTTP 认证 HTTP 缓存 user-agent模拟 robots.txt 爬取深度限制 针对非英语语系中不标准或者错误的编码声明, 提供了自动检测以及健壮的编码支持。 支持根据模板生成爬虫。在加速爬虫创建的同时，保持在大型项目中的代码更为一致。详细内容请参阅 genspider 命令。 针对多爬虫下性能评估、失败检测，提供了可扩展的 状态收集工具 。 提供 交互式shell终端 , 为您测试XPath表达式，编写和调试爬虫提供了极大的方便 提供 System service, 简化在生产环境的部署及运行 内置 Web service, 使您可以监视及控制您的机器 内置 Telnet终端 ，通过在Scrapy进程中钩入Python终端，使您可以查看并且调试爬虫 Logging 为您在爬取过程中捕捉错误提供了方便 支持 Sitemaps 爬取 具有缓存的DNS解析器</p>
                  </blockquote>
                  <p>官方文档：<a href="http://doc.scrapy.org/en/latest/" target="_blank" rel="noopener">http://doc.scrapy.org/en/latest/</a> 等我们掌握了基础的知识，再用这个 Scrapy 框架吧！ 扯了这么多，好像没多少有用的东西额，那就不扯啦！ 下面开始我们正式进入爬虫之旅吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-12 15:35:17" itemprop="dateCreated datePublished" datetime="2015-02-12T15:35:17+08:00">2015-02-12</time>
                </span>
                <span id="/927.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫入门一之综述" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/932.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/932.html" class="post-title-link" itemprop="url">关于Ubuntu开机显示running in low-graphics 问题的解决办法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近一直在学习ubuntu，今天重装了系统，开机出现running in low-graphics mode 问题。 解决办法如下： 第一步：在出现running in low-graphics的界面右下角，有一个OK按钮，点击后有四个选项 第二步：随便点击一个选项可以进入tty1文字输入终端，但不可以进入图形界面 第三步：输入用户名和密码，再输入sudo apt-get install fglrx, Y／N选择Y，等待安装成功，再输入reboot重启之后，就可以正常进入了 以上是我遇到后的解决办法，有更好的解决办法，还请多多指教</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/Tiramisu" class="author" itemprop="url" rel="index">Tiramisu</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-11 23:02:14" itemprop="dateCreated datePublished" datetime="2015-02-11T23:02:14+08:00">2015-02-11</time>
                </span>
                <span id="/932.html" class="post-meta-item leancloud_visitors" data-flag-title="关于Ubuntu开机显示running in low-graphics 问题的解决办法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>253</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/930.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/930.html" class="post-title-link" itemprop="url">在Win7下格式化Ubuntu分区，开机出现grub rescue解决办法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>电脑是双系统，在win7系统下的磁盘管理中，格式化ubuntu分区，开机出现grub rescue。win7系统是完好的，但是进不去。 原因是开机引导出现问题，具体原因在这里不再详述。以下是解决办法 第一步：输入ls出现（hd0,msods1),（hd0,msdos5),（hd0,msods6),（hd0,msods7)，不同的电脑不一样，这是我电脑中的磁盘分区 第二步：输入set，查看现在电脑的root 和prefix所在的位置 第三步：查找你的grub目录（当然如果你知道你grub目录在哪里更好） 查找方法输入ls/(hd0,msdos1) 再按enter看看有没有boot文件夹，如果没有，就输入ls/(hd0,msdos5)等等，依次类推。。。 这里输入（hd0，madosX)是根据你输入ls出现的磁盘分区来输入的 第四步：找到boot文件夹在哪里之后，假设在（hd0,msdos7)中， 输入set root=(hd0,msdos7), 输入set prefix=（hd0，msdos7)/boot/grub 输入insmod normal 输入normal 第五步：之后回车之后应该出现启动界面，如果没有正常启动，文章后边有解决办法 如果正常启动，可以进入linux界面，输入sudo update-grub，回车 第六步：再输入sudo grub-install /dev/sda ，回车 第七步：最后输入reboot 还有一种情况，就是输入insmod normal显示找不到文件，可以选择制作ubuntu开机引导盘，重装ubuntu，不用担心，我们的win7系统还在，重装重启后，就可以看到我们熟悉的系统选择界面，有WIN7还有ubuntu，这样你就可以任意选择你想要进入的系统了。 有不足的地方，请多多指教。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/Tiramisu" class="author" itemprop="url" rel="index">Tiramisu</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-10 23:04:41" itemprop="dateCreated datePublished" datetime="2015-02-10T23:04:41+08:00">2015-02-10</time>
                </span>
                <span id="/930.html" class="post-meta-item leancloud_visitors" data-flag-title="在Win7下格式化Ubuntu分区，开机出现grub rescue解决办法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>740</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/829.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/829.html" class="post-title-link" itemprop="url">WordPress自定义登录注册界面样式及LOGO</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>WordPress主题做好了，但是登录界面还是原生的样子，带有WordPress的图标，现在我们想把Logo自定义成我们想要的样子。 原来的登录界面如下： <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204161421.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204161421.jpg" alt="QQ截图20150204161421"></a> 现在开始，我们将把WordPress图标换做我们自定义的LOGO，首先要明确的是我们不能修改WordPress的源代码，因为如果有版本更新之类的操作，这个效果就找不到了，所以我们需要在主题下修改。 1.修改主题下的 functions.php 文件 在主题的最后面加入下面的代码，来引入一个CSS文件</p>
                  <figure class="highlight php">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 登陆界面图标 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">custom_login</span><span class="params">()</span> </span>&#123; </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">'&lt;link rel="stylesheet" tyssspe="text/css" href="'</span> . get_bloginfo(<span class="string">'template_directory'</span>) . <span class="string">'/login/icon.css" /&gt;'</span>; &#125; </span><br><span class="line"> add_action(<span class="string">'login_head'</span>, <span class="string">'custom_login'</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>也就是引入了 login 目录下的 icon.css 样式表。 2.新建 icon.css 文件 在主题目录下新建 login文件夹，然后新建 icon.css 文件，编码为UTF-8，然后拖入我们自定义的LOGO，命名为 logo.png login目录里面是这样子的 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204162536.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204162536.jpg" alt="QQ截图20150204162536"></a> 我的网站自定义的logo如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/logo.png" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/logo.png" alt="logo"></a> 大家可以自己设计好的LOGO放入login目录下 在 icon.css 中加入如下代码</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.login</span> <span class="selector-tag">h1</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line"> <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">'logo.png'</span>);</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">230px</span>;</span><br><span class="line"> <span class="attribute">background-size</span>: <span class="number">230px</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在以上代码中设定了背景图和宽高度还有背景图片的大小即可。 如果想添加其他样式，只要在 icon.css 文件中加入样式就好。 三、刷新预览 修改完之后，我们预览一下，大功告成啦！ 效果图如下 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204162703.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204162703.jpg" alt="QQ截图20150204162703"></a> 酷酷哒！小伙伴们快来尝试一下吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-04 16:32:42" itemprop="dateCreated datePublished" datetime="2015-02-04T16:32:42+08:00">2015-02-04</time>
                </span>
                <span id="/829.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress自定义登录注册界面样式及LOGO" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>812</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/809.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/809.html" class="post-title-link" itemprop="url">WordPress中去掉CSS文件后的参数，解决修改样式不生效的问题</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="一、移除主题中的样式版本号"><a href="#一、移除主题中的样式版本号" class="headerlink" title="一、移除主题中的样式版本号"></a>一、移除主题中的样式版本号</h2>
                  <p>在更新新版本之后，发现WordPress中的JS和CSS文件引入时带有ver参数，在浏览器中审查元素或者 F12 查看其引入的文件，就如图中一样，文件的末尾会带有一个这样的参数，这样带来的麻烦有很多。很大的问题就是 修改style.css 文件不生效，它带有这个参数的作用就会让浏览器加载缓存的 JS 和 CSS 文件，而你修改了样式之后它还是不会生效。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/0150201161853.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/0150201161853.jpg" alt="0150201161853"></a> 那么这个怎么去除？ 找到你的主题文件中的 functions.php 文件 找到类似于下面的代码：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wp<span class="constructor">_register_script( '<span class="params">jquery</span>','<span class="operator">/</span><span class="operator">/</span><span class="params">libs</span>.<span class="params">baidu</span>.<span class="params">com</span><span class="operator">/</span><span class="params">jquery</span><span class="operator">/</span>1.8.3<span class="operator">/</span><span class="params">jquery</span>.<span class="params">min</span>.<span class="params">js</span>', <span class="params">false</span>,'1.0')</span>;</span><br><span class="line">wp<span class="constructor">_enqueue_script( '<span class="params">jquery</span>' )</span>;</span><br><span class="line">wp<span class="constructor">_register_script( '<span class="params">default</span>', <span class="params">get_template_directory_uri</span>()</span> . '/js/jquery.js', <span class="literal">false</span>, '<span class="number">1.0</span>', dopt('d_jquerybom_b') ? <span class="literal">true</span> : <span class="literal">false</span> ); </span><br><span class="line">wp<span class="constructor">_enqueue_script( '<span class="params">default</span>' )</span>; </span><br><span class="line">wp<span class="constructor">_register_style( '<span class="params">style</span>', <span class="params">get_template_directory_uri</span>()</span> . '/style.css',<span class="literal">false</span>,'<span class="number">1.0</span>');</span><br><span class="line">wp<span class="constructor">_enqueue_style( '<span class="params">style</span>' )</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你可以查找这几个函数名来找到。 你可以发现倒数第二行，引入了 style.css 文件，那么第四个参数就是罪魁祸首了，就是文件的版本号，把第四个参数修改为 null 即可，记住不要加引号的 null</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wp_register_style( <span class="string">'style'</span>, get_template_directory_uri() . <span class="string">'/style.css'</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样刷新页面，你就会发现 style.css 样式表后面的参数就不见啦。 同样的道理，对于 JS文件，你同样可以通过修改第四个参数来解决问题。</p>
                  <h2 id="二、移除主题之外样式版本号"><a href="#二、移除主题之外样式版本号" class="headerlink" title="二、移除主题之外样式版本号"></a>二、移除主题之外样式版本号</h2>
                  <p>除了主题之内的CSS和JS带有版本号，主题之外的界面也带有版本号，比如登录界面等等，如果你想定制一个个性化的登录界面，那么你可以修改 wp-admin 目录下的css样式。但是，修改完之后仍然存在不生效的问题。这个怎么办？ 如下图所示，<a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/150204145120.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/150204145120-1024x505.jpg" alt="150204145120"></a> 审查该登录界面的元素，你会发现它的CSS样式仍然带有版本号，这会导致我们不管怎样修改 login.min.css 仍不会生效，那么我们就分析一下源代码。 我从 wp-admin 目录下找到了 load-styles.php 文件，它正是加载 CSS样式所必备的文件，但是和上面的主题中加载CSS文件的方式不同，它并不存在 wp_register_style 这个方法，不过我发现，它引入了一个 version.php 文件，代码如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">require( <span class="name">ABSPATH</span> . WPINC . '/version.php' )<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么它的路径在哪里，我们会发现 ABSPATH和 WPINC两个变量，这是两个宏定义</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">define( 'ABSPATH', dirname(<span class="name">dirname</span>(<span class="name">__FILE__</span>)) . '/' )<span class="comment">;</span></span><br><span class="line">define( 'WPINC', 'wp-includes' )<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>顺藤摸瓜，我们找到了 wp-includes 目录下的 version.php 文件，其中就定义了版本号这个变量</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">$wp</span>_version = <span class="string">'4.0.1'</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据上面的思路，我们只需要把 version 改成null即可，试一下。这个方法不算好，去掉版本号之后一些插件可能识别有问题，请谨慎修改。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">$wp</span>_version = <span class="literal">null</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再来审查一下元素，我们就已经发现，版本号的后缀不见啦。 <a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204145920.jpg" target="_blank" rel="noopener"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/QQ截图20150204145920.jpg" alt="QQ截图20150204145920"></a> 我们之前修改的样式也已经生效了！如果还有更好的方法，欢迎补充！ 以上只是我的一些拙见，希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-01 16:30:40" itemprop="dateCreated datePublished" datetime="2015-02-01T16:30:40+08:00">2015-02-01</time>
                </span>
                <span id="/809.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress中去掉CSS文件后的参数，解决修改样式不生效的问题" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/806.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="崔庆才的个人站点，记录生活的瞬间，分享学习的心得。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/806.html" class="post-title-link" itemprop="url">Python字符串的相关操作</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="1-大小写转换"><a href="#1-大小写转换" class="headerlink" title="1.大小写转换"></a>1.大小写转换</h2>
                  <p>判断字符串</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">s.isalnum() <span class="meta">#所有字符都是数字或者字母</span></span><br><span class="line">s.isalpha() <span class="meta">#所有字符都是字母</span></span><br><span class="line">s.isdigit() <span class="meta">#所有字符都是数字</span></span><br><span class="line">s.islower() <span class="meta">#所有字符都是小写</span></span><br><span class="line">s.isupper() <span class="meta">#所有字符都是大写</span></span><br><span class="line">s.istitle() <span class="meta">#所有单词都是首字母大写，像标题</span></span><br><span class="line">s.isspace() <span class="meta">#所有字符都是空白字符、\t、\n</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>大小写转换</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">s.<span class="built_in">upper</span>() <span class="comment">#把所有字符中的小写字母转换成大写字母</span></span><br><span class="line">s.<span class="built_in">lower</span>() <span class="comment">#把所有字符中的大写字母转换成小写字母</span></span><br><span class="line">s.capitalize()  <span class="comment">#把第一个字母转化为大写字母，其余小写</span></span><br><span class="line">s.title()  <span class="comment">#把每个单词的第一个字母转化为大写，其余小写</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-02-01 15:49:40" itemprop="dateCreated datePublished" datetime="2015-02-01T15:49:40+08:00">2015-02-01</time>
                </span>
                <span id="/806.html" class="post-meta-item leancloud_visitors" data-flag-title="Python字符串的相关操作" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>307</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">崔庆才的个人站点，记录生活的瞬间，分享学习的心得。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">519</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">21</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">122</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://www.abuyun.com/http-proxy/introduce.html" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/88au8.jpg" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://tutorial.lengyue.video/?coupon=12ef4b1a-a3db-11ea-bb37-0242ac130002_cqx_850" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/bco2a.png" style=" width: 100%;">
              </a>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://luminati-china.io/?affiliate=ref_5fbbaaa9647883f5c6f77095" target="_blank" rel="noopener">
                <img src="https://qiniu.cuiqingcai.com/ikkq9.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/599/" style="font-size: 10px;">599</a> <a href="/tags/Bootstrap/" style="font-size: 11.25px;">Bootstrap</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11.25px;">Eclipse</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/GitHub/" style="font-size: 11.25px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 11.25px;">PHP</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/PySpider/" style="font-size: 10px;">PySpider</a> <a href="/tags/Python/" style="font-size: 16.25px;">Python</a> <a href="/tags/Python3/" style="font-size: 12.5px;">Python3</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 10px;">Selenium</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/Ubuntu/" style="font-size: 11.25px;">Ubuntu</a> <a href="/tags/Vue/" style="font-size: 11.25px;">Vue</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13.75px;">WordPress</a> <a href="/tags/object-Object/" style="font-size: 10px;">[object Object]</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/js%E9%80%86%E5%90%91/" style="font-size: 10px;">js逆向</a> <a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/matlab/" style="font-size: 11.25px;">matlab</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/pywin32/" style="font-size: 10px;">pywin32</a> <a href="/tags/style/" style="font-size: 10px;">style</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/uwsgi/" style="font-size: 10px;">uwsgi</a> <a href="/tags/validate-cert/" style="font-size: 10px;">validate_cert</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/wamp/" style="font-size: 10px;">wamp</a> <a href="/tags/wineQQ/" style="font-size: 10px;">wineQQ</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 11.25px;">七牛</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 10px;">上海</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/" style="font-size: 10px;">个人网站</a> <a href="/tags/%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">主题</a> <a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 10px;">云存储</a> <a href="/tags/%E4%BA%AC%E4%B8%9C%E4%BA%91/" style="font-size: 10px;">京东云</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 10px;">人工智能</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 10px;">代理</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">代码</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 10px;">优化</a> <a href="/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size: 10px;">位运算</a> <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 10px;">分享</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 10px;">创业</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 11.25px;">前端</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%8E%9F%E7%94%9FAPP/" style="font-size: 10px;">原生APP</a> <a href="/tags/%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 12.5px;">反爬虫</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80/" style="font-size: 10px;">响应式布局</a> <a href="/tags/%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A/" style="font-size: 10px;">域名绑定</a> <a href="/tags/%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84/" style="font-size: 10px;">大众点评</a> <a href="/tags/%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">字体反爬虫</a> <a href="/tags/%E5%AE%9E%E7%94%A8/" style="font-size: 10px;">实用</a> <a href="/tags/%E5%B4%94%E5%BA%86%E6%89%8D/" style="font-size: 18.75px;">崔庆才</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE/" style="font-size: 10px;">手机访问</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/tags/%E6%97%85%E6%B8%B8/" style="font-size: 10px;">旅游</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E6%9D%9C%E5%85%B0%E7%89%B9/" style="font-size: 10px;">杜兰特</a> <a href="/tags/%E6%A1%8C%E9%9D%A2/" style="font-size: 10px;">桌面</a> <a href="/tags/%E6%B1%9F%E5%8D%97/" style="font-size: 10px;">江南</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 10px;">环境变量</a> <a href="/tags/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">生活笔记</a> <a href="/tags/%E7%99%BB%E5%BD%95/" style="font-size: 10px;">登录</a> <a href="/tags/%E7%9F%A5%E4%B9%8E/" style="font-size: 10px;">知乎</a> <a href="/tags/%E7%9F%AD%E4%BF%A1/" style="font-size: 10px;">短信</a> <a href="/tags/%E7%BA%B8%E5%BC%A0/" style="font-size: 10px;">纸张</a> <a href="/tags/%E7%BD%91%E7%AB%99/" style="font-size: 10px;">网站</a> <a href="/tags/%E8%82%89%E5%A4%B9%E9%A6%8D/" style="font-size: 10px;">肉夹馍</a> <a href="/tags/%E8%A5%BF%E5%B0%91%E7%88%B7/" style="font-size: 10px;">西少爷</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%BF%9C%E7%A8%8B/" style="font-size: 10px;">远程</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">配置</a> <a href="/tags/%E9%87%8D%E8%A3%85/" style="font-size: 10px;">重装</a> <a href="/tags/%E9%9D%99%E8%A7%85/" style="font-size: 17.5px;">静觅</a> <a href="/tags/%E9%A2%A0%E8%A6%86/" style="font-size: 10px;">颠覆</a> <a href="/tags/%E9%A3%9E%E4%BF%A1/" style="font-size: 10px;">飞信</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">13</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">15</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">38</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">256</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">10</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">75</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">2</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ou6mm.jpg">
                  </span>
                  <span class="link">
                    <a href="https://diygod.me/" target="_blank" rel="noopener">DIYgod</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.jankl.com/img/titleshu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.jankl.com/" target="_blank" rel="noopener">liberalist</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/4i7yf.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lizenghai.com/" target="_blank" rel="noopener">Python量化投资</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/shwr6.png">
                  </span>
                  <span class="link">
                    <a href="http://lanbing510.info/" target="_blank" rel="noopener">冰蓝</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/blvoh.jpg">
                  </span>
                  <span class="link">
                    <a href="https://lengyue.me/" target="_blank" rel="noopener">冷月</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/22uv1.png">
                  </span>
                  <span class="link">
                    <a href="http://www.cenchong.com/" target="_blank" rel="noopener">岑冲博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/ev9kl.png">
                  </span>
                  <span class="link">
                    <a href="http://www.zxiaoji.com/" target="_blank" rel="noopener">张小鸡</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.chrafz.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.chrafz.com/" target="_blank" rel="noopener">张弦先生</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.503error.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.503error.com/" target="_blank" rel="noopener">张志明个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://seofangfa.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://seofangfa.com/" target="_blank" rel="noopener">方法SEO</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lfmj3.png">
                  </span>
                  <span class="link">
                    <a href="http://frankchen.xyz/" target="_blank" rel="noopener">不正经数据科学家</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/129d8.png">
                  </span>
                  <span class="link">
                    <a href="https://www.bysocket.com/" target="_blank" rel="noopener">泥瓦匠BYSocket</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.xiongge.club/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.xiongge.club/" target="_blank" rel="noopener">熊哥club</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/3w4fe.png">
                  </span>
                  <span class="link">
                    <a href="https://zerlong.com/" target="_blank" rel="noopener">知语</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/262r1.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.ysir308.com/" target="_blank" rel="noopener">程序员虾说</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/8g1fk.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.laodong.me/" target="_blank" rel="noopener">老董博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://qiniu.cuiqingcai.com/2y43o.png">
                  </span>
                  <span class="link">
                    <a href="http://bbs.nightteam.cn/" target="_blank" rel="noopener">夜幕爬虫安全论坛</a>
                  </span>
                </li>
              </ul>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">2.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">37:35</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": null,
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
