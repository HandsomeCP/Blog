<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>静觅</title>
  
  <subtitle>崔庆才的个人站点</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://cuiqingcai.com/"/>
  <updated>2021-02-10T17:37:39.224Z</updated>
  <id>https://cuiqingcai.com/</id>
  
  <author>
    <name>崔庆才</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Vue.js 的 prop 如何实现双向绑定</title>
    <link href="https://cuiqingcai.com/30006.html"/>
    <id>https://cuiqingcai.com/30006.html</id>
    <published>2021-02-11T12:16:18.000Z</published>
    <updated>2021-02-10T17:37:39.224Z</updated>
    
    <content type="html"><![CDATA[<p>最近遇到了一个问题，就是 Vue.js 中的 prop 如何实现双向绑定比较好。</p><p>之前我都是把 prop 传递到子组件，然后子组件里面直接把 prop 直接改了，这样虽然能把结果反映到父组件，但并不是一个很好的解决方案。</p><p>比如我就经常遇到这样的 Warning：</p><blockquote>  <p>Avoid mutating a prop directly since the value will be overwritten…</p></blockquote><p>实际上，用事件传递的方式把修改从子组件传到父组件是比较不错的方式，这就需要子组件 $emit 一个事件，然后父组件监听这个事件，然后将接收到的值修改就好了。</p><p>官方文档的说明如下：</p><blockquote>  <p>在有些情况下，我们可能需要对一个 prop 进行“双向绑定”。不幸的是，真正的双向绑定会带来维护上的问题，因为子组件可以变更父组件，且在父组件和子组件都没有明显的变更来源。</p>  <p>这也是为什么我们推荐以 <code>update:myPropName</code> 的模式触发事件取而代之。举个例子，在一个包含 <code>title</code> prop 的假设的组件中，我们可以用以下方法表达对其赋新值的意图：</p>  <figure class="highlight javascript">    <table>      <tr>        <td class="gutter">          <pre><span class="line">1</span><br></pre>        </td>        <td class="code">          <pre><span class="line"><span class="keyword">this</span>.$emit(<span class="string">'update:title'</span>, newTitle)</span><br></pre>        </td>      </tr>    </table>  </figure></blockquote><p>所以这里推荐的就是使用 <code>update:propName</code> 来实现。</p><p>这样的话，父组件原生的写法如下：</p><figure class="highlight html">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="tag">&lt;<span class="name">text-document</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-bind:title</span>=<span class="string">"doc.title"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:update:title</span>=<span class="string">"doc.title = $event"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">text-document</span>&gt;</span></span><br></pre>      </td>    </tr>  </table></figure><p>这里 prop 的名字叫做 title，子组件需要接收到这个值，然后各种操作进行修改都没关系。</p><p>比如子组件可以这么写：</p><figure class="highlight plain">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>      </td>      <td class="code">        <pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-input v-model&#x3D;&quot;titleData&quot;&gt;&lt;&#x2F;el-input&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Child&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &quot;&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      titleData: this.title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    titleData: &#123;</span><br><span class="line">      handler(val) &#123;</span><br><span class="line">        this.$emit(&#39;update:title&#39;, val)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre>      </td>    </tr>  </table></figure><p>这样当 titleData 更新的时候，父组件的 title 就更新了。</p><p>这时候父组件可以简写为：</p><figure class="highlight html">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="tag">&lt;<span class="name">text-document</span> <span class="attr">v-bind:title.sync</span>=<span class="string">"doc.title"</span>&gt;</span><span class="tag">&lt;/<span class="name">text-document</span>&gt;</span></span><br></pre>      </td>    </tr>  </table></figure><blockquote>  <p>注意带有 <code>.sync</code> 修饰符的 <code>v-bind</code> <strong>不能</strong>和表达式一起使用 (例如 <code>v-bind:title.sync=”doc.title + ‘!’”</code> 是无效的)。取而代之的是，你只能提供你想要绑定的 property 名，类似 <code>v-model</code>。</p></blockquote><p>另外当我们用一个对象同时设置多个 prop 的时候，也可以将这个 <code>.sync</code> 修饰符和 <code>v-bind</code> 配合使用：</p><figure class="highlight html">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="tag">&lt;<span class="name">text-document</span> <span class="attr">v-bind.sync</span>=<span class="string">"doc"</span>&gt;</span><span class="tag">&lt;/<span class="name">text-document</span>&gt;</span></span><br></pre>      </td>    </tr>  </table></figure><p>这样会把 <code>doc</code> 对象中的每一个 property (如 <code>title</code>) 都作为一个独立的 prop 传进去，然后各自添加用于更新的 <code>v-on</code> 监听器。</p><blockquote>  <p>将 <code>v-bind.sync</code> 用在一个字面量的对象上，例如 <code>v-bind.sync=”{ title: doc.title }”</code>，是无法正常工作的，因为在解析一个像这样的复杂表达式的时候，有很多边缘情况需要考虑。</p></blockquote><p>以上，完毕。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近遇到了一个问题，就是 Vue.js 中的 prop 如何实现双向绑定比较好。&lt;/p&gt;
&lt;p&gt;之前我都是把 prop 传递到子组件，然后子组件里面直接把 prop 直接改了，这样虽然能把结果反映到父组件，但并不是一个很好的解决方案。&lt;/p&gt;
&lt;p&gt;比如我就经常遇到这样的 
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="前端" scheme="https://cuiqingcai.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Vue" scheme="https://cuiqingcai.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>怎样让你的GitHub全绿</title>
    <link href="https://cuiqingcai.com/30005.html"/>
    <id>https://cuiqingcai.com/30005.html</id>
    <published>2021-02-11T12:16:18.000Z</published>
    <updated>2021-02-10T17:36:43.600Z</updated>
    
    <content type="html"><![CDATA[<p>写这篇文章的缘由来自看到了知乎上的一个问题——在 GitHub 上保持 365 天全绿是一种怎样的体验？</p><h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>大家可能有的不明白啥意思啊，这个绿指的是就是 GitHub 的 Contribution，如果你每天都提交代码到 GitHub，至少一次 commit，那么 GitHub 就会在你当天对应的 Contribution 格子上点上绿色，比如我的就是这样子：</p><p><img src="https://qiniu.cuiqingcai.com/bir3j.png" alt=""></p><p>因为我经常在 GitHub 上提交代码，所以我的 Contribution 页面就显示为绿色，commit 多的就深，少的就浅，灰色的就是当然没有任何代码提交的。</p><p>所以这个问题问的就是，每天都在 GitHub 上提交代码是什么体验，也就是 365 天每天一天不落地撸代码是什么体验？</p><p>然后有一个回答看得我笑出声：</p><blockquote>  <p>曾经保持了200多天全绿，但是冷落了女朋友，一直绿到现在。</p></blockquote><p>原回答如下：</p><p><img src="https://qiniu.cuiqingcai.com/v3th3.png" alt=""></p><p>这哥们真的是太秀了，秀到我实在忍不住给他默默点了个赞…</p><p>不过咱们还是言归正传啊，说回这个问题。</p><p>其实说实话真的保持 365 天全绿真的是一件很难的事情，每周都会有周末吧，周末得陪女朋友吧？什么，你没有女朋友，那忽略这一条。</p><p>那即使没有女朋友，一年不得有几天是过年过节的，还撸啥代码啊？即使不是逢年过节，那也总有几天状态不好或者生病的吧，强如铁人那坚持 365 天天撸代码也是够神的。</p><p>不过我还真见过几个，实打实的大神，比如 Taylor Otweel，PHP Laravel 框架的开发者，一年 8000 多次 commit，他的 Contribution 是这样的：</p><p><img src="https://qiniu.cuiqingcai.com/c8w1x.png" alt=""></p><p>这个是真的强，而且人家撸的代码质量肯定也高啊，不像我们可能改了点 README 啥的。</p><p>但强如 Taylor Otweel，你也能看到有些天是没有贡献的，毕竟人家周末可能就真的不撸代码或者有其他的安排。</p><p>那怎么才能做到 365 天全绿呢？</p><p>既然人不行，那就靠机器人吧。</p><p>GitHub 不是这两年出了个 GitHub Actions 的功能吗？这就是 CI 嘛，借助于它，我们想做到 GitHub 365 天全绿，就轻而易举了。</p><p>到底怎么做？难不难。</p><p>不难，可能只需要两分钟就搞定了。</p><p>想不想知道怎么做的？想知道的接着往下看。</p><h2 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h2><p>这里介绍一个 GitHub 的库，地址为：<a href="https://github.com/justjavac/auto-green，借助它，咔咔几步就能搞定了。" target="_blank" rel="noopener">https://github.com/justjavac/auto-green，借助它，咔咔几步就能搞定了。</a></p><p>先说步骤。</p><p>首先打开这个仓库，点 Use this template，注意千万不要点 Fork，不然是不生效的，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/xlcq9.png" alt=""></p><p>点了之后就是提示你用这个 Template 创建一个自己的 Git 残酷，这时候就会让你填写的的仓库名称，比如我就创建了一个名字叫做 AutoGreen 的仓库，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/a83or.png" alt=""></p><p>至此，已经成功了一半了。</p><p>现在你会观察到，在 Actions 这个选项卡自动执行了一个任务。啪！很快啊，执行完了：</p><p><img src="https://qiniu.cuiqingcai.com/44c26.png" alt=""></p><p>执行完了你会发现这个仓库多了一次 commit，是来自 justjavac 的一次 commit：</p><p><img src="https://qiniu.cuiqingcai.com/1s33b.png" alt=""></p><p>点进去看看，commit 的信息还叫 “a commit a day keeps your girlfriend away”，啥意思？</p><p>跟代码做好朋友，永远没有女朋友？？？Oh，No，不是这样的！</p><p>commit 如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/0cnts.png" alt=""></p><p>神奇的是这次 commit 还没有任何 file change，还是个空的 commit。</p><p>行了，不管这么多了。</p><p>到现在就结束了吗？GitHub 以后就会天天绿了吗，当然不会绿啊，为啥啊？</p><p>扒一扒源码看一下，打开 <code>.github/workflows/ci.yml</code> 文件，结果如下：</p><p><img src="https://qiniu.cuiqingcai.com/4v7aa.png" alt="">代码：</p><figure class="highlight yaml">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="attr">name:</span> <span class="string">ci</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">"0 0 * * *"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">autogreen:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Clone</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Auto</span> <span class="string">green</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--local</span> <span class="string">user.email</span> <span class="string">"justjavac@gmail.com"</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--local</span> <span class="string">user.name</span> <span class="string">"迷渡"</span></span><br><span class="line">          <span class="string">git</span> <span class="string">remote</span> <span class="string">set-url</span> <span class="string">origin</span> <span class="string">https://$&#123;&#123;</span> <span class="string">github.actor</span> <span class="string">&#125;&#125;:$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;@github.com/$&#123;&#123;</span> <span class="string">github.repository</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">pull</span> <span class="string">--rebase</span></span><br><span class="line">          <span class="string">git</span> <span class="string">commit</span> <span class="string">--allow-empty</span> <span class="string">-m</span> <span class="string">"a commit a day keeps your girlfriend away"</span></span><br><span class="line">          <span class="string">git</span> <span class="string">push</span></span><br></pre>      </td>    </tr>  </table></figure><p>看看这个文件，意思就是每天执行一下下面的这几行代码，比如 git 的 config、commit、push 等，就相当于模拟了一次提交。</p><p>其中有几行代码比较有意思：</p><figure class="highlight dsconfig">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="string">git </span><span class="string">remote </span><span class="built_in">set-url</span> <span class="string">origin </span><span class="string">https:</span>//$&#123;&#123; <span class="string">github.</span><span class="string">actor </span>&#125;&#125;:$&#123;&#123; <span class="string">secrets.</span><span class="string">GITHUB_TOKEN </span>&#125;&#125;@<span class="string">github.</span><span class="string">com/</span>$&#123;&#123; <span class="string">github.</span><span class="string">repository </span>&#125;&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里就是指定远程仓库等地址，这里有几个占位符，github 的 actor 和 repository 对象，其实这些我们不用管，在运行的时候会被自动赋值为当前仓库的信息，另外还有 GITHUB_TOKEN 也是在该任务运行的时候自动添加的。</p><p>另外还有一行代码：</p><figure class="highlight pgsql">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">git <span class="keyword">commit</span> <span class="comment">--allow-empty -m "a commit a day keeps your girlfriend away"</span></span><br></pre>      </td>    </tr>  </table></figure><p>这里的 commit 操作加上了一个 <code>--allow-empty</code> 选项，意思就是允许空的提交，这也就解释了上文空提交的缘由了。</p><p>OK，但这里我们再回过头来看看配置就知道为啥不算我们的提交了：</p><p><img src="https://qiniu.cuiqingcai.com/zv2tf.png" alt=""></p><p>因为这里配置的是原作者的 GitHub 邮箱，所以这次提交当然就会算作原作者的了。</p><p>那怎么才能让我们的绿呢？那把邮箱改成我们自己的就好了，比如我的就修改为了这样子：</p><figure class="highlight">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="attribute">name</span>: ci</span><br><span class="line"></span><br><span class="line"><span class="attribute">on:</span></span><br><span class="line">  push:</span><br><span class="line">    branches:</span><br><span class="line">      - master</span><br><span class="line">  schedule:</span><br><span class="line">    - cron: "0 0 * * *"</span><br><span class="line"></span><br><span class="line"><span class="attribute">jobs:</span></span><br><span class="line">  autogreen:</span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line">    steps:</span><br><span class="line">      - name: Clone repository</span><br><span class="line">        uses: actions/checkout@v2</span><br><span class="line"></span><br><span class="line">      - name: Auto green</span><br><span class="line">        run: |</span><br><span class="line">          git config --local user.email "cqc@cuiqingcai.com"</span><br><span class="line">          git config --local user.name "Germey"</span><br><span class="line">          git remote set-url origin https://$&#123;&#123; github.actor &#125;&#125;:$&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;@github.com/$&#123;&#123; github.repository &#125;&#125;</span><br><span class="line">          git pull --rebase</span><br><span class="line">          git commit --allow-empty -m "a commit a day keeps your girlfriend away"</span><br><span class="line">          git push</span><br></pre>      </td>    </tr>  </table></figure><p>直接在 GitHub 网页上点击修改，修改好了保存就行了。</p><p>修改完了之后我们就自动有了一次 commit，接着 Actions 还会自动触发一次 commit，最后结果如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/a5wv5.png" alt=""></p><p>可以看到，最后这次 commit 已经变成我自己了。</p><p>以后，我每天都可以自动绿了。</p><p>（这话怎么听着这么奇怪？</p><h2 id="福利"><a href="#福利" class="headerlink" title="福利"></a>福利</h2><p>最后，原作者还预留了一个定时任务，可以使得你想绿就绿，不仅可以让你每天都绿，还能让你每小时都绿，每分钟都能绿。</p><p>想绿就绿，其乐无穷。</p><p>绿的方式很简单，套用原作者的介绍了，修改 yml 文件的定时配置就好了：</p><p>计划任务语法有 5 个字段，中间用空格分隔，每个字段代表一个时间单位。</p><figure class="highlight plain">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>      </td>      <td class="code">        <pre><span class="line">┌───────────── 分钟 (0 - 59)</span><br><span class="line">│ ┌───────────── 小时 (0 - 23)</span><br><span class="line">│ │ ┌───────────── 日 (1 - 31)</span><br><span class="line">│ │ │ ┌───────────── 月 (1 - 12 或 JAN-DEC)</span><br><span class="line">│ │ │ │ ┌───────────── 星期 (0 - 6 或 SUN-SAT)</span><br><span class="line">│ │ │ │ │</span><br><span class="line">│ │ │ │ │</span><br><span class="line">│ │ │ │ │</span><br><span class="line">* * * * *</span><br></pre>      </td>    </tr>  </table></figure><p>每个时间字段的含义：</p><div class="table-container">  <table>    <thead>      <tr>        <th>符号</th>        <th>描述</th>        <th>举例</th>      </tr>    </thead>    <tbody>      <tr>        <td><code>*</code></td>        <td>任意值</td>        <td><code>* * * * *</code> 每天每小时每分钟</td>      </tr>      <tr>        <td><code>,</code></td>        <td>值分隔符</td>        <td><code>1,3,4,7 * * * *</code> 每小时的 1 3 4 7 分钟</td>      </tr>      <tr>        <td><code>-</code></td>        <td>范围</td>        <td><code>1-6 * * * *</code> 每小时的 1-6 分钟</td>      </tr>      <tr>        <td><code>/</code></td>        <td>每</td>        <td><code>*/15 * * * *</code> 每隔 15 分钟</td>      </tr>    </tbody>  </table></div><p>比如修改为 <code>0 * * * *</code> ，你就能做到每小时都绿了，修改为 <code>* * * * *</code> 你就能每分钟都绿了，真舒服啊！</p><p><strong>注</strong>：由于 GitHub Actions 的限制，如果设置为 <code>* * * * *</code> 实际的执行频率为每 5 分执行一次，也就是每 5 分钟绿一次，也还不错嘛～</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;写这篇文章的缘由来自看到了知乎上的一个问题——在 GitHub 上保持 365 天全绿是一种怎样的体验？&lt;/p&gt;
&lt;h2 id=&quot;解释&quot;&gt;&lt;a href=&quot;#解释&quot; class=&quot;headerlink&quot; title=&quot;解释&quot;&gt;&lt;/a&gt;解释&lt;/h2&gt;
&lt;p&gt;大家可能有的不明白
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="GitHub" scheme="https://cuiqingcai.com/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>各种变量格式你真的都清楚吗？</title>
    <link href="https://cuiqingcai.com/30007.html"/>
    <id>https://cuiqingcai.com/30007.html</id>
    <published>2021-02-11T02:16:18.000Z</published>
    <updated>2021-02-10T17:38:24.927Z</updated>
    
    <content type="html"><![CDATA[<p>大家想必听说过一些变量命名格式，比如大驼峰式、小驼峰式，其他的你还知道什么？</p><p>今天看文档的时候，提到了一个 kebab case，这个你知道是什么命名格式吗？不知道的接着往下看。</p><p>这篇文章我们把所有变量命名格式梳理下。</p><h2 id="Lower-Camel-Case"><a href="#Lower-Camel-Case" class="headerlink" title="Lower Camel Case"></a>Lower Camel Case</h2><p>又名：小驼峰式</p><p>特征：第一个单词首字母小写，后续单词首字母大写。</p><p>例如：firstName、lastName</p><h2 id="Upper-Camel-Case"><a href="#Upper-Camel-Case" class="headerlink" title="Upper Camel Case"></a>Upper Camel Case</h2><p>又名：大驼峰式、Pascal Case</p><p>特征：每个单词的首字母都大写。</p><p>例如：FirstName、LastName</p><h2 id="Snake-Case"><a href="#Snake-Case" class="headerlink" title="Snake Case"></a>Snake Case</h2><p>特征：每个单词小写，单词之间用下划线连接。</p><p>例如：first_name、last_name</p><h2 id="Kebab-Case"><a href="#Kebab-Case" class="headerlink" title="Kebab Case"></a>Kebab Case</h2><p>又名：Spinal Case、Train Case、Lisp Case</p><p>特征：每个单词小写，单词之间用中划线连接。</p><p>例如：first-name、last-name</p><h2 id="Studly-Case"><a href="#Studly-Case" class="headerlink" title="Studly Case"></a>Studly Case</h2><p>特征：混合大小写，对大写字母的使用没有<a href="https://en.wikipedia.org/wiki/Semantics" target="_blank" rel="noopener">语义</a>或<a href="https://en.wikipedia.org/wiki/Syntax" target="_blank" rel="noopener">语法</a>意义。有时只有<a href="https://en.wikipedia.org/wiki/Vowel" target="_blank" rel="noopener">元音</a>是大写的，其他时候大写和小写是交替的，但通常只是随机的。这个名字来自讽刺或讽刺意味，它是作者试图传达自己的冷静的一种尝试。它也可以用来模拟营销人员在命名计算机软件包时违反标准英语案例惯例的行为，即使在没有技术要求的情况下也是如此。</p><p>例如：tHeqUicKBrOWnFoXJUmpsoVeRThElAzydOG</p><h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul>  <li><a href="https://en.wikipedia.org/wiki/Letter_case" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Letter_case</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;大家想必听说过一些变量命名格式，比如大驼峰式、小驼峰式，其他的你还知道什么？&lt;/p&gt;
&lt;p&gt;今天看文档的时候，提到了一个 kebab case，这个你知道是什么命名格式吗？不知道的接着往下看。&lt;/p&gt;
&lt;p&gt;这篇文章我们把所有变量命名格式梳理下。&lt;/p&gt;
&lt;h2 id=&quot;L
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>Base64 的图片如何完美复制到系统粘贴板</title>
    <link href="https://cuiqingcai.com/30008.html"/>
    <id>https://cuiqingcai.com/30008.html</id>
    <published>2021-02-10T02:16:18.000Z</published>
    <updated>2021-02-10T17:39:17.147Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>最近开发过程中遇到了一个小知识点，这里有一张 Base64 编码的图片，我想要把它复制到系统的粘贴板中，这个该怎么解决？</p><p>比如这里有一张图：</p><p><img src="https://qiniu.cuiqingcai.com/9wixm.png" alt="404"></p><p>我可以通过 Base64 转换工具转换为 Base64 编码，转换网址为 <a href="https://www.base64-image.de/，转换结果如下：" target="_blank" rel="noopener">https://www.base64-image.de/，转换结果如下：</a></p><p><img src="https://qiniu.cuiqingcai.com/soqwi.png" alt=""></p><p>图片就是类似 <code>data:image/png;base64,ivBor2...</code> 这样的编码。</p><p>问：现在有一张这样格式的图片，怎么把它复制到系统粘贴板中？</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>首先这里需要用到一个 JavaScript 库，叫做 clipboard-polyfill，这个库的 npm 包地址为： <a href="https://www.npmjs.com/package/clipboard-polyfill，" target="_blank" rel="noopener">https://www.npmjs.com/package/clipboard-polyfill，</a></p><p>看库的介绍有个关键的部分：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> clipboard <span class="keyword">from</span> <span class="string">"clipboard-polyfill"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Previous clipboard contents:"</span>, <span class="keyword">await</span> clipboard.read());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> item = <span class="keyword">new</span> clipboard.ClipboardItem(&#123;</span><br><span class="line">    <span class="string">"text/html"</span>: <span class="keyword">new</span> Blob(</span><br><span class="line">      [<span class="string">"&lt;i&gt;Markup&lt;/i&gt; &lt;b&gt;text&lt;/b&gt;. Paste me into a rich text editor."</span>],</span><br><span class="line">      &#123; <span class="attr">type</span>: <span class="string">"text/html"</span> &#125;</span><br><span class="line">    ),</span><br><span class="line">    <span class="string">"text/plain"</span>: <span class="keyword">new</span> Blob(</span><br><span class="line">      [<span class="string">"Fallback markup text. Paste me into a rich text editor."</span>],</span><br><span class="line">      &#123; <span class="attr">type</span>: <span class="string">"text/plain"</span> &#125;</span><br><span class="line">    ),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> clipboard.write([item]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">"button"</span>);</span><br><span class="line">  button.textContent = <span class="string">"Copy"</span>;</span><br><span class="line">  button.addEventListener(<span class="string">"click"</span>, handler);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(button);</span><br><span class="line">&#125;);</span><br></pre>      </td>    </tr>  </table></figure><p>这里可以创建一个 ClipboardItem 对象，并传入对应的 Blob 内容，同时指定对应的 content-type 即可。</p><p>OK，那这里就需要一个关键部分，那就是如何把 Base64 编码的图片转化为 Blob。</p><p>一般来说，Base64 编码的图片的开头是 <code>data:image/jpg;base64,</code>，后面跟的就是 Base64 真实编码。</p><p>这里提供一个方法，可以将 Base64 编码转化为 Blob，代码如下：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64toBlob</span>(<span class="params">b64Data, contentType = null, sliceSize = null</span>) </span>&#123;</span><br><span class="line">  contentType = contentType || <span class="string">'image/png'</span></span><br><span class="line">  sliceSize = sliceSize || <span class="number">512</span></span><br><span class="line">  <span class="keyword">let</span> byteCharacters = atob(b64Data)</span><br><span class="line">  <span class="keyword">let</span> byteArrays = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> offset = <span class="number">0</span>; offset &lt; byteCharacters.length; offset += sliceSize) &#123;</span><br><span class="line">    <span class="keyword">let</span> slice = byteCharacters.slice(offset, offset + sliceSize)</span><br><span class="line">    <span class="keyword">let</span> byteNumbers = <span class="keyword">new</span> <span class="built_in">Array</span>(slice.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; slice.length; i++) &#123;</span><br><span class="line">      byteNumbers[i] = slice.charCodeAt(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> byteArray = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(byteNumbers)</span><br><span class="line">    byteArrays.push(byteArray)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Blob(byteArrays, &#123;<span class="attr">type</span>: contentType&#125;)</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里其实就是将 Base64 编码先转化为了 Uint8Array，然后再将其转化为 Blob，并指定 contentType 即可。</p><p>接下来复制到粘贴板就很简单了，调用最上面的方法声明 ClipboardItem 对象即可：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clip</span>(<span class="params">b64Data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> item = <span class="keyword">new</span> clipboard.ClipboardItem(&#123;</span><br><span class="line">    <span class="string">"image/png"</span>: <span class="keyword">this</span>.b64toBlob(b64Data.replace(<span class="string">'data:image/jpg;base64,'</span>, <span class="string">''</span>), <span class="string">'image/png'</span>, <span class="number">512</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里 contentType 指定为了 <code>image/png</code>。</p><p>至此，clip 方法传入 Base64 编码的图片即可复制到系统粘贴板了，亲测可以在 Windows、Mac 上生效。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;
&lt;p&gt;最近开发过程中遇到了一个小知识点，这里有一张 Base64 编码的图片，我想要把它复制到系统的粘贴板中，这个该怎么解决？&lt;/p&gt;
&lt;p&gt;比
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="前端" scheme="https://cuiqingcai.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>腾讯云TKE里面获取客户端真实IP</title>
    <link href="https://cuiqingcai.com/30004.html"/>
    <id>https://cuiqingcai.com/30004.html</id>
    <published>2021-01-03T09:57:38.000Z</published>
    <updated>2021-02-10T17:34:38.705Z</updated>
    
    <content type="html"><![CDATA[<p>最近服务器都迁移到腾讯云 TKE 了，就是腾讯云 Kubernetes 服务，然后最近有个需求是获取客户端真实 IP。</p><p>我的情况：</p><ul>  <li>服务用 Django 写的，通过 HTTP 请求头获取真实 IP</li>  <li>Django 通过 uwsgi 运行，并通过 Nginx 转发出去</li>  <li>Ingress 使用的 Nginx Ingress，而不是 TKE Ingress</li></ul><p>下面说下几个关键配置：</p><h2 id="Django-中获取-IP"><a href="#Django-中获取-IP" class="headerlink" title="Django 中获取 IP"></a>Django 中获取 IP</h2><p>获取方式如下：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>      </td>      <td class="code">        <pre><span class="line">def get_client_ip(request):</span><br><span class="line">    x_forwarded_for = request.META.<span class="builtin-name">get</span>(<span class="string">'HTTP_X_FORWARDED_FOR'</span>)</span><br><span class="line">    <span class="keyword">if</span> x_forwarded_for:</span><br><span class="line">       <span class="built_in"> ip </span>= x_forwarded_for.split(<span class="string">','</span>)[0]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       <span class="built_in"> ip </span>= request.META.<span class="builtin-name">get</span>(<span class="string">'REMOTE_ADDR'</span>)</span><br><span class="line">    return ip</span><br></pre>      </td>    </tr>  </table></figure><h2 id="uwsgi-配置"><a href="#uwsgi-配置" class="headerlink" title="uwsgi 配置"></a>uwsgi 配置</h2><p>uwsgi.ini 配置如下：</p><figure class="highlight ini">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">module</span> = core.wsgi</span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">vacuum</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">static-map</span> = /static=/app/app/static</span><br><span class="line"><span class="attr">http</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span></span><br><span class="line"><span class="attr">log-master</span> = <span class="literal">true</span></span><br></pre>      </td>    </tr>  </table></figure><h2 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h2><p>Nginx 需要转发 uwsgi 出去，并且加上三个关键请求头：</p><figure class="highlight nginx">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">7777</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><h2 id="Supervisor-配置"><a href="#Supervisor-配置" class="headerlink" title="Supervisor 配置"></a>Supervisor 配置</h2><p>Supervisor 需要启动 Uwsgi 和 Nginx：</p><figure class="highlight ini">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="section">[supervisord]</span></span><br><span class="line"><span class="attr">nodaemon</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[program:uwsgi]</span></span><br><span class="line"><span class="attr">command</span>=uwsgi --ini /app/uwsgi.ini</span><br><span class="line"><span class="attr">stdout_logfile</span>=/dev/stdout</span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">stderr_logfile</span>=/dev/stderr</span><br><span class="line"><span class="attr">stderr_logfile_maxbytes</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[program:nginx]</span></span><br><span class="line"><span class="attr">command</span>=/usr/sbin/nginx -g <span class="string">"pid /run/nginx/nginx.pid; daemon off;"</span></span><br><span class="line"><span class="attr">stdout_logfile</span>=/dev/stdout</span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">stderr_logfile</span>=/dev/stderr</span><br><span class="line"><span class="attr">stderr_logfile_maxbytes</span>=<span class="number">0</span></span><br></pre>      </td>    </tr>  </table></figure><h2 id="Dockerfile-配置"><a href="#Dockerfile-配置" class="headerlink" title="Dockerfile 配置"></a>Dockerfile 配置</h2><p>Dockkerfile 里面指定启动的命令为 supervisor：</p><figure class="highlight dockerfile">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>-alpine</span><br><span class="line"><span class="keyword">ENV</span> PYTHONUNBUFFERED <span class="number">1</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk update &amp;&amp; apk add \</span></span><br><span class="line"><span class="bash">        libuuid \</span></span><br><span class="line"><span class="bash">        gcc \</span></span><br><span class="line"><span class="bash">        nginx \</span></span><br><span class="line"><span class="bash">        supervisor \</span></span><br><span class="line"><span class="bash">        libc-dev \</span></span><br><span class="line"><span class="bash">        linux-headers \</span></span><br><span class="line"><span class="bash">        postgresql-libs \</span></span><br><span class="line"><span class="bash">        postgresql-dev \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip install pip -U \</span></span><br><span class="line"><span class="bash">    &amp;&amp; pip install -r requirements.txt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /run/nginx</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> nginx.conf /etc/nginx/conf.d/default.conf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> supervisord.conf /etc/supervisord.conf</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"/usr/bin/supervisord"</span>, <span class="string">"-c"</span>, <span class="string">"/etc/supervisord.conf"</span>]</span></span><br></pre>      </td>    </tr>  </table></figure><h3 id="TKE-配置"><a href="#TKE-配置" class="headerlink" title="TKE 配置"></a>TKE 配置</h3><p>这里参考来源为：<a href="https://cloud.tencent.com/document/product/457/48949" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/457/48949</a></p><p>最关键的就是：</p><p><img src="https://qiniu.cuiqingcai.com/whe5t.png" alt=""></p><p>这里我需要修改 Service 的负载均衡：</p><p><img src="https://qiniu.cuiqingcai.com/4k05y.png" alt=""></p><p>修改 externalTrafficPolicy 为 Local 即可：</p><p><img src="https://qiniu.cuiqingcai.com/77mvl.png" alt=""></p><p>大功告成，后面 IP 就能成功获取到了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近服务器都迁移到腾讯云 TKE 了，就是腾讯云 Kubernetes 服务，然后最近有个需求是获取客户端真实 IP。&lt;/p&gt;
&lt;p&gt;我的情况：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;服务用 Django 写的，通过 HTTP 请求头获取真实 IP&lt;/li&gt;
  &lt;li&gt;Djang
      
    
    </summary>
    
    
    
      <category term="TKE" scheme="https://cuiqingcai.com/tags/TKE/"/>
    
      <category term="Django" scheme="https://cuiqingcai.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>uwsgi将日志输出到控制台的方法</title>
    <link href="https://cuiqingcai.com/30003.html"/>
    <id>https://cuiqingcai.com/30003.html</id>
    <published>2021-01-03T09:29:43.000Z</published>
    <updated>2021-02-10T17:34:38.649Z</updated>
    
    <content type="html"><![CDATA[<p>之前配置 uwsgi 的时候，配完了之后 Python 的日志就输出不出来了，其实可以在 uwsgi.ini 里面加一个日志配置就行了，很简单：</p><figure class="highlight crmsh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">log-<span class="keyword">master</span> <span class="title">= true</span></span><br></pre>      </td>    </tr>  </table></figure><p>示例配置如下：</p><figure class="highlight ini">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">module</span> = core.wsgi</span><br><span class="line"><span class="attr">master</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">processes</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">vacuum</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">static-map</span> = /static=/app/app/static</span><br><span class="line"><span class="attr">http</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span></span><br><span class="line"><span class="attr">log-master</span> = <span class="literal">true</span></span><br></pre>      </td>    </tr>  </table></figure><p>加上这句之后，日志就可以顺利输出到控制台了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;之前配置 uwsgi 的时候，配完了之后 Python 的日志就输出不出来了，其实可以在 uwsgi.ini 里面加一个日志配置就行了，很简单：&lt;/p&gt;
&lt;figure class=&quot;highlight crmsh&quot;&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;t
      
    
    </summary>
    
    
    
      <category term="Python" scheme="https://cuiqingcai.com/tags/Python/"/>
    
      <category term="uwsgi" scheme="https://cuiqingcai.com/tags/uwsgi/"/>
    
  </entry>
  
  <entry>
    <title>加湿器还有这么多讲究</title>
    <link href="https://cuiqingcai.com/30002.html"/>
    <id>https://cuiqingcai.com/30002.html</id>
    <published>2021-01-02T14:43:03.000Z</published>
    <updated>2021-02-10T17:34:38.665Z</updated>
    
    <content type="html"><![CDATA[<p>说到加湿器，那就不得不先提一下空气净化器。</p><p>之前其实我家里是没有空气净化器的，最近刚搬新住处就入手了一个，因为我想打造一套全新的小米之家，哈哈哈。</p><p>这个空气净化器用和没用给我的感觉区别不大，因为我确实感觉不到室内空气好一点或者坏一点有啥区别。但是记得在我刚打开空气净化器的一瞬间，上面的空气质量指数显示为 180 多（实际上这个是说的 PM 2.5 的指数），重度污染！我直接好家伙，难道我没用空气净化器的二十多年一直都呼吸的是重度污染的空气吗？心中不由倒吸一口凉气。净化器开了一会，那个质量指数慢慢降低，最后一直降到 10 以下，我心里也慢慢舒服多了，这时候我就感觉自己处在一个洁净的环境里面。所以，虽然我自己并不能感受出来空气变好了，但是心里是舒服的、安心的。</p><p>那为什么又扯到加湿器呢？</p><p>这是因为当我在开着空气净化器的时候，和往常一样打开我的加湿器…这时候，空气净化器显示的空气质量指数直接爆表了，直接 200 以上，当场就把我吓坏了。我当时就跟我老婆说，老婆我们这个加湿器有问题啊，它加湿后的水雾怎么控制质量这么差，肯定对身体有害。说完了之后我就去搜新的加湿器去了。因为最近我在搞米家智能家居，所以第一个搜的就是小米的加湿器，搜到这么一款：</p><p><img src="https://qiniu.cuiqingcai.com/7zaiu.png" alt=""></p><p>OK，除菌加湿器，很好，有了这个除菌功能，加湿的空气应该不会那么差了。当时我那款「美的」的加湿器是没有这个功能的，所以我就又跟老婆说，老婆我搜到这个小米的加湿器是有除菌功能的，我买了这个肯定就没事了，于是我成功说服了我老婆，于是我的米家智能家居又新增了一员。</p><p>然而，等到货之后我灌上水重新打开，情况居然跟我想的不一样！空气净化器依然非常高，直逼 200，这是怎么回事？难道这个除菌功能一点用都没有？</p><p>抱着好奇又震惊的心情，我就去网上查，原来，这个和水有关系。空气指数上升的原因可以简单这么解释：这么因为我用的是自来水，而自来水含有氯、重金属等杂质，我买的加湿器又属于超声波式加湿器，它的原理是利用超声波将水打散成直径只有 1-5 微米的细小颗粒，然后利用风动装置将这些小颗粒吹到空气中，所以自来水中的杂质也就跟着进入空气中了，这就导致了空气净化器指数急剧上升，污染空气，长期这样下去对人体并不好。</p><p>看到这里，那就牵扯到了几个概念，一个是水，一个是加湿器，这两者的不同组合可能产生不同的结果，下面且听我一一道来。</p><h2 id="水"><a href="#水" class="headerlink" title="水"></a>水</h2><p>首先说水啊，其实我们平常见到的水有很多种，名字也不同，目前常见的水可以分为这么几种类别：自来水、白开水、纯净水、矿泉水、天然水、蒸馏水，咋这么多？听着都懵啊，下面来解释下。</p><h3 id="自来水"><a href="#自来水" class="headerlink" title="自来水"></a>自来水</h3><p>这个大家都知道了，水龙头里面直接放出来的水就是自来水，它是经过自来水厂加工、消毒之后生产出来的复合国家饮用水标准的工人们生产生活用的水，消毒的时候，里面含有一些微生物（如大肠杆菌）、重金属、有机污染物、泥沙等物质，另外由于自来水厂喜欢用氯气消毒，所以自来水里面还含有一些氯离子，总之这些都是对人体健康不利的。看到这里不要害怕，那就不能喝了吗？没关系，把水烧开了就行了。</p><h3 id="白开水"><a href="#白开水" class="headerlink" title="白开水"></a>白开水</h3><p>白开水就是把自然水直接烧开得到的水，因为刚才也说了，自来水里面含有各种对人体有害的物质，把水烧开后，大部分细菌病毒都会被杀死，一些氯也会被分解掉，另外钙、镁和一些重金属离子也会在烧开的过程中形成沉淀，也就是我们通常说的水垢。不过金属离子是不能完全沉淀的，所以水中还会有溶解有少量的重金属离子，所以并不是完完全全是干净的，但基本问题不大。另外白开水其实口感非常不好，喝起来很涩，反正我是完全喝不惯白开水的味道。</p><h3 id="矿泉水"><a href="#矿泉水" class="headerlink" title="矿泉水"></a>矿泉水</h3><p>大家肯定听说过矿泉水，但你平时喝的还真不一定是矿泉水，目前比较常见的矿泉水有百岁山、恒大冰泉等，它是是天然含有矿物质离子或盐或硫化物或二氧化碳气体等物质的水，矿泉水对水源地要求很高，不同水源地的矿物质含量也不同，比如百岁山的河寨山水源说是富含了偏硅酸锂、锶、钙、钾等多种有益于人体健康的微量元素，是为数不多的优质水源，当然依云也是。</p><h3 id="纯净水"><a href="#纯净水" class="headerlink" title="纯净水"></a>纯净水</h3><p>纯净水就是水里不含任何其他物质，只有水分子的水，没有任何矿物质。它是经过一些离子交换、反渗透、蒸馏等工艺制成的，过滤掉了细菌、病毒等有害物质，而且几乎不含任何矿物质，水的硬度也很低，用它烧水也不会形成水垢。纯净水可以有两种获取方式，一种就是家里装净水器，出来的都是纯净水。另外就是直接购买，比如怡宝就是纯净水。</p><h3 id="天然水"><a href="#天然水" class="headerlink" title="天然水"></a>天然水</h3><p>天然水，最常见的就是农夫山泉，它的标识叫做饮用天然水，为啥他不标识天然矿泉水呢？它其实和矿泉水几乎差不多，但是其中有益的元素含量并不能达到天然矿泉水的要求。百岁山的水源相对农夫山泉更好一些，农夫山泉的水源有好几个基地，一般来说千岛湖的最好喝，带有一点甘甜的味道。不过不仔细对比，这个和矿泉水大查不差，反正都含有一些钙、镁、钾等矿物质。</p><h3 id="蒸馏水"><a href="#蒸馏水" class="headerlink" title="蒸馏水"></a>蒸馏水</h3><p>蒸馏水相比大家在学习化学等时候听说过，其实就是把水烧开，把水蒸气收集下来，然后再把水蒸气液化，分离出来的水就是纯水了，和纯净水一样也是不含矿物质的。由于工艺复杂，制造设备昂贵，所以蒸馏水一般在实验室比较常用，家庭基本上没有喝的，当然要买也能买到，比如屈臣氏的瓶装蒸馏水，价格不菲。</p><p>好，说完了以上的水，那哪种水适合放在加湿器（目前指的是超声波加湿器）里面不会引起空气指数升高呢？答案是纯净水和蒸馏水，其他的都不行。纯净水和蒸馏水加上之后，我的空气净化器指数基本没有变化，保持超绿色状态，舒服了。</p><p>另外平时喝的话，矿泉水、纯净水、天然水、白开水其实都行，虽然说矿泉水相比纯净水多了一些对人体有益的矿物质，但人体矿物质的摄入也不一定是靠水嘛，所以基本没有什么影响。</p><p>好，说完了水，那就得再说说加湿器了，这个其实也是有讲究的。</p><h2 id="加湿器"><a href="#加湿器" class="headerlink" title="加湿器"></a>加湿器</h2><p>市面上的加湿器主要分为两种，一种是超声波式加湿器，一种是冷蒸发式加湿器。</p><h3 id="超声波式加湿器"><a href="#超声波式加湿器" class="headerlink" title="超声波式加湿器"></a>超声波式加湿器</h3><p>大部分人家里的加湿器可能都是一二三百块钱的吧，加湿的过程中你还会看到白雾对不对？没错，这种加湿器就是超声波式加湿器，这种加湿器刚才也说了，利用高效的超声波振动将水打散成直径只有1-5微米的细小颗粒，再利用风动装置，将这些小颗粒吹到空气中，这种加湿器具有加湿速度快耗电量小、使用寿命长的优点，而且价格相对比较便宜，但存在不足之处在于对水要求高。</p><p><img src="https://qiniu.cuiqingcai.com/nq0t8.jpg" alt=""></p><h3 id="冷蒸发式加湿器"><a href="#冷蒸发式加湿器" class="headerlink" title="冷蒸发式加湿器"></a>冷蒸发式加湿器</h3><p>这种加湿器和超声波最大的区别就是加湿过程看不见水雾，它的原理就是通过循环风将液态水变成气态水，其实这种加湿器的加湿效果和超声波式相比并不占优势，不过加湿过程中，水是真正变成水蒸气而进入空气中的，所以水中的一些物质并不会进入到空气中，所以这种加湿器我们可以放心使用自来水，而不会引起空气净化器指数上升。不过这种加湿器价格都挺贵的，比超声波式加湿器贵了两三倍不止。</p><p>所以呢，到这里，基本就通透了吧，我用的加湿器就是第一种，这种加湿器就必须得用纯净水或者蒸馏水才能保证空气净化器不会爆表。如果加湿器是第二种，那随便用什么水都没啥关系了。</p><p>另外友情提醒，如果你的加湿器是第一种，请不要再用自来水了，对身体健康不利，还是改用纯净水吧，或者直接换个蒸发式加湿器也可以的。</p><p>所以说，这一番下来，学到还真不少，水和加湿器原来还有这么多讲究，生活真是处处皆学问啊。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>想知道农夫山泉 景田百岁山和怡宝味道的差别? - 徐野的回答 - 知乎 <a href="https://www.zhihu.com/question/29367546/answer/109448432" target="_blank" rel="noopener">https://www.zhihu.com/question/29367546/answer/109448432</a></p><p>白开水、纯净水、矿泉水和蒸馏水哪个最适合做长期饮用水？ - 安吉尔的回答 - 知乎 <a href="https://www.zhihu.com/question/20418550/answer/1271349511" target="_blank" rel="noopener">https://www.zhihu.com/question/20418550/answer/1271349511</a></p><p>你的加湿器到底该加什么水？今天让你秒懂！<a href="http://jd.zol.com.cn/734/7346674.html" target="_blank" rel="noopener">http://jd.zol.com.cn/734/7346674.html</a></p><p>怎样选购加湿器？ - 老爸评测的回答 - 知乎 <a href="https://www.zhihu.com/question/22406803/answer/555850897" target="_blank" rel="noopener">https://www.zhihu.com/question/22406803/answer/555850897</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;说到加湿器，那就不得不先提一下空气净化器。&lt;/p&gt;
&lt;p&gt;之前其实我家里是没有空气净化器的，最近刚搬新住处就入手了一个，因为我想打造一套全新的小米之家，哈哈哈。&lt;/p&gt;
&lt;p&gt;这个空气净化器用和没用给我的感觉区别不大，因为我确实感觉不到室内空气好一点或者坏一点有啥区别。但是
      
    
    </summary>
    
    
    
      <category term="生活笔记" scheme="https://cuiqingcai.com/tags/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript教程二之接口</title>
    <link href="https://cuiqingcai.com/30001.html"/>
    <id>https://cuiqingcai.com/30001.html</id>
    <published>2020-12-29T18:16:52.000Z</published>
    <updated>2021-02-10T17:34:38.593Z</updated>
    
    <content type="html"><![CDATA[<p>上一节学习了 TypeScript 的基本类型，本节再来学习下接口 Interfaces 的使用。</p><p>TypeScript 的一个重要的特性就是帮助检查参数的字段是否是合法的，比如检查某个参数包含字段 foo，且类型需要是 number 类型，否则就会报错。通过接口，即 Interface 我们可以方便地实现这个操作。</p><h2 id="第一个-Interface"><a href="#第一个-Interface" class="headerlink" title="第一个 Interface"></a>第一个 Interface</h2><p>最简单的实现方式参考下面的例子：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labeledObj: &#123; label: <span class="built_in">string</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(labeledObj.label);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123; size: <span class="number">10</span>, label: <span class="string">"Size 10 Object"</span> &#125;;</span><br><span class="line">printLabel(myObj);</span><br></pre>      </td>    </tr>  </table></figure><p>在这里我们声明了一个方法，叫做 printLabel，它接收一个参数叫做 labeledObj，在 labeledObj 后面声明了该参数需要的字段和类型，这里它需要一个字段 label，且类型必须要是 string 类型。在调用时，我们传入了一个 Object，它包含了两个字段，一个是 size，类型为 number，另一个是 label，类型为 string。这里值得注意的是传入的参数是比声明的参数多了一个字段 size 的，但是这并没有关系，编译器只检查传入的参数是否至少存在所需要的属性，对于多余的属性是不关心的。</p><p>运行结果如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">"Size 10 Object"</span></span><br></pre>      </td>    </tr>  </table></figure><p>如果此时我们将 label 属性的类型修改为 number：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labeledObj: &#123; label: <span class="built_in">number</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(labeledObj.label);</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>则会出现如下报错：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Argument of<span class="built_in"> type </span><span class="string">'&#123; size: number; label: string; &#125;'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span> parameter of<span class="built_in"> type </span><span class="string">'&#123; label: number; &#125;'</span>. Types of property <span class="string">'label'</span> are incompatible.<span class="built_in"> Type </span><span class="string">'string'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span><span class="built_in"> type </span><span class="string">'number'</span>.</span><br></pre>      </td>    </tr>  </table></figure><p>这里就提示 label 属性只能传入 number 类型，而不能是 string 类型。</p><p>但上面这个写法其实很不友好，如果属性比较多，那这个声明会非常复杂，而且不同方法如果都用到这个参数，难道还把它的声明都重复声明一遍？这也太不好了吧。</p><p>所以，为了更方便地实现声明，这里我们可以使用 Interface 来实现，上面的例子就可以改写为如下形式：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> LabeledValue &#123;</span><br><span class="line">  label: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labeledObj: LabeledValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(labeledObj.label);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123; size: <span class="number">10</span>, label: <span class="string">"Size 10 Object"</span> &#125;;</span><br><span class="line">printLabel(myObj);</span><br></pre>      </td>    </tr>  </table></figure><p>这里我们使用 interface 声明了一个类型声明，这样在 printLabel 就可以直接使用 Interface 的名称了。</p><p>怎么样？这种写法是不是感觉好多了。</p><h2 id="Optional-properties"><a href="#Optional-properties" class="headerlink" title="Optional properties"></a>Optional properties</h2><p>某些情况下，某些字段并不是完全必要的，比如看下面的例子：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> LabeledValue &#123;</span><br><span class="line">  label: <span class="built_in">string</span>;</span><br><span class="line">  count: <span class="built_in">number</span>,</span><br><span class="line">  message: <span class="built_in">string</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labeledObj: LabeledValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(labeledObj.label);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123; size: <span class="number">10</span>, count: <span class="number">1</span>, label: <span class="string">"Size 10 Object"</span>&#125;;</span><br><span class="line">printLabel(myObj);</span><br></pre>      </td>    </tr>  </table></figure><p>其中 message 字段其实在 myObj 对象里面没有，而且这个字段也并不是必需的，但是该字段如果存在的话，必须是 string 类型。那像上面的写法，其实就会报错了：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Argument of<span class="built_in"> type </span><span class="string">'&#123; size: number; count: number; label: string; &#125;'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span> parameter of<span class="built_in"> type </span><span class="string">'LabeledValue'</span>. Property <span class="string">'message'</span> is missing <span class="keyword">in</span><span class="built_in"> type </span><span class="string">'&#123; size: number; count: number; label: string; &#125;'</span> but required <span class="keyword">in</span><span class="built_in"> type </span><span class="string">'LabeledValue'</span>.</span><br></pre>      </td>    </tr>  </table></figure><p>这里说 message 字段没有传。</p><p>这时候我们可以将 message 标识为可选字段，只需要在字段后面加个 <code>?</code> 就好了，写法如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> LabeledValue &#123;</span><br><span class="line">  label: <span class="built_in">string</span>;</span><br><span class="line">  count: <span class="built_in">number</span>,</span><br><span class="line">  message?: <span class="built_in">string</span>,</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这样就不会再报错了。</p><h2 id="Readonly-properties"><a href="#Readonly-properties" class="headerlink" title="Readonly properties"></a>Readonly properties</h2><p>在某些情况下，我们期望一个 Object 的某些字段不能后续被修改，只能在创建的时候声明，这个怎么做到呢？很简单，将其设置为只读字段就好了，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> Point &#123;</span><br><span class="line">  readonly x: <span class="built_in">number</span>;</span><br><span class="line">  readonly y: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p1: Point = &#123; x: <span class="number">10</span>, y: <span class="number">20</span> &#125;;</span><br><span class="line">p1.x = <span class="number">5</span>; <span class="comment">// error!</span></span><br></pre>      </td>    </tr>  </table></figure><p>这里我们声明了一个名为 Point 的 Interface，然后在创建 Point 的时候将 x 设置为 10。但后续如果我们想设置 x 的属性为 5 的时候，就会报错了：</p><figure class="highlight applescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Cannot assign <span class="keyword">to</span> 'x' because <span class="keyword">it</span> <span class="keyword">is</span> a <span class="built_in">read</span>-only <span class="keyword">property</span>.</span><br></pre>      </td>    </tr>  </table></figure><p>这样就可以保证某些字段不能在后续操作流程中被修改，保证了安全性。</p><p>另外我们可以使用 ReadonlyArray 来声明不可变的 Array，一旦初始化完成之后，后续所有关于 Array 的操作都会报错，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;<span class="built_in">number</span>&gt; = a;</span><br><span class="line"></span><br><span class="line">ro[<span class="number">0</span>] = <span class="number">12</span>; <span class="comment">// error!</span></span><br><span class="line">Index signature <span class="keyword">in</span> <span class="keyword">type</span> <span class="string">'readonly number[]'</span> only permits reading.</span><br><span class="line">ro.push(<span class="number">5</span>); <span class="comment">// error!</span></span><br><span class="line">Property <span class="string">'push'</span> does not exist on <span class="keyword">type</span> <span class="string">'readonly number[]'</span>.</span><br><span class="line">ro.length = <span class="number">100</span>; <span class="comment">// error!</span></span><br><span class="line">Cannot assign to <span class="string">'length'</span> because it is a read-only property.</span><br><span class="line">a = ro; <span class="comment">// error!</span></span><br><span class="line">The <span class="keyword">type</span> <span class="string">'readonly number[]'</span> is <span class="string">'readonly'</span> and cannot be assigned to the mutable <span class="keyword">type</span> <span class="string">'number[]'</span>.</span><br></pre>      </td>    </tr>  </table></figure><p>另外到这里大家可能疑惑 readonly 和 const 是什么区别，二者不都代表不可修改吗？其实区分很简单，readonly 是用来修改 Object 的某个属性的，而 const 是用来修饰某个变量的。</p><h2 id="Function-Types"><a href="#Function-Types" class="headerlink" title="Function Types"></a>Function Types</h2><p>除了用 interface 声明 Object 的字段，我们还可以声明方法的一些规范，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里就是用 interface 声明了一个 Function，前半部分是接收的参数类型，后面 boolean 是返回值类型。</p><p>声明 interface 之后，我们便可以声明一个 Function 了，写法如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc = <span class="function">(<span class="params">source: <span class="built_in">string</span>, subString: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString);</span><br><span class="line">  <span class="keyword">return</span> result &gt; <span class="number">-1</span>;</span><br><span class="line">&#125;;</span><br></pre>      </td>    </tr>  </table></figure><p>这里声明了一个 Function 叫做 mySearch，其中其参数和返回值严格按照 SearchFunc 这个 Interface 来实现，那就没问题。</p><p>如果我们将返回值改掉，改成非 boolean 类型，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> SearchFunc &#123;</span><br><span class="line">  (source: <span class="built_in">string</span>, subString: <span class="built_in">string</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySearch: SearchFunc = <span class="function">(<span class="params">source: <span class="built_in">string</span>, subString: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = source.search(subString);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre>      </td>    </tr>  </table></figure><p>这时候就会得到如下报错：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Type <span class="string">'(source: string, subString: string) =&gt; number'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span><span class="built_in"> type </span><span class="string">'SearchFunc'</span>.<span class="built_in"> Type </span><span class="string">'number'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span><span class="built_in"> type </span><span class="string">'boolean'</span>.</span><br></pre>      </td>    </tr>  </table></figure><p>这里就说返回值是 number，而不是 boolean。</p><h2 id="Class-Types"><a href="#Class-Types" class="headerlink" title="Class Types"></a>Class Types</h2><p>除了声明 Function，interface 还可以用来声明 Class，主要作用就是声明 class 里面所必须的属性和方法，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Clock <span class="keyword">implements</span> ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.currentTime = d;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">h: <span class="built_in">number</span>, m: <span class="built_in">number</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这个简直跟其他语言的接口定义太像了。定义好了 ClockInterface 之后，class 需要使用 implements 来实现这个接口，同时必须要声明 currentTime 这个变量和 setTime 方法，类型也需要完全一致，不然就会报错。</p><h2 id="Extending-Interfaces"><a href="#Extending-Interfaces" class="headerlink" title="Extending Interfaces"></a>Extending Interfaces</h2><p>另外 Interface 之间也是可以继承的，相当于在一个 Interface 上进行扩展，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line">  color: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Square <span class="keyword">extends</span> Shape &#123;</span><br><span class="line">  sideLength: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = &#123;&#125; <span class="keyword">as</span> Square;</span><br><span class="line">square.color = <span class="string">"blue"</span>;</span><br><span class="line">square.sideLength = <span class="number">10</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>这里 Shape 这个 Interface 只有 color 这个属性，而 Square 则继承了 Shape，并且加了 sideLength 属性，那其实现在 Square 这个接口声明了 color 和 sideLength 这两个属性。</p><p>另外 Interface 还支持多继承，获取被继承的 Interface 的所有声明，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line">  color: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> PenStroke &#123;</span><br><span class="line">  penWidth: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Square <span class="keyword">extends</span> Shape, PenStroke &#123;</span><br><span class="line">  sideLength: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = &#123;&#125; <span class="keyword">as</span> Square;</span><br><span class="line">square.color = <span class="string">"blue"</span>;</span><br><span class="line">square.sideLength = <span class="number">10</span>;</span><br><span class="line">square.penWidth = <span class="number">5.0</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>但如果同名的字段不一致怎么办呢？比如下面的例子：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">interface</span> Fruit &#123;</span><br><span class="line">    color: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Apple <span class="keyword">extends</span> Fruit &#123;</span><br><span class="line">    hasLeaf: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Orange <span class="keyword">extends</span> Fruit &#123;</span><br><span class="line">    size: <span class="built_in">number</span>,</span><br><span class="line">    hasLeaf: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Watermalon <span class="keyword">extends</span> Apple, Orange &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里 hasLeaf 在 Apple 里面是 boolean 类型，在 Orange 里面是 number 类型，最后 Watermalon 继承了这两个 Interface 会怎样呢？</p><p>很明显，报错了，结果如下：</p><figure class="highlight delphi">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">Interface</span> <span class="string">'Watermalon'</span> cannot simultaneously extend types <span class="string">'Apple'</span> <span class="keyword">and</span> <span class="string">'Orange'</span>. Named <span class="keyword">property</span> <span class="string">'hasLeaf'</span> <span class="keyword">of</span> types <span class="string">'Apple'</span> <span class="keyword">and</span> <span class="string">'Orange'</span> are <span class="keyword">not</span> identical.</span><br></pre>      </td>    </tr>  </table></figure><p>意思就是说字段类型不一致。</p><p>所以，要多继承的话，需要被继承的 Interface 里面的属性不互相冲突，不然是无法同时继承的。</p><h2 id="Interfaces-Extending-Classes"><a href="#Interfaces-Extending-Classes" class="headerlink" title="Interfaces Extending Classes"></a>Interfaces Extending Classes</h2><p>在某些情况下，Interface 可能需要继承 Class，Interface 扩展 Class 时，它将继承该 Class 的成员，但不继承其实现。这就类似该 Interface 声明了该类的所有成员而没有提供实现。</p><p>另外 Interface 甚至可以继承 Class 的私有成员和受保护成员。这意味着，当创建一个扩展带有私有或受保护成员的 Class 的 Interface 时，该 Interface 只能由该 Class 或其子 Class 实现。</p><p>示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">class</span> Control &#123;</span><br><span class="line">  <span class="keyword">private</span> state: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> SelectableControl <span class="keyword">extends</span> Control &#123;</span><br><span class="line">  select(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Button <span class="keyword">extends</span> Control <span class="keyword">implements</span> SelectableControl &#123;</span><br><span class="line">  select() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> TextBox <span class="keyword">extends</span> Control &#123;</span><br><span class="line">  select() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ImageControl <span class="keyword">implements</span> SelectableControl &#123;</span><br><span class="line">  <span class="comment">// Error, Class 'ImageControl' incorrectly implements interface 'SelectableControl'.</span></span><br><span class="line">  <span class="comment">// Types have separate declarations of a private property 'state'.</span></span><br><span class="line">  <span class="keyword">private</span> state: <span class="built_in">any</span>;</span><br><span class="line">  select() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>上面我们可以知道，当创建一个扩展带有私有或受保护成员的 Class 的 Interface 时，该 Interface 只能由该 Class 或其子 Class 实现。在这里 ImageControl 由于没有继承 Control，但同时 Control 还包含了私有成员变量，所以 ImageControl 并不能继承得到 state 这个私有成员变量，所以会报错。</p><p>以上便是关于 Interface 的一些用法，后面会继续总结其他的用法，如 Functions、Classes 等详细用法。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;上一节学习了 TypeScript 的基本类型，本节再来学习下接口 Interfaces 的使用。&lt;/p&gt;
&lt;p&gt;TypeScript 的一个重要的特性就是帮助检查参数的字段是否是合法的，比如检查某个参数包含字段 foo，且类型需要是 number 类型，否则就会报错。通过
      
    
    </summary>
    
    
      <category term="TypeScript" scheme="https://cuiqingcai.com/categories/TypeScript/"/>
    
    
  </entry>
  
  <entry>
    <title>TypeScript教程一之基本类型</title>
    <link href="https://cuiqingcai.com/30000.html"/>
    <id>https://cuiqingcai.com/30000.html</id>
    <published>2020-12-28T18:16:52.000Z</published>
    <updated>2021-02-10T17:34:38.593Z</updated>
    
    <content type="html"><![CDATA[<p>之前的时候都是用 JavaScript 开发，但是最近发现随着项目的推进，一些项目越来越多地要求使用 TypeScript 来开发，所以不得不来专门学习一下 TypeScript 了，本篇文章就简单记录下学习 TypeScript 的过程。</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>先看看 TypeScript 的官方介绍：</p><blockquote>  <p>Typed JavaScript at Any Scale. </p>  <p>TypeScript extends JavaScript by adding types. By understanding JavaScript, TypeScript saves you time catching errors and providing fixes before you run code. Any browser, any OS, anywhere JavaScript runs. Entirely Open Source.</p></blockquote><p>我们知道 JavaScript 是弱类型的语言，而实际上说白了就是加上类型标识的 JavaScript 语言，加上类型标识之后，可以帮助我们减少开发的调试成本，尽早发现错误，节省更多时间。同时 TypeScript 是完全开源的，它编译后得到的 JavaScript 支持任何浏览器和操作系统运行。</p><p>截止本文撰写的时间，TypeScript 已经更新到 4.1 版本，官方文档地址：<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html。" target="_blank" rel="noopener">https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-1.html。</a></p><h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><p>学习 TypeScript 当然要看原汁原味的资料，推荐 TypeScript 官方的 Handbook，链接为：<a href="https://www.typescriptlang.org/docs/handbook/intro.html。" target="_blank" rel="noopener">https://www.typescriptlang.org/docs/handbook/intro.html。</a></p><p>本文所总结的内容基于 Handbook 的内容加上个人的一些修改而成。</p><p>另外本节的代码推荐大家直接在 TypeScript 提供的 Playgroud 里面运行即可，不用自己再初始化 Node 和 TypeScript 环境，简单方便，链接为：<a href="https://www.typescriptlang.org/play，大家直接打开就行了，预览如下：" target="_blank" rel="noopener">https://www.typescriptlang.org/play，大家直接打开就行了，预览如下：</a></p><p><img src="https://qiniu.cuiqingcai.com/eg15j.png" alt="image-20201228234110415"></p><p>比如默认情况下就有两行初始化代码：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">const</span> anExampleVariable = <span class="string">"Hello World"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(anExampleVariable);</span><br></pre>      </td>    </tr>  </table></figure><p>点击 Run 之后就可以直接运行，控制台输出结果显示在右侧，内容如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">"Hello World"</span></span><br></pre>      </td>    </tr>  </table></figure><p>如果你运行成功了，那我们就可以开始接下来的学习了。</p><p>下面正式开始介绍。</p><p>TypeScript 主要就是在 JavaScript 基础上扩展了一些类型，所以这里就分各种类型来进行介绍。</p><h2 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h2><h3 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h3><p>最常见的基本类型就是布尔类型了，其值就是 true 或者 false，类型声明用 boolean 就好了，在 TypeScript 中，声明一个 boolean 类型的变量写法如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> isDone: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="built_in">console</span>.log(isDone, <span class="keyword">typeof</span> isDone);</span><br></pre>      </td>    </tr>  </table></figure><p>这里注意到，声明类型可以在变量名的后面加上一个冒号，然后跟一个类型声明，和 Python 的 Type Hint 非常像。然后我们用 console 的 log 方法输出了这个变量，并用 typeof 输出了它的类型。</p><p>运行结果如下：</p><figure class="highlight autoit">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="built_in">LOG</span>]: <span class="literal">false</span>,  <span class="string">"boolean"</span></span><br></pre>      </td>    </tr>  </table></figure><p>可以看到运行结果就被输出出来了，同时 typeof 就是这个变量的类型，结果是一个字符串，就是 boolean。</p><p>是不是很简单？基本套路就是在变量的后面跟一个冒号再跟一个类型声明就好了。</p><h3 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h3><p>Number 即数值类型，对于这个类型，TypeScript 和 JavaScript 是一样的，Number 可以代表整数、浮点数、大整数。其中大整数需要单独用 bigint 来表示。另外 Number 还可以代表十六进制、八进制、二进制。</p><p>示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> decimal: <span class="built_in">number</span> = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">let</span> hex: <span class="built_in">number</span> = <span class="number">0xf00d</span>;</span><br><span class="line"><span class="keyword">let</span> binary: <span class="built_in">number</span> = <span class="number">0b1010</span>;</span><br><span class="line"><span class="keyword">let</span> octal: <span class="built_in">number</span> = <span class="number">0o744</span>;</span><br><span class="line"><span class="keyword">let</span> big: bigint = <span class="number">100n</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(hex, <span class="keyword">typeof</span> hex);</span><br><span class="line"><span class="built_in">console</span>.log(big, <span class="keyword">typeof</span> big);</span><br></pre>      </td>    </tr>  </table></figure><p>其中 bigint 需要 ES2020 的支持，需要在 TS Config 里面设置下：</p><p><img src="https://qiniu.cuiqingcai.com/qkhwz.png" alt="image-20201228235911831"></p><p>运行结果如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">61453,  "number" </span></span><br><span class="line">[<span class="symbol">LOG</span>]: <span class="link">100,  "bigint"</span></span><br></pre>      </td>    </tr>  </table></figure><p>这里输出了 hex 和 big 变量的值和类型，其中 hex 本身是用十六进制声明的，打印输出的时候被转化为了十进制，同时其类型为 number。</p><p>另外对于 bigint 类型来说，值的后面需要加一个 n，即 100 和 100n 代表的类型是不一样的，后者的类型是 bigint，前者的类型是 number。</p><p>假如把 bigint 类型的变量声明为 number 类型是会报错的，比如这样就是错误的：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> big: <span class="built_in">number</span> = <span class="number">100n</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>报错内容如下：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Type <span class="string">'bigint'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span><span class="built_in"> type </span><span class="string">'number'</span>.</span><br></pre>      </td>    </tr>  </table></figure><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>String 即字符串类型，需要用 string 来声明类型。字符串可以用单引号或者双引号或者斜引号声明，其中斜引号就是模板字符串。</p><p>示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> color: <span class="built_in">string</span> = <span class="string">"blue"</span>;</span><br><span class="line">color = <span class="string">'red'</span>;</span><br><span class="line"><span class="keyword">let</span> fullName: <span class="built_in">string</span> = <span class="string">`Bob Bobbington`</span>;</span><br><span class="line"><span class="keyword">let</span> age: <span class="built_in">number</span> = <span class="number">37</span>;</span><br><span class="line"><span class="keyword">let</span> sentence: <span class="built_in">string</span> = <span class="string">`Hello, my name is <span class="subst">$&#123;fullName&#125;</span>. I'll be <span class="subst">$&#123;age + <span class="number">1</span>&#125;</span> years old next month.`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(sentence, <span class="keyword">typeof</span> sentence);</span><br></pre>      </td>    </tr>  </table></figure><p>运行结果如下：</p><figure class="highlight 1c">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="built_in">LOG</span>]: <span class="string">"Hello, my name is Bob Bobbington. I'll be 38 years old next month."</span>,  <span class="string">"string"</span></span><br></pre>      </td>    </tr>  </table></figure><p>嗯，没什么特殊的，就是字符串类型。</p><h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p>Array 即数组，声明可以有两种方式，一种是 <code>type[]</code> 这样的形式，一种是 Generics 泛型的形式，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> list: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> list2: <span class="built_in">Array</span>&lt;<span class="built_in">number</span>&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> list3: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; = [<span class="number">1</span>, <span class="string">"2"</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(list, <span class="keyword">typeof</span> list);</span><br><span class="line"><span class="built_in">console</span>.log(list2, <span class="keyword">typeof</span> list2);</span><br><span class="line"><span class="built_in">console</span>.log(list3, <span class="keyword">typeof</span> list3);</span><br></pre>      </td>    </tr>  </table></figure><p>其中 list 就是使用了 <code>type[]</code> 这样的声明方式，声明为 <code>number[]</code>，那么数组里面的每个元素都必须要是 number 类型，list2 则是使用了泛型类型的声明，和 list 的效果是一样的，另外 list3 使用了 any 泛型类型，所以其值可以不仅仅为 number，因此这里 list3 的第二个元素设置为了字符串 2。</p><p>运行结果如下：</p><figure class="highlight prolog">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],  <span class="string">"object"</span> </span><br><span class="line">[<span class="symbol">LOG</span>]: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],  <span class="string">"object"</span> </span><br><span class="line">[<span class="symbol">LOG</span>]: [<span class="number">1</span>, <span class="string">"2"</span>, <span class="number">3</span>],  <span class="string">"object"</span></span><br></pre>      </td>    </tr>  </table></figure><p>结果的 typeof 输出的结果可能让人意外，不应该是输出其声明的类型吗，怎么是 object？这是因为浏览器真正执行的是刚才的 TypeScript 编译生成的 JavaScript，而 JavaScript 本身的 Array 和 Object 等类型，typeof 都统一返回 object 类型，因此得到的结果就是 object 了。</p><h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><p>Tuple 即元组，它可以允许我们声明固定数量和顺序的 Array，来看个例子就懂了：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> x: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>]; <span class="comment">// Error</span></span><br><span class="line">x = [<span class="string">"Hello"</span>, <span class="number">2</span>]; <span class="comment">// Correct</span></span><br></pre>      </td>    </tr>  </table></figure><p>比如这里声明了一个变量 x，x 必须是一个 Array，按照顺序来说，其第一个元素必须要是 string，第二个元素必须要是 number，所以第二行的声明就会报错，第三行的声明才是正确的。</p><p>有了类型声明之后，在编译阶段就能发现错误或者编辑器给出方法输入提示。比如：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="built_in">console</span>.log(x[<span class="number">0</span>].substring(<span class="number">1</span>)); <span class="comment">// Correct</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">1</span>].substring(<span class="number">1</span>)); <span class="comment">// Error, Property 'substring' does not exist on type 'number'.</span></span><br></pre>      </td>    </tr>  </table></figure><p>比如这里第一行我们在敲 substring 的时候，编辑器根据类型判断出 <code>x[0]</code> 是 string 类型，那就可以给出 substring 的提示。而对于第二行代码的 <code>x[1]</code>，编译器会直接检查出其中存在错误，这有助于我们在静态类型检查时候及时发现问题，减少 Bug 出现的概率。</p><h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><p>Enum 即枚举类型，这个非常有用，有时候我们想定义的变量其实就只有某几种取值，那完全可以定义为枚举类型。</p><p>用法如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">enum</span> Stage &#123;</span><br><span class="line">    Debug,</span><br><span class="line">    Info,</span><br><span class="line">    Warning,</span><br><span class="line">    <span class="built_in">Error</span>,</span><br><span class="line">    Critical,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stage: Stage = Stage.Critical;</span><br><span class="line"><span class="built_in">console</span>.log(stage, <span class="keyword">typeof</span> stage);</span><br></pre>      </td>    </tr>  </table></figure><p>这里我们声明了一个枚举类型，其名称叫做 Stage，值有五个。然后声明的变量直接用 Stage 修饰即可，值则可以直接取 Stage 的某个值，这里取值为 <code>Stage.Critical</code>。</p><p>最后打印输出该变量，结果如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">4,  "number"</span></span><br></pre>      </td>    </tr>  </table></figure><p>结果居然是 4，这个怎么情况？</p><p>原来是因为枚举类型，它会按照枚举值的声明顺序自动编号，比如 Debug 的值就是 0，Info 就是 1，以此类推。默认情况下是从 0 开始编号的，不过我们也可以手动更改编号的起始值，比如 Debug 从 1 开始编号，可以声明如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">enum</span> Stage &#123;</span><br><span class="line">    Debug = <span class="number">1</span>,</span><br><span class="line">    Info,</span><br><span class="line">    Warning,</span><br><span class="line">    <span class="built_in">Error</span>,</span><br><span class="line">    Critical,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stage: Stage = Stage.Critical;</span><br><span class="line"><span class="built_in">console</span>.log(stage, <span class="keyword">typeof</span> stage);</span><br></pre>      </td>    </tr>  </table></figure><p>最后可以看到 Critical 的编号就变成 5 了，运行结果如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">5,  "number"</span></span><br></pre>      </td>    </tr>  </table></figure><p>有点意思。</p><p>那既然它是按照顺序来赋值的，那我如果在前面的值设置大一点，会不会出现后面的值和前面的值相等的情况？比如：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">enum</span> Stage &#123;</span><br><span class="line">    Debug = <span class="number">1</span>,</span><br><span class="line">    Info = <span class="number">3</span>,</span><br><span class="line">    Warning = <span class="number">2</span>,</span><br><span class="line">    <span class="built_in">Error</span>,</span><br><span class="line">    Critical,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stage: Stage = Stage.Error;</span><br><span class="line"><span class="keyword">let</span> stage2: Stage = Stage.Info;</span><br><span class="line"><span class="built_in">console</span>.log(stage, <span class="keyword">typeof</span> stage);</span><br><span class="line"><span class="built_in">console</span>.log(stage2, <span class="keyword">typeof</span> stage2);</span><br><span class="line"><span class="built_in">console</span>.log(stage == stage2);</span><br></pre>      </td>    </tr>  </table></figure><p>看看这样会发生什么？这里 Error 按照常理来说会从 Warning 开始自增，值应该为 3，那 Info 我也设置为 3，二者会是相等吗？</p><p>运行结果如下：</p><figure class="highlight markdown">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="symbol">LOG</span>]: <span class="link">3,  "number" </span></span><br><span class="line">[<span class="symbol">LOG</span>]: <span class="link">3,  "number" </span></span><br><span class="line">[<span class="symbol">LOG</span>]: <span class="link">true</span></span><br></pre>      </td>    </tr>  </table></figure><p>果不其然，二者还都是 3，而且它们就是相等的。所以，对于枚举类型，我们一定要注意声明值的时候最好不要引起自增值和设定值之间的冲突，不然会引入不必要的麻烦。</p><p>另外对于枚举类型，我们还可以根据值进行查询，比如对于上述声明，我们不知道哪个值等于 2 或者 3，那可以直接将值传给 Stage 进行查询，得到的结果是一个字符串，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">enum</span> Stage &#123;</span><br><span class="line">    Debug = <span class="number">1</span>,</span><br><span class="line">    Info = <span class="number">3</span>,</span><br><span class="line">    Warning = <span class="number">2</span>,</span><br><span class="line">    <span class="built_in">Error</span>,</span><br><span class="line">    Critical,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stage: <span class="built_in">string</span> = Stage[<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(stage, <span class="keyword">typeof</span> stage);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stage2: <span class="built_in">string</span> = Stage[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">console</span>.log(stage2, <span class="keyword">typeof</span> stage2);</span><br></pre>      </td>    </tr>  </table></figure><p>运行结果如下：</p><figure class="highlight 1c">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="built_in">LOG</span>]: <span class="string">"Error"</span>,  <span class="string">"string"</span> </span><br><span class="line">[<span class="built_in">LOG</span>]: <span class="string">"Warning"</span>,  <span class="string">"string"</span></span><br></pre>      </td>    </tr>  </table></figure><p>比如这里 <code>Stage[2]</code> 就是查找枚举值等于 2 的枚举名称，结果是 Warning。那值相同的咋办呢？比如 3，看结果它返回的是 Error，看来 Error 把 Info 覆盖掉了，查询的结果是最新的一个枚举名称。注意这里返回的结果是字符串类型，不是枚举类型，它仅仅代表枚举的名称而已。</p><h3 id="Unknown"><a href="#Unknown" class="headerlink" title="Unknown"></a>Unknown</h3><p>Unknown 即未知类型，一般在类型不确定的情况下可以声明为 unknown 类型。比如说一个数据可能是 API 返回的，它可能是数值类型也可能是字符串类型，并不知道，这时候我们就可以将其声明为 unknown 类型。</p><p>示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> notSure: unknown = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">"maybe a string instead"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OK, definitely a boolean</span></span><br><span class="line">notSure = <span class="literal">false</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>比如这里 notSure 就声明了 unknown 类型，一开始它是数值类型，但当然也可以是字符串或者布尔类型。</p><p>那这样不就没啥用了吗？和 JavaScript 有啥不同吗？其实 unknown 还有其他用处，比如说编译器可以在一些判定条件下对 unknown 的值进行精确化处理，比如说一个 if 条件，判定了类型为布尔类型，那么其他和该类型相关的变量都会执行静态类型检查。示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> maybe: unknown;</span><br><span class="line"><span class="comment">// 'maybe' could be a string, object, boolean, undefined, or other types</span></span><br><span class="line"><span class="keyword">const</span> aNumber: <span class="built_in">number</span> = maybe;</span><br><span class="line"><span class="comment">// Type 'unknown' is not assignable to type 'number'.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (maybe === <span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// TypeScript knows that maybe is a boolean now</span></span><br><span class="line">  <span class="keyword">const</span> aBoolean: <span class="built_in">boolean</span> = maybe;</span><br><span class="line">  <span class="comment">// So, it cannot be a string</span></span><br><span class="line">  <span class="keyword">const</span> aString: <span class="built_in">string</span> = maybe;</span><br><span class="line">  <span class="comment">// Type 'boolean' is not assignable to type 'string'.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> maybe === <span class="string">"string"</span>) &#123;</span><br><span class="line">  <span class="comment">// TypeScript knows that maybe is a string</span></span><br><span class="line">  <span class="keyword">const</span> aString: <span class="built_in">string</span> = maybe;</span><br><span class="line">  <span class="comment">// So, it cannot be a boolean</span></span><br><span class="line">  <span class="keyword">const</span> aBoolean: <span class="built_in">boolean</span> = maybe;</span><br><span class="line">  <span class="comment">// Type 'string' is not assignable to type 'boolean'.</span></span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里使用 declare 声明了一个类型变量，然后通过类型变量里面的判定条件就能配合检查其他变量的类型了。</p><h3 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h3><p>和 Unknown 的情形类似，我们还可以使用 any 来代表任意的类型，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params">key: <span class="built_in">string</span></span>): <span class="title">any</span></span>;</span><br><span class="line"><span class="comment">// OK, return value of 'getValue' is not checked</span></span><br><span class="line"><span class="keyword">const</span> str: <span class="built_in">string</span> = getValue(<span class="string">"myString"</span>);</span><br></pre>      </td>    </tr>  </table></figure><p>这里声明了一个方法，返回类型就是 any，这样的话返回类型就可以是任意的结果了。</p><p>那 any 和 unknown 有什么不同呢？any 的自由度会更高一点，如果声明为 any，那么静态类型检查都会通过，即使某个变量的属性不存在。示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> looselyTyped: <span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// OK, ifItExists might exist at runtime</span></span><br><span class="line">looselyTyped.ifItExists();</span><br><span class="line"><span class="comment">// OK, toFixed exists (but the compiler doesn't check)</span></span><br><span class="line">looselyTyped.toFixed();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strictlyTyped: unknown = <span class="number">4</span>;</span><br><span class="line">strictlyTyped.toFixed();</span><br><span class="line"><span class="comment">// Error, Object is of type 'unknown'.</span></span><br></pre>      </td>    </tr>  </table></figure><p>可以看到，前两行的静态类型检查是能过的，但是 unknown 就过不了。</p><p>所以，什么时候用 unknown 什么时候用 any 呢？可以从含义上来进行区分：如果某个变量我确实就不知道它的类型，即我没办法知道它的类型，那就用 unknown；如果某个值但其实我确实有办法知道可能的类型，但确实它的类型自由度比较高，那就可以被声明为 any。</p><p>但在不必要的情况下，尽量减少 any 类型的使用。</p><h3 id="Void"><a href="#Void" class="headerlink" title="Void"></a>Void</h3><p>Void 一般用于声明方法的返回值，如果一个方法不返回任何结果，那就用 Void，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnUser</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"This is my warning message"</span>);</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><h3 id="Null-和-Undefined"><a href="#Null-和-Undefined" class="headerlink" title="Null 和 Undefined"></a>Null 和 Undefined</h3><p>其实 TypeScript 还专门为 null 和 undefined 声明了类型，一般 null 就声明为 null 类型，undefined 就声明为 undefined 类型，不过这两个并不太常用，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment">// Not much else we can assign to these variables!</span></span><br><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>另外对于其他类型来说，其值也可以是 null 或者 undefined，比如 number 类型的变量，其值为 null 也是完全可以的。不过这里有个前提条件就是，TS Config 里面的 strictNullChecks 应该是关闭状态，不然会报错的。</p><p>设置如下：</p><p><img src="https://qiniu.cuiqingcai.com/ricrd.png" alt="image-20201229014015393"></p><p>比如：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> b: <span class="built_in">string</span> = <span class="literal">null</span>;</span><br></pre>      </td>    </tr>  </table></figure><p>这样就是没问题的了。</p><h3 id="Never"><a href="#Never" class="headerlink" title="Never"></a>Never</h3><p>这个类型也比较特殊，它代表你永远得不到它的结果。比如一个方法始终抛出一个异常，或者处于一个无限循环中，那么就可以声明为 never，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment">// Function returning never must not have a reachable end point</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inferred return type is never</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> error(<span class="string">"Something failed"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Function returning never must not have a reachable end point</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">infiniteLoop</span>(<span class="params"></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><p>Object 是 JavaScript 本身带有的类型，它表示非原始型的类型，即任何不是 number、string、boolean、bigint、symbol、null、undefined 的类型。</p><p>示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">o: object | <span class="literal">null</span></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OK</span></span><br><span class="line">create(&#123; prop: <span class="number">0</span> &#125;);</span><br><span class="line">create(<span class="literal">null</span>);</span><br><span class="line">create(<span class="number">42</span>);</span><br><span class="line"><span class="comment">// Error, Argument of type '42' is not assignable to parameter of type 'object | null'.</span></span><br><span class="line">create(<span class="string">"string"</span>);</span><br><span class="line"><span class="comment">// Error, Argument of type '"string"' is not assignable to parameter of type 'object | null'.</span></span><br><span class="line">create(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// Error, Argument of type 'false' is not assignable to parameter of type 'object | null'.</span></span><br><span class="line">create(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">// Error, Argument of type 'undefined' is not assignable to parameter of type 'object | null'.</span></span><br></pre>      </td>    </tr>  </table></figure><p>不过，一般不用。</p><h3 id="Type-assertions"><a href="#Type-assertions" class="headerlink" title="Type assertions"></a>Type assertions</h3><p>一般情况下，我们确确实实知道某个变量属于什么类型，或者在某种情况下确实需要这种类型的转化，则可以显式的声明某个类型，示例如下：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">let</span> someValue: unknown = <span class="string">"this is a string"</span>;</span><br><span class="line"><span class="keyword">let</span> strLength: <span class="built_in">number</span> = (someValue <span class="keyword">as</span> <span class="built_in">string</span>).length;</span><br><span class="line"><span class="keyword">let</span> someValue2: unknown = <span class="string">"this is a string"</span>;</span><br><span class="line"><span class="keyword">let</span> strLength2: <span class="built_in">number</span> = (&lt;<span class="built_in">string</span>&gt;someValue2).length;</span><br></pre>      </td>    </tr>  </table></figure><p>这里有两种使用方式，一种是 as，一种是尖括号声明。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>另外值得注意到是，以上的一些类型声明，使用大写形式 <code>Number</code>, <code>String</code>, <code>Boolean</code>, <code>Symbol</code> and <code>Object</code> 也是可以的，不过不推荐这么做，推荐还是用小写的形式。</p><p>比如这样其实是可以的：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">s: <span class="built_in">String</span></span>): <span class="title">String</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.split(<span class="string">""</span>).reverse().join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reverse(<span class="string">"hello world"</span>);</span><br></pre>      </td>    </tr>  </table></figure><p>但更推荐使用小写，写成如下形式：</p><figure class="highlight typescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params">s: <span class="built_in">string</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.split(<span class="string">""</span>).reverse().join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reverse(<span class="string">"hello world"</span>);</span><br></pre>      </td>    </tr>  </table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上便是一些基本的类型声明方式，暂时先总结这么多，后面还会继续整理更高级的用法，比如 Function、Interface、Class 等。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;之前的时候都是用 JavaScript 开发，但是最近发现随着项目的推进，一些项目越来越多地要求使用 TypeScript 来开发，所以不得不来专门学习一下 TypeScript 了，本篇文章就简单记录下学习 TypeScript 的过程。&lt;/p&gt;
&lt;h2 id=&quot;介绍&quot;&gt;
      
    
    </summary>
    
    
      <category term="TypeScript" scheme="https://cuiqingcai.com/categories/TypeScript/"/>
    
    
  </entry>
  
  <entry>
    <title>腾讯云容器服务Docker容器存储爆满解决方案</title>
    <link href="https://cuiqingcai.com/23858.html"/>
    <id>https://cuiqingcai.com/23858.html</id>
    <published>2020-11-28T18:35:47.000Z</published>
    <updated>2021-02-10T17:34:38.705Z</updated>
    
    <content type="html"><![CDATA[<p>最近的服务都放到腾讯云上了，但是最近遇到了一个问题是 Docker 云磁盘满了，部署的适合提示 no space left 等等。</p><p>然后我就登录云主机看了下磁盘情况，好家伙：</p><figure class="highlight angelscript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="symbol">ubuntu@</span>VM<span class="number">-0</span><span class="number">-2</span>-ubuntu:/var/lib/docker/containers$ df</span><br><span class="line">Filesystem     <span class="number">1</span>K-blocks    Used Available Use% Mounted on</span><br><span class="line">udev             <span class="number">3869584</span>       <span class="number">0</span>   <span class="number">3869584</span>   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs             <span class="number">777376</span>   <span class="number">15124</span>    <span class="number">762252</span>   <span class="number">2</span>% /run</span><br><span class="line">/dev/vda1      <span class="number">103145380</span> <span class="number">9460508</span>  <span class="number">89390616</span>  <span class="number">10</span>% /</span><br><span class="line">tmpfs            <span class="number">3886864</span>      <span class="number">24</span>   <span class="number">3886840</span>   <span class="number">1</span>% /dev/shm</span><br><span class="line">tmpfs               <span class="number">5120</span>       <span class="number">0</span>      <span class="number">5120</span>   <span class="number">0</span>% /run/lock</span><br><span class="line">tmpfs            <span class="number">3886864</span>       <span class="number">0</span>   <span class="number">3886864</span>   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/vdb        <span class="number">10255636</span> <span class="number">10155252</span>   -  <span class="number">99</span>% /var/lib/docker</span><br></pre>      </td>    </tr>  </table></figure><p>vdb 这个磁盘就是我的数据盘，里面放了容器数据，现在已经到了 99% 了，一共就 10G。</p><p>然后我就去腾讯云控制台搞了下数据盘的扩容，然后直接扩容到了 200G。</p><p>但是回过头来看了下磁盘还是 10G，一变不变。</p><p>但 fdisk 已经看到变了：</p><figure class="highlight yaml">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="string">ubuntu@VM-0-2-ubuntu:/var/lib/docker/containers$</span> <span class="string">sudo</span> <span class="string">fdisk</span> <span class="string">-l</span></span><br><span class="line"><span class="attr">Disk /dev/vda:</span> <span class="number">100</span> <span class="string">GiB,</span> <span class="number">107374182400</span> <span class="string">bytes,</span> <span class="number">209715200</span> <span class="string">sectors</span></span><br><span class="line"><span class="attr">Units:</span> <span class="string">sectors</span> <span class="string">of</span> <span class="number">1</span> <span class="string">*</span> <span class="number">512</span> <span class="string">=</span> <span class="number">512</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">Sector</span> <span class="string">size</span> <span class="string">(logical/physical):</span> <span class="number">512</span> <span class="string">bytes</span> <span class="string">/</span> <span class="number">512</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">I/O</span> <span class="string">size</span> <span class="string">(minimum/optimal):</span> <span class="number">512</span> <span class="string">bytes</span> <span class="string">/</span> <span class="number">512</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Disklabel type:</span> <span class="string">dos</span></span><br><span class="line"><span class="attr">Disk identifier:</span> <span class="number">0x3fa1d255</span></span><br><span class="line"></span><br><span class="line"><span class="string">Device</span>     <span class="string">Boot</span> <span class="string">Start</span>       <span class="string">End</span>   <span class="string">Sectors</span>  <span class="string">Size</span> <span class="string">Id</span> <span class="string">Type</span></span><br><span class="line"><span class="string">/dev/vda1</span>  <span class="string">*</span>     <span class="number">2048</span> <span class="number">209715166</span> <span class="number">209713119</span>  <span class="string">100G</span> <span class="number">83</span> <span class="string">Linux</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Disk /dev/vdb:</span> <span class="number">200</span> <span class="string">GiB,</span> <span class="number">214748364800</span> <span class="string">bytes,</span> <span class="number">419430400</span> <span class="string">sectors</span></span><br><span class="line"><span class="attr">Units:</span> <span class="string">sectors</span> <span class="string">of</span> <span class="number">1</span> <span class="string">*</span> <span class="number">512</span> <span class="string">=</span> <span class="number">512</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">Sector</span> <span class="string">size</span> <span class="string">(logical/physical):</span> <span class="number">512</span> <span class="string">bytes</span> <span class="string">/</span> <span class="number">512</span> <span class="string">bytes</span></span><br><span class="line"><span class="string">I/O</span> <span class="string">size</span> <span class="string">(minimum/optimal):</span> <span class="number">512</span> <span class="string">bytes</span> <span class="string">/</span> <span class="number">512</span> <span class="string">bytes</span></span><br></pre>      </td>    </tr>  </table></figure><p>这是因为之前的数据被格式化为了 ext4，但是新扩容的部分并没有。</p><p>问了腾讯云的工程师，这时候必须要重新格式化才能用上新的容量，没有好的解决方法。</p><p>最后的解决方案：</p><ul>  <li>将当前节点所有 Pod 驱逐到其他的节点。</li>  <li>当前节点退出集群然后配置磁盘，重新操作 mount 和格式化。（但是这里劝别折腾了，终究还是要格式化的。</li>  <li>把节点再加回来，这时候可以选重新格式化数据盘，mount 到 /var/lib/docker。</li>  <li>再把之前的 Pod 收回到本节点就好了。</li></ul><p>完毕。</p><p>感觉还是不完善啊，像 Azure Kubernetes 的扩容就方便多了，不用整这么多麻烦事。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近的服务都放到腾讯云上了，但是最近遇到了一个问题是 Docker 云磁盘满了，部署的适合提示 no space left 等等。&lt;/p&gt;
&lt;p&gt;然后我就登录云主机看了下磁盘情况，好家伙：&lt;/p&gt;
&lt;figure class=&quot;highlight angelscript&quot;&gt;
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>Python之父和我成为同事了？！</title>
    <link href="https://cuiqingcai.com/23857.html"/>
    <id>https://cuiqingcai.com/23857.html</id>
    <published>2020-11-14T15:28:24.000Z</published>
    <updated>2021-02-10T17:34:38.576Z</updated>
    
    <content type="html"><![CDATA[<p>就昨天的时候，Python 之父 Guido 发了个推特，说自己觉得退休太无聊了，然后于是乎决定加入微软。</p><p><img src="https://qiniu.cuiqingcai.com/diqwk.jpg" alt=""></p><p>同时推特上大神 Anders Hejlsberg（Delphi、C# 和 TypeScript 之父）转发了推特，表示希望可以一起工作。</p><p><img src="https://qiniu.cuiqingcai.com/3nz48.png" alt=""></p><p>要知道，去年那会去年 10 月 30 日，Python 之父 Guido 宣布退休，当时他发推文说，“这件事感觉既苦涩又甜蜜：苦涩的是，我马上要离开 Dropbox，现在已经退休；甜蜜的是，在 Dropbox 做工程师期间，我学到很多，比如类型标注就来自这段经历。我会非常怀念在这里工作的日子。”</p><p>看到这个消息我既震惊又激动，Python 之父加入我司了？那我岂不是和他也算做同事了？哈哈哈。</p><p>当时我看到这个消息之后，第一时间就去公司的系统里面查了下，果真就查到了，这里放个图。</p><p><img src="https://qiniu.cuiqingcai.com/e1rl8.png" alt=""></p><p>他的 Title 叫 DISTINUISHED ENGINEER，这个 Title 可不是一般的牛逼，在微软，有这样的 Title 的人可是屈指可数的，DISTINUISHED 意思就是杰出的，非常牛逼的意思，能有这种 Title 的是为业界或公司做出过特别特别大贡献的，特别有影响力的，可能普通人在微软呆个二十多年都不一定能到这个地位。他的职级和 Report Line 就不说了，他距离微软 CEO 纳德拉只差 3 级，稍微形象点说就是对标阿里 P11 或者 P12 的位置吧。</p><p>他的部门就直接写了 Python and Tools for AI，和 AI 相关，同时 Guido 又这么热爱开源，微软也在一直拥抱开源，期待 Python 之父将来不久之后又出新的杰作吧。</p><p>要知道 Python 之父 Guido 已经 64 岁了，或许大佬就是大佬吧，退休了感觉无聊，就来微软来玩玩。怎么说呢？他这个地位就是类似达成一些自我追求和实现自己的一些价值，顺便解解闷，这种境界完全不是我们能比的了。反过来想想中国这个环境，多少人都是用代码来换取一份工作谋求生存，然后 35 岁干不动了可能就被辞退。本来想展开说说的，但是感觉说来都是痛，就不多说了，希望我将来不会为生活所迫，能够自由地继续追求自己热爱的东西。</p><p>另外本想说说 Guido 的履历的，但看到其他的一些文章已经整理得挺好了，我就不再重复了，大家想了解更多的话可以去看看 <a href="https://mp.weixin.qq.com/s/ZQJClbYiKP5cAnKjB_ZfUg。" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ZQJClbYiKP5cAnKjB_ZfUg。</a></p><p>总之，我就是来宣布这个和 Python 之父成为“同事”的开心的消息，值得纪念下，然后顺便期待下 Python 之父将来出新的杰作！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;就昨天的时候，Python 之父 Guido 发了个推特，说自己觉得退休太无聊了，然后于是乎决定加入微软。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qiniu.cuiqingcai.com/diqwk.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;同时推特上大神 And
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>二次封装requests，构造通用的请求函数</title>
    <link href="https://cuiqingcai.com/23859.html"/>
    <id>https://cuiqingcai.com/23859.html</id>
    <published>2020-11-12T15:42:51.000Z</published>
    <updated>2021-02-10T17:34:38.654Z</updated>
    
    <content type="html"><![CDATA[<p>本章将告诉你该如何去对request模块进行二次封装，暂时并不会告诉你HTTP协议及原理、URL等相关。当然你会使用然后在来阅读此文章一定会另有所获。我已经迫不及待要告诉你这个小秘密，以及想与你交流了。没时间解释了，快来一起和我一起探讨相关的内容吧</p><p><a href="https://requests.readthedocs.io/zh_CN/latest/#requests-http" target="_blank" rel="noopener">官方文档</a>对requests的定义为：Requests 唯一的一个<strong>非转基因</strong>的 Python HTTP 库，人类可以安全享用。</p><p>使用Python写做爬虫的小伙伴一定使用过requests这个模块，初入爬虫的小伙伴也一定写过N个重复的requests，这是你的疑问。当然也一直伴随着我，最近在想对requests如何进行封装一下，让他支持支持通用的函数。若需要使用，直接调用即可。</p><p>那么问题来了，如果要写个供自己使用通用的请求函数将会有几个问题</p><ul>  <li>requests的请求方式(GET\POST\INPUT等等)</li>  <li>智能识别网站的编码，避免出现乱码</li>  <li>支持文本、二进制(图片、视频等为二进制内容)</li>  <li>以及还需要傻瓜一点，那就是网站的Ua(Ua:User-Agent，基本上网站都会验证接受到请求的Ua。来初步判断是爬虫还是用户)</li></ul><p>那么咱们就针对以上问题开干吧</p><h2 id="Requests的安装"><a href="#Requests的安装" class="headerlink" title="Requests的安装"></a>Requests的安装</h2><p>在确保python环境搭建完成后直接使用pip或者conda命令进行安装，安装命令如下：</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line">pip install requests</span><br><span class="line">conda install requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者下载过慢点话，可以使用国内的pip镜像源，例如:</span></span><br><span class="line">pip install requests -i  https://pypi.tuna.tsinghua.edu.cn/simple/</span><br></pre>      </td>    </tr>  </table></figure><p>安装完成后，效果图如下：</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gkmppwcd62j325008g0w1.jpg" alt=""></p><h2 id="初探requests基本使用"><a href="#初探requests基本使用" class="headerlink" title="初探requests基本使用"></a>初探requests基本使用</h2><p>HTTP 中最常见的请求之一就是 GET 请求，下面我们来详细了解利用 requests 库构建 GET 请求的方法。</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 响应状态码</span></span><br><span class="line">print(<span class="string">"response.status_code:"</span>, response.status_code)</span><br><span class="line"><span class="comment"># 响应头</span></span><br><span class="line">print(<span class="string">"response.headers:"</span>, response.headers)</span><br><span class="line"><span class="comment"># 响应请求头</span></span><br><span class="line">print(<span class="string">"response.request.headers:"</span>, response.request.headers)</span><br><span class="line"><span class="comment"># 响应二进制内容</span></span><br><span class="line">print(<span class="string">"response.content:"</span>, response.content)</span><br><span class="line"><span class="comment"># 响应文本</span></span><br><span class="line">print(<span class="string">"response.text"</span>, response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回如下</span></span><br><span class="line">response.status_code: <span class="number">200</span></span><br><span class="line">response.headers: &#123;<span class="string">'Date'</span>: <span class="string">'Thu, 12 Nov 2020 13:38:05 GMT'</span>, <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>, <span class="string">'Content-Length'</span>: <span class="string">'306'</span>, <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>, <span class="string">'Server'</span>: <span class="string">'gunicorn/19.9.0'</span>, <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>, <span class="string">'Access-Control-Allow-Credentials'</span>: <span class="string">'true'</span>&#125;</span><br><span class="line">response.request.headers: &#123;<span class="string">'User-Agent'</span>: <span class="string">'python-requests/2.24.0'</span>, <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>&#125;</span><br><span class="line">response.content: <span class="string">b'&#123;\n  "args": &#123;&#125;, \n  "headers": &#123;\n    "Accept": "*/*", \n    "Accept-Encoding": "gzip, deflate", \n    "Host": "httpbin.org", \n    "User-Agent": "python-requests/2.24.0", \n    "X-Amzn-Trace-Id": "Root=1-5fad3abd-7516d60b3e951824687a50d8"\n  &#125;, \n  "origin": "116.162.2.166", \n  "url": "http://httpbin.org/get"\n&#125;\n'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"python-requests/2.24.0"</span>,</span><br><span class="line">    <span class="string">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-5fad3abd-7516d60b3e951824687a50d8"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"116.162.2.166"</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>requests基本使用已经经过简单的测试了，是否有一点点feel呢？接下来我们直接将它封装为一个函数以供随时调用</p><p>示例如下</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">urls = <span class="string">'http://httpbin.org/get'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, headers=None)</span>:</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"downloader.status_code:"</span>, downloader(url=urls).status_code)</span><br><span class="line">print(<span class="string">"downloader.headers:"</span>, downloader(url=urls).headers)</span><br><span class="line">print(<span class="string">"downloader.request.headers:"</span>, downloader(url=urls).request.headers)</span><br><span class="line">print(<span class="string">"downloader.content:"</span>, downloader(url=urls).content)</span><br><span class="line">print(<span class="string">"downloader.text"</span>, downloader(url=urls).text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回效果如上所示，此处省略</span></span><br></pre>      </td>    </tr>  </table></figure><p>以上我们就把，请求方法封装成了一个函数。将基本的url，headers以形参的方式暴露出来，我们只需传入需要请求的url即可发起请求，至此一个简单可复用的请求方法咱们就完成啦。</p><p>完～～～</p><p>以上照顾新手的就基本完成了，接下来我们搞点真家伙。</p><h2 id="二次封装"><a href="#二次封装" class="headerlink" title="二次封装"></a>二次封装</h2><h3 id="请求函数的封装"><a href="#请求函数的封装" class="headerlink" title="请求函数的封装"></a>请求函数的封装</h3><p>由于请求方式并不一定(有可能是GET也有可能是POST)，所以我们并不能<code>智能</code>的确定它是什么方式发送请求的。</p><p>Requests中request方法以及帮我们实现了这个方法。我们将他的请求方式暴露出来，写法如下：</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>      </td>      <td class="code">        <pre><span class="line">urls = <span class="string">'http://httpbin.org/get'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, method=None, headers=None)</span>:</span></span><br><span class="line">    _method = <span class="string">"GET"</span> <span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">else</span> method</span><br><span class="line">    response = requests.request(url, method=_method, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">"downloader.status_code:"</span>, downloader(url=urls).status_code)</span><br><span class="line">print(<span class="string">"downloader.headers:"</span>, downloader(url=urls).headers)</span><br><span class="line">print(<span class="string">"downloader.request.headers:"</span>, downloader(url=urls).request.headers)</span><br><span class="line">print(<span class="string">"downloader.content:"</span>, downloader(url=urls).content)</span><br><span class="line">print(<span class="string">"downloader.text"</span>, downloader(url=urls).text)</span><br></pre>      </td>    </tr>  </table></figure><p>由于大部分都是GET方法，所以我们定义了一个默认的请求方式。如果需要修改请求方式，只需在调用时传入相对应的方法即可。例如我们可以这样</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">downloader(urls, method=<span class="string">"POST"</span>)</span><br></pre>      </td>    </tr>  </table></figure><h3 id="文本编码问题"><a href="#文本编码问题" class="headerlink" title="文本编码问题"></a>文本编码问题</h3><p>解决由于request的误差判断而造成解码错误，而得到乱码。</p><p>此误差造成的原因是可能是响应头的<code>Accept-Encoding</code>，另一个是识别错误</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 查看响应编码</span></span><br><span class="line">response.encoding</span><br></pre>      </td>    </tr>  </table></figure><p>此时我们需要借用Python中C语言编写的<code>cchardet</code>这个包来识别响应文本的编码。安装它</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line">pip install cchardet -i  https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line"><span class="comment"># 如果pip直接安装失败的话，直接用清华源的镜像。</span></span><br></pre>      </td>    </tr>  </table></figure><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 实现智能版的解码：如下</span></span><br><span class="line">encoding = cchardet.detect(response.content)[<span class="string">'encoding'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, method=None, headers=None)</span>:</span></span><br><span class="line">    _method = <span class="string">"GET"</span> <span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">else</span> method</span><br><span class="line">    response = requests.request(url, method=_method, headers=headers)</span><br><span class="line">    encoding = cchardet.detect(response.content)[<span class="string">'encoding'</span>]</span><br><span class="line">    <span class="keyword">return</span> response.content.decode(encoding)</span><br></pre>      </td>    </tr>  </table></figure><h3 id="区分二进制与文本的解析"><a href="#区分二进制与文本的解析" class="headerlink" title="区分二进制与文本的解析"></a>区分二进制与文本的解析</h3><p>在下载图片、视频等需获取到其二进制内容。而下载网页文本需要进行encode。</p><p>同理，我们只需要将一个标志传进去，从而达到分辨的的效果。例如这样</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, method=None, headers=None, binary=False)</span>:</span></span><br><span class="line">    _method = <span class="string">"GET"</span> <span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">else</span> method</span><br><span class="line">    response = requests.request(url, method=_method, headers=headers)</span><br><span class="line">    encoding = cchardet.detect(response.content)[<span class="string">'encoding'</span>]</span><br><span class="line">    <span class="keyword">return</span> response.content <span class="keyword">if</span> binary <span class="keyword">else</span> response.content.decode(encoding)</span><br></pre>      </td>    </tr>  </table></figure><h3 id="默认Ua"><a href="#默认Ua" class="headerlink" title="默认Ua"></a>默认Ua</h3><p>在很多时候，我们拿ua又是复制。又是加引号构建key-value格式。这样有时候仅仅用requests做个测试。就搞的麻烦的很。而且请求过多了，直接就被封IP了。没有自己的ip代理，没有钱又时候还真有点感觉玩不起爬虫。</p><p>为了减少被封禁IP的概率什么的，我们添加个自己的Ua池。Ua池的原理很简单，内部就是采用随机的Ua，从而减少被发现的<code>概率</code>.至于为什么可以达到这这样的效果，在这里仅作简单介绍。详细可能要从计算机网络原理说起。</p><p>结论就是你一个公司里大多采用的都是同一个<code>外网</code>ip去访问目标网址。那么就意味着可能你们公司有N个人使用同一个ip去访问目标网址。而封禁做区分的一般由ip访问频率和浏览器的指纹和在一起的什么鬼东东。简单理解为Ua+ip访问频率达到峰值，你IP就对方关小黑屋了。</p><p>构建自己的ua池，去添加默认的请求头，</p><p>Ua有很多，这里就不放出来了，如果有兴趣可以直接去<a href="https://github.com/PowerSpider/PowerSpider/tree/dev" target="_blank" rel="noopener">源码</a>里面拿。直接说原理：构造很多个Ua，然后随机取用。从而降低这个同一访问频率：同时也暴露端口方便你自己传入header</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">from</span> powerspider.tools.Ua <span class="keyword">import</span> ua</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, method=None, header=None, binary=False)</span>:</span></span><br><span class="line">    _headers = header <span class="keyword">if</span> header <span class="keyword">else</span> &#123;<span class="string">'User-Agent'</span>: ua()&#125;</span><br><span class="line">    _method = <span class="string">"GET"</span> <span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">else</span> method</span><br><span class="line">    response = requests.request(url, method=_method, headers=_headers)</span><br><span class="line">    encoding = cchardet.detect(response.content)[<span class="string">'encoding'</span>]</span><br><span class="line">    <span class="keyword">return</span> response.content <span class="keyword">if</span> binary <span class="keyword">else</span> response.content.decode(encoding)</span><br></pre>      </td>    </tr>  </table></figure><p>那么基本的文件都已经解决了，不过还不完美。异常处理，错误重试，日志什么都没。这怎么行呢。活既然干了，那就干的漂漂亮亮的。</p><p>来让我们加入进来这些东西</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">import</span> cchardet</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">from</span> powerspider <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> powerspider.tools.Ua <span class="keyword">import</span> ua</span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> request, RequestException</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(stop_max_attempt_number=3, retry_on_result=lambda x: x is None, wait_fixed=2000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloader</span><span class="params">(url, method=None, header=None, timeout=None, binary=False, **kwargs)</span>:</span></span><br><span class="line">    logger.info(<span class="string">f'Scraping <span class="subst">&#123;url&#125;</span>'</span>)</span><br><span class="line">    _header = &#123;<span class="string">'User-Agent'</span>: ua()&#125;</span><br><span class="line">    _maxTimeout = timeout <span class="keyword">if</span> timeout <span class="keyword">else</span> <span class="number">5</span></span><br><span class="line">    _headers = header <span class="keyword">if</span> header <span class="keyword">else</span> _header</span><br><span class="line">    _method = <span class="string">"GET"</span> <span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">else</span> method</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = request(method=_method, url=url, headers=_headers, **kwargs)</span><br><span class="line">        encoding = cchardet.detect(response.content)[<span class="string">'encoding'</span>]</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.content <span class="keyword">if</span> binary <span class="keyword">else</span> response.content.decode(encoding)</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">200</span> &lt; response.status_code &lt; <span class="number">400</span>:</span><br><span class="line">            logger.info(<span class="string">f"Redirect_URL: <span class="subst">&#123;response.url&#125;</span>"</span>)</span><br><span class="line">        logger.error(<span class="string">'Get invalid status code %s while scraping %s'</span>, response.status_code, url)</span><br><span class="line">    <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f'Error occurred while scraping <span class="subst">&#123;url&#125;</span>, Msg: <span class="subst">&#123;e&#125;</span>'</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(downloader(<span class="string">"https://www.baidu.com/"</span>, <span class="string">"GET"</span>))</span><br></pre>      </td>    </tr>  </table></figure><p>至此，我们的对Requests二次封装，构造通用的请求函数就已经完成了。</p><p>源码地址：<a href="https://github.com/PowerSpider/PowerSpider/tree/dev" target="_blank" rel="noopener">https://github.com/PowerSpider/PowerSpider/tree/dev</a></p><p>期待下次再见</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本章将告诉你该如何去对request模块进行二次封装，暂时并不会告诉你HTTP协议及原理、URL等相关。当然你会使用然后在来阅读此文章一定会另有所获。我已经迫不及待要告诉你这个小秘密，以及想与你交流了。没时间解释了，快来一起和我一起探讨相关的内容吧&lt;/p&gt;
&lt;p&gt;&lt;a hr
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="爬虫" scheme="https://cuiqingcai.com/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>华为云CloudIDE带你实现云上编码</title>
    <link href="https://cuiqingcai.com/23855.html"/>
    <id>https://cuiqingcai.com/23855.html</id>
    <published>2020-11-10T17:28:24.000Z</published>
    <updated>2021-02-10T17:34:38.666Z</updated>
    
    <content type="html"><![CDATA[<p>前阵子有个朋友问我一个 Python 相关的问题，然后我把解决方案简单用代码写了一下发给他，结果他说跑不起来，我就很纳闷，确认了下他说 Python 库也都装了，但是运行的时候还是会报库找不到。果不其然，经过一段时间沟通发现，它的机器上装了两个 Python 环境，装 Python 库的时候是用的 pip 安装的，它对应了一个 Python 环境，但是运行的时候却是用的使用的 python3 命令却是对应另外一个 Python 环境，理所当然就跑不通了。这个问题其实挺常见的，有时候跟对方说检查下 Python 环境路径什么的，但是对方有时候并不知道怎么做，或者直接得再告诉他用 <code>python3 -m pip install ...</code> 命令来装包。</p><p>另外我还有个需求是，我写了一些代码，想直接把运行结果和代码发给别人看，一种方法可以直接借助于 GitHub，代码放上去，然后让对方 Clone 下来再运行。对方也得配置下相关的环境才能正确跑起来。另一种方法则是打包 Docker 镜像，但是这也得额外花一些时间。有没有更好的方案解决这个问题呢？</p><p>上面这就是两个问题：</p><ul>  <li>环境不一致的问题</li>  <li>环境共享的问题</li></ul><p>这俩问题有通用的解决方案吗？有！答案就是云 IDE。有了云 IDE，不仅以上两个问题可以解决，甚至都不用自己配置开发环境了，我们只需要一个浏览器就能在线编辑代码，同时这个 IDE 还能分享给他人，他人打开之后，看到的就是和我一模一样的内容，甚至还可以看到我正在编写代码的实时效果。</p><p>美哉美哉！</p><p>今天就给大家介绍一款云 IDE，是华为家的，叫做「华为云CloudIDE」，我试用了一下感觉还不错，它的官方介绍页面是这样的：</p><p><img src="https://qiniu.cuiqingcai.com/mqq3y.png" alt="image-20201111005857785"></p><p>官方介绍如下：</p><blockquote>  <p>通过华为云CloudIDE，您仅需一个浏览器就可以编辑、调试、运行您的代码。</p>  <p>开发环境通常包括各种配置文件、特定的语言、框架版本、以及其他个人设备等等一系列个人配置。当您开发一个新的项目或者测试一些程序时，不得不对已有的个人配置做相应的调整。或者，您可以通过CloudIDE将个人的偏好设置转移到云端。CloudIDE将存储项目设置，实现您与他人共享，并通过浏览器授予访问的权限。您可以将所有文件保存在云环境中，并通过各种访问设备操作管理它们。开发环境在云端，您可以实现代码阅读、编写、调试、运行，也可以将代码存入代码仓库，随时、随地、随心！</p></blockquote><p>和我刚才说的就是一样的，利用它我们可以解决诸多问题：如环境配置、环境统一、环境共享的问题，同时我们还可以随时随地编辑代码，丝毫不受机器的限制，上云之后，一切都是那么方便。</p><p>好，这里我就带大家来体验下「华为云CloudIDE」吧。</p><p>首先，目前「华为云CloudIDE」是可以免费体验的，每个人每天有 120 分钟的免费体验时间，如果要获得更好的体验可以创建付费实例。</p><p>目前免费体验需要有这些规定：</p><p>尊敬的用户，您已经开通CloudIDE服务，免费体验需要遵守如下约定：</p><ul>  <li>每天的免费体验时间为120分钟，少于5分钟不能创建新的体验；</li>  <li>每个实例可使用时长为60分钟，60分钟后，实例将会被删除，并且数据将会被删除；</li>  <li>同一时间只能体验一个实例，打开第二个实例将会自动关闭第一个实例；</li>  <li>免费体验不能保证最佳使用体验，您可能需要排队等候，付费使用可以获得更好的体验</li></ul><p>完全没问题，体验完全足够了。</p><p>我这里操作的 URL 是 <a href="https://devcloud.cn-north-4.huaweicloud.com/cloudide/trial，大家可以注册个华为云账号就能看到对应的入口页面了，就是上文发的图。" target="_blank" rel="noopener">https://devcloud.cn-north-4.huaweicloud.com/cloudide/trial，大家可以注册个华为云账号就能看到对应的入口页面了，就是上文发的图。</a></p><p>由于我对 Python 比较熟悉，那么我就来体验一个 Python 环境吧，找到下方的 Python 环境，然后点击「免费体验」。</p><p>这时候环境就会变成「启动中」的状态，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/0egrr.png" alt="image-20201111010644754"></p><p>然后接下来我们就会进入到云 IDE 的环境，等待一顿初始化之后之后，我们就可以看到如下页面，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/r9k3g.png" alt="image-20201111010740454"></p><p>嗯？有没有熟悉的感觉？</p><p>没错，这和 VS Code 可太像了，简直就是一个在线版的 VS Code。不过仔细看看，其实还是有些不一样的，比如左上角的 Logo，插件仓库以及一些菜单选项。可以说是 VS Code 的魔改版。</p><p>我们看下左侧栏其他的菜单，搜索、版本控制、调试没啥好说的，看看插件仓库吧，打开之后是这样的：</p><p><img src="https://qiniu.cuiqingcai.com/zvatx.png" alt="image-20201111011151570"></p><p>这里我们可以看到「华为云CloudIDE」已经为我们预装了一些插件，如 Python。另外下方还有一些推荐的插件，例如 Huawei Cloud Toolkit，这些插件的安装方式和 VS Code 是一模一样的。</p><p>接下来我们再看看菜单的一些配置，随便挑几个看看吧：</p><p><img src="https://qiniu.cuiqingcai.com/mljvc.png" alt="image-20201111011434518"></p><p><img src="https://qiniu.cuiqingcai.com/ztzn9.png" alt="image-20201111011453092"></p><p>几乎所有功能菜单和 VS Code 是一样的，不过「华为云CloudIDE」添加了一些入口，比如 Close Instance 等等，点了之后就会关闭当前云 IDE 实例。</p><p>OK，接下来我们再回到代码看看，看看它给初始化了个什么，代码结构是这样的：</p><p><img src="https://qiniu.cuiqingcai.com/etn5w.png" alt="image-20201111011717465"></p><p>就是一个基本的 Flask 的 Hello World。</p><p>那来跑跑试试吧，点击右上角的运行按钮，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/3eogy.png" alt="image-20201111011824402"></p><p>哦，居然报错了，内容如下：</p><p><img src="https://qiniu.cuiqingcai.com/4ly2x.png" alt="image-20201111011856800"></p><p>这里报错说找不到 flask 这个包，那很明显就是没安装了，正好我们可以看到 requirements.txt 定义了相关的依赖环境，那我们来手动安装下吧。</p><p>在当前命令行下输入：</p><figure class="highlight cmake">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">pip3 <span class="keyword">install</span> -r requirements.txt</span><br></pre>      </td>    </tr>  </table></figure><p>运行结果类似如下：</p><p><img src="https://qiniu.cuiqingcai.com/75k2m.png" alt="image-20201111012030928"></p><p>看起来不错，另外可以观察到它是从 <a href="https://repo.huaweicloud.com/repository/pypi/" target="_blank" rel="noopener">https://repo.huaweicloud.com/repository/pypi/</a> 这里下载的 Python 包，速度也挺快的。简直是意外收获呢，又发现了一个不错的 Pypi 加速镜像。</p><p>顺便看看 pip.conf 配置吧：</p><figure class="highlight stata">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">cat</span> ~/.pip/pip.<span class="keyword">conf</span></span><br></pre>      </td>    </tr>  </table></figure><p>结果如下：</p><figure class="highlight pgsql">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line">[<span class="keyword">global</span>]</span><br><span class="line"><span class="keyword">index</span>-url = https://repo.huaweicloud.com/repository/pypi/simple</span><br><span class="line"><span class="keyword">trusted</span>-host = repo.huaweicloud.com</span><br><span class="line">timeout = <span class="number">120</span></span><br><span class="line">extra-<span class="keyword">index</span>-url = https://obs-workspace<span class="number">-20180810.</span>obs.cn-north<span class="number">-1.</span>myhuaweicloud.com/pypi/simple</span><br></pre>      </td>    </tr>  </table></figure><p>一目了然，可以看到 pip 全局配置了一个加速镜像，index-url 配置为了 <a href="https://repo.huaweicloud.com/repository/pypi/simple，这个是可以公开访问的，所以以后" target="_blank" rel="noopener">https://repo.huaweicloud.com/repository/pypi/simple，这个是可以公开访问的，所以以后</a></p><p>我们装包的时候就可以这么来装了：</p><figure class="highlight awk">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">pip3 install requests -i https:<span class="regexp">//</span>repo.huaweicloud.com<span class="regexp">/repository/</span>pypi<span class="regexp">/simple</span></span><br></pre>      </td>    </tr>  </table></figure><p>速度还是挺不错的，美滋滋，意外收获。</p><p>OK，切回正题，这时候我们已经装完环境了，重新运行 app.py，这时候就可以发现运行成功了，结果类似如下：</p><p><img src="https://qiniu.cuiqingcai.com/u2vph.png" alt="image-20201111012729299"></p><p>可以看到它就在 8080 端口上运行了一个服务，那咋访问呢？</p><p>在运行的同时，还弹出了这么一个窗口，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/w80pr.png" alt="image-20201111012846946"></p><p>似乎是提示我们可以注册一个外部端口将服务暴露出去，我们点击 Register 和 OK。</p><p>接下来 OK 按钮就变成了 Access 按钮，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/6qotw.png" alt="image-20201111013057453"></p><p>还带了一个二维码和 Copy 按钮，我们 Copy 一下看看，我 Copy 之后的 URL 是 <a href="https://sermgcaktl-8080-cce-5.lf.templink.dev/，然后我在浏览器中打开，显示如下：" target="_blank" rel="noopener">https://sermgcaktl-8080-cce-5.lf.templink.dev/，然后我在浏览器中打开，显示如下：</a></p><p><img src="https://qiniu.cuiqingcai.com/u1dd9.png" alt="image-20201111013157227"></p><p>很不错啊，这是自动给我们生成了一个域名，然后还把服务暴露出去可供访问了，挺好。</p><p>接下来我们再看看 Workspace 吧，切换下代码文件夹，点击 File - Open ，可以看到如下页面：</p><p><img src="https://qiniu.cuiqingcai.com/7mnj2.png" alt="image-20201111013747428"></p><p>可以看到当前打开的是 python3-sample 这个文件夹，那能换其他文件夹吗？我在上方输入个根目录 / 看看，结果如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/bp0jm.png" alt="image-20201111013852795"></p><p>出现了熟悉的 Linux 文件树结构，那可以断定这其实就是一个 Linux 环境了，那岂不是干啥事都行了。</p><p>找到 /home/user/projects 目录，看起来是用来专门存放项目的目录。</p><p>另外我再试试能否随便打开一个 GitHub 上的项目吧，比如在控制台进入刚才这个目录，然后 Clone 一个项目，命令如下：</p><figure class="highlight awk">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line">cd <span class="regexp">/home/u</span>ser<span class="regexp">/projects/</span></span><br><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/Python3WebSpider/</span>ScrapyTutorial.git</span><br></pre>      </td>    </tr>  </table></figure><p>OK，简单 Clone 了一个 Scrapy 项目，成功！如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/gcp5p.png" alt="image-20201111014223373"></p><p>然后打开下这个项目，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/iv7as.png" alt="image-20201111015026872"></p><p>打开 Terminal，安装下依赖：</p><figure class="highlight mipsasm">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">pip3 <span class="keyword">install </span><span class="keyword">scrapy </span>pymongo</span><br></pre>      </td>    </tr>  </table></figure><p>另外这个项目依赖于 MongoDB，不过我们这里仅仅测试，可以取消它的依赖，setting.py 中注释掉如下代码：</p><figure class="highlight diff">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    'tutorial.pipelines.TextPipeline': 300,</span><br><span class="line"><span class="deletion">-    'tutorial.pipelines.MongoDBPipeline': 400,</span></span><br><span class="line"><span class="addition">+    #'tutorial.pipelines.MongoDBPipeline': 400,</span></span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>然后接下来可以运行如下命令启动爬虫了：</p><figure class="highlight ebnf">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="attribute">scrapy crawl quotes</span></span><br></pre>      </td>    </tr>  </table></figure><p>这时候就可以看到爬虫就成功运行了，如图所示：</p><p><img src="https://qiniu.cuiqingcai.com/iwoga.png" alt="image-20201111015327574"></p><p>完美，Clone 的项目也成功运行了，美滋滋。</p><p>最后我们看看这个退出之后怎么样，先复制下当前的 URL，我的 URL 是 <a href="https://ide.devcloud.cn-north-4.huaweicloud.com/cce-5/sermgcaktl/#/home/user/projects/ScrapyTutorial，然后我们直接关掉当前页面选项卡，然后重新进入，看看现在的运行状态还在不在。" target="_blank" rel="noopener">https://ide.devcloud.cn-north-4.huaweicloud.com/cce-5/sermgcaktl/#/home/user/projects/ScrapyTutorial，然后我们直接关掉当前页面选项卡，然后重新进入，看看现在的运行状态还在不在。</a></p><p>牛逼！重新进入之后还是原来的样子，控制台依然还是开的，跑的结果也依然有！</p><p><img src="https://qiniu.cuiqingcai.com/bk9rc.png" alt="image-20201111015741812"></p><p>很好！</p><p>那这个环境怎么分享给别人呢？看了下「华为云CloudIDE」是支持分享功能的，这里可以进入到 CloudIDE 的首页，点击管理，然后通过白名单或者黑名单的方式添加用户就可以了。</p><p><img src="https://qiniu.cuiqingcai.com/uqi8m.png" alt="image-20201111020023870"></p><p>好了，到现在为止「华为云CloudIDE」就体验完了，感觉整体上还是挺不错的，大家也可以来体验试试看吧！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;前阵子有个朋友问我一个 Python 相关的问题，然后我把解决方案简单用代码写了一下发给他，结果他说跑不起来，我就很纳闷，确认了下他说 Python 库也都装了，但是运行的时候还是会报库找不到。果不其然，经过一段时间沟通发现，它的机器上装了两个 Python 环境，装 Py
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>Kubectl部署筹备</title>
    <link href="https://cuiqingcai.com/23184.html"/>
    <id>https://cuiqingcai.com/23184.html</id>
    <published>2020-11-01T17:28:24.000Z</published>
    <updated>2021-02-10T17:34:38.551Z</updated>
    
    <content type="html"><![CDATA[<h2 id="YAML文件概述"><a href="#YAML文件概述" class="headerlink" title="YAML文件概述"></a>YAML文件概述</h2><p>K8s集群文件中对资源管理和资源对象编排部署都可以通过声明样式<code>yaml</code>,文件来解决，也就是说可以把需要对资源对象操作编辑到<code>yaml</code>,文件中。</p><p>我们称之为<code>资源清单</code>或<code>资源清单文件</code>通过kubectl命令直接使用资源清单文件就可以实现对大量资源对象进行编排部署</p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><ul>  <li>大小写敏感</li>  <li>使用缩进表示层级关系，缩进不允许使用tab，只允许空格</li>  <li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>  <li>‘#’表示注释</li>  <li><code>---</code>表示新的yaml文件的开始<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3>YAML 支持以下几种数据类型：</li>  <li>对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）</li>  <li>数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li>  <li>纯量（scalars）：单个的、不可再分的值<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3>常量是最基本的，不可再分的值，包括：</li>  <li>字符串</li>  <li>布尔值</li>  <li>整数</li>  <li>浮点数</li>  <li>Null</li>  <li>时间</li>  <li>日期<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3>    <blockquote>      <p><strong>&amp;</strong> 锚点和 <strong>*</strong> 别名，可以用来引用:</p>      <p><strong>&amp;</strong> 用来建立锚点（defaults），<strong>&lt;&lt;</strong> 表示合并到当前数据，<strong>*</strong> 用来引用锚点。</p>      <figure class="highlight yaml">        <table>          <tr>            <td class="gutter">              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>            </td>            <td class="code">              <pre><span class="line"><span class="attr">defaults:</span> <span class="meta">&amp;defaults</span></span><br><span class="line">  <span class="attr">adapter:</span>  <span class="string">postgres</span></span><br><span class="line">  <span class="attr">host:</span>     <span class="string">localhost</span></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">myapp_development</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">myapp_test</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="string">---相当于</span></span><br><span class="line"><span class="attr">defaults:</span></span><br><span class="line">  <span class="attr">adapter:</span>  <span class="string">postgres</span></span><br><span class="line">  <span class="attr">host:</span>     <span class="string">localhost</span></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">myapp_development</span></span><br><span class="line">  <span class="attr">adapter:</span>  <span class="string">postgres</span></span><br><span class="line">  <span class="attr">host:</span>     <span class="string">localhost</span></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">myapp_test</span></span><br><span class="line">  <span class="attr">adapter:</span>  <span class="string">postgres</span></span><br><span class="line">  <span class="attr">host:</span>     <span class="string">localhost</span></span><br></pre>            </td>          </tr>        </table>      </figure>      <h2 id="kubernetes中yaml组成部分"><a href="#kubernetes中yaml组成部分" class="headerlink" title="kubernetes中yaml组成部分"></a>kubernetes中yaml组成部分</h2>      <figure class="highlight yaml">        <table>          <tr>            <td class="gutter">              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>            </td>            <td class="code">              <pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span><span class="comment"># API版本 可使用命令kubeclt api--verison查看</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span><span class="comment"># 资源类型 - 副本控制器RC</span></span><br><span class="line"><span class="attr">metadata:</span><span class="comment"># 资源元数据</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span><span class="comment"># - RC的名称(全局唯一)，符合目标的Pod拥有此标签</span></span><br><span class="line"><span class="attr">spec:</span><span class="comment"># 资源的规格(RC的相关属性的定义)</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span><span class="comment"># 副本的期望数量</span></span><br><span class="line">  <span class="attr">selector:</span><span class="comment"># 标签选择器</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"> <span class="comment"># *********************************************</span></span><br><span class="line">  <span class="attr">template:</span><span class="comment"># Pod 模版</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">labels:</span><span class="comment"># 标签Pod 副本拥有的标签，对应RC的Selector</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span><span class="comment"># Pod规格</span></span><br><span class="line">      <span class="attr">containers:</span><span class="comment"># 容器的配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql</span><span class="comment"># 容器名称</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mysql</span><span class="comment"># 容器镜像(对应的Docker images)</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3306</span><span class="comment"># 容器引用监听的端口号</span></span><br><span class="line">          <span class="attr">env:</span><span class="comment"># 环境配置</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">"123456"</span></span><br><span class="line">              </span><br><span class="line">              </span><br><span class="line">  <span class="string">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> <span class="comment">#  资源类型 服务</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">3306</span></span><br></pre>            </td>          </tr>        </table>      </figure>    </blockquote>  </li>  <li>控制器部分<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gka2eynwi4j30dw07ygm8.jpg" alt="控制器部分" style="zoom:139%;" /></li>  <li>被控制的对象<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gka2i29sqpj30j80e8ta8.jpg" alt="被控制的对象"></li>  <li>RC<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gka3668adhj31ap0u0jyb.jpg" alt="RC" style="zoom:45%;" />    <h2 id="快速编写yaml文件"><a href="#快速编写yaml文件" class="headerlink" title="快速编写yaml文件"></a>快速编写yaml文件</h2>    <h3 id="Part-1-使用命令生成yaml文件"><a href="#Part-1-使用命令生成yaml文件" class="headerlink" title="Part 1:使用命令生成yaml文件"></a>Part 1:使用命令生成yaml文件</h3>    <figure class="highlight sh">      <table>        <tr>          <td class="gutter">            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>          </td>          <td class="code">            <pre><span class="line"><span class="comment"># kubectl create </span></span><br><span class="line">kubectl create deployment web --image=nginx -o yaml --dry-run</span><br><span class="line"><span class="comment"># -o 使用yaml格式展示</span></span><br><span class="line"><span class="comment"># -dry-run 尝试运行，并不会真正运行</span></span><br><span class="line"><span class="comment"># 保存至myweb.yaml</span></span><br><span class="line">kubectl create deployment web --image=nginx -o yaml --dry-run &gt; myweb.yaml</span><br></pre>          </td>        </tr>      </table>    </figure>  </li>  <li>kubectl create deployment web —image=nginx -o yaml —dry-run运行效果如下⬇️:<br><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gka3obd2j7j31bo0ketgm.jpg" alt="kubectl create">    <h3 id="Part-2-使用命令导出yaml文件"><a href="#Part-2-使用命令导出yaml文件" class="headerlink" title="Part 2: 使用命令导出yaml文件"></a>Part 2: 使用命令导出yaml文件</h3>    <figure class="highlight sh">      <table>        <tr>          <td class="gutter">            <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>          </td>          <td class="code">            <pre><span class="line">kubectl get</span><br><span class="line">kubectl get deploy <span class="comment"># 查看部署</span></span><br><span class="line">kubectl get deploy nginx -o yaml --<span class="built_in">export</span> &gt; myweb.yaml</span><br></pre>          </td>        </tr>      </table>    </figure>  </li></ul><h2 id="kubectl命令学习"><a href="#kubectl命令学习" class="headerlink" title="kubectl命令学习"></a>kubectl命令学习</h2><p>这里简单记录下 Kubectl 部署的一些准备工作。</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Basic Commands (Beginner):</span><br><span class="line">  create         <span class="comment"># Create a resource from a file or from stdin.</span></span><br><span class="line">  expose         <span class="comment"># 使用 replication controller, service, deployment 或者 pod 并暴露它作为一个 新的</span></span><br><span class="line">Kubernetes Service</span><br><span class="line">  run            <span class="comment"># 在集群中运行一个指定的镜像</span></span><br><span class="line">  <span class="built_in">set</span>            <span class="comment"># 为 objects 设置一个指定的特征</span></span><br><span class="line"></span><br><span class="line">Basic Commands (Intermediate):</span><br><span class="line">  explain        <span class="comment"># 查看资源的文档</span></span><br><span class="line">  get            <span class="comment"># 显示一个或更多 resources</span></span><br><span class="line">  edit           <span class="comment"># 在服务器上编辑一个资源</span></span><br><span class="line">  delete         <span class="comment"># Delete resources by filenames, stdin, resources and names, or by resources and label selector</span></span><br><span class="line"></span><br><span class="line">Deploy Commands:</span><br><span class="line">  rollout        <span class="comment"># Manage the rollout of a resource</span></span><br><span class="line">  scale          <span class="comment"># 为 Deployment, ReplicaSet, Replication Controller 或者 Job 设置一个新的副本数量</span></span><br><span class="line">  autoscale      <span class="comment"># 自动调整一个 Deployment, ReplicaSet, 或者 ReplicationController 的副本数量</span></span><br><span class="line"></span><br><span class="line">Cluster Management Commands:</span><br><span class="line">  certificate    <span class="comment"># 修改 certificate 资源.</span></span><br><span class="line">  cluster-info   <span class="comment"># 显示集群信息</span></span><br><span class="line">  top            <span class="comment"># Display Resource (CPU/Memory/Storage) usage.</span></span><br><span class="line">  cordon         <span class="comment"># 标记 node 为 unschedulable</span></span><br><span class="line">  uncordon       <span class="comment"># 标记 node 为 schedulable</span></span><br><span class="line">  drain          <span class="comment"># Drain node in preparation for maintenance</span></span><br><span class="line">  taint          <span class="comment"># 更新一个或者多个 node 上的 taints</span></span><br><span class="line"></span><br><span class="line">Troubleshooting and Debugging Commands:</span><br><span class="line">  describe       <span class="comment"># 显示一个指定 resource 或者 group 的 resources 详情</span></span><br><span class="line">  logs           <span class="comment"># 输出容器在 pod 中的日志</span></span><br><span class="line">  attach         <span class="comment"># Attach 到一个运行中的 container</span></span><br><span class="line">  <span class="built_in">exec</span>           <span class="comment"># 在一个 container 中执行一个命令</span></span><br><span class="line">  port-forward   <span class="comment"># Forward one or more local ports to a pod</span></span><br><span class="line">  proxy          <span class="comment"># 运行一个 proxy 到 Kubernetes API server</span></span><br><span class="line">  cp             <span class="comment"># 复制 files 和 directories 到 containers 和从容器中复制 files 和 directories.</span></span><br><span class="line">  auth           <span class="comment"># Inspect authorization</span></span><br><span class="line"></span><br><span class="line">Advanced Commands:</span><br><span class="line">  diff           <span class="comment"># Diff live version against would-be applied version</span></span><br><span class="line">  apply          <span class="comment"># 通过文件名或标准输入流(stdin)对资源进行配置</span></span><br><span class="line">  patch          <span class="comment"># 使用 strategic merge patch 更新一个资源的 field(s)</span></span><br><span class="line">  replace        <span class="comment"># 通过 filename 或者 stdin替换一个资源</span></span><br><span class="line">  <span class="built_in">wait</span>           <span class="comment"># Experimental: Wait for a specific condition on one or many resources.</span></span><br><span class="line">  convert        <span class="comment"># 在不同的 API versions 转换配置文件</span></span><br><span class="line">  kustomize      <span class="comment"># Build a kustomization target from a directory or a remote url.</span></span><br><span class="line"></span><br><span class="line">Settings Commands:</span><br><span class="line">  label          <span class="comment"># 更新在这个资源上的 labels</span></span><br><span class="line">  annotate       <span class="comment"># 更新一个资源的注解</span></span><br><span class="line">  completion     <span class="comment"># Output shell completion code for the specified shell (bash or zsh)</span></span><br><span class="line"></span><br><span class="line">Other Commands:</span><br><span class="line">  api-resources  <span class="comment"># Print the supported API resources on the server</span></span><br><span class="line">  api-versions   <span class="comment"># Print the supported API versions on the server, in the form of "group/version"</span></span><br><span class="line">  config         <span class="comment"># 修改 kubeconfig 文件</span></span><br><span class="line">  plugin         <span class="comment"># Provides utilities for interacting with plugins.</span></span><br><span class="line">  version        <span class="comment"># 输出 client 和 server 的版本信息</span></span><br></pre>      </td>    </tr>  </table></figure><h2 id="Kubectl-create"><a href="#Kubectl-create" class="headerlink" title="Kubectl create"></a>Kubectl create</h2><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>      </td>      <td class="code">        <pre><span class="line">Create a resource from a file or from stdin.</span><br><span class="line"></span><br><span class="line"> JSON and YAML formats are accepted.</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">  <span class="comment"># Create a pod using the data in pod.json.</span></span><br><span class="line">  kubectl create -f ./pod.json</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Create a pod based on the JSON passed into stdin.</span></span><br><span class="line">  cat pod.json | kubectl create -f -</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Edit the data in docker-registry.yaml in JSON then create the resource using the edited data.</span></span><br><span class="line">  kubectl create -f docker-registry.yaml --edit -o json</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  clusterrole         <span class="comment"># Create a ClusterRole.</span></span><br><span class="line">  clusterrolebinding  <span class="comment"># 为一个指定的 ClusterRole 创建一个 ClusterRoleBinding</span></span><br><span class="line">  configmap           <span class="comment"># 从本地 file, directory 或者 literal value 创建一个 configmap</span></span><br><span class="line">  cronjob             <span class="comment"># Create a cronjob with the specified name.</span></span><br><span class="line">  deployment          <span class="comment"># 创建一个指定名称的 deployment.</span></span><br><span class="line">  job                 <span class="comment"># Create a job with the specified name.</span></span><br><span class="line">  namespace           <span class="comment"># 创建一个指定名称的 namespace</span></span><br><span class="line">  poddisruptionbudget <span class="comment"># 创建一个指定名称的 pod disruption budget.</span></span><br><span class="line">  priorityclass       <span class="comment"># Create a priorityclass with the specified name.</span></span><br><span class="line">  quota               <span class="comment"># 创建一个指定名称的 quota.</span></span><br><span class="line">  role                <span class="comment"># Create a role with single rule.</span></span><br><span class="line">  rolebinding         <span class="comment"># 为一个指定的 Role 或者 ClusterRole创建一个 RoleBinding</span></span><br><span class="line">  secret              <span class="comment"># 使用指定的 subcommand 创建一个 secret</span></span><br><span class="line">  service             <span class="comment"># 使用指定的 subcommand 创建一个 service.</span></span><br><span class="line">  serviceaccount      <span class="comment"># 创建一个指定名称的 service account</span></span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --allow-missing-template-keys=<span class="literal">true</span>: If <span class="literal">true</span>, ignore any errors <span class="keyword">in</span> templates when a field or map key is missing <span class="keyword">in</span> the template. Only applies to golang and jsonpath output formats.</span><br><span class="line">      --dry-run=<span class="literal">false</span>: If <span class="literal">true</span>, only <span class="built_in">print</span> the object that would be sent, without sending it.</span><br><span class="line">      --edit=<span class="literal">false</span>: Edit the API resource before creating</span><br><span class="line">  -f, --filename=[]: Filename, directory, or URL to files to use to create the resource</span><br><span class="line">  -k, --kustomize=<span class="string">''</span>: Process the kustomization directory. This flag can<span class="string">'t be used together with -f or -R.</span></span><br><span class="line"><span class="string">  -o, --output='</span><span class="string">': Output format. One of:</span></span><br><span class="line"><span class="string">json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-file.</span></span><br><span class="line"><span class="string">      --raw='</span><span class="string">': Raw URI to POST to the server.  Uses the transport specified by the kubeconfig file.</span></span><br><span class="line"><span class="string">      --record=false: Record current kubectl command in the resource annotation. If set to false, do not record the</span></span><br><span class="line"><span class="string">command. If set to true, record the command. If not set, default to updating the existing annotation value only if one</span></span><br><span class="line"><span class="string">already exists.</span></span><br><span class="line"><span class="string">  -R, --recursive=false: Process the directory used in -f, --filename recursively. Useful when you want to manage</span></span><br><span class="line"><span class="string">related manifests organized within the same directory.</span></span><br><span class="line"><span class="string">      --save-config=false: If true, the configuration of current object will be saved in its annotation. Otherwise, the</span></span><br><span class="line"><span class="string">annotation will be unchanged. This flag is useful when you want to perform kubectl apply on this object in the future.</span></span><br><span class="line"><span class="string">  -l, --selector='</span><span class="string">': Selector (label query) to filter on, supports '</span>=<span class="string">', '</span>==<span class="string">', and '</span>!=<span class="string">'.(e.g. -l key1=value1,key2=value2)</span></span><br><span class="line"><span class="string">      --template='</span><span class="string">': Template string or path to template file to use when -o=go-template, -o=go-template-file. The</span></span><br><span class="line"><span class="string">template format is golang templates [http://golang.org/pkg/text/template/#pkg-overview].</span></span><br><span class="line"><span class="string">      --validate=true: If true, use a schema to validate the input before sending it</span></span><br><span class="line"><span class="string">      --windows-line-endings=false: Only relevant if --edit=true. Defaults to the line ending native to your platform.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Usage:</span></span><br><span class="line"><span class="string">  kubectl create -f FILENAME [options]</span></span><br></pre>      </td>    </tr>  </table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;YAML文件概述&quot;&gt;&lt;a href=&quot;#YAML文件概述&quot; class=&quot;headerlink&quot; title=&quot;YAML文件概述&quot;&gt;&lt;/a&gt;YAML文件概述&lt;/h2&gt;
&lt;p&gt;K8s集群文件中对资源管理和资源对象编排部署都可以通过声明样式&lt;code&gt;yaml&lt;/co
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="kubernetes" scheme="https://cuiqingcai.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>Hexo构建时内存溢出 FatalProcessOutOfMemory 解决方案</title>
    <link href="https://cuiqingcai.com/23854.html"/>
    <id>https://cuiqingcai.com/23854.html</id>
    <published>2020-10-31T17:37:43.000Z</published>
    <updated>2021-02-10T17:34:38.645Z</updated>
    
    <content type="html"><![CDATA[<p>最近博客换上了 Hexo，但是发现经常莫名其妙构建失败，报内存溢出，Out of Memory，错误如下：</p><figure class="highlight angelscript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>      </td>      <td class="code">        <pre><span class="line">==== JS stack trace =========================================</span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>: ExitFrame [pc: <span class="number">0x1409219</span>]</span><br><span class="line">Security context: <span class="number">0x36ffd21408d1</span> &lt;JSObject&gt;</span><br><span class="line">    <span class="number">1</span>: <span class="keyword">get</span> sticky [<span class="number">0x36ffd2149801</span>](<span class="keyword">this</span>=<span class="number">0x1e69c6f730e1</span> &lt;JSRegExp &lt;String[<span class="number">10</span>]: [\t \n\r]+&gt;&gt;)</span><br><span class="line">    <span class="number">2</span>: match [<span class="number">0x6ca6396ae39</span>] [/github/workspace/node_modules/js-beautify/js/src/core/inputscanner.js:~<span class="number">110</span>] [pc=<span class="number">0x1d19a16be4dc</span>](<span class="keyword">this</span>=<span class="number">0x1e69c6f73119</span> &lt;InputScanner map = <span class="number">0x1c206a47a549</span>&gt;,<span class="number">0x1e69c6f730e1</span> &lt;JSRegExp &lt;String[<span class="number">10</span>]: [\t \n\r]+&gt;&gt;)</span><br><span class="line">    <span class="number">3</span>: tokenize [<span class="number">0x6ca6396e171</span>] [/gith...</span><br><span class="line"></span><br><span class="line"> <span class="number">1</span>: <span class="number">0xa17c40</span> node::Abort() [hexo]</span><br><span class="line"> <span class="number">2</span>: <span class="number">0xa1804c</span> node::OnFatalError(char <span class="keyword">const</span>*, char <span class="keyword">const</span>*) [hexo]</span><br><span class="line"> <span class="number">3</span>: <span class="number">0xb95a7e</span> v8::Utils::ReportOOMFailure(v8::<span class="built_in">int</span>ernal::Isolate*, char <span class="keyword">const</span>*, <span class="built_in">bool</span>) [hexo]</span><br><span class="line"> <span class="number">4</span>: <span class="number">0xb95df9</span> v8::<span class="built_in">int</span>ernal::V8::FatalProcessOutOfMemory(v8::<span class="built_in">int</span>ernal::Isolate*, char <span class="keyword">const</span>*, <span class="built_in">bool</span>) [hexo]</span><br><span class="line"> <span class="number">5</span>: <span class="number">0xd53075</span>  [hexo]</span><br><span class="line"> <span class="number">6</span>: <span class="number">0xd53706</span> v8::<span class="built_in">int</span>ernal::Heap::RecomputeLimits(v8::<span class="built_in">int</span>ernal::GarbageCollector) [hexo]</span><br><span class="line"> <span class="number">7</span>: <span class="number">0xd5ffc5</span> v8::<span class="built_in">int</span>ernal::Heap::PerformGarbageCollection(v8::<span class="built_in">int</span>ernal::GarbageCollector, v8::GCCallbackFlags) [hexo]</span><br><span class="line"> <span class="number">8</span>: <span class="number">0xd60e75</span> v8::<span class="built_in">int</span>ernal::Heap::CollectGarbage(v8::<span class="built_in">int</span>ernal::AllocationSpace, v8::<span class="built_in">int</span>ernal::GarbageCollectionReason, v8::GCCallbackFlags) [hexo]</span><br><span class="line"> <span class="number">9</span>: <span class="number">0xd6251f</span> v8::<span class="built_in">int</span>ernal::Heap::HandleGCRequest() [hexo]</span><br><span class="line"><span class="number">10</span>: <span class="number">0xd10f85</span> v8::<span class="built_in">int</span>ernal::StackGuard::HandleInterrupts() [hexo]</span><br><span class="line"><span class="number">11</span>: <span class="number">0x106c5c6</span> v8::<span class="built_in">int</span>ernal::Runtime_StackGuard(<span class="built_in">int</span>, unsigned long*, v8::<span class="built_in">int</span>ernal::Isolate*) [hexo]</span><br><span class="line"><span class="number">12</span>: <span class="number">0x1409219</span>  [hexo]</span><br></pre>      </td>    </tr>  </table></figure><p>原因就是内存溢出了，这是因为 Hexo 在构建的时候存了一个特别大的数组，而默认 Node 运行时最大内存为 512 MB，详情可以见：<a href="https://github.com/hexojs/hexo/issues/2165。" target="_blank" rel="noopener">https://github.com/hexojs/hexo/issues/2165。</a></p><p>真是服了，才几百篇文章就不行了，耗费内存至于这么多吗？</p><p>解决方案，可以直接设置 Node 的最大内存限制，比如我直接设置为 16G，在构建之前执行如下命令就行了：</p><figure class="highlight routeros">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">NODE_OPTIONS</span>=<span class="string">"--max-old-space-size=16384"</span></span><br></pre>      </td>    </tr>  </table></figure><p>这样就设置了 Node 运行时的最大内存，就不会触发内存溢出了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近博客换上了 Hexo，但是发现经常莫名其妙构建失败，报内存溢出，Out of Memory，错误如下：&lt;/p&gt;
&lt;figure class=&quot;highlight angelscript&quot;&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td class=&quot;gutt
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="Hexo" scheme="https://cuiqingcai.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Markdown如何实现代码增删对比效果</title>
    <link href="https://cuiqingcai.com/23853.html"/>
    <id>https://cuiqingcai.com/23853.html</id>
    <published>2020-10-31T16:05:48.000Z</published>
    <updated>2021-02-10T17:34:38.555Z</updated>
    
    <content type="html"><![CDATA[<p>在写文章的时候我经常会遇到这么一个需求，我想要跟大家说明某一行代码需要改动成另外一行代码。</p><p>比如我这里有一段代码：</p><figure class="highlight dockerfile">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.6</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/app/proxypool/crawlers/private"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"supervisord"</span>, <span class="string">"-c"</span>, <span class="string">"supervisord.conf"</span>]</span></span><br></pre>      </td>    </tr>  </table></figure><p>仅仅作为示例，这里行号我也没标，行数也有可能很多行，比如上百行。</p><p>比如我就想告诉大家，我想把：</p><figure class="highlight dockerfile">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span></span><br></pre>      </td>    </tr>  </table></figure><p>改成：</p><figure class="highlight stylus">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">RUN pip install -r requirements<span class="selector-class">.txt</span> -<span class="selector-tag">i</span> https:<span class="comment">//pypi.douban.com/simple</span></span><br></pre>      </td>    </tr>  </table></figure><p>这一行。</p><p>看，我已经说完了。</p><p>为了说这件事，我需要打好几行字，我得把原来的代码打上，然后说「改成」，然后再把新代码打上。</p><p>麻烦吧？</p><p>有没有什么更好的表述方式呢？</p><p>有。</p><p>看这里：</p><figure class="highlight diff">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="deletion">-RUN pip install -r requirements.txt</span></span><br><span class="line"><span class="addition">+RUN pip install -r requirements.txt -i https://pypi.douban.com/simple</span></span><br></pre>      </td>    </tr>  </table></figure><p>是不是很直观？</p><p>红色代表删减，绿色代表增加。</p><p>经常 Code Review 的朋友一定倍感亲切。</p><p>那这个怎么实现的呢？其实这就是用了 Markdown 高亮的一种写法，只需要把语言改成 diff 就好了。</p><p>原语言如下：</p><p><img src="https://qiniu.cuiqingcai.com/tpmmx.png" alt=""></p><p>这里为了防止 Markdown 解析冲突，我就用图片了。</p><p>反正就是语言标注改成 diff，然后需要删除的前面加个减号，需要增加的加个加号就行了。</p><p>完毕！</p><p>希望有帮助！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在写文章的时候我经常会遇到这么一个需求，我想要跟大家说明某一行代码需要改动成另外一行代码。&lt;/p&gt;
&lt;p&gt;比如我这里有一段代码：&lt;/p&gt;
&lt;figure class=&quot;highlight dockerfile&quot;&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td c
      
    
    </summary>
    
    
      <category term="Markdown" scheme="https://cuiqingcai.com/categories/Markdown/"/>
    
    
  </entry>
  
  <entry>
    <title>详解K8s安装及陷阱</title>
    <link href="https://cuiqingcai.com/23186.html"/>
    <id>https://cuiqingcai.com/23186.html</id>
    <published>2020-10-31T03:03:53.000Z</published>
    <updated>2021-02-10T17:34:38.710Z</updated>
    
    <content type="html"><![CDATA[<h1 id="kubernetes-install"><a href="#kubernetes-install" class="headerlink" title="kubernetes-install"></a>kubernetes-install</h1><h2 id="操作系统初始化"><a href="#操作系统初始化" class="headerlink" title="操作系统初始化"></a>操作系统初始化</h2><ul>  <li>关闭防火墙(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 临时关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 永久关闭防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment"># 验证 </span></span><br><span class="line">systemctl status firewalld</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>关闭selinux(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 永久</span></span><br><span class="line">sed -i <span class="string">'s/enforcing/disabled/'</span> /etc/selinux/config</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>关闭swap(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 临时</span></span><br><span class="line"> swapoff -a </span><br><span class="line"><span class="comment"># 永久</span></span><br><span class="line">sed  -ri <span class="string">'s/.*swap.*/#&amp;/'</span> /etc/fstab</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>设置主机名称(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 设置名称(k8s-m-1)忽略大写字母</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname k8s-m-1</span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">hostname</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>在<code>Master</code>添加Hostname(<code>master</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 设置</span></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">masterIp master</span><br><span class="line">node1Ip node1</span><br><span class="line">node2Ip node2</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># eg</span></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">192.168.50.212 k8s-m-1</span><br><span class="line">192.168.50.87 k8s-n-1</span><br><span class="line">192.168.50.85 k8s-n-2</span><br><span class="line">EOF</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>将桥接的IPV4 流量传递到iptables的链(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>      </td>      <td class="code">        <pre><span class="line">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line">sysctl --system</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>时间同步(<code>All</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line">yum install -y ntpdate </span><br><span class="line">ntpdate time.windows.com</span><br><span class="line"><span class="comment"># 三台机子输出如下则成功（相差几秒或几分为正常现象）</span></span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk829whexij31bo03awgc.jpg" alt=""></p><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener">官方文档-安装</a></p><ul>  <li>Docker安装sh Script:(<code>All</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># You can use scripts for one click installation，You may need to type enter at the end</span></span><br><span class="line"><span class="comment"># remove docker </span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"><span class="comment"># Set up repository</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"><span class="comment"># Use Aliyun Docker</span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># install docker from yum</span></span><br><span class="line">yum install  -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment"># restart docker</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># cat version </span></span><br><span class="line">docker --version</span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk826sq9qgj30pg032q44.jpg" alt=""></p><ul>  <li>配置加速(<code>all</code>)</li></ul><figure class="highlight sh">  <figcaption><span>j</span></figcaption>  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://etdea28s.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># reload</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查阿里云加速</span></span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk827vux9xj30p6074tb1.jpg" alt=""></p><h2 id="kubernetes安装"><a href="#kubernetes安装" class="headerlink" title="kubernetes安装"></a>kubernetes安装</h2><ul>  <li>配置kubernetes源(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>      </td>      <td class="code">        <pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre>      </td>    </tr>  </table></figure><p>由于官网kubernetes源在国外有墙，直接使用官方源会导致安装失败。所以我们配置国内的阿里源</p><ul>  <li>安装 kubectl kubelet kubeadm(<code>all</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># install kubectl kubelet kubeadm</span></span><br><span class="line">yum install -y kubectl kubelet kubeadm</span><br><span class="line"><span class="comment"># set boot on opening computer</span></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>初始化k8s部署(<code>Master</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>      </td>      <td class="code">        <pre><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=youselfIp of Master   \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line"><span class="comment"># 不冲突即可</span></span><br><span class="line">--service-cidr=10.10.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.122.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># eg  </span></span><br><span class="line">kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.50.212   \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--service-cidr=10.10.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.122.0.0/16</span><br></pre>      </td>    </tr>  </table></figure><blockquote>  <p>常见错误：running with swap on is not supported. Please disable swap</p>  <p>[preflight] If you know what you are doing, you can make a check non-fatal with `—ignore-preflight-</p>  <p>errors=…`</p>  <p>原因：系统自动进行分区</p>  <p>解决：</p>  <figure class="highlight sh">    <table>      <tr>        <td class="gutter">          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>        </td>        <td class="code">          <pre><span class="line"><span class="comment"># 临时</span></span><br><span class="line"> swapoff -a </span><br><span class="line"><span class="comment"># 永久</span></span><br><span class="line">sed  -ri <span class="string">'s/.*swap.*/#&amp;/'</span> /etc/fstab</span><br></pre>        </td>      </tr>    </table>  </figure></blockquote><ul>  <li>following as a regular user(<code>Master</code>)</li></ul><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre>      </td>    </tr>  </table></figure><ul>  <li>join master node(<code>node</code>)</li></ul><figure class="highlight angelscript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">kubeadm join <span class="number">172.16</span><span class="number">.164</span><span class="number">.136</span>:<span class="number">6443</span> --token <span class="number">9</span>oilao.bpbxcm5zkk0jjcgm --discovery-token-ca-cert-hash sha256:<span class="number">609794</span>bd03915be382bdb130c4c180e89cdc863d35cf99be79cf4ddcbfacee24</span><br></pre>      </td>    </tr>  </table></figure><p>加入成功，如下图</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk824r9yd8j31k40qmnga.jpg" alt=""></p><blockquote>  <p>此时我们在<code>Master</code>节点上使用命令<code>kubectl get nodes</code>查看节点信息：如下图所示</p>  <p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk82g07ydxj30p205ogod.jpg" alt=""></p></blockquote><p>此时的<code>kubectl get nodes</code>的status都是NotNotReady：</p><blockquote>  <p>查看kubernetes运行状态：</p>  <p><code>kubectl get pods -n kube-system</code></p>  <p>如图：</p>  <p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk82oxurldj311s0cqwm1.jpg" alt=""></p>  <p>果然，两个Pending犹豫未决</p></blockquote><p>此时我们部署CNI网络，配置如下</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 根据官方文档提示配置CNI网络</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="comment"># 报错：The connection to the server raw.githubusercontent.com was refused - did you specify the right host or port? 原因：外网不可访问 -&gt; 在https://www.ipaddress.com/查询raw.githubusercontent.com的真实IP。</span></span><br></pre>      </td>    </tr>  </table></figure><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line">sudo vi /etc/hosts</span><br><span class="line">199.232.28.133 raw.githubusercontent.com</span><br><span class="line"><span class="comment"># 如下</span></span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk82x5xdgwj31b2078djr.jpg" alt=""></p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 开启IPVS，修改ConfigMap的kube-system/kube-proxy中的模式为ipvs</span></span><br><span class="line"></span><br><span class="line">kubectl edit cm kube-proxy -n kube-system </span><br><span class="line"><span class="comment"># 将空的data -&gt; ipvs -&gt; mode中替换如下</span></span><br><span class="line">mode: <span class="string">"ipvs"</span></span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk82xypglpj30rg0eo431.jpg" alt=""></p><p>在此运行<code>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code>成功,如图</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk82zbkqlej31jq08sn3c.jpg" alt=""></p><p>此时运行<code>kubectl get nodes</code>效果图如下-&gt;成功。（肯能并不一定会立马成功，上面👆确定没问题，请稍等片刻即可）</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk831cnz4nj30p2064acr.jpg" alt=""></p><h2 id="测试kubernetes"><a href="#测试kubernetes" class="headerlink" title="测试kubernetes"></a>测试kubernetes</h2><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 创建nginx镜像 Create a deployment with the specified name</span></span><br><span class="line"><span class="comment"># kubectl create deployment NAME --image=image -- [COMMAND] [args...] [options]</span></span><br><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line"><span class="comment"># 对外暴露端口</span></span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line"><span class="comment"># 查看pod服务</span></span><br><span class="line">kubectl get pod,svc</span><br></pre>      </td>    </tr>  </table></figure><p>成功</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwgy1gk83ujg3d0j31oc0latef.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;kubernetes-install&quot;&gt;&lt;a href=&quot;#kubernetes-install&quot; class=&quot;headerlink&quot; title=&quot;kubernetes-install&quot;&gt;&lt;/a&gt;kubernetes-install&lt;/h1&gt;
&lt;h2 id=&quot;
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="K8s" scheme="https://cuiqingcai.com/tags/K8s/"/>
    
  </entry>
  
  <entry>
    <title>Vue生产环境如何还原debugger</title>
    <link href="https://cuiqingcai.com/23851.html"/>
    <id>https://cuiqingcai.com/23851.html</id>
    <published>2020-10-28T15:02:43.000Z</published>
    <updated>2021-02-10T17:34:38.595Z</updated>
    
    <content type="html"><![CDATA[<p>最近刚遇到个问题，我要给自己做的网站加个无限 debugger 反爬，网站是基于 Vue.js 开发的，比如我就想在 main.js 里面加这么一段：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'debugger'</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre>      </td>    </tr>  </table></figure><p>当时在 Debug 环境下一切好好的，但是到了 build 之后，再运行发现 debugger 就没了，这就神奇了。</p><p>我搜了很久，最后终于找到了解决方案，这里记录下。</p><h2 id="开发环境和生产环境"><a href="#开发环境和生产环境" class="headerlink" title="开发环境和生产环境"></a>开发环境和生产环境</h2><p>这里首先说下 Vue.js 是有开发环境和生产环境之分的，这里它用了一个关键词，叫做 mode。</p><p>我们先来看看两个常用的命令：</p><figure class="highlight dockerfile">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line">npm <span class="keyword">run</span><span class="bash"> serve</span></span><br><span class="line">npm <span class="keyword">run</span><span class="bash"> build</span></span><br></pre>      </td>    </tr>  </table></figure><p>这两个命令如果大家开发 Vue.js 的话一定不会陌生，但它们是怎么实现的呢？</p><p>顺着一找，其实他们定义在了 package.json 里面，是这样的：</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>      </td>      <td class="code">        <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="string">"private"</span>: true,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"serve"</span>: <span class="string">"vue-cli-service serve"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"vue-cli-service build"</span>,</span><br><span class="line">    <span class="string">"lint"</span>: <span class="string">"vue-cli-service lint"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里其实就是调用了 <code>vue-cli-service</code> 的几个命令而已。</p><p>那 <code>vue-cli-service</code> 又是哪里来的呢？很简单，在刚开始初始化项目的时候装了个 Vue CLI：</p><figure class="highlight coffeescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="built_in">npm</span> install -g @vue/cli</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">yarn <span class="built_in">global</span> add @vue/cli</span><br></pre>      </td>    </tr>  </table></figure><p>它提供了 <code>vue-cli-service</code> 这个命令。</p><p>然后我们再来详细看看这个 serve 和 build 命令。</p><h3 id="serve"><a href="#serve" class="headerlink" title="serve"></a>serve</h3><p>用法如下：</p><figure class="highlight">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="attribute">Usage</span>: vue-cli-service serve [options] [entry]</span><br><span class="line"></span><br><span class="line"><span class="attribute">Options:</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">  --open         open browser on server start</span><br><span class="line">  --copy         copy url to clipboard on server start</span><br><span class="line">  --mode         specify env mode (default: development)</span><br><span class="line">  --host         specify host (default: 0.0.0.0)</span><br><span class="line">  --port         specify port (default: 8080)</span><br><span class="line">  --https        use https (default: false)</span><br><span class="line">  --public       specify the public network URL for the HMR client</span><br><span class="line">  --skip-plugins comma-separated list of plugin names to skip for this run</span><br></pre>      </td>    </tr>  </table></figure><p>看到了吧，这里有个 mode，指的就是运行环境，这里默认为 development，即开发环境。</p><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>用法如下：</p><figure class="highlight">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="attribute">Usage</span>: vue-cli-service build [options] [entry|pattern]</span><br><span class="line"></span><br><span class="line"><span class="attribute">Options:</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">  --mode         specify env mode (default: production)</span><br><span class="line">  --dest         specify output directory (default: dist)</span><br><span class="line">  --modern       build app targeting modern browsers with auto fallback</span><br><span class="line">  --no-unsafe-inline build app without introducing inline scripts</span><br><span class="line">  --target       app | lib | wc | wc-async (default: app)</span><br><span class="line">  --formats      list of output formats for library builds (default: commonjs,umd,umd-min)</span><br><span class="line">  --inline-vue   include the Vue module in the final bundle of library or web component target</span><br><span class="line">  --name         name for lib or web-component mode (default: "name" in package.json or entry filename)</span><br><span class="line">  --filename     file name for output, only usable for 'lib' target (default: value of --name),</span><br><span class="line">  --no-clean     do not remove the dist directory before building the project</span><br><span class="line">  --report       generate report.html to help analyze bundle content</span><br><span class="line">  --report-json  generate report.json to help analyze bundle content</span><br><span class="line">  --skip-plugins comma-separated list of plugin names to skip for this run</span><br><span class="line">  --watch        watch for changes</span><br></pre>      </td>    </tr>  </table></figure><p>这里也有一个 mode，默认就是 production 了，即生产环境。</p><p>所以，到这里我们就明白了，调用 build 命令之后，实际上是生产环境了，然后生产环境可能做了一些特殊的配置，把一些 debugger 给去除了，所以就没了。</p><h2 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h2><p>那咋还原呢？</p><p>这里我们就需要用到 Vue.js 的另外一个知识了。</p><p>Vue.js 同样是基于 Webpack 构建的，利用了 Webpack 的打包技术，不过为了更加方便开发者配置，Vue.js 在 Webpack 的基础上又封装了一层，一些配置我们不需要再实现 webpack.config.js 了，而是可以实现 vue.config.js，配置更加简单。</p><p>在 vue.config.js 里面，它为 Webpack 暴露了几个重要的配置入口，一个就是 configureWebpack，一个是 chainWebpack。</p><p>具体的教程大家可以参考官方文档：<a href="https://cli.vuejs.org/zh/guide/webpack.html。" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/webpack.html。</a></p><p>比如前者可以这么配置：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> MyAwesomeWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>后者可以这么配置：</p><figure class="highlight javascript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    config.module</span><br><span class="line">      .rule(<span class="string">'vue'</span>)</span><br><span class="line">      .use(<span class="string">'vue-loader'</span>)</span><br><span class="line">        .loader(<span class="string">'vue-loader'</span>)</span><br><span class="line">        .tap(<span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> options</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里，我们如果要修改 Webpack 构建的一些配置的话，可以利用 chainWebpack。</p><h2 id="TerserPlugin"><a href="#TerserPlugin" class="headerlink" title="TerserPlugin"></a>TerserPlugin</h2><p>然后，这里又需要引入另外一个 Webpack 插件了，叫做 TerserPlugin，官方介绍链接为 <a href="https://webpack.js.org/plugins/terser-webpack-plugin/。" target="_blank" rel="noopener">https://webpack.js.org/plugins/terser-webpack-plugin/。</a></p><p>而这个库又是依赖 terser 的，官方介绍链接为 <a href="https://github.com/terser/terser。" target="_blank" rel="noopener">https://github.com/terser/terser。</a></p><p>官方介绍为：</p><blockquote>  <p>A JavaScript parser and mangler/compressor toolkit for ES6+.</p></blockquote><p>OK，反正就是类似一个 JavaScript 压缩转换器，比如它可以将一些 JavaScript 代码转码、混淆、压缩等等。</p><p>这里我们就需要借助于它来实现 debugger 的还原。</p><p>这里由于我使用的 Webpack 是 4.x 版本，所以 TerserPlugin 也需要是 4.x 版本，5.x 版本我测试过了不行。</p><p>安装配置如下，添加到 package.json 的 devDependencies 里面：</p><figure class="highlight 1c">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="string">"terser-webpack-plugin"</span>: <span class="string">"^4.2.3"</span>,</span><br></pre>      </td>    </tr>  </table></figure><p>然后：</p><figure class="highlight cmake">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br></pre>      </td>      <td class="code">        <pre><span class="line">npm <span class="keyword">install</span></span><br></pre>      </td>    </tr>  </table></figure><p>接着 vue.config.js 改写如下：</p><figure class="highlight python">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>      </td>      <td class="code">        <pre><span class="line">const TerserPlugin = require(<span class="string">'terser-webpack-plugin'</span>)</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  productionSourceMap: false,</span><br><span class="line">  chainWebpack: config =&gt; &#123;</span><br><span class="line">    config.optimization.minimizer([</span><br><span class="line">        new TerserPlugin(&#123;</span><br><span class="line">          terserOptions: &#123;</span><br><span class="line">            mangle: true,</span><br><span class="line">            compress: &#123;</span><br><span class="line">              drop_debugger: false</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>      </td>    </tr>  </table></figure><p>这里我就保留了 chainWebpack 的配置，然后这里面通过 config 的 optimization 的 minimizer 方法配置了 plugins，然后这里 TerserPlugin 需要声明一个 terserOptions，然后 compress 里面的 drop_debugger 需要设置为 false。</p><p>这样，生产环境的 debugger 语句就不会丢了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近刚遇到个问题，我要给自己做的网站加个无限 debugger 反爬，网站是基于 Vue.js 开发的，比如我就想在 main.js 里面加这么一段：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;
  &lt;table&gt;
    &lt;tr&gt;

      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
      <category term="前端" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue" scheme="https://cuiqingcai.com/tags/Vue/"/>
    
      <category term="Webpack" scheme="https://cuiqingcai.com/tags/Webpack/"/>
    
  </entry>
  
  <entry>
    <title>1024，其实我想聊一聊程序员的标签化</title>
    <link href="https://cuiqingcai.com/23850.html"/>
    <id>https://cuiqingcai.com/23850.html</id>
    <published>2020-10-24T13:37:43.000Z</published>
    <updated>2021-02-10T17:34:38.527Z</updated>
    
    <content type="html"><![CDATA[<p>2019 年，网红王尼玛做了一个五分钟的视频，是有关程序员的综艺节目《创造1024》，视频冲上热搜，被转发了几十万次，而这个视频，通篇是对程序员的刻板印象和标签化再加深。</p><p>视频里，程序员是这样子的：</p><p><img src="https://qiniu.cuiqingcai.com/p0j8w.png" alt=""></p><p>视频里面每个程序员都是标配的黑眼圈，更有甚者那个连续七天七夜不眠不休最后累倒的程序员被推崇为 C 位大佬。「没女朋友」、「宅男」、「呆板」、「理工男」、「格子衫」、「没头发」 等等这些标签。</p><p>我不是吐槽视频本身，通过这个视频，站在另外的角度去思考，这里面确实有很多让我感觉不那么舒服的地方。</p><ul>  <li>第一，把女性程序员排除在外；</li>  <li>第二，把整个行业的形象刻画的呆板、邋遢；</li>  <li>第三，为什么程序员就一定会被标签化为这样的形象；</li></ul><p>有的时候真的非常伤心，互联网时代真的来临了，程序员这个行业走上台前了。</p><p>然而走上台前的，不是曾经想用产品改变世界的梦想，而是秃头、加班、格子衫。</p><p>看到一些微博还有这样的：</p><p><img src="https://qiniu.cuiqingcai.com/vwqmd.png" alt=""></p><p>所以一直到现在，我都对格子衫有着非常深刻的生理性反感，我有条纹衬衫，也有花衬衫，但就是不喜欢格子衫，因为每当我去穿格子衫的时候，我就觉得我走进了公众预设定的无聊框架中。因此，每当女朋友陪我买衣服的时候，路过格子衫的区域，我一定不会去选。</p><p>嘿嘿没错，我还有女朋友，谁说程序员没有女朋友的？况且，我女朋友还那么好看。</p><p>哦哦跑题了，说回格子衫，我现在选择不穿格子衫，其实也是被框架捆绑的一部分，可我又能怎么办呢？</p><p>当然，logo卫衣还是很赞。</p><p>当然，在提到程序员这个行业的时候，最大也是最让我讨厌的刻板影响，叫程序员安慰师。</p><p>程序员安慰师这个所谓的行业和所谓的热搜热转出来的时候，是我觉得最荒谬的事情，到底是谁觉得我们的智商和情商，我们对工作的热情和严谨，是被女性带动的。每个男性都喜欢漂亮的女孩，这是原始的性，但在这之上，我们如此优秀完成工作的事情，是我们聪明的大脑（掐腰）。</p><p>最后我想说，我仍然能看到有非常多的调研报告，有越来越多的小姐姐开始在相亲中去倾向程序员这个行业。</p><p>但我想说，所谓高薪，所谓单纯，所谓不会出轨，都是外界给我们的一个个贴下的标签，而在这标签下，我们仍然是独立而特别的个体。希望你最后的选择是因为我这个人，而并不是那些无聊的刻板印象。</p><p>我们程序员并不一定是秃头、呆滞、毫无生活情趣的死肥宅，至少说很多都不是，我们也有可爱的一面，也有自己热爱的生活，喜欢的人，喜欢的事，请行业不要再这么标签化我们。</p><p>1024，我既不想接受格子衫与人体工学椅的安利，也不想接受任何《程序员图鉴》的调侃。我希望节日能让公司反思过高强度的加班，我希望节日能给更多的人传输目前程序届的开源思想，我希望节日能让人们回忆起，在疫情时候，有那么多个体的程序员不记薪资帮助做统计和维护框架，我希望节日能让更多人意识到我们每一个有灵魂的个体本身。</p><p>最后，整篇发言稿都是我的一家之言，是我的三观输出，可能会有很多朋友不习惯或者不开心。用程序码出世界，始终是我的理想。</p><p>无论如何，祝大家 1024 节日快乐！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;2019 年，网红王尼玛做了一个五分钟的视频，是有关程序员的综艺节目《创造1024》，视频冲上热搜，被转发了几十万次，而这个视频，通篇是对程序员的刻板印象和标签化再加深。&lt;/p&gt;
&lt;p&gt;视频里，程序员是这样子的：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://qiniu
      
    
    </summary>
    
    
      <category term="技术杂谈" scheme="https://cuiqingcai.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>使用Hexo编写博客</title>
    <link href="https://cuiqingcai.com/23185.html"/>
    <id>https://cuiqingcai.com/23185.html</id>
    <published>2020-10-17T16:18:25.000Z</published>
    <updated>2021-02-10T17:34:38.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用Hexo编写博客？"><a href="#使用Hexo编写博客？" class="headerlink" title="使用Hexo编写博客？"></a>使用Hexo编写博客？</h1><blockquote>  <p>亲爱的伙伴您好，很荣幸能与您在此相遇.</p>  <p>本文主要用于记录，在一台完全的“新”机子上，书写Hexo部署博客。</p>  <p>我已经迫不及待想告诉你的几个容易错误的点，你准备好了么？</p>  <p>Let’s Go</p>  <p>在此之前说明，很多东西都是来自网络，当然无论如何还是建议你查阅官方文档。</p></blockquote><p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">Hexo</a>官方文档</p><h2 id="Fisrt-环境准备"><a href="#Fisrt-环境准备" class="headerlink" title="Fisrt  环境准备"></a>Fisrt 环境准备</h2><ul>  <li>[ ] Git</li>  <li>[ ] <a href="http://nodejs.org/" target="_blank" rel="noopener">Node.js</a> (Node.js 版本需不低于 10.13，建议使用 Node.js 12.0 及以上版本)</li>  <li>[ ] Hexo</li></ul><h3 id="Git："><a href="#Git：" class="headerlink" title="Git："></a>Git：</h3><p>可以参考此文章 <a href="https://cuiqingcai.com/9336.html">https://cuiqingcai.com/9336.html</a></p><blockquote>  <p><strong>Mac 用户</strong></p>  <p>如果在编译时可能会遇到问题，请先到 App Store 安装 Xcode，Xcode 完成后，启动并进入 <strong>Preferences -&gt; Download -&gt; Command Line Tools -&gt; Install</strong> 安装命令行工具。</p></blockquote><h3 id="Node-JS"><a href="#Node-JS" class="headerlink" title="Node.JS:"></a>Node.JS:</h3><p>Node.js 为大多数平台提供了官方的 <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">安装程序</a>。对于中国大陆地区用户，可以前往 <a href="https://npm.taobao.org/mirrors/node" target="_blank" rel="noopener">淘宝 Node.js 镜像</a> 下载。</p><p>其它的安装方法：</p><ul>  <li>Windows：通过 <a href="https://github.com/jasongin/nvs/" target="_blank" rel="noopener">nvs</a>（推荐）或者<a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener">nvm</a> 安装。</li>  <li>Mac：使用 <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a> 或 <a href="http://www.macports.org/" target="_blank" rel="noopener">MacPorts</a> 安装。</li>  <li>Linux（DEB/RPM-based）：从 <a href="https://github.com/nodesource/distributions" target="_blank" rel="noopener">NodeSource</a> 安装。</li>  <li>其它：使用相应的软件包管理器进行安装，可以参考由 Node.js 提供的 <a href="https://nodejs.org/en/download/package-manager/" target="_blank" rel="noopener">指导</a></li></ul><h3 id="Hexo："><a href="#Hexo：" class="headerlink" title="Hexo："></a>Hexo：</h3><blockquote>  <p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p></blockquote><figure class="highlight plain">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"># 和我一样小白的可使用以下命令来安装</span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"># 对于熟悉 npm 的大牛，可以仅局部安装 hexo 包。</span><br><span class="line">npm install hexo</span><br></pre>      </td>    </tr>  </table></figure><h3 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h3><figure class="highlight applescript">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 注意请不要在项目中使用，可能会因为限制从而导致验证误差</span></span><br><span class="line">hexo <span class="built_in">version</span></span><br></pre>      </td>    </tr>  </table></figure><p>Look </p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjsryfevu8j30ks0bs41p.jpg" alt="Hexo Version"></p><h2 id="Second-写作"><a href="#Second-写作" class="headerlink" title="Second  写作"></a>Second 写作</h2><h3 id="新建"><a href="#新建" class="headerlink" title="新建"></a>新建</h3><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 创建一篇新文章或者新的页面</span></span><br><span class="line">hexo new [layout] &lt;title&gt;</span><br><span class="line"><span class="comment"># EG  注意双引号中的是博客标题，不需要加.md等后缀。</span></span><br><span class="line">hexo new <span class="string">"Your Title"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hexo new --help</span></span><br><span class="line">Usage: hexo new [layout] &lt;title&gt;</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">Create a new post.</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  layout  Post layout. Use post, page, draft or whatever you want.</span><br><span class="line">  title   Post title. Wrap it with quotations to escape.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --path     Post path. Customize the path of the post.</span><br><span class="line">  -r, --replace  Replace the current post <span class="keyword">if</span> existed.</span><br><span class="line">  -s, --slug     Post slug. Customize the URL of the post.</span><br></pre>      </td>    </tr>  </table></figure><blockquote>  <p>Hexo 有三种默认布局：<code>post</code>、<code>page</code> 和 <code>draft</code>。在创建者三种不同类型的文件时，它们将会被保存到不同的路径；而您自定义的其他布局和 <code>post</code> 相同，都将储存到 <code>source/_posts</code> 文件夹。</p>  <div class="table-container">    <table>      <thead>        <tr>          <th style="text-align:left">布局</th>          <th style="text-align:left">路径</th>        </tr>      </thead>      <tbody>        <tr>          <td style="text-align:left"><code>post</code></td>          <td style="text-align:left"><code>source/_posts</code></td>        </tr>        <tr>          <td style="text-align:left"><code>page</code></td>          <td style="text-align:left"><code>source</code></td>        </tr>        <tr>          <td style="text-align:left"><code>draft</code></td>          <td style="text-align:left"><code>source/_drafts</code></td>        </tr>      </tbody>    </table>  </div></blockquote><h3 id="文内设置"><a href="#文内设置" class="headerlink" title="文内设置"></a>文内设置</h3><p>用markdown等编辑器写博客，tags的写法如下：</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 注意冒号与方括号之间有一个空格，方括号中的标签用英文的”,”</span></span><br><span class="line">tags: [hexo,备忘录]</span><br></pre>      </td>    </tr>  </table></figure><h4 id="添加“阅读全文”按钮"><a href="#添加“阅读全文”按钮" class="headerlink" title="添加“阅读全文”按钮"></a><strong>添加“阅读全文”按钮</strong></h4><p>方法一：</p><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 在文章任意你想添加的位置添加</span></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"><span class="comment"># EG</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">title: How to use hexo to create blog?</span><br><span class="line">date: 2020-10-17 01:48:53</span><br><span class="line">author:Payne</span><br><span class="line">Mail:wuzhipeng1289690157@gamil.com</span><br><span class="line">tags:[Hexo]</span><br><span class="line">---</span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line">后面的内容在首页不显示，只显示到&lt;!--more--&gt;这里</span><br></pre>      </td>    </tr>  </table></figure><p>方法二：</p><figure class="highlight yaml">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 设置首页文章以摘要形式显示，打开主题配置文件，找到auto_excerpt进行修改</span></span><br><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">150</span></span><br></pre>      </td>    </tr>  </table></figure><blockquote>  <p>其中length代表显示摘要的截取字符长度。<br>注：这两种方法，在博客首页显示的效果不一样，根据自己的需要，选择自己喜欢的方法</p></blockquote><p>请开始您的表演😊</p><p>Show Time 。。。</p><h2 id="Third-自我查阅"><a href="#Third-自我查阅" class="headerlink" title="Third  自我查阅"></a>Third 自我查阅</h2><figure class="highlight vala">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="meta"># 构建 -&gt; 用于生成博客的html文件</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="meta"># 预览 -&gt; 用于在本地预览博客，打开浏览器，输入 localhost:4000/ 即可查看。</span></span><br><span class="line">hexo s</span><br><span class="line"><span class="meta"># 检查博客格式等符合要求后，用此命令将博客推送到远端。(需要是自己的才行)</span></span><br><span class="line">hexo d</span><br><span class="line"></span><br><span class="line"><span class="meta"># 实操</span></span><br><span class="line"><span class="meta"># 构建并查阅</span></span><br><span class="line">hexo g &amp;&amp; hexo s</span><br><span class="line"><span class="meta"># 推送（记得清除缓存！！！）</span></span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre>      </td>    </tr>  </table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjsrwob2sgj31280u0e59.jpg" alt="images"></p><h2 id="Fourth-发布"><a href="#Fourth-发布" class="headerlink" title="Fourth 发布"></a>Fourth 发布</h2><figure class="highlight sh">  <table>    <tr>      <td class="gutter">        <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>      </td>      <td class="code">        <pre><span class="line"><span class="comment"># 详细流程如下</span></span><br><span class="line">首先<span class="built_in">clone</span>下来然后，创建分支</span><br><span class="line">git <span class="built_in">clone</span> <span class="string">"目标地址"</span></span><br><span class="line">git checkout -b branch_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编写博客</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建并查阅</span></span><br><span class="line">hexo g &amp;&amp; hexo s</span><br><span class="line"><span class="comment"># 推送（记得清除缓存！！！）</span></span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre>      </td>    </tr>  </table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;使用Hexo编写博客？&quot;&gt;&lt;a href=&quot;#使用Hexo编写博客？&quot; class=&quot;headerlink&quot; title=&quot;使用Hexo编写博客？&quot;&gt;&lt;/a&gt;使用Hexo编写博客？&lt;/h1&gt;
&lt;blockquote&gt;
  &lt;p&gt;亲爱的伙伴您好，很荣幸能与您在此相遇
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
